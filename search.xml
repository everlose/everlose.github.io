<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>散列表(哈希表)的实现</title>
    <url>/2019/11/09/alorigam/hash-js/</url>
    <content><![CDATA[<h2 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h2><p>在真实世界中，我们描述一个事物最常用的方式是使用属性-值（key-value）这样的键值对数据，面向对象编程中对象的定义和js中的对象都是这种模式。比如我们描述一个人是这样的：</p>
<p><img src="http://note.youdao.com/yws/res/16157/C4787981899847E4A1F742927AD7D3DD" alt="image"></p>
<h3 id="那在计算机中怎么保存这样的数据呢？"><a href="#那在计算机中怎么保存这样的数据呢？" class="headerlink" title="那在计算机中怎么保存这样的数据呢？"></a>那在计算机中怎么保存这样的数据呢？</h3><p>开数组存储，并把键名和数组下标按一定程度联系起来，以用特定的码表（如ASCII）进行转换。变换下面这样</p>
<p><img src="http://note.youdao.com/yws/res/16170/F9F56E8A0D5E4CE18DDB60DA27257614" alt="image"></p>
<p>若依照上图，开一个10010长度的数组，全部容纳此对象，则就可以实现查找一遍得出值的目的。</p>
<p>但由于键名长度不一，所以转换后的下标的值也相差巨大，个数不确定，也就意味着下标的个数也有很大的范围，甚至无穷多，就有了下面的问题：</p>
<ul>
<li>怎么将一组值相差范围巨大，个数波动范围很大的下标放入特定的数组空间呢？</li>
<li>如何处理下标冲突呢？</li>
</ul>
<h3 id="怎么将一组值相差范围巨大，个数波动范围很大的下标放入特定的数组空间呢？"><a href="#怎么将一组值相差范围巨大，个数波动范围很大的下标放入特定的数组空间呢？" class="headerlink" title="怎么将一组值相差范围巨大，个数波动范围很大的下标放入特定的数组空间呢？"></a>怎么将一组值相差范围巨大，个数波动范围很大的下标放入特定的数组空间呢？</h3><p>若直接取键名的所有字母 Ascii 码来构建数组长度，则是一个极大的浪费，必须针对此数据进行处理，有三种方式</p>
<p>1，除法散列法。</p>
<p>最直观的一种，公式：index = key % 16。这样取得的下标参见下面的图</p>
<p><img src="http://note.youdao.com/yws/res/16201/D225FE8428D24DDC86049D574C9D35FF" alt="image"></p>
<p>2，平方散列法。</p>
<p>因为乘法的运算要比除法来得省时，所以我们考虑把除法换成乘法和一个位移操作。公式：index = (key * key) &gt;&gt; 28。</p>
<p>如果数值分配比较均匀的话这种方法能得到不错的结果，另外key如果很大，key * key会发生溢出。但我们这个乘法不关心溢出，因为我们根本不是为了获取相乘结果，而是为了获取index。</p>
<p>3，斐波那契（Fibonacci）散列法</p>
<p>平方散列法的缺点是显而易见的，所以我们能不能找出一个理想的乘数，而不是拿value本身当作乘数呢？答案是肯定的。</p>
<p>对于16位整数而言，这个乘数是40503，对于32位整数（JS中的Number是64位的，但在位操作时，会转化为32位整数处理，最后结果再转化位64位浮点数）而言，这个乘数是2654435769，对于64位整数而言，这个乘数是11400714819323198485</p>
<p>这几个“理想乘数”是如何得出来的呢？这跟一个法则有关，叫黄金分割法则，而描述黄金分割法则的最经典表达式无疑就是著名的斐波那契数列，即如此形式的序列：0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144,233, 377, 610， 987, 1597, 2584, 4181, 6765, 10946，…。</p>
<p>对我们常见的32位整数而言，公式(&gt;&gt;&gt;是JS的无符号右移操作，得到的都是整数)：index = (key* 2654435769) &gt;&gt;&gt; 28。32位移动28位，剩下只有4位，数值也就在0～15之间。</p>
<h3 id="如何处理冲突的下标"><a href="#如何处理冲突的下标" class="headerlink" title="如何处理冲突的下标"></a>如何处理冲突的下标</h3><p>还是上面这个例子，29和69发生了冲突，但是我们可以将他们组成一个链表，链表的头部放在数组中，得到。链表结构中，每个元素（除单向链表的尾部）都包含了相连元素的内存地址和本身的值，上文中的冲突放入一个链表中，可以得到这样的结构：</p>
<p><img src="http://note.youdao.com/yws/res/16207/8D1F626E65BE407B84413287BE6D2B4D" alt="image"></p>
<p>最终得到的这个数据结构，也就是我们常说哈希表了。这种将数组与链表结合生成哈希表的方法，叫拉链法。</p>
<p>此外还有其他策略如下</p>
<p>1）拉链法变种。由于链表的查找需要遍历，如果我们将链表换成树或者哈希表结构，那么就能大幅提高冲突元素的查找效率。不过这样做则会加大哈希表构造的复杂度，也就是构建哈希表时的效率会变差。</p>
<p>2）开放寻址： 当关键字key的哈希地址p=H（key）出现冲突时，以p为基础，产生另一个哈希地址p1，如果p1仍然冲突，再以p为基础，产生另一个哈希地址p2，…，直到找出一个不冲突的哈希地址pi，将相应元素存入其中。这种方法有一个通用的函数形式：</p>
<p>Hi=（H（key）+di）% m i=1，2，…，n</p>
<p>根据di的不同，又可以分为线性的、平方的、随机数之类的。。。这里不再展开。</p>
<p>开发寻址的好处是存储空间更加紧凑，利用率高。但是这种方式让冲突元素之间产生了联系，在删除元素的时候，不能直接删除，否则就打乱了冲突元素的寻址链。</p>
<p>3）再哈希法</p>
<p>这种方法会预先定义一组哈希算法，发生冲突的时候，调用下一个哈希算法计算一直计算到不发生冲突的时候则插入元素，这种方法跟开放寻址的方法优缺点类似。函数表达式：</p>
<p>index=Hi（key） , i=1，2，…，n</p>
<h2 id="哈希表数据的查找"><a href="#哈希表数据的查找" class="headerlink" title="哈希表数据的查找"></a>哈希表数据的查找</h2><p>比如想知道小明的name属性，即小明.name。流程是这样的：</p>
<ol>
<li>根据字符映射关系(若使用简单除法散列)得到映射值为69</li>
<li>使用哈希算法得到下标 index=hash(69)=9</li>
<li>遍历数组中下标为9的链表，链表的第一个元素的key刚好就是我们要找的name，所以返回value值小明</li>
</ol>
<p>哈希表中增删一个元素并不会影响到其他的元素，不像数组一样需要改变后面所有的元素下标。在拉链式的哈希表中，属性的增删就是链表的增删，非常方便。而在纯数组形式的哈希表中，对属性的删并不是真的删除，而是做一个空标志而已，所以不影响其他元素。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 链表</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">LinkedList</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> Node = <span class="function"><span class="keyword">function</span>(<span class="params">element</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.element = element;</span><br><span class="line">        <span class="keyword">this</span>.next = <span class="literal">null</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> length = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> head = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.append = <span class="function"><span class="keyword">function</span>(<span class="params">element</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> node = <span class="keyword">new</span> Node(element),</span><br><span class="line">            current;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (head === <span class="literal">null</span>)&#123; <span class="comment">//first node on list</span></span><br><span class="line">            head = node;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">            current = head;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//loop the list until find last item</span></span><br><span class="line">            <span class="keyword">while</span>(current.next)&#123;</span><br><span class="line">                current = current.next;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//get last item and assign next to added item to make the link</span></span><br><span class="line">            current.next = node;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        length++; <span class="comment">//update size of list</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.insert = <span class="function"><span class="keyword">function</span>(<span class="params">position, element</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//check for out-of-bounds values</span></span><br><span class="line">        <span class="keyword">if</span> (position &gt;= <span class="number">0</span> &amp;&amp; position &lt;= length)&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> node = <span class="keyword">new</span> Node(element),</span><br><span class="line">                current = head,</span><br><span class="line">                previous,</span><br><span class="line">                index = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (position === <span class="number">0</span>)&#123; <span class="comment">//add on first position</span></span><br><span class="line"></span><br><span class="line">                node.next = current;</span><br><span class="line">                head = node;</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">while</span> (index++ <span class="xml"><span class="tag">&lt; <span class="attr">position</span>)&#123;</span></span></span><br><span class="line"><span class="xml">                    previous = current;</span></span><br><span class="line"><span class="xml">                    current = current.next;</span></span><br><span class="line"><span class="xml">                &#125;</span></span><br><span class="line"><span class="xml">                node.next = current;</span></span><br><span class="line"><span class="xml">                previous.next = node;</span></span><br><span class="line"><span class="xml">            &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">            length++; //update size of list</span></span><br><span class="line"></span><br><span class="line"><span class="xml">            return true;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">        &#125; else &#123;</span></span><br><span class="line"><span class="xml">            return false;</span></span><br><span class="line"><span class="xml">        &#125;</span></span><br><span class="line"><span class="xml">    &#125;;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    this.removeAt = function(position)&#123;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">        //check for out-of-bounds values</span></span><br><span class="line"><span class="xml">        if (position &gt; -1 &amp;&amp; position <span class="tag">&lt; <span class="attr">length</span>)&#123;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">            var current = head,</span></span><br><span class="line"><span class="xml">                previous,</span></span><br><span class="line"><span class="xml">                index = 0;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">            //removing first item</span></span><br><span class="line"><span class="xml">            if (position === 0)&#123;</span></span><br><span class="line"><span class="xml">                head = current.next;</span></span><br><span class="line"><span class="xml">            &#125; else &#123;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">                while (index++ <span class="tag">&lt; <span class="attr">position</span>)&#123;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">                    previous = current;</span></span><br><span class="line"><span class="xml">                    current = current.next;</span></span><br><span class="line"><span class="xml">                &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">                //link previous with current's next - skip it to remove</span></span><br><span class="line"><span class="xml">                previous.next = current.next;</span></span><br><span class="line"><span class="xml">            &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">            length--;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">            return current.element;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">        &#125; else &#123;</span></span><br><span class="line"><span class="xml">            return null;</span></span><br><span class="line"><span class="xml">        &#125;</span></span><br><span class="line"><span class="xml">    &#125;;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    this.remove = function(element)&#123;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">        var index = this.indexOf(element);</span></span><br><span class="line"><span class="xml">        return this.removeAt(index);</span></span><br><span class="line"><span class="xml">    &#125;;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    this.indexOf = function(element)&#123;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">        var current = head,</span></span><br><span class="line"><span class="xml">            index = 0;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">        while (current) &#123;</span></span><br><span class="line"><span class="xml">            if (element === current.element) &#123;</span></span><br><span class="line"><span class="xml">                return index;</span></span><br><span class="line"><span class="xml">            &#125;</span></span><br><span class="line"><span class="xml">            index++;</span></span><br><span class="line"><span class="xml">            current = current.next;</span></span><br><span class="line"><span class="xml">        &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">        return -1;</span></span><br><span class="line"><span class="xml">    &#125;;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    this.isEmpty = function() &#123;</span></span><br><span class="line"><span class="xml">        return length === 0;</span></span><br><span class="line"><span class="xml">    &#125;;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    this.size = function() &#123;</span></span><br><span class="line"><span class="xml">        return length;</span></span><br><span class="line"><span class="xml">    &#125;;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    this.getHead = function()&#123;</span></span><br><span class="line"><span class="xml">        return head;</span></span><br><span class="line"><span class="xml">    &#125;;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    this.toString = function()&#123;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">        var current = head,</span></span><br><span class="line"><span class="xml">            string = '';</span></span><br><span class="line"></span><br><span class="line"><span class="xml">        while (current) &#123;</span></span><br><span class="line"><span class="xml">            string = current.element;</span></span><br><span class="line"><span class="xml">            current = current.next;</span></span><br><span class="line"><span class="xml">        &#125;</span></span><br><span class="line"><span class="xml">        return string;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    &#125;;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    this.print = function()&#123;</span></span><br><span class="line"><span class="xml">        console.log(this.toString());</span></span><br><span class="line"><span class="xml">    &#125;;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">// hash map的实现</span></span><br><span class="line"><span class="xml">function HashTableSeparateChaining()&#123;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    var table = [];</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    var ValuePair = function(key, value)&#123;</span></span><br><span class="line"><span class="xml">        this.key = key;</span></span><br><span class="line"><span class="xml">        this.value = value;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">        this.toString = function() &#123;</span></span><br><span class="line"><span class="xml">            return '[' + this.key + ' - ' + this.value + ']';</span></span><br><span class="line"><span class="xml">        &#125;</span></span><br><span class="line"><span class="xml">    &#125;;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    // 散列函数-除法散列法，运算效率低，不够均匀分布。</span></span><br><span class="line"><span class="xml">    var getHashByDivision = function (key) &#123;</span></span><br><span class="line"><span class="xml">        var hash = 0;</span></span><br><span class="line"><span class="xml">        for (var i = 0; i <span class="tag">&lt; <span class="attr">key.length</span>; <span class="attr">i</span>++) &#123;</span></span></span><br><span class="line"><span class="xml">            hash += key.charCodeAt(i);</span></span><br><span class="line"><span class="xml">        &#125;</span></span><br><span class="line"><span class="xml">        return hash % 16;</span></span><br><span class="line"><span class="xml">    &#125;;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    // 散列函数-平方散列法，乘法运算效率稍微高，但还是不够均匀分布。</span></span><br><span class="line"><span class="xml">    var getHashBySquare = function (key) &#123;</span></span><br><span class="line"><span class="xml">        var hash = 0;</span></span><br><span class="line"><span class="xml">        for (var i = 0; i <span class="tag">&lt; <span class="attr">key.length</span>; <span class="attr">i</span>++) &#123;</span></span></span><br><span class="line"><span class="xml">            hash += key.charCodeAt(i);</span></span><br><span class="line"><span class="xml">        &#125;</span></span><br><span class="line"><span class="xml">        return (hash * hash) &gt;&gt;&gt; 28;</span></span><br><span class="line"><span class="xml">    &#125;;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    // 散列函数-斐波那契（Fibonacci）散列法</span></span><br><span class="line"><span class="xml">    // 位操作时将会转换32位整数，再无符号右移28，结果只有4位，范围在0～15间</span></span><br><span class="line"><span class="xml">    var getHashBySquare = function (key) &#123;</span></span><br><span class="line"><span class="xml">        var hash = 0;</span></span><br><span class="line"><span class="xml">        for (var i = 0; i <span class="tag">&lt; <span class="attr">key.length</span>; <span class="attr">i</span>++) &#123;</span></span></span><br><span class="line"><span class="xml">            hash += key.charCodeAt(i);</span></span><br><span class="line"><span class="xml">        &#125;</span></span><br><span class="line"><span class="xml">        return (hash * 2654435769) &gt;&gt;&gt; 28;</span></span><br><span class="line"><span class="xml">    &#125;;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    var hashCode = function(key)&#123;</span></span><br><span class="line"><span class="xml">        return getHashBySquare(key);</span></span><br><span class="line"><span class="xml">    &#125;;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    // 拉链法，计算code得到重复position时，建立一个链表存放</span></span><br><span class="line"><span class="xml">    // 此实现仍有 bug，比如说无法更改 key-value 中的 value，因为只会在链表中append</span></span><br><span class="line"><span class="xml">    this.put = function(key, value)&#123;</span></span><br><span class="line"><span class="xml">        var position = hashCode(key);</span></span><br><span class="line"><span class="xml">        console.log(position + ' - ' + key);</span></span><br><span class="line"></span><br><span class="line"><span class="xml">        if (table[position] == undefined) &#123;</span></span><br><span class="line"><span class="xml">            table[position] = new LinkedList();</span></span><br><span class="line"><span class="xml">        &#125;</span></span><br><span class="line"><span class="xml">        table[position].append(new ValuePair(key, value));</span></span><br><span class="line"><span class="xml">    &#125;;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    this.get = function(key) &#123;</span></span><br><span class="line"><span class="xml">        var position = hashCode(key);</span></span><br><span class="line"></span><br><span class="line"><span class="xml">        if (table[position] !== undefined  &amp;&amp; !table[position].isEmpty())&#123;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">            //iterate linked list to find key/value</span></span><br><span class="line"><span class="xml">            var current = table[position].getHead();</span></span><br><span class="line"></span><br><span class="line"><span class="xml">            while(current.next)&#123;</span></span><br><span class="line"><span class="xml">                if (current.element.key === key)&#123;</span></span><br><span class="line"><span class="xml">                    return current.element.value;</span></span><br><span class="line"><span class="xml">                &#125;</span></span><br><span class="line"><span class="xml">                current = current.next;</span></span><br><span class="line"><span class="xml">            &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">            //check in case first or last element</span></span><br><span class="line"><span class="xml">            if (current.element.key === key)&#123;</span></span><br><span class="line"><span class="xml">                return current.element.value;</span></span><br><span class="line"><span class="xml">            &#125;</span></span><br><span class="line"><span class="xml">        &#125;</span></span><br><span class="line"><span class="xml">        return undefined;</span></span><br><span class="line"><span class="xml">    &#125;;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    this.remove = function(key)&#123;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">        var position = hashCode(key);</span></span><br><span class="line"></span><br><span class="line"><span class="xml">        if (table[position] !== undefined)&#123;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">            //iterate linked list to find key/value</span></span><br><span class="line"><span class="xml">            var current = table[position].getHead();</span></span><br><span class="line"></span><br><span class="line"><span class="xml">            while(current.next)&#123;</span></span><br><span class="line"><span class="xml">                if (current.element.key === key)&#123;</span></span><br><span class="line"><span class="xml">                    table[position].remove(current.element);</span></span><br><span class="line"><span class="xml">                    if (table[position].isEmpty())&#123;</span></span><br><span class="line"><span class="xml">                        table[position] = undefined;</span></span><br><span class="line"><span class="xml">                    &#125;</span></span><br><span class="line"><span class="xml">                    return true;</span></span><br><span class="line"><span class="xml">                &#125;</span></span><br><span class="line"><span class="xml">                current = current.next;</span></span><br><span class="line"><span class="xml">            &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">            //check in case first or last element</span></span><br><span class="line"><span class="xml">            if (current.element.key === key)&#123;</span></span><br><span class="line"><span class="xml">                table[position].remove(current.element);</span></span><br><span class="line"><span class="xml">                if (table[position].isEmpty())&#123;</span></span><br><span class="line"><span class="xml">                    table[position] = undefined;</span></span><br><span class="line"><span class="xml">                &#125;</span></span><br><span class="line"><span class="xml">                return true;</span></span><br><span class="line"><span class="xml">            &#125;</span></span><br><span class="line"><span class="xml">        &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">        return false;</span></span><br><span class="line"><span class="xml">    &#125;;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    this.print = function() &#123;</span></span><br><span class="line"><span class="xml">        for (var i = 0; i <span class="tag">&lt; <span class="attr">table.length</span>; ++<span class="attr">i</span>) &#123;</span></span></span><br><span class="line"><span class="xml">            if (table[i] !== undefined) &#123;</span></span><br><span class="line"><span class="xml">               console.log(table[i].toString());</span></span><br><span class="line"><span class="xml">            &#125;</span></span><br><span class="line"><span class="xml">        &#125;</span></span><br><span class="line"><span class="xml">    &#125;;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>alorigam</category>
      </categories>
  </entry>
  <entry>
    <title>模式匹配算法DFA与敏感词识别</title>
    <url>/2019/11/08/alorigam/dfa/</url>
    <content><![CDATA[<p>DFA（Deterministic Finite Automaton,即确定有穷自动机。其原理为：有一个有限状态集合和一些从一个状态通向另一个状态的边，每条边上标记有一个符号，其中一个状态是初态，某些状态是终态。但不同于不确定的有限自动机，DFA中不会有从同一状态出发的两条边标志有相同的符号。</p>
<p>举例有限状态机字典如下</p>
<img  src=http://www.plantuml.com/plantuml/svg/qtZUrwsfe6kdeF6qTRKc5vW4Sr_CxaRcFjyt1SW5aH35QoTe0W00>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &apos;王&apos;: &#123;</span><br><span class="line">    &apos;八&apos;: &#123;</span><br><span class="line">      &apos;蛋&apos;: &#123;</span><br><span class="line">        empty: true</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &apos;羔&apos;: &#123;</span><br><span class="line">      &apos;子&apos;: &#123;</span><br><span class="line">        empty: true</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输入为王八端时，逐字对比有限状态机的字典</p>
<ol>
<li>王字命中</li>
<li>八字命中</li>
<li>端没有命中，则返回八字继续开始匹配</li>
<li>八字没有命中有限状态机，over</li>
</ol>
<p>输入为王八蛋时</p>
<ol>
<li>王字命中</li>
<li>八字命中</li>
<li>蛋命中</li>
<li>下一个 empty 为 true 命中，匹配成功。</li>
</ol>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>找出敏感词代码</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 特殊符号过滤逻辑</span></span><br><span class="line"><span class="keyword">const</span> ignoreChars = <span class="string">" \t\r\n~!@#$%^&amp;*()_+-=【】、&#123;&#125;|;':\"，。、《》？αβγδεζηθικλμνξοπρστυφχψωΑΒΓΔΕΖΗΘΙΚΛΜΝΞΟΠΡΣΤΥΦΧΨΩ。，、；：？！…—·ˉ¨‘’“”々～‖∶＂＇｀｜〃〔〕〈〉《》「」『』．〖〗【】（）［］｛｝ⅠⅡⅢⅣⅤⅥⅦⅧⅨⅩⅪⅫ⒈⒉⒊⒋⒌⒍⒎⒏⒐⒑⒒⒓⒔⒕⒖⒗⒘⒙⒚⒛㈠㈡㈢㈣㈤㈥㈦㈧㈨㈩①②③④⑤⑥⑦⑧⑨⑩⑴⑵⑶⑷⑸⑹⑺⑻⑼⑽⑾⑿⒀⒁⒂⒃⒄⒅⒆⒇≈≡≠＝≤≥＜＞≮≯∷±＋－×÷／∫∮∝∞∧∨∑∏∪∩∈∵∴⊥∥∠⌒⊙≌∽√§№☆★○●◎◇◆□℃‰€■△▲※→←↑↓〓¤°＃＆＠＼︿＿￣―♂♀┌┍┎┐┑┒┓─┄┈├┝┞┟┠┡┢┣│┆┊┬┭┮┯┰┱┲┳┼┽┾┿╀╁╂╃└┕┖┗┘┙┚┛━┅┉┤┥┦┧┨┩┪┫┃┇┋┴┵┶┷┸┹┺┻╋╊╉╈╇╆╅╄"</span>;</span><br><span class="line"><span class="keyword">const</span> ignoreObj = &#123;&#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, j = ignoreChars.length; i &lt; j; i++) &#123;</span><br><span class="line">  ignoreObj[ignoreChars.charCodeAt(i)] = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构建有限状态机</span></span><br><span class="line"><span class="comment">// 生成的数据结构形制如下</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &#123;</span></span><br><span class="line"><span class="comment"> *   '王': &#123;</span></span><br><span class="line"><span class="comment"> *     '八': &#123;</span></span><br><span class="line"><span class="comment"> *       '蛋': &#123;</span></span><br><span class="line"><span class="comment"> *         empty: true</span></span><br><span class="line"><span class="comment"> *       &#125;</span></span><br><span class="line"><span class="comment"> *       '羔': &#123;</span></span><br><span class="line"><span class="comment"> *         '子': &#123;</span></span><br><span class="line"><span class="comment"> *           empty: true</span></span><br><span class="line"><span class="comment"> *         &#125;</span></span><br><span class="line"><span class="comment"> *       &#125;</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> *   &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buildMap</span>(<span class="params">wordList</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> result = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = wordList.length; i &lt; len; ++i) &#123;</span><br><span class="line">    <span class="keyword">let</span> map = result;</span><br><span class="line">    <span class="keyword">const</span> word = wordList[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; word.length; ++j) &#123;</span><br><span class="line">      <span class="keyword">const</span> ch = word.charAt(j).toLowerCase();</span><br><span class="line">      <span class="keyword">if</span> (map[ch]) &#123;</span><br><span class="line">        map = map[ch];</span><br><span class="line">        <span class="keyword">if</span> (map.empty) &#123;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (map.empty) &#123;</span><br><span class="line">          <span class="keyword">delete</span> map.empty;</span><br><span class="line">        &#125;</span><br><span class="line">        map[ch] = &#123;</span><br><span class="line">          empty: <span class="literal">true</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">        map = map[ch];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取敏感词列表</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSensitiveWords</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  let words = [];</span></span><br><span class="line"><span class="comment">  if (words.length === 0) &#123;</span></span><br><span class="line"><span class="comment">    const data = fs.readFileSync(path.join(__dirname, './words'), 'utf8');</span></span><br><span class="line"><span class="comment">    words = data.split('\n');</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">  return words.filter(item =&gt; !!item);</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    <span class="string">'王八蛋'</span>,</span><br><span class="line">    <span class="string">'王八羔子'</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取敏感词库对象</span></span><br><span class="line"><span class="keyword">const</span> sensitiveWords = getSensitiveWords();</span><br><span class="line"><span class="keyword">const</span> map = buildMap(sensitiveWords);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体检测代码。</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params">map, content</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> result = [];</span><br><span class="line">  <span class="keyword">let</span> stack = [];</span><br><span class="line">  <span class="keyword">let</span> point = map;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = content.length; i &lt; len; ++i) &#123;</span><br><span class="line">    <span class="keyword">const</span> code = content.charCodeAt(i);</span><br><span class="line">    <span class="keyword">if</span> (ignoreObj[code]) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> ch = content.charAt(i);</span><br><span class="line">    <span class="keyword">const</span> item = point[ch.toLowerCase()];</span><br><span class="line">    <span class="keyword">if</span> (!item) &#123;</span><br><span class="line">      i = i - stack.length;</span><br><span class="line">      stack = [];</span><br><span class="line">      point = map;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (item.empty) &#123;</span><br><span class="line">      stack.push(ch);</span><br><span class="line">      result.push(stack.join(<span class="string">''</span>));</span><br><span class="line">      stack = [];</span><br><span class="line">      point = map;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      stack.push(ch);</span><br><span class="line">      point = item;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkSensitive</span>(<span class="params">content</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> words = check(map, content);</span><br><span class="line">  <span class="keyword">return</span> words;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = checkSensitive;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">checkSensitive(<span class="string">'老板黄鹤*王&amp;八&amp;（&amp;蛋，吃喝嫖赌，欠下了3.5个亿，带着他的小姨子跑了'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['王八蛋']</span></span><br></pre></td></tr></table></figure>

<h2 id="缺陷"><a href="#缺陷" class="headerlink" title="缺陷"></a>缺陷</h2><p>若用火星文、异体字、同音字来替代，这类算法没什么好的办法能识别</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">checkSensitive(<span class="string">'王八羔仔'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// []</span></span><br></pre></td></tr></table></figure>

<p>若敏感词短，则误伤很大，若前文设置的是 <code>王八</code> 作为敏感词。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">checkSensitive(<span class="string">'虎躯一震，散发一阵王八之气'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ['王八']</span></span><br></pre></td></tr></table></figure>

<p>自然还有大名鼎鼎的 <code>江阴毛纺织厂</code> 怕也会很容易被误伤。</p>
<p>此外，敏感词收集的过程也是一个可以扩展来说的点。</p>
]]></content>
      <categories>
        <category>alorigam</category>
      </categories>
  </entry>
  <entry>
    <title>npm installation integrity checksum failure</title>
    <url>/2018/07/26/node/npm-installation-integrity-checksum-failure/</url>
    <content><![CDATA[<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ npm install </span><br><span class="line"></span><br><span class="line">&gt; dafengche_hostling_manage_rn@0.2.3 i /Users/everlose/workspace/souche/dafenche_hostling_manage_rn</span><br><span class="line">&gt; npm install --registry=http://registry.npm.souche-inc.com</span><br><span class="line"></span><br><span class="line">npm ERR! code EINTEGRITY</span><br><span class="line">npm ERR! sha1-wn2eY/Tj6rCpvd6nyEtHhL1+ty0= integrity checksum failed when using sha1: wanted sha1-wn2eY/Tj6rCpvd6nyEtHhL1+ty0= but got sha1-w2ZcER/THiTjko+588ibWZmtkUI=. (2313436 bytes)</span><br><span class="line"></span><br><span class="line">npm ERR! A complete <span class="built_in">log</span> of this run can be found <span class="keyword">in</span>:</span><br><span class="line">npm ERR!     /Users/everlose/.npm/_logs/2018-07-26T09_31_57_935Z-debug.log</span><br><span class="line">npm ERR! code ELIFECYCLE</span><br><span class="line">npm ERR! errno 1</span><br><span class="line">npm ERR! dafengche_hostling_manage_rn@0.2.3 i: `npm install --registry=http://registry.npm.souche-inc.com`</span><br><span class="line">npm ERR! Exit status 1</span><br><span class="line">npm ERR!</span><br><span class="line">npm ERR! Failed at the dafengche_hostling_manage_rn@0.2.3 i script.</span><br><span class="line">npm ERR! This is probably not a problem with npm. There is likely additional logging output above.</span><br><span class="line"></span><br><span class="line">npm ERR! A complete <span class="built_in">log</span> of this run can be found <span class="keyword">in</span>:</span><br><span class="line">npm ERR!     /Users/everlose/.npm/_logs/2018-07-26T09_31_57_981Z-debug.log</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm cache --force clean</span><br><span class="line"></span><br><span class="line">npm install --update-binary --no-shrinkwrap</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果前面两部都做了，但还是无法解决，则重新启动计算机吧，本人最终重启下才得以解决</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>node</category>
      </categories>
  </entry>
  <entry>
    <title>浏览器发送的 http 请求是复用一个 tcp 连接么</title>
    <url>/2018/07/25/tcp-http/is-http-reuse-a-tcp/</url>
    <content><![CDATA[<h2 id="答案"><a href="#答案" class="headerlink" title="答案"></a>答案</h2><p>不一定。</p>
<p>如果发的不同域名，肯定不复用。</p>
<p>发的同域名。若第一个请求与第二个请求并行发送，不复用。</p>
<p>发的同域名，并且是第一个请求完事了才发第二个请求。则看是否有 connection: keep-alive 请求头，没有则不复用。</p>
<p>发的同域名，第一个请求完了后发第二个请求，有 connection: keep-alive 请求头。则复用同一个 TCP 连接。</p>
<h2 id="补充说明"><a href="#补充说明" class="headerlink" title="补充说明"></a>补充说明</h2><p>HTTP 1.1 里大概规范了几项提高性能的手段：</p>
<ol>
<li>持久连接 （keep-alive/persistent connection）</li>
<li>并行连接</li>
<li>Pipelining</li>
</ol>
<h3 id="持久连接"><a href="#持久连接" class="headerlink" title="持久连接"></a>持久连接</h3><p>每一个请求都会重新建立一个 TCP 连接，一旦响应返回，就关闭连接。 而建立一个连接，则需要进行三次握手。HTTP 1.1 出了一个请求头 connection，默认 keep-alive，告诉服务器不关闭 TCP 连接。</p>
<h3 id="并行连接"><a href="#并行连接" class="headerlink" title="并行连接"></a>并行连接</h3><p>由于现代网页通常包含了复数个（&gt;=10）资源，而按照默认设定，一个连接中的每一个请求必须等待收到响应后才能发送下一个请求，所以如果复数的资源请求全部在一个连接 one by one 发送给服务器显然会很慢，而为了弥补这一缺陷，浏览器通常会默认开启多个 TCP 连接，然后再根据每个连接的状态在其中依次发送数据请求，而且客户端有权任意关闭超发的连接。各个浏览器允许的并行连接数大致是这样的（From SO）：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Firefox 2:  2</span><br><span class="line">Firefox 3+: 6</span><br><span class="line">Opera 9.26: 4</span><br><span class="line">Opera 12:   6</span><br><span class="line">Safari 3:   4</span><br><span class="line">Safari 5:   6</span><br><span class="line">IE 7:       2</span><br><span class="line">IE 8:       6</span><br><span class="line">IE 10:      8</span><br><span class="line">Chrome:     6</span><br></pre></td></tr></table></figure>

<p>由于 TCP 协议本身有慢启动的特征，会随着时间调谐连接的最大速度，因此在现代浏览器中持久连接和并行连接通常是搭配在一起使用的—— 一方面由于持久连接的存在，每个 TCP 连接已经处于调谐后的状态，另一方面持久连接可以避免重新三次握手的开销。</p>
<p>在 Chrome 中，页面初始并行加载一堆静态资源是会最大开 6 个 TCP 连接去并行运作，其后发 Ajax 请求则是复用之前的 TCP 连接。</p>
<h3 id="Pipelining"><a href="#Pipelining" class="headerlink" title="Pipelining"></a>Pipelining</h3><p>按照 HTTP 1.1 的描述，还有种可以提升性能的方案是管道化，可以在一个 TCP 连接中并行执行多个请求并返回。</p>
<p>因为这项技术比较复杂，如何能在一个 TCP 中有序的处理所接收到的包，并且不会乱序返回，这在早期没有规范，所以各大浏览器都没有支持此功能，形同鸡肋。</p>
<h2 id="关于-HTTP-2"><a href="#关于-HTTP-2" class="headerlink" title="关于 HTTP 2"></a>关于 HTTP 2</h2><p>HTTP 2 为了性能做了不少努力，比如提供了规范以支持连接的多路复用。</p>
<p>如前文所说，在同一个 TCP 连接里面同时发生两个请求响应就不是那么简单。而 HTTP 2 正是提供了这样的规范，可以给数据拆成包，并打上包的顺序标签以供 TCP 能正确认知接收的包的顺序。</p>
<p>所以很多网络优化的知识已经过时</p>
<ul>
<li>因为“所有的 HTTP 2.0 的请求都在一个 TCP 链接上”，“资源合并减少请求”，比如 CSS Sprites ,多个 JS 文件、CSS 文件合并等手段没有效果，或者说没有必要。</li>
<li>因为“多路复用”，采用“cdn1.cn,cdn2.cn,cdn3.cn，打开多个 TCP 会话，突破浏览器对同一域名的链接数的限制”的手段是没有必要的。因为因为资源都是并行交错发送，且没有限制，不需要额外的多域名并行下载。</li>
<li>内嵌资源（如base64的图片）的优化手段也变得没有意义了。而且使用服务器推送的资源的方式更加高效，因为客户端还可以缓存起来，甚至可以由不同的页面共享（依旧遵循同源策略）</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://linjunzhu.github.io/blog/2016/03/10/http2-zongjie/" target="_blank" rel="noopener">https://linjunzhu.github.io/blog/2016/03/10/http2-zongjie/</a></li>
<li><a href="https://www.zhihu.com/question/36469741" target="_blank" rel="noopener">https://www.zhihu.com/question/36469741</a></li>
</ul>
]]></content>
      <categories>
        <category>tcp-http</category>
      </categories>
  </entry>
  <entry>
    <title>经典数组操作方法</title>
    <url>/2018/07/24/javascript/array-api/</url>
    <content><![CDATA[<h2 id="Arrays"><a href="#Arrays" class="headerlink" title="Arrays"></a>Arrays</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">list = [a,b,c,d,e]</span><br></pre></td></tr></table></figure>
<p>{: .-setup}</p>
<h2 id="子集"><a href="#子集" class="headerlink" title="子集"></a>子集</h2><h4 id="Immutable"><a href="#Immutable" class="headerlink" title="Immutable"></a>Immutable</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">list.slice(<span class="number">0</span>,<span class="number">1</span>)         <span class="comment">// → [a]</span></span><br><span class="line">list.slice(<span class="number">1</span>)           <span class="comment">// → [b,c,d,e]</span></span><br><span class="line">list.slice(<span class="number">1</span>,<span class="number">2</span>)         <span class="comment">// → [b]</span></span><br></pre></td></tr></table></figure>

<h3 id="Mutative"><a href="#Mutative" class="headerlink" title="Mutative"></a>Mutative</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">re = list.splice(<span class="number">1</span>)     <span class="comment">// re = [b,c,d,e]  list == [a]</span></span><br><span class="line">re = list.splice(<span class="number">1</span>,<span class="number">2</span>)   <span class="comment">// re = [b,c]      list == [a,d,e]</span></span><br></pre></td></tr></table></figure>

<h2 id="增"><a href="#增" class="headerlink" title="增"></a>增</h2><h4 id="Mutative-1"><a href="#Mutative-1" class="headerlink" title="Mutative"></a>Mutative</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">list.push(X)            <span class="comment">// list == [_,_,_,_,_,X]</span></span><br><span class="line">list.unshift(X)         <span class="comment">// list == [X,_,_,_,_,_]</span></span><br><span class="line">list.splice(<span class="number">2</span>, <span class="number">0</span>, X)    <span class="comment">// list == [_,_,X,_,_,_]</span></span><br></pre></td></tr></table></figure>

<h4 id="Immutable-1"><a href="#Immutable-1" class="headerlink" title="Immutable"></a>Immutable</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">list.concat([X,Y])      <span class="comment">// → [_,_,_,_,_,X,Y]</span></span><br></pre></td></tr></table></figure>

<h2 id="改"><a href="#改" class="headerlink" title="改"></a>改</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">list.splice(<span class="number">2</span>, <span class="number">1</span>, X)    <span class="comment">// list == [a,b,X,d,e]</span></span><br></pre></td></tr></table></figure>

<h2 id="删"><a href="#删" class="headerlink" title="删"></a>删</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">list.pop()              <span class="comment">// → e    list == [a,b,c,d]</span></span><br><span class="line">list.shift()            <span class="comment">// → a    list == [b,c,d,e]</span></span><br><span class="line">list.splice(<span class="number">2</span>, <span class="number">1</span>)       <span class="comment">// → [c]  list == [a,b,d,e]</span></span><br></pre></td></tr></table></figure>

<h2 id="迭代"><a href="#迭代" class="headerlink" title="迭代"></a>迭代</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> list = [</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">'张三'</span>, <span class="attr">age</span>: <span class="number">18</span> &#125;, </span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">'李四'</span>, <span class="attr">age</span>: <span class="number">24</span> &#125;, </span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">name</span>: <span class="string">'王小二'</span>, <span class="attr">age</span>: <span class="number">22</span> &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">list.forEach(<span class="function"><span class="params">item</span> =&gt;</span> <span class="built_in">console</span>.log(item.id)); <span class="comment">// 1, 2, 3</span></span><br></pre></td></tr></table></figure>

<h4 id="产生新数组"><a href="#产生新数组" class="headerlink" title="产生新数组"></a>产生新数组</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">list.map(<span class="function"><span class="params">item</span> =&gt;</span> item.name); <span class="comment">// [ '张三', '李四', '王小二' ]</span></span><br></pre></td></tr></table></figure>

<h4 id="筛选"><a href="#筛选" class="headerlink" title="筛选"></a>筛选</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">list</span><br><span class="line">    .filter(<span class="function"><span class="params">item</span> =&gt;</span> item.age &gt; <span class="number">18</span>);</span><br><span class="line">    .map(<span class="function"><span class="params">item</span> =&gt;</span> item.name);</span><br><span class="line">    </span><br><span class="line"><span class="comment">// [ '李四', '王小二' ]</span></span><br></pre></td></tr></table></figure>


<h4 id="some方法测试数组中的某些元素是否通过指定函数的测试"><a href="#some方法测试数组中的某些元素是否通过指定函数的测试" class="headerlink" title="some方法测试数组中的某些元素是否通过指定函数的测试"></a>some方法测试数组中的某些元素是否通过指定函数的测试</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isRepeat</span> (<span class="params">array, props, value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> array.some(<span class="function"><span class="params">item</span> =&gt;</span> item[props] === value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">isRepeat(list, <span class="string">'name'</span>, <span class="string">'张三'</span>); <span class="comment">// true</span></span><br><span class="line">isRepeat(list, <span class="string">'name'</span>, <span class="string">'李白'</span>); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<h4 id="检测某个数组里的每个对象是否都具有某种属性"><a href="#检测某个数组里的每个对象是否都具有某种属性" class="headerlink" title="检测某个数组里的每个对象是否都具有某种属性"></a>检测某个数组里的每个对象是否都具有某种属性</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hasSomeProps</span> (<span class="params">array, props</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> array.every(<span class="function"><span class="params">item</span> =&gt;</span> item[props]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">hasSomeProps(list, <span class="string">'name'</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h4 id="获取累计结果"><a href="#获取累计结果" class="headerlink" title="获取累计结果"></a>获取累计结果</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">arr.reduce(<span class="function">(<span class="params">prev, curr</span>) =&gt;</span> prev + curr, <span class="number">0</span>) <span class="comment">// 6</span></span><br></pre></td></tr></table></figure>

<h2 id="数组去重"><a href="#数组去重" class="headerlink" title="数组去重"></a>数组去重</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unique</span> (<span class="params">arr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="keyword">set</span> = new Set(arr);</span><br><span class="line">    return Array.from(<span class="keyword">set</span>);</span><br><span class="line">&#125;</span><br><span class="line">var arr = [2, NaN, 2, 3, NaN, &#123;&#125;, &#123;&#125;];</span><br><span class="line">unique(arr); <span class="comment">// [2, NaN, 3, Object, Object]</span></span><br></pre></td></tr></table></figure>

<h2 id="数组深度拷贝"><a href="#数组深度拷贝" class="headerlink" title="数组深度拷贝"></a>数组深度拷贝</h2><p>同对象的深度拷贝</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 遍历法，对象需递归</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">copyObject</span> (<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> x <span class="keyword">in</span> obj) &#123;</span><br><span class="line">        result[x] = <span class="keyword">typeof</span> obj === <span class="string">'object'</span> ?</span><br><span class="line">            copyObject(obj[x]) :</span><br><span class="line">            obj[x]</span><br><span class="line">        <span class="comment">//如果拷贝的值仍然是一个对象,那么重复执行当前方法。</span></span><br><span class="line">    &#125;　　</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">copyObject</span> (<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(obj));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="伪数组转真数组"><a href="#伪数组转真数组" class="headerlink" title="伪数组转真数组"></a>伪数组转真数组</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = &#123; <span class="number">0</span>: <span class="string">'a'</span>, <span class="number">1</span>: <span class="string">'b'</span>, <span class="number">2</span>: <span class="string">'c'</span>, <span class="attr">length</span>: <span class="number">3</span>, <span class="attr">splice</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125; &#125;;</span><br><span class="line">arr = <span class="built_in">Array</span>.prototype.slice.call(arr);</span><br><span class="line">arr; <span class="comment">// ["a", "b", "c"]    真数组</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
  </entry>
  <entry>
    <title>经典日期操作方法</title>
    <url>/2018/07/24/javascript/date-api/</url>
    <content><![CDATA[<h3 id="Date"><a href="#Date" class="headerlink" title="Date"></a>Date</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Now</span></span><br><span class="line">date = <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// ms since epoch</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">1419785527580</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ISO date format</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'2013-03-01T01:10:00'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 年月日时分秒，注意月份从0开始计数</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">2014</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">59</span>, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>{: .-setup}</p>
<h3 id="获取时间戳"><a href="#获取时间戳" class="headerlink" title="获取时间戳"></a>获取时间戳</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">date.getTime();</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line">+date</span><br></pre></td></tr></table></figure>

<h2 id="时间格式转化"><a href="#时间格式转化" class="headerlink" title="时间格式转化"></a>时间格式转化</h2><h3 id="moment"><a href="#moment" class="headerlink" title="moment"></a>moment</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> moment = <span class="built_in">require</span>(<span class="string">'moment'</span>)</span><br><span class="line">date = <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">m = moment(date)</span><br><span class="line"></span><br><span class="line">m.format(<span class="string">'YYYY-MM-DD hh:mm:ss'</span>)</span><br><span class="line"><span class="comment">// 2018-03-26 12:13:58</span></span><br></pre></td></tr></table></figure>

<h3 id="简化版本"><a href="#简化版本" class="headerlink" title="简化版本"></a>简化版本</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> temp = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/\//g</span>;</span><br><span class="line">(temp.toLocaleDateString() + <span class="string">' '</span> + temp.toLocaleTimeString().slice(<span class="number">2</span>)).replace(regex,<span class="string">'-'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// "2015-5-7 9:04:10"</span></span><br></pre></td></tr></table></figure>

<h3 id="全面版本"><a href="#全面版本" class="headerlink" title="全面版本"></a>全面版本</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> parseTime = <span class="function"><span class="keyword">function</span> (<span class="params">value, format</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!value || (+value) !== (+value)) &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (value.toString().length === <span class="number">10</span>) &#123;</span><br><span class="line">        value = (+value) * <span class="number">1000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>(value);</span><br><span class="line">    <span class="keyword">var</span> o = &#123;</span><br><span class="line">        <span class="string">'M+'</span>: date.getMonth() + <span class="number">1</span>, <span class="comment">//month</span></span><br><span class="line">        <span class="string">'D+'</span>: date.getDate(), <span class="comment">//day</span></span><br><span class="line">        <span class="string">'h+'</span>: date.getHours(), <span class="comment">//hour</span></span><br><span class="line">        <span class="string">'m+'</span>: date.getMinutes(), <span class="comment">//minute</span></span><br><span class="line">        <span class="string">'s+'</span>: date.getSeconds(), <span class="comment">//second</span></span><br><span class="line">        <span class="string">'S'</span>: date.getMilliseconds() <span class="comment">//millisecond</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/(Y+)/</span>.test(format)) &#123;</span><br><span class="line">        format = format.replace(<span class="built_in">RegExp</span>.$<span class="number">1</span>,</span><br><span class="line">            date.getFullYear().toString().substr(<span class="number">4</span> - <span class="built_in">RegExp</span>.$<span class="number">1.</span>length));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> k <span class="keyword">in</span> o) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'('</span>+ k +<span class="string">')'</span>).test(format)) &#123;</span><br><span class="line">            format = format.replace(<span class="built_in">RegExp</span>.$<span class="number">1</span>,</span><br><span class="line">                <span class="built_in">RegExp</span>.$<span class="number">1.</span>length == <span class="number">1</span> ? o[k] : (<span class="string">'00'</span>+ o[k]).substr((<span class="string">''</span>+ o[k]).length));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> format;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">parseTime(date.getTime(), <span class="string">'YYYY-MM-DD hh:mm:ss'</span>)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
  </entry>
  <entry>
    <title>git tag 简化操作</title>
    <url>/2018/07/16/source-control/git-tag-simple/</url>
    <content><![CDATA[<h2 id="目录层级"><a href="#目录层级" class="headerlink" title="目录层级"></a>目录层级</h2><p>项目中与本篇相关的几个文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">├── build</span><br><span class="line">│   ├── check-versions.js</span><br><span class="line">│   ├── tag.js</span><br><span class="line">├── package.json</span><br></pre></td></tr></table></figure>

<h2 id="前置依赖安装"><a href="#前置依赖安装" class="headerlink" title="前置依赖安装"></a>前置依赖安装</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ npm install inquirer chalk moment semver shelljs --save-dev</span><br></pre></td></tr></table></figure>

<h2 id="tag-js"><a href="#tag-js" class="headerlink" title="tag.js"></a>tag.js</h2><p>贴入其中代码</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'./check-versions'</span>)();</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'shelljs/global'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> inquirer = <span class="built_in">require</span>(<span class="string">'inquirer'</span>);</span><br><span class="line"><span class="keyword">var</span> chalk = <span class="built_in">require</span>(<span class="string">'chalk'</span>);</span><br><span class="line"><span class="keyword">var</span> moment = <span class="built_in">require</span>(<span class="string">'moment'</span>);</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">var</span> semver = <span class="built_in">require</span>(<span class="string">'semver'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> packageJsonPath = path.resolve(process.cwd(), <span class="string">'package.json'</span>);</span><br><span class="line"><span class="keyword">var</span> packageJson = <span class="built_in">require</span>(packageJsonPath);</span><br><span class="line"><span class="keyword">var</span> packageJsonVersion = packageJson.version;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> verOptList = getVersionOptions(packageJsonVersion);</span><br><span class="line"></span><br><span class="line">inquirer.prompt([&#123;</span><br><span class="line">    name: <span class="string">'version'</span>,</span><br><span class="line">    message: <span class="string">`选择将要升级的版本(当前版本 <span class="subst">$&#123;packageJsonVersion&#125;</span> )：`</span>,</span><br><span class="line">    type: <span class="string">'list'</span>,</span><br><span class="line">    <span class="keyword">default</span>: <span class="number">0</span>,</span><br><span class="line">    choices: verOptList</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    name: <span class="string">'week'</span>,</span><br><span class="line">    message: <span class="string">'是否添加发布次数 tag (格式如 16w12a  &lt;year&gt;w&lt;week&gt;[a-z])'</span>,</span><br><span class="line">    type: <span class="string">'confirm'</span>,</span><br><span class="line">    <span class="keyword">default</span>: <span class="literal">false</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    name: <span class="string">'message'</span>,</span><br><span class="line">    message: <span class="string">'版本发布说明'</span>,</span><br><span class="line">    type: <span class="string">'input'</span>,</span><br><span class="line">    <span class="keyword">default</span>: <span class="string">''</span></span><br><span class="line">&#125;]).then(<span class="function"><span class="keyword">function</span> (<span class="params">answers</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> weekSuffix = answers.week ? <span class="string">'+'</span> + getWeekSubfix(packageJsonVersion) : <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">var</span> version = <span class="string">`<span class="subst">$&#123;answers.version&#125;</span><span class="subst">$&#123;weekSuffix&#125;</span>`</span>;</span><br><span class="line">    <span class="keyword">var</span> commitMessage = <span class="string">`"chore(package.json): bump version to <span class="subst">$&#123;version&#125;</span>"`</span>;</span><br><span class="line">    <span class="keyword">var</span> message = <span class="string">`"<span class="subst">$&#123;answers.message&#125;</span>"`</span> || <span class="string">'v'</span> + version;</span><br><span class="line">    packageJson.version = version;</span><br><span class="line">    fs.writeFileSync(process.cwd() + <span class="string">'/package.json'</span>, <span class="built_in">JSON</span>.stringify(packageJson, <span class="literal">null</span>, <span class="string">'  '</span>));</span><br><span class="line">    <span class="keyword">var</span> cmd = <span class="string">`git add package.json &amp;&amp; git commit -m <span class="subst">$&#123;commitMessage&#125;</span> &amp;&amp; git tag -a <span class="subst">$&#123;version&#125;</span> -m <span class="subst">$&#123;message&#125;</span> &amp;&amp; git push origin master &amp;&amp; git push origin --tags`</span>;</span><br><span class="line"></span><br><span class="line">    exec(cmd);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log();</span><br><span class="line">    <span class="built_in">console</span>.log(chalk.green(<span class="string">`   成功，当前版本为( <span class="subst">$&#123;version&#125;</span> ) `</span>));</span><br><span class="line">    <span class="built_in">console</span>.log();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取发布周数 patch</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getWeekSubfix</span> (<span class="params">version</span>) </span>&#123;</span><br><span class="line">    version = version.split(<span class="string">'+'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> versionSuffix = version[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">var</span> year = moment().format(<span class="string">'gg'</span>);</span><br><span class="line">    <span class="keyword">var</span> week = moment().format(<span class="string">'ww'</span>);</span><br><span class="line">    <span class="keyword">var</span> pubSuffix = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!versionSuffix) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;year&#125;</span>w<span class="subst">$&#123;week&#125;</span>a`</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> currentWeek = versionSuffix.match(<span class="regexp">/\d+w(\d+)(\w+)/</span>)[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">var</span> currentPubSuffix = versionSuffix.match(<span class="regexp">/\d+w(\d+)(\w+)/</span>)[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">parseInt</span>(week) === <span class="built_in">parseInt</span>(currentWeek)) &#123;</span><br><span class="line">        <span class="comment">// 没有处理达到 Z 的情况</span></span><br><span class="line">        <span class="keyword">if</span> (currentPubSuffix === <span class="string">'z'</span>) &#123;</span><br><span class="line">            pubSuffix = <span class="string">'A'</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 如果是 Z 那么下一个没有处理</span></span><br><span class="line">            pubSuffix = <span class="built_in">String</span>.fromCharCode(currentPubSuffix.charCodeAt(<span class="number">0</span>) + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        pubSuffix = <span class="string">'a'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;year&#125;</span>w<span class="subst">$&#123;week&#125;</span><span class="subst">$&#123;pubSuffix&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取升级版本列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getVersionOptions</span> (<span class="params">version</span>) </span>&#123;</span><br><span class="line">    version = version.split(<span class="string">'+'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> currentVersion = version[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">var</span> levels = [<span class="string">'patch'</span>, <span class="string">'minor'</span>, <span class="string">'major'</span>];</span><br><span class="line">    <span class="keyword">var</span> opts = [];</span><br><span class="line"></span><br><span class="line">    levels.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> val = semver.inc(currentVersion, item);</span><br><span class="line">        opts.push(&#123;</span><br><span class="line">            name: val,</span><br><span class="line">            value: val</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> opts;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">process.on(<span class="string">'unhandledRejection'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(a, b);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="check-versions-js"><a href="#check-versions-js" class="headerlink" title="check-versions.js"></a>check-versions.js</h2><p>这个文件其实是 vue-cli 建的，主要做了检查 package.json 里的版本的功能，代码如下</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> chalk = <span class="built_in">require</span>(<span class="string">'chalk'</span>)</span><br><span class="line"><span class="keyword">var</span> semver = <span class="built_in">require</span>(<span class="string">'semver'</span>)</span><br><span class="line"><span class="keyword">var</span> packageConfig = <span class="built_in">require</span>(<span class="string">'../package.json'</span>)</span><br><span class="line"><span class="keyword">var</span> shell = <span class="built_in">require</span>(<span class="string">'shelljs'</span>)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">exec</span> (<span class="params">cmd</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">require</span>(<span class="string">'child_process'</span>).execSync(cmd).toString().trim()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> versionRequirements = [</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'node'</span>,</span><br><span class="line">    currentVersion: semver.clean(process.version),</span><br><span class="line">    versionRequirement: packageConfig.engines.node</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (shell.which(<span class="string">'npm'</span>)) &#123;</span><br><span class="line">  versionRequirements.push(&#123;</span><br><span class="line">    name: <span class="string">'npm'</span>,</span><br><span class="line">    currentVersion: exec(<span class="string">'npm --version'</span>),</span><br><span class="line">    versionRequirement: packageConfig.engines.npm</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> warnings = []</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; versionRequirements.length; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> mod = versionRequirements[i]</span><br><span class="line">    <span class="keyword">if</span> (!semver.satisfies(mod.currentVersion, mod.versionRequirement)) &#123;</span><br><span class="line">      warnings.push(mod.name + <span class="string">': '</span> +</span><br><span class="line">        chalk.red(mod.currentVersion) + <span class="string">' should be '</span> +</span><br><span class="line">        chalk.green(mod.versionRequirement)</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (warnings.length) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">''</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(chalk.yellow(<span class="string">'To use this template, you must update following to modules:'</span>))</span><br><span class="line">    <span class="built_in">console</span>.log()</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; warnings.length; i++) &#123;</span><br><span class="line">      <span class="keyword">var</span> warning = warnings[i]</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'  '</span> + warning)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log()</span><br><span class="line">    process.exit(<span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ node build/tag.js</span><br><span class="line"></span><br><span class="line">? 选择将要升级的版本(当前版本 1.1.8 )： (Use arrow keys)</span><br><span class="line">❯ 1.1.9</span><br><span class="line">  1.2.0</span><br><span class="line">  2.0.0</span><br><span class="line"></span><br><span class="line">? 是否添加发布次数 tag (格式如 16w12a  &lt;year&gt;w&lt;week&gt;[a-z]) (y/N)</span><br><span class="line"></span><br><span class="line">? 版本发布说明 ()</span><br><span class="line"></span><br><span class="line">[master 976e906] chore(package.json): bump version to 1.1.9</span><br><span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span><br><span class="line">To git.souche-inc.com:bigBusiness/dafengche-reorganize-manage.git</span><br><span class="line">   31bbfe9..976e906  master -&gt; master</span><br><span class="line">To git.souche-inc.com:bigBusiness/dafengche-reorganize-manage.git</span><br><span class="line"> * [new tag]         1.1.9 -&gt; 1.1.9</span><br><span class="line"></span><br><span class="line">   成功，当前版本为( 1.1.9 )</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>source-control</category>
      </categories>
  </entry>
  <entry>
    <title>postcss 简单使用</title>
    <url>/2018/07/13/css/postcss-introduce/</url>
    <content><![CDATA[<h2 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h2><p>在 webpack 中 css 的 loader 写上 postcss 支持。而后在 .postcssrc.js 中配置想要引入的插件。而 vue-cli 构建的项目已经集成</p>
<p>接着在 .postcssrc.js 以下介绍几种常用插件</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="built_in">require</span>(<span class="string">'postcss-autoprefixer'</span>),</span><br><span class="line">        <span class="built_in">require</span>(<span class="string">'postcss-cssnext'</span>)(&#123;</span><br><span class="line">            browsers: [<span class="string">'ie &gt; 8'</span>, <span class="string">'last 2 versions'</span>]</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="built_in">require</span>(<span class="string">'postcss-mixins'</span>),</span><br><span class="line">        <span class="built_in">require</span>(<span class="string">'postcss-css-reset'</span>)</span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="autoprefixer"><a href="#autoprefixer" class="headerlink" title="autoprefixer"></a>autoprefixer</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 被最终编译成 */</span></span><br><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">    <span class="attribute">-webkit-box-sizing</span>: border-box;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="cssnext"><a href="#cssnext" class="headerlink" title="cssnext"></a>cssnext</h2><p>可定义变量</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-pseudo">:root</span> &#123;</span><br><span class="line">    <span class="attribute">--white</span>: <span class="number">#fff</span>;</span><br><span class="line">    <span class="attribute">--grey</span>: <span class="number">#1e1e1d</span>;</span><br><span class="line">    <span class="attribute">--yellow</span>: <span class="number">#ffad15</span>;</span><br><span class="line">    <span class="attribute">--offwhite</span>: <span class="number">#f8f8f8</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 使用如 */</span></span><br><span class="line"><span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--yellow);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 编译为 */</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#ffad15</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可扩展和类占位符，@apply可以复制每个属性的规则和值。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-pseudo">:root</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="selector-tag">--franklin</span>: &#123;</span><br><span class="line">        <span class="attribute">font-family</span>: <span class="string">'futura-pt'</span>, helvetica, sans-serif;</span><br><span class="line">    </span><br><span class="line">    &#125;; </span><br><span class="line">    <span class="selector-tag">--franklin-heading</span>: &#123; </span><br><span class="line">        @apply --franklin; font-weight: 700; line-height: 1.1; text-transform: uppercase; </span><br><span class="line">    &#125;; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 使用如 */</span></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.my-heading</span> &#123;</span><br><span class="line">    @apply --franklin-heading;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 编译为 */</span></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.my-heading</span> &#123;</span><br><span class="line">   <span class="attribute">font-family</span>: <span class="string">'futura-pt'</span>, helvetica, sans-serif;</span><br><span class="line">   <span class="attribute">font-weight</span>: <span class="number">700</span>;</span><br><span class="line">   <span class="attribute">line-height</span>: <span class="number">1.1</span>;</span><br><span class="line">   <span class="attribute">text-transform</span>: uppercase; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="mixins"><a href="#mixins" class="headerlink" title="mixins"></a>mixins</h2><p>带参数的混合宏</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">@<span class="keyword">mixin</span> project-block ($c) &#123;</span><br><span class="line">    background-color: $c;</span><br><span class="line">    <span class="selector-tag">a</span> &#123; </span><br><span class="line">        <span class="attribute">color</span>: $c;</span><br><span class="line">        &amp;:hover &#123;</span><br><span class="line">            background-color: $c;</span><br><span class="line">            <span class="selector-tag">color</span>: <span class="selector-id">#fff</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 使用如 */</span></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.p-jribbble</span> &#123;</span><br><span class="line">    @include project-block(#ff0066);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 编译为 */</span></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.p-jribbble</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#ff0066</span>;</span><br><span class="line">    a &#123; </span><br><span class="line">        <span class="selector-tag">color</span>: <span class="selector-id">#ff0066</span>;</span><br><span class="line">        &amp;<span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">            <span class="attribute">background-color</span>: <span class="number">#ff0066</span>;</span><br><span class="line">            <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="css-reset"><a href="#css-reset" class="headerlink" title="css reset"></a>css reset</h2><p>可选两种模式，<code>@reset-global: [pc|mobile];</code>，在 css 文件头部加入以下一句话就可以生效。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">@<span class="keyword">reset</span>-<span class="keyword">global</span> pc;</span><br></pre></td></tr></table></figure>

<p>会被编译为</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: sans-serif;</span><br><span class="line">    <span class="attribute">-ms-text-size-adjust</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">-webkit-text-size-adjust</span>: <span class="number">100%</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">article</span>, <span class="selector-tag">aside</span>, <span class="selector-tag">details</span>, <span class="selector-tag">figcaption</span>, <span class="selector-tag">figure</span>, <span class="selector-tag">footer</span>, <span class="selector-tag">header</span>, <span class="selector-tag">main</span>, <span class="selector-tag">menu</span>, <span class="selector-tag">nav</span>, <span class="selector-tag">section</span>, <span class="selector-tag">summary</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: block</span><br><span class="line">&#125;</span><br><span class="line">.......</span><br></pre></td></tr></table></figure>

<p>需要注意的是这个作者在 <code>@reset-global mobile;</code> 模式下，加入了 <code>* { box-sizing: border-box }</code> </p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="http://www.tuicool.com/articles/aayEF3" target="_blank" rel="noopener">PostCSS深入学习: 结合BEM和SUIT方法使用PostCSS</a></p>
<p><a href="http://cssnext.io/playground/" target="_blank" rel="noopener">css next playground</a></p>
]]></content>
      <categories>
        <category>css</category>
      </categories>
      <tags>
        <tag>css 3</tag>
      </tags>
  </entry>
  <entry>
    <title>CommonJS 中的 require/exports 和 ES6 中的 import/export 区别？</title>
    <url>/2018/07/10/javascript/commonjs-vs-import/</url>
    <content><![CDATA[<h2 id="一"><a href="#一" class="headerlink" title="一"></a>一</h2><p>require理论上可以运用在代码的任何地方，甚至不需要赋值给某个变量之后再使用</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ...a lot code</span></span><br><span class="line"><span class="built_in">require</span>(process.cwd() + <span class="string">'/a'</span>);</span><br></pre></td></tr></table></figure>

<p>但是import则不同，它是编译时的（require是运行时的），它必须放在文件开头，而且使用格式也是确定的，不容置疑。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> a <span class="keyword">from</span> <span class="string">'./a'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...a lot code</span></span><br></pre></td></tr></table></figure>

<h2 id="二"><a href="#二" class="headerlink" title="二"></a>二</h2><p>CommonJS 模块的重要特性是加载时执行，即脚本代码在 require 的时候，就会全部执行。一旦出现某个模块被”循环加载”，就只输出已经执行的部分，还未执行的部分不会输出。</p>
<p>而ES6 模块是动态引用，如果使用 import 从一个模块加载变量，那些变量不会被缓存，而是成为一个指向被加载模块的引用，需要开发者自己保证，真正取值的时候能够取到值。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// counter.js</span></span><br><span class="line">exports.count = <span class="number">0</span></span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'increase count to'</span>, ++exports.count, <span class="string">'in counter.js after 500ms'</span>)</span><br><span class="line">&#125;, <span class="number">500</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// commonjs.js</span></span><br><span class="line"><span class="keyword">const</span> &#123;count&#125; = <span class="built_in">require</span>(<span class="string">'./counter'</span>)</span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'read count after 1000ms in commonjs is'</span>, count)</span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br><span class="line"><span class="comment">// increase count to 1 in counter.js after 500ms</span></span><br><span class="line"><span class="comment">// read count after 1000ms in commonjs is 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//es6.js</span></span><br><span class="line"><span class="keyword">import</span> &#123;count&#125; <span class="keyword">from</span> <span class="string">'./counter'</span></span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'read count after 1000ms in es6 is'</span>, count)</span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br><span class="line"><span class="comment">// node 9，when I run with babel-node</span></span><br><span class="line"><span class="comment">// increase count to 1 in counter.js after 500ms</span></span><br><span class="line"><span class="comment">// read count after 1000ms in es6 is 1</span></span><br></pre></td></tr></table></figure>

<h2 id="三"><a href="#三" class="headerlink" title="三"></a>三</h2><p>CommonJS 规范规定，每个模块内部，module 变量代表当前模块。这个变量是一个对象，它的 exports 属性（即 module.exports ）是对外的接口。加载某个模块，其实是加载该模块的 module.exports 属性。</p>
<p>export 命令规定的是对外的接口，必须与模块内部的变量建立一一对应关系。</p>
<p>就如下面module.export 只能导出一个对象，而es6的export可以多次，用解构去一一对应。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    a: <span class="number">1</span>,</span><br><span class="line">    b: <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> b = <span class="number">2</span>;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
  </entry>
  <entry>
    <title>linux find 命令详解</title>
    <url>/2018/07/10/os/linux-find/</url>
    <content><![CDATA[<h3 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find &lt;path&gt; &lt;conditions&gt; &lt;actions&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Conditions"><a href="#Conditions" class="headerlink" title="Conditions"></a>Conditions</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-name <span class="string">"*.c"</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-<span class="built_in">type</span> f            <span class="comment"># File</span></span><br><span class="line">-<span class="built_in">type</span> d            <span class="comment"># Directory</span></span><br><span class="line">-<span class="built_in">type</span> l            <span class="comment"># Symlink</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-depth 2           <span class="comment"># At least 3 levels deep</span></span><br><span class="line">-regex PATTERN</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-newer   file.txt</span><br><span class="line">-newerm  file.txt        <span class="comment"># modified newer than file.txt</span></span><br><span class="line">-newerX  file.txt        <span class="comment"># [c]hange, [m]odified, [B]create</span></span><br><span class="line">-newerXt <span class="string">"1 hour ago"</span>    <span class="comment"># [t]imestamp</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-path  <span class="string">"*/node_modules"</span> -prune  <span class="comment"># 忽略任意node_modules文件夹</span></span><br></pre></td></tr></table></figure>

<h3 id="Condition-flow"><a href="#Condition-flow" class="headerlink" title="Condition flow"></a>Condition flow</h3><p>查找当前文件夹且忽略node_modules文件夹下的，所有后缀为js的文件，-o是短路语句</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find . -path  <span class="string">"*/node_modules"</span> -prune -o -<span class="built_in">type</span> f -name <span class="string">"*.js"</span> -<span class="built_in">print</span></span><br></pre></td></tr></table></figure>

<h3 id="Actions"><a href="#Actions" class="headerlink" title="Actions"></a>Actions</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-<span class="built_in">exec</span> rm &#123;&#125; \; <span class="comment"># 花括号代表前面find查找出来的文件名，反斜杠分号代表语句结束</span></span><br><span class="line">-<span class="built_in">print</span> <span class="comment"># 打印</span></span><br><span class="line">-delete</span><br></pre></td></tr></table></figure>

<h3 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find . -name <span class="string">'*.jpg'</span></span><br><span class="line">find . -name <span class="string">'*.jpg'</span> -<span class="built_in">exec</span> rm &#123;&#125; \;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find . -newerBt <span class="string">"24 hours ago"</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>os</category>
      </categories>
  </entry>
  <entry>
    <title>CentOS 安装 nodejs 一件套</title>
    <url>/2018/07/05/node/centos-install-node/</url>
    <content><![CDATA[<p>首先进入node官网寻找一个合适的版本</p>
<p><a href="http://nodejs.org/dist/" target="_blank" rel="noopener">http://nodejs.org/dist/</a></p>
<p>以 node-v9.0.0-linux-x64.tar.gz  为例</p>
<p>运行命令获取node资源</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget http://nodejs.org/dist/v9.0.0/node-v9.0.0-linux-x64.tar.gz</span><br></pre></td></tr></table></figure>

<p>下载到当前目录后解压</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar -zxvf node-v9.0.0-linux-x64.tar.gz</span><br><span class="line"></span><br><span class="line">mv node-v9.0.0-linux-x64 node-v9</span><br></pre></td></tr></table></figure>

<p>查看node程序是否能正常执行</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> node-v9/bin &amp;&amp; ./node -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># v9.0.0</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">pwd</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># /root/node-v9/bin</span></span><br></pre></td></tr></table></figure>

<p>接着设置全局变量</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim ~/.bash_profile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 找到 PATH=$PATH:$HOME/bin，在后面添加路径为：</span></span><br><span class="line"></span><br><span class="line">PATH=<span class="variable">$PATH</span>:<span class="variable">$HOME</span>/bin:/root/node-v9/bin</span><br></pre></td></tr></table></figure>

<p>保存后重载</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.bash_profile</span><br></pre></td></tr></table></figure>


<h2 id="其他一些node技术栈软件"><a href="#其他一些node技术栈软件" class="headerlink" title="其他一些node技术栈软件"></a>其他一些node技术栈软件</h2><p>npm install pm2 -g</p>
<p>yum install -y mongodb</p>
<p>常用命令</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看mongo安装位置</span></span><br><span class="line">whereis mongod</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看修改配置文件</span></span><br><span class="line">vi /etc/mongod.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动mongodb</span></span><br><span class="line">systemctl start mongod.service</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">service mongod start</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新启动mongodb</span></span><br><span class="line">systemctl restart mongod.service</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">service mongod restart</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止mongodb</span></span><br><span class="line">systemctl stop mongod.service</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">service mongod stop</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看mongodb的状态</span></span><br><span class="line">systemctl status mongod.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># mongo登录</span></span><br><span class="line">mongo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看数据库</span></span><br><span class="line">show dbs</span><br></pre></td></tr></table></figure>

<p>用supervisord开机启动，加入配置</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># whereis mongod</span></span><br><span class="line">mongod: /usr/bin/mongod /etc/mongod.conf /usr/share/man/man1/mongod.1.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 /etc/supervisord.conf 里加入</span></span><br><span class="line">[program:mongodb]</span><br><span class="line"><span class="built_in">command</span>=/usr/bin/mongod -f /etc/mongod.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启</span></span><br><span class="line">supervisorctl reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看目前守护的进程</span></span><br><span class="line">supervisorctl</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>node</category>
      </categories>
  </entry>
  <entry>
    <title>在 node 程序中写 es6 语法</title>
    <url>/2018/07/05/node/node-es6/</url>
    <content><![CDATA[<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>本人 node 环境是 9.0.0，直接起项目时发现</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ node server.js</span><br><span class="line">/Users/everlose/workspace/fedidea/graphql-server/server.js:1</span><br><span class="line">(<span class="keyword">function</span> (exports, require, module, __filename, __dirname) &#123; import Koa from <span class="string">'koa'</span></span><br><span class="line">                                                              ^^^^^^</span><br><span class="line"></span><br><span class="line">SyntaxError: Unexpected token import</span><br><span class="line">    at createScript (vm.js:80:10)</span><br><span class="line">    at Object.runInThisContext (vm.js:152:10)</span><br><span class="line">    at Module._compile (module.js:605:28)</span><br><span class="line">    at Object.Module._extensions..js (module.js:652:10)</span><br><span class="line">    at Module.load (module.js:560:32)</span><br><span class="line">    at tryModuleLoad (module.js:503:12)</span><br><span class="line">    at Function.Module._load (module.js:495:3)</span><br><span class="line">    at Function.Module.runMain (module.js:682:10)</span><br><span class="line">    at startup (bootstrap_node.js:191:16)</span><br><span class="line">    at bootstrap_node.js:613:3</span><br></pre></td></tr></table></figure>

<p>在本机可以检测 node 所支持的 es6 语法，如下所示，由此可知我本地其他 es6 语法大体上都支持，除了 import 和 export。而 es6 注定绕不过这个。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ node -v</span><br><span class="line">v9.0.0</span><br><span class="line"></span><br><span class="line">$ npm install -g es-checker</span><br><span class="line"></span><br><span class="line">$ es-checker</span><br><span class="line"></span><br><span class="line">ECMAScript 6 Feature Detection (v1.4.1)</span><br><span class="line"></span><br><span class="line">Variables</span><br><span class="line">  √ <span class="built_in">let</span> and const</span><br><span class="line">  √ TDZ error <span class="keyword">for</span> too-early access of <span class="built_in">let</span> or const declarations</span><br><span class="line">  √ Redefinition of const declarations not allowed</span><br><span class="line">  √ destructuring assignments/declarations <span class="keyword">for</span> arrays and objects</span><br><span class="line">  √ ... operator</span><br><span class="line"></span><br><span class="line">Data Types</span><br><span class="line">  √ For...of loop</span><br><span class="line">  √ Map, Set, WeakMap, WeakSet</span><br><span class="line">  √ Symbol</span><br><span class="line">  √ Symbols cannot be implicitly coerced</span><br><span class="line"></span><br><span class="line">Number</span><br><span class="line">  √ Octal (e.g. 0o1 ) and binary (e.g. 0b10 ) literal forms</span><br><span class="line">  √ Old octal literal invalid now (e.g. 01 )</span><br><span class="line">  √ Static <span class="built_in">functions</span> added to Math (e.g. Math.hypot(), Math.acosh(), Math.imul() )</span><br><span class="line">  √ Static <span class="built_in">functions</span> added to Number (Number.isNaN(), Number.isInteger() )</span><br><span class="line"></span><br><span class="line">String</span><br><span class="line">  √ Methods added to String.prototype (String.prototype.includes(), String.prototype.repeat() )</span><br><span class="line">  √ Unicode code-point escape form <span class="keyword">in</span> string literals (e.g. \u&#123;20BB7&#125; )</span><br><span class="line">  √ Unicode code-point escape form <span class="keyword">in</span> identifier names (e.g. var \u&#123;20BB7&#125; = 42; )</span><br><span class="line">  √ Unicode code-point escape form <span class="keyword">in</span> regular expressions (e.g. var regexp = /\u&#123;20BB7&#125;/u; )</span><br><span class="line">  √ y flag <span class="keyword">for</span> sticky regular expressions (e.g. /b/y )</span><br><span class="line">  √ Template String Literals</span><br><span class="line"></span><br><span class="line">Function</span><br><span class="line">  √ arrow <span class="keyword">function</span></span><br><span class="line">  √ default <span class="keyword">function</span> parameter values</span><br><span class="line">  √ destructuring <span class="keyword">for</span> <span class="keyword">function</span> parameters</span><br><span class="line">  √ Inferences <span class="keyword">for</span> <span class="keyword">function</span> name property <span class="keyword">for</span> anonymous <span class="built_in">functions</span></span><br><span class="line">  × Tail-call optimization <span class="keyword">for</span> <span class="keyword">function</span> calls and recursion</span><br><span class="line"></span><br><span class="line">Array</span><br><span class="line">  × Methods added to Array.prototype ([].fill(), [].find(), [].findIndex(), [].entries(), [].keys(), [].values() )</span><br><span class="line">  √ Static <span class="built_in">functions</span> added to Array (Array.from(), Array.of() )</span><br><span class="line">  √ TypedArrays like Uint8Array, ArrayBuffer, Int8Array(), Int32Array(), Float64Array()</span><br><span class="line">  √ Some Array methods (e.g. Int8Array.prototype.slice(), Int8Array.prototype.join(), Int8Array.prototype.forEach() ) added to the TypedArray prototypes</span><br><span class="line">  √ Some Array statics (e.g. Uint32Array.from(), Uint32Array.of() ) added to the TypedArray constructors</span><br><span class="line"></span><br><span class="line">Object</span><br><span class="line">  √ __proto__ <span class="keyword">in</span> object literal definition sets [[Prototype]] link</span><br><span class="line">  √ Static <span class="built_in">functions</span> added to Object (Object.getOwnPropertySymbols(), Object.assign() )</span><br><span class="line">  √ Object Literal Computed Property</span><br><span class="line">  √ Object Literal Property Shorthands</span><br><span class="line">  √ Proxies</span><br><span class="line">  √ Reflect</span><br><span class="line"></span><br><span class="line">Generator and Promise</span><br><span class="line">  √ Generator <span class="keyword">function</span></span><br><span class="line">  √ Promises</span><br><span class="line"></span><br><span class="line">Class</span><br><span class="line">  √ Class</span><br><span class="line">  √ super allowed <span class="keyword">in</span> object methods</span><br><span class="line">  √ class ABC extends Array &#123; .. &#125;</span><br><span class="line"></span><br><span class="line">Module</span><br><span class="line">  × Module <span class="built_in">export</span> <span class="built_in">command</span></span><br><span class="line">  × Module import <span class="built_in">command</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">=========================================</span><br><span class="line">Passes 38 feature Detections</span><br><span class="line">Your runtime supports 90% of ECMAScript 6</span><br><span class="line">=========================================</span><br></pre></td></tr></table></figure>

<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><ol>
<li>安装三个依赖</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install --save-dev babel-cli babel-preset-stage-2 babel-preset-es2015  babel-plugin-transform-runtime</span><br></pre></td></tr></table></figure>

<p>其中 babel-cli 自带 babel-node 命令</p>
<ol start="2">
<li>修改 package.json 的 script</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"start"</span>: <span class="string">"babel-node server.js"</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>再加入.babelrc</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"presets"</span>: [</span><br><span class="line">        <span class="string">"es2015"</span>,</span><br><span class="line">        <span class="string">"stage-2"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"plugins"</span>: [<span class="string">"transform-runtime"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>最后运行 <code>npm run start</code> 启动程序</li>
</ol>
<h2 id="如果要在-vscode-中调试-es6-代码"><a href="#如果要在-vscode-中调试-es6-代码" class="headerlink" title="如果要在 vscode 中调试 es6 代码"></a>如果要在 vscode 中调试 es6 代码</h2><p>在 package.json 里加入一下代码，能将除了 node_modules 以外的代码都打包入 dist 文件夹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">    // 省略其他...</span><br><span class="line">    &quot;build&quot;: &quot;babel ./ --ignore node_modules  -d dist --source-maps&quot;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>接着在 .vscode 文件夹下加入 task.json</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"version"</span>: <span class="string">"0.1.0"</span>,</span><br><span class="line">    <span class="string">"command"</span>: <span class="string">"npm"</span>,</span><br><span class="line">    <span class="string">"isShellCommand"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"showOutput"</span>: <span class="string">"always"</span>,</span><br><span class="line">    <span class="string">"suppressTaskName"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"tasks"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">"taskName"</span>: <span class="string">"build"</span>,</span><br><span class="line">            <span class="string">"args"</span>: [ <span class="string">"run"</span>, <span class="string">"build"</span> ],</span><br><span class="line">            <span class="string">"isBuildCommand"</span>: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再于 .vscode 加入 launch.json </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 使用 IntelliSense 了解相关属性。</span></span><br><span class="line">    <span class="comment">// 悬停以查看现有属性的描述。</span></span><br><span class="line">    <span class="comment">// 欲了解更多信息，请访问: https://go.microsoft.com/fwlink/?linkid=830387</span></span><br><span class="line">    <span class="string">"version"</span>: <span class="string">"0.1.0"</span>,</span><br><span class="line">    <span class="string">"configurations"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">"name"</span>: <span class="string">"Launch"</span>,</span><br><span class="line">            <span class="string">"type"</span>: <span class="string">"node"</span>,</span><br><span class="line">            <span class="string">"request"</span>: <span class="string">"launch"</span>,</span><br><span class="line">            <span class="string">"program"</span>: <span class="string">"$&#123;workspaceRoot&#125;/server.js"</span>,</span><br><span class="line">            <span class="string">"stopOnEntry"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"args"</span>: [],</span><br><span class="line">            <span class="string">"cwd"</span>: <span class="string">"$&#123;workspaceRoot&#125;"</span>,</span><br><span class="line">            <span class="string">"preLaunchTask"</span>: <span class="string">"build"</span>,</span><br><span class="line">            <span class="string">"runtimeExecutable"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="string">"runtimeArgs"</span>: [ <span class="string">"--nolazy"</span> ],</span><br><span class="line">            <span class="string">"env"</span>: &#123;</span><br><span class="line">                <span class="string">"NODE_ENV"</span>: <span class="string">"development"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"console"</span>: <span class="string">"integratedTerminal"</span>,</span><br><span class="line">            <span class="string">"sourceMaps"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">"outFiles"</span>: [<span class="string">"$&#123;workspaceRoot&#125;/dist/*.js"</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后按F5启动，每次启动都会由 preLaunchTask 来预先 运行 build task 来把 es6 代码编译了，再启动</p>
]]></content>
      <categories>
        <category>node</category>
      </categories>
  </entry>
  <entry>
    <title>JS 对象内部属性遍历的顺序乱了</title>
    <url>/2018/06/14/javascript/object-property-order/</url>
    <content><![CDATA[<h2 id="问题重现"><a href="#问题重现" class="headerlink" title="问题重现"></a>问题重现</h2><p>需求是要获取一个车型列表，并且输出到页面上按年份排序，故而接口提供的对象简化如下</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    <span class="string">'2018'</span>: &#123;</span><br><span class="line">        modelCode: <span class="string">"204313"</span>,</span><br><span class="line">        modelName: <span class="string">"2018款 Vanquish 6.0L S Coupe"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'2017'</span>: &#123;</span><br><span class="line">        modelCode: <span class="string">"202479"</span>,</span><br><span class="line">        modelName: <span class="string">"2017款 Rapide 6.0L AMR"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'2013'</span>: &#123;</span><br><span class="line">        modelCode: <span class="string">"139705"</span>,</span><br><span class="line">        modelName: <span class="string">"2013款  Rapide  6.0L S"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(obj)</span><br><span class="line"><span class="comment">// &#123;2013: &#123;…&#125;, 2017: &#123;…&#125;, 2018: &#123;…&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>??? 为什么 2013 在前面了，用户肯定希望先看到新的车型的，这不科学！</p>
<h2 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h2><p>查阅了一些文档后，得出了以下有效结论：</p>
<ol>
<li>An object is a member of the type Object. It is an unordered collection of properties each of which contains a primitive value, object, or function. A function stored in a property of an object is called a method.</li>
<li>Chrome Opera 的 JavaScript 解析引擎遵循的是新版 ECMA-262 第五版规范。因此，使用 for-in 语句遍历对象属性时遍历书序并非属性构建顺序。而 IE6 IE7 IE8 Firefox Safari 的 JavaScript 解析引擎遵循的是较老的 ECMA-262 第三版规范，属性遍历顺序由属性构建的顺序决定。</li>
</ol>
<p>而 Chrome Opera 中使用 for-in 语句遍历对象属性时会遵循一个规律：</p>
<p><strong>它们会先提取所有 key 的 parseFloat 值为非负整数的属性，然后根据数字顺序对属性排序首先遍历出来，然后按照对象定义的顺序遍历余下的所有属性。</strong></p>
<h2 id="猜想"><a href="#猜想" class="headerlink" title="猜想"></a>猜想</h2><p>按照上面的解释，那么我来一个例子</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    <span class="string">'a'</span>: <span class="string">'testa'</span>,</span><br><span class="line">    <span class="string">'1'</span>: <span class="string">'test1'</span>,</span><br><span class="line">    <span class="string">'测'</span>: <span class="string">'test测'</span>,</span><br><span class="line">    <span class="string">'2'</span>: <span class="string">'test2'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.keys(obj));</span><br><span class="line"></span><br><span class="line"><span class="comment">// [1, 2, 'a', '测']</span></span><br></pre></td></tr></table></figure>

<p>果然会把 ‘1’ 和 ‘2’ 这种能被 parseFloat 转化为正整数的提到前面并且按照升序排</p>
<p>而 ‘a’ 和 ‘测’ 没法转为整数那就排在 ‘1’、’2’ 后并按照构建时的顺序拍</p>
<h2 id="解决问题"><a href="#解决问题" class="headerlink" title="解决问题"></a>解决问题</h2><p>回到问题，对象既然不能保证其顺序，那么使用数组来进行遍历吧。</p>
<p>当然业务中如果需要查某个年份的车型，而不想要每次都遍历一遍的来找的话。可以维护两份数据。一份数组，用于遍历输出，一份对象，用于查。</p>
<h2 id="参照"><a href="#参照" class="headerlink" title="参照"></a>参照</h2><p><a href="http://jartto.wang/2016/10/25/does-js-guarantee-object-property-order/" target="_blank" rel="noopener">js能够保证object属性的输出顺序吗？</a></p>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
  </entry>
  <entry>
    <title>为什么 0.1 + 0.2 !== 0.3</title>
    <url>/2018/03/27/javascript/why-0.1+0.2!==0.3/</url>
    <content><![CDATA[<h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="number">0.1</span> + <span class="number">0.2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//0.30000000000000004</span></span><br></pre></td></tr></table></figure>

<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>浮点数在计算机中的表示是用阶码与尾数结合的形式。</p>
<p>0.75 的二进制表现模式就是<code>(1  + 1 * 2 ^ -1) * 2 ^ -1</code>，为了看得直观，这里表达式中的2没有用10来表示</p>
<p>二进制中<code>2 ^ -1</code>表示的其实是十进制中的0.5。想想十进制中幂次方多1代表数值10倍，那么二进制中幂次方多1代表数值2倍。</p>
<p>0.75 在二进制中是可以妥善表现出来的。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> num = <span class="number">0.75</span>;</span><br><span class="line">num.toString(<span class="number">2</span>);</span><br><span class="line"><span class="comment">// 0.11</span></span><br></pre></td></tr></table></figure>

<p>而0.1在二进制中却是一个表现不出来的无限不循环数，所以只能取一个近似数。</p>
<p>而计算机精度有限，所能表现的值而非真正的0.1，0.2，所以自然相加时有偏差</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="number">0.1</span> + <span class="number">0.2</span> <span class="comment">// 0.30000000000000004</span></span><br><span class="line">(<span class="number">0.1</span> + <span class="number">0.2</span>).toFixed(<span class="number">2</span>) <span class="comment">// "0.30"</span></span><br><span class="line"><span class="built_in">parseFloat</span>((<span class="number">0.1</span> + <span class="number">0.2</span>).toFixed(<span class="number">2</span>)) <span class="comment">// 0.3</span></span><br><span class="line"></span><br><span class="line"><span class="number">24.99</span> * <span class="number">10000</span> <span class="comment">// 249899.99999999997</span></span><br><span class="line"><span class="built_in">parseFloat</span>((<span class="number">24.99</span> * <span class="number">10000</span>).toFixed(<span class="number">2</span>)); <span class="comment">// 249900</span></span><br></pre></td></tr></table></figure>

<p>But why ? see <a href="http://www.ecma-international.org/ecma-262/6.0/#sec-number.prototype.tofixed" target="_blank" rel="noopener">es6文档 20.1.3.3 Number.prototype.toFixed ( fractionDigits ) </a></p>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
  </entry>
  <entry>
    <title>浏览器市场份额统计</title>
    <url>/2018/03/18/browser/browser-market-share/</url>
    <content><![CDATA[<p>根据此站点显示的份额统计 <a href="http://gs.statcounter.com/browser-market-share/desktop/china" target="_blank" rel="noopener">http://gs.statcounter.com/browser-market-share/desktop/china</a></p>
<p><img src="http://7xn4mw.com1.z0.glb.clouddn.com/18-8-5/97324376.jpg" alt=""></p>
<p>chrome 占比在50%上下，半壁江山。</p>
]]></content>
      <categories>
        <category>browser</category>
      </categories>
  </entry>
  <entry>
    <title>简述浏览器渲染流程</title>
    <url>/2018/03/07/browser/chrome-rendering/</url>
    <content><![CDATA[<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><p>chrome –》 Timeline</p>
<p><img src="http://images2015.cnblogs.com/blog/751661/201702/751661-20170210141057729-386070939.png" alt=""></p>
<h2 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h2><p>浏览器的渲染过程</p>
<ol>
<li>Create/Update DOM And request css/image/js：浏览器请求到HTML代码后，在生成DOM的最开始阶段（应该是 Bytes → characters 后），并行发起css、图片、js的请求，无论他们是否在HEAD里。</li>
</ol>
<p>注意：发起 js 文件的下载 request 并不需要 DOM 处理到那个 script 节点，比如：简单的正则匹配就能做到这一点，虽然实际上并不一定是通过正则：）。这是很多人在理解渲染机制的时候存在的误区。</p>
<ol start="2">
<li><p>Create/Update Render CSSOM：CSS文件下载完成，开始构建CSSOM</p>
</li>
<li><p>Create/Update Render Tree：所有CSS文件下载完成，CSSOM构建结束后，和 DOM 一起生成 Render Tree。</p>
</li>
<li><p>Layout：有了Render Tree，浏览器已经能知道网页中有哪些节点、各个节点的CSS定义以及他们的从属关系。下一步操作称之为Layout，顾名思义就是计算出每个节点在屏幕中的位置。</p>
</li>
<li><p>Painting：Layout后，浏览器已经知道了哪些节点要显示（which nodes are visible）、每个节点的CSS属性是什么（their computed styles）、每个节点在屏幕中的位置是哪里（geometry）。就进入了最后一步：Painting，按照算出来的规则，通过显卡，把内容画到屏幕上。</p>
</li>
</ol>
<p>以上五个步骤前3个步骤之所有使用 “Create/Update” 是因为DOM、CSSOM、Render Tree都可能在第一次Painting后又被更新多次，比如JS修改了DOM或者CSS属性。</p>
<p>Layout 和 Painting 也会被重复执行，除了DOM、CSSOM更新的原因外，图片下载完成后也需要调用Layout 和 Painting来更新网页。</p>
<h4 id="重绘"><a href="#重绘" class="headerlink" title="重绘"></a>重绘</h4><p>当页面元素样式改变不影响元素在文档流中的位置时（如background-color，border-color，visibility），浏览器只会将新样式赋予元素并进行重新绘制操作。</p>
<h4 id="回流"><a href="#回流" class="headerlink" title="回流"></a>回流</h4><p>当改变的操作响应文档内容或者结构，或者元素位置时，就会触发回流。有以下几种情况：</p>
<ul>
<li>页面首次渲染</li>
<li>DOM操作（对元素的增删改、顺序变化等）</li>
<li>内容变化，包括表单区域内的文本变化</li>
<li>css属性的更改或者重新计算</li>
<li>增删样式表内容</li>
<li>修改class属性</li>
<li>浏览器窗口变化（滚动或缩放）</li>
<li>伪类样式激活（：hover等）</li>
</ul>
<p>一些常用且会导致回流的属性和方法：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">clientWidth、clientHeight、clientTop、clientLeft</span><br><span class="line">offsetWidth、offsetHeight、offsetTop、offsetLeft</span><br><span class="line">scrollWidth、scrollHeight、scrollTop、scrollLeft</span><br><span class="line">scrollIntoView()、scrollIntoViewIfNeeded()</span><br><span class="line">getComputedStyle()</span><br><span class="line">getBoundingClientRect()</span><br><span class="line">scrollTo()</span><br></pre></td></tr></table></figure>

<h2 id="css和js执行的时机"><a href="#css和js执行的时机" class="headerlink" title="css和js执行的时机"></a>css和js执行的时机</h2><p>css和js在chrome浏览器里都是并行下载的，只是执行时机不同。</p>
<p>CSS是一种渲染阻塞资源，它需要完全被解析完毕之后才能进入生成渲染树的环节。CSS并不像HTML那样能执行部分并显示，因为CSS具有继承属性， 后面定义的样式会覆盖或者修改前面的样式。如果我们只使用样式表中部分解析好的样式，我们可能会得到错误的页面效果。所以，我们只能等待CSS完全解析之后，才能进入关键渲染路径的下一环节。</p>
<p>Js脚本执行应该实在CSSOM生成之后，所以说CSS也会阻塞脚本(script blocking)。按script标签出现的顺序逐个执行，证据是jsonp请求之前必须定义全局方法，而jsonp请求后再定义全局方法将无效。</p>
<h2 id="问题的答案"><a href="#问题的答案" class="headerlink" title="问题的答案"></a>问题的答案</h2><p>问题：script标签的位置会影响首屏时间么？</p>
<p>分析：“页面渲染出来了” 指的是什么？</p>
<ol>
<li>没有图片的首屏（后面统称StepA）</li>
<li>显示了全部图片的首屏（后面统称StepB）</li>
<li>页面完整地加载好了（后面统称StepC）</li>
</ol>
<p>答：如果 “页面渲染出来了” 指的是StepA，那么问题变成：script标签的位置会影响首屏时间么？</p>
<p>不影响（如果这里的首屏指的是页面从白板变成网页画面——也就是第一次Painting），但有可能截断首屏的内容，使其只显示上面一部分。</p>
<p>如果 “页面渲染出来了” 指的是 StepC，那么script标签不放在body底部不会拖慢页面完整地加载好的时间。</p>
<h2 id="script-的-defer属性"><a href="#script-的-defer属性" class="headerlink" title="script 的 defer属性"></a>script 的 defer属性</h2><p>如果 async=”async”：脚本相对于页面的其余部分异步地执行（当页面继续进行解析时，脚本将被执行）</p>
<p>如果不使用 async 且 defer=”defer”：脚本将在页面完成解析时执行</p>
<p>如果既不使用 async 也不使用 defer：在浏览器继续解析页面之前，立即读取并执行脚本</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;script defer=&quot;defer&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>有了这条属性，script标签放在头部也不要紧。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="http://www.cnblogs.com/Christeen/p/6524797.html" target="_blank" rel="noopener">http://www.cnblogs.com/Christeen/p/6524797.html</a></p>
<p><a href="http://www.cnblogs.com/BurtBlog/p/6386195.html#commentform" target="_blank" rel="noopener">http://www.cnblogs.com/BurtBlog/p/6386195.html#commentform</a></p>
]]></content>
      <categories>
        <category>browser</category>
      </categories>
  </entry>
  <entry>
    <title>树的深搜与广搜</title>
    <url>/2018/03/06/alorigam/tree-traversal/</url>
    <content><![CDATA[<h2 id="深搜，递归"><a href="#深搜，递归" class="headerlink" title="深搜，递归"></a>深搜，递归</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepTraversal</span>(<span class="params">node</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (node != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(node);</span><br><span class="line">        <span class="keyword">let</span> children = node.children;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; children.length; i++) &#123;</span><br><span class="line">            deepTraversal(children[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">deepTraversal(<span class="built_in">document</span>.body);</span><br><span class="line"><span class="string">``</span><span class="string">` </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 广搜，非递归</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>js</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">wideTraversal</span>(<span class="params">node</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> queue = [];</span><br><span class="line">    <span class="keyword">if</span> (node != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(node);</span><br><span class="line">        queue.unshift(node);</span><br><span class="line">        <span class="keyword">while</span> (queue.length != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> item = queue.shift();</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'search: '</span> , item );</span><br><span class="line">            <span class="keyword">let</span> children = item.children;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; children.length; i++)</span><br><span class="line">                queue.push(children[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> queue;</span><br><span class="line">&#125;</span><br><span class="line">wideTraversal(<span class="built_in">document</span>.body);</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>alorigam</category>
      </categories>
  </entry>
  <entry>
    <title>浏览器的重绘与回流(Reflow & Repaint)</title>
    <url>/2018/03/06/browser/reflow-repaint/</url>
    <content><![CDATA[<h2 id="重绘"><a href="#重绘" class="headerlink" title="重绘"></a>重绘</h2><p>当页面元素样式改变不影响元素在文档流中的位置时（如background-color，border-color，visibility），浏览器只会将新样式赋予元素并进行重新绘制操作。</p>
<h2 id="回流"><a href="#回流" class="headerlink" title="回流"></a>回流</h2><p>当改变的操作响应文档内容或者结构，或者元素位置时，就会触发回流。有以下几种情况：</p>
<ul>
<li>页面首次渲染</li>
<li>DOM操作（对元素的增删改、顺序变化等）</li>
<li>内容变化，包括表单区域内的文本变化</li>
<li>css属性的更改或者重新计算</li>
<li>增删样式表内容</li>
<li>修改class属性</li>
<li>浏览器窗口变化（滚动或缩放）</li>
<li>伪类样式激活（：hover等）</li>
</ul>
<p>一些常用且会导致回流的属性和方法：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">clientWidth、clientHeight、clientTop、clientLeft</span><br><span class="line">offsetWidth、offsetHeight、offsetTop、offsetLeft</span><br><span class="line">scrollWidth、scrollHeight、scrollTop、scrollLeft</span><br><span class="line">scrollIntoView()、scrollIntoViewIfNeeded()</span><br><span class="line">getComputedStyle()</span><br><span class="line">getBoundingClientRect()</span><br><span class="line">scrollTo()</span><br></pre></td></tr></table></figure>

<h2 id="性能影响"><a href="#性能影响" class="headerlink" title="性能影响"></a>性能影响</h2><p>回流比重绘的代价要更高。</p>
<p>有时即使仅仅回流一个单一的元素，它的父元素以及任何跟随它的元素也会产生回流。</p>
<p>现代浏览器会对频繁的回流或重绘操作进行优化：</p>
<p>浏览器会维护一个队列，把所有引起回流和重绘的操作放入队列中，如果队列中的任务数量或者时间间隔达到一个阈值的，浏览器就会将队列清空，进行一次批处理，这样可以把多次回流和重绘变成一次。</p>
<p>当你访问以下属性或方法时，浏览器会立刻清空队列：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">clientWidth、clientHeight、clientTop、clientLeft</span><br><span class="line">offsetWidth、offsetHeight、offsetTop、offsetLeft</span><br><span class="line">scrollWidth、scrollHeight、scrollTop、scrollLeft</span><br><span class="line">scrollIntoView()、scrollIntoViewIfNeeded()</span><br><span class="line">getComputedStyle()</span><br><span class="line">getBoundingClientRect()</span><br><span class="line">scrollTo()</span><br></pre></td></tr></table></figure>

<p>因为队列中可能会有影响到这些属性或方法返回值的操作，即使你希望获取的信息与队列中操作引发的改变无关，浏览器也会强行清空队列，确保你拿到的值是最精确的。</p>
<h2 id="如何避免频繁的回流"><a href="#如何避免频繁的回流" class="headerlink" title="如何避免频繁的回流"></a>如何避免频繁的回流</h2><h4 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h4><ul>
<li>避免使用table布局。</li>
<li>尽可能在DOM树的最末端改变class。</li>
<li>避免设置多层内联样式。</li>
<li>将动画效果应用到position属性为absolute或fixed的元素上。</li>
<li>避免使用CSS表达式（例如：calc()）。</li>
</ul>
<h4 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h4><ul>
<li>避免频繁操作样式，最好一次性重写style属性，或者将样式列表定义为class并一次性更改class属性。</li>
<li>避免频繁操作DOM，创建一个documentFragment，在它上面应用所有DOM操作，最后再把它添加到文档中。</li>
<li>也可以先为元素设置display: none，操作结束后再把它显示出来。因为在display属性为none的元素上进行的DOM操作不会引发回流和重绘。</li>
<li>避免频繁读取会引发回流/重绘的属性，如果确实需要多次使用，就用一个变量缓存起来。</li>
<li>对具有复杂动画的元素使用绝对定位，使它脱离文档流，否则会引起父元素及后续元素频繁回流。</li>
</ul>
]]></content>
      <categories>
        <category>browser</category>
      </categories>
  </entry>
  <entry>
    <title>js 变量类型检测</title>
    <url>/2018/01/18/javascript/variable-type-checking/</url>
    <content><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>javascript的变量类型分为原始类型和引用类型。</p>
<ul>
<li>原始类型有6种, 注意多了 Symbol<ul>
<li>Number</li>
<li>String</li>
<li>Boolean</li>
<li>Null</li>
<li>Undefined</li>
<li>Symbol</li>
</ul>
</li>
<li>引用类型包括<ul>
<li>Function</li>
<li>Array</li>
<li>Date</li>
<li>Object</li>
<li>RegExp</li>
</ul>
</li>
</ul>
<p>而检测这些类型的变量有3种办法：<code>typeof</code>，<code>instanceof</code>，<code>Object.prototype.toString.call</code>。让我来一一例举，废话不多说，上代码。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//首先是typeof</span></span><br><span class="line"><span class="keyword">var</span> obj = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">typeof</span> obj; <span class="comment">//"number"</span></span><br><span class="line">obj = <span class="string">"abc"</span></span><br><span class="line"><span class="keyword">typeof</span> obj; <span class="comment">//"string"</span></span><br><span class="line">obj = <span class="literal">false</span></span><br><span class="line"><span class="keyword">typeof</span> obj; <span class="comment">//"boolean"</span></span><br><span class="line">obj = <span class="literal">undefined</span>;</span><br><span class="line"><span class="keyword">typeof</span> obj; <span class="comment">//"undefined"</span></span><br><span class="line">obj = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">typeof</span> obj; <span class="comment">//"object"，WTF，其实这是js的一个bug，人艰不拆 T_T</span></span><br><span class="line">obj = <span class="built_in">Symbol</span>();</span><br><span class="line"><span class="keyword">typeof</span> obj; <span class="comment">//"symbol"</span></span><br><span class="line"></span><br><span class="line">obj = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line"><span class="keyword">typeof</span> obj; <span class="comment">//"function"</span></span><br><span class="line">obj = [];</span><br><span class="line"><span class="keyword">typeof</span> obj; <span class="comment">//"object"</span></span><br><span class="line">obj = &#123;&#125;;</span><br><span class="line"><span class="keyword">typeof</span> obj; <span class="comment">//"object"</span></span><br><span class="line">obj = <span class="regexp">/w/g</span>;</span><br><span class="line"><span class="keyword">typeof</span> obj <span class="comment">//"object"</span></span><br></pre></td></tr></table></figure>

<p>从上面我们可以得出type能检测原始类型<code>number</code>,<code>string</code>,<code>boolean</code>,<code>undefined</code>，引用类型的<code>function</code>。但是对于数组和对象却是无法区分。</p>
<p>而关于引用类型，还可以尝试下<code>instanceof</code>操作符。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line">obj <span class="keyword">instanceof</span> <span class="built_in">Function</span>; <span class="comment">//true</span></span><br><span class="line">obj = [];</span><br><span class="line">obj <span class="keyword">instanceof</span> <span class="built_in">Array</span>; <span class="comment">//true</span></span><br><span class="line">obj = &#123;&#125;;</span><br><span class="line">obj <span class="keyword">instanceof</span> <span class="built_in">Object</span>; <span class="comment">//true</span></span><br><span class="line">obj = <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">obj <span class="keyword">instanceof</span> <span class="built_in">Date</span>; <span class="comment">//true</span></span><br><span class="line">obj = <span class="regexp">/w/g</span>;</span><br><span class="line">obj <span class="keyword">instanceof</span> <span class="built_in">RegExp</span>; <span class="comment">//true</span></span><br><span class="line"><span class="comment">//....wait for it, 事情其实还没完呢</span></span><br><span class="line">obj = [];</span><br><span class="line">obj <span class="keyword">instanceof</span> <span class="built_in">Object</span>; <span class="comment">//true  所有引用类型其实都是继承自Object对象的，所以你懂的。</span></span><br></pre></td></tr></table></figure>

<p>incetanceof 操作符能鉴别引用类型，可惜有个缺憾是，如果想鉴别一个变量object类型而不是其他的<code>function</code>，<code>array</code>，<code>date</code>什么的，仍然需要花一番力气。</p>
<p>这里我们是不是漏了什么，如果..</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = <span class="keyword">new</span> <span class="built_in">String</span>(<span class="string">'abc'</span>);</span><br><span class="line"><span class="keyword">typeof</span> obj; <span class="comment">//"object" 。 </span></span><br><span class="line">obj <span class="keyword">instanceof</span> <span class="built_in">String</span>; <span class="comment">//true 。</span></span><br></pre></td></tr></table></figure>

<p>天了个撸，不能愉快玩耍了。要解释这个, 就得解释js里变量的赋值规则。 </p>
<ul>
<li>原始类型的变量直接保存原始值，而不是一个指向对象的指针。如果一个变量赋值给另一个变量，那么每个变量都它自己的一份数据拷贝，并不会相互影响。</li>
<li>引用类型的变量保存的是一个指向内存中实际对象所在的指针（或者说引用）。因此当你将一个对象赋值给变量时，实际是赋值给这个变量一个指针。意味着将一个变量赋值给另一个变量时，两个变量指向的是内存中同一个对象。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = <span class="string">'abc'</span>;</span><br><span class="line">obj.something = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> firstChar = obj.charAt(<span class="number">0</span>); <span class="comment">//"a"</span></span><br><span class="line"><span class="built_in">console</span>.log(obj.something); <span class="comment">//undefined</span></span><br><span class="line"><span class="comment">//实际上js做了这样的处理</span></span><br><span class="line"><span class="keyword">var</span> obj = <span class="string">'abc'</span>;</span><br><span class="line"><span class="keyword">var</span> temp = <span class="keyword">new</span> <span class="built_in">String</span>(obj);</span><br><span class="line"><span class="keyword">var</span> firstChar = temp.charAt(<span class="number">0</span>); <span class="comment">//"a"</span></span><br><span class="line">temp.something = <span class="number">1</span>;</span><br><span class="line">temp = <span class="literal">null</span>;</span><br><span class="line"><span class="built_in">console</span>.log(obj.something); <span class="comment">//undefined</span></span><br></pre></td></tr></table></figure>

<p>创建了一个临时的引用类型变量去访问属性，修改属性，然后就被释放了，扯远了。</p>
<p>总而言之，如果指定<code>obj = &quot;abc&quot;</code>则obj保存的实际上就是abc的值，是一个基本类型。而如果指定<code>obj = new String(&#39;abc&#39;)</code>那么obj实际上保存的是一个指向字符串对象的指针。所以就不难理解两者对于<code>typeof</code>和<code>instanceof</code>的差别了<br>额，读者：“说了这么多，你有没有一种万全的手段哇”。好吧， 我们来一个简单又粗暴的鉴别手段。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">Object</span>.prototype.toString.call(obj) === <span class="string">'[object Number]'</span>; <span class="comment">//true</span></span><br><span class="line">obj = <span class="keyword">new</span> <span class="built_in">Number</span>(<span class="number">1</span>);</span><br><span class="line"><span class="built_in">Object</span>.prototype.toString.call(obj) === <span class="string">'[object Number]'</span>; <span class="comment">//true</span></span><br><span class="line">obj = <span class="built_in">Symbol</span>();</span><br><span class="line"><span class="built_in">Object</span>.prototype.toString.call(obj) === <span class="string">'[object Symbol]'</span>; <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line">obj = [];</span><br><span class="line"><span class="built_in">Object</span>.prototype.toString.call(obj) === <span class="string">'[object Array]'</span>; <span class="comment">//true</span></span><br><span class="line">obj = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line"><span class="built_in">Object</span>.prototype.toString.call(obj) === <span class="string">'[object Array]'</span>; <span class="comment">//true</span></span><br><span class="line"><span class="built_in">Object</span>.prototype.toString.call(obj) === <span class="string">'[object Object]'</span>; <span class="comment">//false</span></span><br></pre></td></tr></table></figure>

<p>这个方法是不是很好用呢， 哇哈哈哈哈。</p>
<p><strong>总结归纳了下，我列举了一些校验函数:</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//低版本ie中undefined变量可以被修改，所以使用void 0 获取真实的undefined值，</span></span><br><span class="line"><span class="keyword">var</span> isUndefined = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//or: return typeof obj === 'undefined';</span></span><br><span class="line">    <span class="keyword">return</span> obj === <span class="keyword">void</span> <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//typeof null 的结果是"object"。</span></span><br><span class="line"><span class="keyword">var</span> isNull = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> obj === <span class="literal">null</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// boolean值，number值和string值需要考虑两种情况，值为字面量时使用typeof和Object.prototype.toString能检测; </span></span><br><span class="line"><span class="comment">// 值为构造函数构建的时候需要使用Object.prototype.toString或者instanceof检测</span></span><br><span class="line"><span class="keyword">var</span> isBoolean = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(obj) == <span class="string">'[object Boolean]'</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> isNumber = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(obj) == <span class="string">'[object Number]'</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> isString = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(obj) == <span class="string">'[object String]'</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> isSymbol = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(obj) == <span class="string">'[object Symbol]'</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> <span class="built_in">isNaN</span> = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> obj !== obj;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//typeof 操作符在引用类型的变量里能对function有效。</span></span><br><span class="line"><span class="keyword">var</span> isFunction = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//or:  return Object.prototype.toString.call(obj) == '[object Function]';</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">typeof</span> obj === <span class="string">'function'</span>;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> isDate = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(obj) == <span class="string">'[object Date]'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> isArray = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(obj) == <span class="string">'[object Array]'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> isObject = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//or: return obj === Object(obj);</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(obj) == <span class="string">'[object Object]'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> isRegExp = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//or: return obj === Object(obj);</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(obj) == <span class="string">'[object RegExp]'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> has = <span class="function"><span class="keyword">function</span>(<span class="params">obj, key</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.hasOwnProperty.call(obj, key);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//判断数组，字符串，对象是否为空</span></span><br><span class="line"><span class="keyword">var</span> isEmpty = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (obj == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (isArray(obj) || isString(obj)) <span class="keyword">return</span> obj.length === <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> obj) <span class="keyword">if</span> (has(obj, key)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="最后再来一个好用的识别方法"><a href="#最后再来一个好用的识别方法" class="headerlink" title="最后再来一个好用的识别方法"></a>最后再来一个好用的识别方法</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getType</span>(<span class="params">p</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (obj === <span class="keyword">void</span> <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'Undefined'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (obj === <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'Null'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    /<span class="function"><span class="keyword">function</span>.(<span class="params">\w*</span>)\(<span class="params">\</span>)/.<span class="title">test</span>(<span class="params">p.constructor</span>); //通过其构造函数来获取对应的类型。</span></span><br><span class="line"><span class="function">    <span class="title">return</span> <span class="title">RegExp</span>.<span class="title">$1</span>;</span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"><span class="title">getType</span>(<span class="params"><span class="string">'1'</span></span>); //"<span class="title">String</span>"</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
  </entry>
  <entry>
    <title>new 操作符都做了什么</title>
    <url>/2018/01/18/javascript/what-does-new-in-js-do/</url>
    <content><![CDATA[<h2 id="解答"><a href="#解答" class="headerlink" title="解答"></a>解答</h2><p>stackoverflow 原提问，<a href="https://stackoverflow.com/questions/9468055/what-does-new-in-javascript-do-anyway" target="_blank" rel="noopener">https://stackoverflow.com/questions/9468055/what-does-new-in-javascript-do-anyway</a></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> f(a, b, c)</span><br></pre></td></tr></table></figure>

<p>is eaqal to </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Create a new instance using f's prototype.</span></span><br><span class="line"><span class="keyword">var</span> newInstance = <span class="built_in">Object</span>.create(f.prototype), result;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Call the function</span></span><br><span class="line">result = f.call(newInstance, a, b, c);</span><br><span class="line"></span><br><span class="line"><span class="comment">// If the result is a non-null object, use it, otherwise use the new instance.</span></span><br><span class="line">result &amp;&amp; <span class="keyword">typeof</span> result === <span class="string">'object'</span> ? result : newInstance;</span><br></pre></td></tr></table></figure>

<h2 id="testing"><a href="#testing" class="headerlink" title="testing"></a>testing</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> f = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.test = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> newInstance = <span class="built_in">Object</span>.create(f.prototype), result;</span><br><span class="line"></span><br><span class="line">result = f.call(newInstance);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(result, <span class="string">'--'</span>, newInstance);</span><br><span class="line"><span class="comment">// undefined -- f &#123;test: 1&#125;</span></span><br></pre></td></tr></table></figure>


<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> f = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.test = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> newInstance = <span class="built_in">Object</span>.create(f.prototype), result;</span><br><span class="line"></span><br><span class="line">result = f.call(newInstance);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(result, <span class="string">'--'</span>, newInstance);</span><br><span class="line"><span class="comment">// f &#123;test: 1&#125; -- f &#123;test: 1&#125;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
  </entry>
  <entry>
    <title>ES6 标准研读笔记</title>
    <url>/2018/01/16/javascript/es6-standard-reading/</url>
    <content><![CDATA[<p>阮一峰，读懂 ECMAScript 规格：<a href="http://www.ruanyifeng.com/blog/2015/11/ecmascript-specification.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2015/11/ecmascript-specification.html</a></p>
<p><a href="http://www.ecma-international.org/ecma-262/6.0/" target="_blank" rel="noopener">ES6标准在线英文文档</a></p>
<p><a href="https://www.w3.org/html/ig/zh/wiki/ES5#.E8.AF.8D.E6.B3.95" target="_blank" rel="noopener">wiki百科ES5中文翻译</a></p>
<p><a href="某个人整理的ES5中文翻译">http://yanhaijing.com/es5</a></p>
<h2 id="有人问-obj-sub-amp-amp-obj-sub-name-为什么返回的不是一个bool值，而是name值。"><a href="#有人问-obj-sub-amp-amp-obj-sub-name-为什么返回的不是一个bool值，而是name值。" class="headerlink" title="有人问 obj.sub &amp;&amp; obj.sub.name 为什么返回的不是一个bool值，而是name值。"></a>有人问 obj.sub &amp;&amp; obj.sub.name 为什么返回的不是一个bool值，而是name值。</h2><p>翻了翻es5标准，得到<a href="https://www.w3.org/html/ig/zh/wiki/ES5/%E8%A1%A8%E8%BE%BE%E5%BC%8F" target="_blank" rel="noopener">ES5/表达式</a>找到如下答案。</p>
<p>二元按位运算符</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">LogicalANDExpression :</span><br><span class="line">   BitwiseORExpression</span><br><span class="line">   LogicalANDExpression &amp;&amp; BitwiseORExpression</span><br></pre></td></tr></table></figure>

<p>语义：</p>
<p>产生式 LogicalANDExpression : LogicalANDExpression &amp;&amp; BitwiseORExpression 按照下面的过程执行：</p>
<ol>
<li>令 lref 为解释执行 LogicalANDExpression 的结果。</li>
<li>令 lval 为 GetValue(lref)。</li>
<li>如果 ToBoolean(lval) 为 false，返回 lval。</li>
<li>令 rref 为解释执行 BitwiseORExpression 的结果。</li>
<li>返回 GetValue(rref)。</li>
</ol>
<p>总之如果左表达式执行后不能转化为false，那么返回右表达式的value</p>
<h2 id="toFixed为何能解决js浮点数运算问题"><a href="#toFixed为何能解决js浮点数运算问题" class="headerlink" title="toFixed为何能解决js浮点数运算问题"></a>toFixed为何能解决js浮点数运算问题</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="number">0.1</span> + <span class="number">0.2</span> <span class="comment">// 0.30000000000000004</span></span><br><span class="line">(<span class="number">0.1</span> + <span class="number">0.2</span>).toFixed(<span class="number">2</span>) <span class="comment">// "0.30"</span></span><br><span class="line"><span class="built_in">parseFloat</span>((<span class="number">0.1</span> + <span class="number">0.2</span>).toFixed(<span class="number">2</span>)) <span class="comment">// 0.3</span></span><br><span class="line"></span><br><span class="line"><span class="number">24.99</span>*<span class="number">10000</span> <span class="comment">// 249899.99999999997</span></span><br><span class="line"><span class="built_in">parseFloat</span>((<span class="number">24.99</span>*<span class="number">10000</span>).toFixed(<span class="number">2</span>)); <span class="comment">// 249900</span></span><br></pre></td></tr></table></figure>

<p>toFixed解决精度问题，parseFloat解决不定小数点问题。那么问题来了，为何toFixed能够解决精度问题，而非简单的省却小数点做法。翻开<a href="http://www.ecma-international.org/ecma-262/6.0/#sec-number.prototype.tofixed" target="_blank" rel="noopener">es6文档 20.1.3.3 Number.prototype.toFixed ( fractionDigits ) 有答案</a></p>
<p>注意最为关键的一步</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Number.prototype.toFixed ( fractionDigits )</span><br><span class="line"></span><br><span class="line">1. Let x be thisNumberValue(this value).</span><br><span class="line">2. ReturnIfAbrupt(x).</span><br><span class="line">3. Let f be ToInteger(fractionDigits). (If fractionDigits is undefined, this step produces the value 0).</span><br><span class="line">...</span><br><span class="line">10. Else x &lt; 10^21,</span><br><span class="line">    a. Let n be an integer for which the exact mathematical value of n ÷ 10f – x is as close to zero as possible. If there are two such n, pick the larger n.</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>令 x 为运算结果的数值，令 f 为toFixed的参数转化的数值。</p>
<p>如果x小于10的21次方，则令 n 为一个整数，让 (n / 10^f – x) 准确的数学值尽可能接近零。如果有两个这样 n 值，选择较大的 n。</p>
<p>也就是意味着(0.1 + 0.2).toFixed(2)时，n值为300则其运算结果最接近0。</p>
<p>另外注意标准里 fractionDigits 小于 0 或大于 20 时会抛出 RangeError 错误，而在 Chrome 62 版浏览器中笔者亲测小于 0 或大于 100 才会抛出</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(0.1 + 0.2).toFixed(101)</span><br><span class="line">VM586:1 Uncaught RangeError: toFixed() digits argument must be between 0 and 100</span><br><span class="line">    at Number.toFixed (&lt;anonymous&gt;)</span><br><span class="line">    at &lt;anonymous&gt;:1:13</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
  </entry>
  <entry>
    <title>video 标签加载视频有声音却黑屏</title>
    <url>/2018/01/14/mobile-h5/video-black/</url>
    <content><![CDATA[<p>昨天用户上传了一个<a href="http://ukee.oss-cn-shanghai.aliyuncs.com/admin/cover/2018-1-4/71aff139-3fbc-4b82-9d7a-d693715edb25.mp4?avinfo" target="_blank" rel="noopener">视频文件</a>，然而发现虽然有声音但是黑屏。</p>
<p>因为原视频的编码是用mpeg-4标准的，chrome并不支持，所以无法播放</p>
<p>然后如果用转码功能转成用h.264编码，就可以播放了</p>
<p>最后chrome的视频解码格式参考这里：<a href="http://en.wikipedia.org/wiki/Html_video_tag" target="_blank" rel="noopener">http://en.wikipedia.org/wiki/Html_video_tag</a></p>
]]></content>
      <categories>
        <category>mobile-h5</category>
      </categories>
  </entry>
  <entry>
    <title>ES6标准之逻辑与的规则</title>
    <url>/2017/12/16/javascript/ES6-standard-LogicalANDExpression/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近看到了阮一峰的一篇(读懂 ECMAScript 规格](<a href="http://www.ruanyifeng.com/blog/2015/11/ecmascript-specification.html)，颇受鼓舞，特此收录一些在ES标准中能给我解惑的知识点。" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2015/11/ecmascript-specification.html)，颇受鼓舞，特此收录一些在ES标准中能给我解惑的知识点。</a></p>
<p>恰逢写RN的原生同事有下面的问题相问：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">obj.subObj &amp;&amp; obj.subObj.name <span class="comment">// 如果subObj存在，则表达式会输出name而非输出一个布尔值，为何？</span></span><br></pre></td></tr></table></figure>

<h2 id="解答"><a href="#解答" class="headerlink" title="解答"></a>解答</h2><h3 id="ES6原版文档"><a href="#ES6原版文档" class="headerlink" title="ES6原版文档"></a>ES6原版文档</h3><p><a href="http://www.ecma-international.org/ecma-262/6.0/" target="_blank" rel="noopener">ES6标准在线英文文档地址</a></p>
<blockquote>
<p>12.12.3 Runtime Semantics: Evaluation</p>
</blockquote>
<p>LogicalANDExpression : LogicalANDExpression &amp;&amp; BitwiseORExpression</p>
<ol>
<li>Let lref be the result of evaluating LogicalANDExpression.</li>
<li>Let lval be GetValue(lref).</li>
<li>Let lbool be ToBoolean(lval).</li>
<li>ReturnIfAbrupt(lbool).</li>
<li>If lbool is false, return lval.</li>
<li>Let rref be the result of evaluating BitwiseORExpression.</li>
<li>Return GetValue(rref).</li>
</ol>
<h3 id="翻译"><a href="#翻译" class="headerlink" title="翻译"></a>翻译</h3><ol>
<li>令 lref 为解释执行 LogicalANDExpression 的结果。</li>
<li>令 lval 为 GetValue(lref)。</li>
<li>如果 ToBoolean(lval) 为 false，返回 lval。</li>
<li>令 rref 为解释执行 BitwiseORExpression 的结果。</li>
<li>返回 GetValue(rref)。</li>
</ol>
<p>关键在第三部 ，如果 lref 左表达式执行得到的值 lval 不能被当作 false 的时候直接返回 lval，否则就要返回右表达式的执行值 rref 的具体value，而不是 bool 值。</p>
<h3 id="ToBoolean"><a href="#ToBoolean" class="headerlink" title="ToBoolean"></a>ToBoolean</h3><table>
<thead>
<tr>
<th>Argument Type</th>
<th>Result</th>
</tr>
</thead>
<tbody><tr>
<td>Completion Record</td>
<td>If argument is an abrupt completion, return argument. Otherwise return ToBoolean(argument.[[value]])</td>
</tr>
<tr>
<td>Undefined</td>
<td>Return false.</td>
</tr>
<tr>
<td>Null</td>
<td>Return false.</td>
</tr>
<tr>
<td>Boolean</td>
<td>Return argument.</td>
</tr>
<tr>
<td>Number</td>
<td>Return false if argument is +0, −0, or NaN; otherwise return true.</td>
</tr>
<tr>
<td>String</td>
<td>Return false if argument is the empty String (its length is zero); otherwise return true.</td>
</tr>
<tr>
<td>Symbol</td>
<td>Return true.</td>
</tr>
<tr>
<td>Object</td>
<td>Return true.</td>
</tr>
</tbody></table>
<p>可知左表达式如果为 <code>undefeind</code>、<code>null</code>、<code>false</code>、<code>0</code>、<code>NaN</code>、<code>空字符串</code> 的时候被当作 <code>false</code>。反之为 <code>true</code>，则返回<code>GetValue(rref)</code>。</p>
<h3 id="GetValue"><a href="#GetValue" class="headerlink" title="GetValue"></a>GetValue</h3><ol>
<li>ReturnIfAbrupt(V).</li>
<li>If Type(V) is not Reference, return V.</li>
<li>Let base be GetBase(V).</li>
<li>If IsUnresolvableReference(V), throw a ReferenceError exception.</li>
<li>If IsPropertyReference(V), then<ol>
<li>If HasPrimitiveBase(V) is true, then<ol>
<li>Assert: In this case, base will never be null or undefined.</li>
<li>Let base be ToObject(base).</li>
</ol>
</li>
<li>Return base.<a href="GetReferencedName(V">[Get]</a>, GetThisValue(V)).</li>
</ol>
</li>
<li>Else base must be an Environment Record,<ol>
<li>Return base.GetBindingValue(GetReferencedName(V), IsStrictReference(V)) (see 8.1.1).</li>
</ol>
</li>
</ol>
<p>NOTE： The object that may be created in step 5.a.ii is not accessible outside of the above abstract operation and the ordinary object [[Get]] internal method. An implementation might choose to avoid the actual creation of the object.</p>
<p>第二步谈到如果不是一个引用类型的变量则直接返回这个变量本身，所以 <code>obj.subObj.name</code> 返回的就是 name 属性。</p>
<h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h2><p>那么逻辑或也是同理</p>
<p>LogicalORExpression : LogicalORExpression || LogicalANDExpression</p>
<ol>
<li>Let lref be the result of evaluating LogicalORExpression.</li>
<li>Let lval be GetValue(lref).</li>
<li>Let lbool be ToBoolean(lval).</li>
<li>ReturnIfAbrupt(lbool).</li>
<li>If lbool is true, return lval.</li>
<li>Let rref be the result of evaluating LogicalANDExpression.</li>
<li>Return GetValue(rref).</li>
</ol>
<p>只是判断 lval 能被当成 true 的时候则返回 lval 本身，否则返回 GetValue(rref).</p>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>ES6</tag>
      </tags>
  </entry>
  <entry>
    <title>webpack 把你的 vue 项目编译成了什么</title>
    <url>/2017/12/11/js-util/what-webpack-has-compiled-vue-project/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>往 main.js 里写入最简单的 vue 项目结构如下</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App.vue'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">'#app'</span>,</span><br><span class="line">    template: <span class="string">'&lt;App/&gt;'</span>,</span><br><span class="line">    components: &#123;</span><br><span class="line">        App</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>App.vue 如下</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; msg &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Essential Links<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://vuejs.org"</span> <span class="attr">target</span>=<span class="string">"_blank"</span>&gt;</span>Core Docs<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://forum.vuejs.org"</span> <span class="attr">target</span>=<span class="string">"_blank"</span>&gt;</span>Forum<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://chat.vuejs.org"</span> <span class="attr">target</span>=<span class="string">"_blank"</span>&gt;</span>Community Chat<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://twitter.com/vuejs"</span> <span class="attr">target</span>=<span class="string">"_blank"</span>&gt;</span>Twitter<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Ecosystem<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://router.vuejs.org/"</span> <span class="attr">target</span>=<span class="string">"_blank"</span>&gt;</span>vue-router<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://vuex.vuejs.org/"</span> <span class="attr">target</span>=<span class="string">"_blank"</span>&gt;</span>vuex<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://vue-loader.vuejs.org/"</span> <span class="attr">target</span>=<span class="string">"_blank"</span>&gt;</span>vue-loader<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://github.com/vuejs/awesome-vue"</span> <span class="attr">target</span>=<span class="string">"_blank"</span>&gt;</span>awesome-vue<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="actionscript">    name: <span class="string">'app'</span>,</span></span><br><span class="line">    data() &#123;</span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="actionscript">            msg: <span class="string">'Welcome to Your Vue.js App'</span></span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-id">#app</span> &#123;</span></span><br><span class="line">    font-family: 'Avenir', Helvetica, Arial, sans-serif;</span><br><span class="line">    -webkit-font-smoothing: antialiased;</span><br><span class="line">    -moz-osx-font-smoothing: grayscale;</span><br><span class="line">    text-align: center;</span><br><span class="line"><span class="css">    <span class="selector-tag">color</span>: <span class="selector-id">#2c3e50</span>;</span></span><br><span class="line">    margin-top: 60px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">h1,</span><br><span class="line">h2 &#123;</span><br><span class="line">    font-weight: normal;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ul &#123;</span><br><span class="line">    list-style-type: none;</span><br><span class="line">    padding: 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">li &#123;</span><br><span class="line">    display: inline-block;</span><br><span class="line">    margin: 0 10px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">a &#123;</span><br><span class="line"><span class="css">    <span class="selector-tag">color</span>: <span class="selector-id">#42b983</span>;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>编译生成后得到一个316kb的文件，而在316Kb中包含着什么，我很好奇想探索一番。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm run build</span><br><span class="line"></span><br><span class="line">&gt; learning-in-vue@1.0.0 build /Users/everlose/workspace/github/learningInVue</span><br><span class="line">&gt; cross-env NODE_ENV=production webpack --progress --hide-modules</span><br><span class="line"></span><br><span class="line">Hash: 18d868a423b48dc263e9</span><br><span class="line">Version: webpack 3.9.1</span><br><span class="line">Time: 3693ms</span><br><span class="line">       Asset    Size  Chunks                    Chunk Names</span><br><span class="line">    build.js  316 kB       0  [emitted]  [big]  main</span><br><span class="line">build.js.map  399 kB       0  [emitted]         main</span><br></pre></td></tr></table></figure>

<h2 id="代码分解"><a href="#代码分解" class="headerlink" title="代码分解"></a>代码分解</h2><p>按顺序往下解读，<a href="https://github.com/everlose/learningInVue/blob/v0.0.2/dist/build.js" target="_blank" rel="noopener">本篇编译后的代码在这儿</a>，如果只想看结论那么请拉到最后有一张结构梳理图。</p>
<h3 id="webpack-模块机制"><a href="#webpack-模块机制" class="headerlink" title="webpack 模块机制"></a>webpack 模块机制</h3><p>前面70行还是熟悉的 webpack 模块机制的基础代码，关于它的细致解读参见上一篇<a href="https://github.com/everlose/learningInVue/blob/master/docs/webpack%E6%A8%A1%E5%9D%97%E6%9C%BA%E5%88%B6.md" target="_blank" rel="noopener">webpack模块机制</a>，编译后的代码格式如下，并且我做了代码美化，并且插上了中文注释</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/******/</span> (<span class="function"><span class="keyword">function</span>(<span class="params">modules</span>) </span>&#123; <span class="comment">// webpackBootstrap</span></span><br><span class="line"><span class="comment">/******/</span>     <span class="comment">// The module cache</span></span><br><span class="line"><span class="comment">/******/</span>     <span class="comment">// 缓存模块，所有被加载过的模块都会成为installedModules对象的属性，靠函数__webpack_require__做到。</span></span><br><span class="line"><span class="comment">/******/</span>     <span class="keyword">var</span> installedModules = &#123;&#125;;</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span>     <span class="comment">// The require function 核心加载方法</span></span><br><span class="line"><span class="comment">/******/</span>     <span class="function"><span class="keyword">function</span> <span class="title">__webpack_require__</span>(<span class="params">moduleId</span>) </span>&#123;</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span>         <span class="comment">// Check if module is in cache</span></span><br><span class="line"><span class="comment">/******/</span>         <span class="comment">// 检查模块是否已在缓存中，是则直接返回缓存中的模块不需要再次加载</span></span><br><span class="line"><span class="comment">/******/</span>         <span class="keyword">if</span>(installedModules[moduleId]) &#123;</span><br><span class="line"><span class="comment">/******/</span>             <span class="keyword">return</span> installedModules[moduleId].exports;</span><br><span class="line"><span class="comment">/******/</span>         &#125;</span><br><span class="line"><span class="comment">/******/</span>         <span class="comment">// Create a new module (and put it into the cache)</span></span><br><span class="line"><span class="comment">/******/</span>         <span class="comment">// 创造一个新模块并放入缓存中，i是模块标识，l意为是否加载此模块完毕，exports是此模块执行后的输出对象</span></span><br><span class="line"><span class="comment">/******/</span>         <span class="keyword">var</span> <span class="built_in">module</span> = installedModules[moduleId] = &#123;</span><br><span class="line"><span class="comment">/******/</span>             i: moduleId,</span><br><span class="line"><span class="comment">/******/</span>             l: <span class="literal">false</span>,</span><br><span class="line"><span class="comment">/******/</span>             exports: &#123;&#125;</span><br><span class="line"><span class="comment">/******/</span>         &#125;;</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span>         <span class="comment">// Execute the module function</span></span><br><span class="line"><span class="comment">/******/</span>         <span class="comment">// 传入参数并执行模块函数</span></span><br><span class="line"><span class="comment">/******/</span>         modules[moduleId].call(<span class="built_in">module</span>.exports, <span class="built_in">module</span>, <span class="built_in">module</span>.exports, __webpack_require__);</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span>         <span class="comment">// Flag the module as loaded 标为true代表模块执行完成。</span></span><br><span class="line"><span class="comment">/******/</span>         <span class="built_in">module</span>.l = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span>         <span class="comment">// Return the exports of the module 返回此模块输出的对象</span></span><br><span class="line"><span class="comment">/******/</span>         <span class="keyword">return</span> <span class="built_in">module</span>.exports;</span><br><span class="line"><span class="comment">/******/</span>     &#125;</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span>     <span class="comment">// expose the modules object (__webpack_modules__)</span></span><br><span class="line"><span class="comment">/******/</span>     <span class="comment">// webpack 私有变量，保存传入的modules，即所有的模块组成的数组</span></span><br><span class="line"><span class="comment">/******/</span>     __webpack_require__.m = modules;</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span>     <span class="comment">// expose the module cache</span></span><br><span class="line"><span class="comment">/******/</span>     <span class="comment">// 保存缓存中的模块数组</span></span><br><span class="line"><span class="comment">/******/</span>     __webpack_require__.c = installedModules;</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span>     <span class="comment">// define getter function for harmony exports</span></span><br><span class="line"><span class="comment">/******/</span>     <span class="comment">// 为 es6 exports 定义 getter</span></span><br><span class="line"><span class="comment">/******/</span>     __webpack_require__.d = <span class="function"><span class="keyword">function</span>(<span class="params">exports, name, getter</span>) </span>&#123;</span><br><span class="line"><span class="comment">/******/</span>         <span class="comment">// 如果 exports 输出的对象本身不包含 name 属性时，定义一个。</span></span><br><span class="line"><span class="comment">/******/</span>         <span class="keyword">if</span>(!__webpack_require__.o(exports, name)) &#123;</span><br><span class="line"><span class="comment">/******/</span>             <span class="built_in">Object</span>.defineProperty(exports, name, &#123;</span><br><span class="line"><span class="comment">/******/</span>                 configurable: <span class="literal">false</span>,</span><br><span class="line"><span class="comment">/******/</span>                 enumerable: <span class="literal">true</span>,</span><br><span class="line"><span class="comment">/******/</span>                 <span class="keyword">get</span>: getter</span><br><span class="line">/******/             &#125;);</span><br><span class="line">/******/         &#125;</span><br><span class="line">/******/     &#125;;</span><br><span class="line">/******/</span><br><span class="line">/******/     // getDefaultExport function for compatibility with non-harmony modules</span><br><span class="line">/******/     // 解决 ES module 和 Common js module 的冲突，ES 则返回 module['default']</span><br><span class="line">/******/     __webpack_require__.n = function(module) &#123;</span><br><span class="line"><span class="comment">/******/</span>         <span class="keyword">var</span> getter = <span class="built_in">module</span> &amp;&amp; <span class="built_in">module</span>.__esModule ?</span><br><span class="line"><span class="comment">/******/</span>             <span class="function"><span class="keyword">function</span> <span class="title">getDefault</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="built_in">module</span>[<span class="string">'default'</span>]; &#125; :</span><br><span class="line"><span class="comment">/******/</span>             <span class="function"><span class="keyword">function</span> <span class="title">getModuleExports</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="built_in">module</span>; &#125;;</span><br><span class="line"><span class="comment">/******/</span>         __webpack_require__.d(getter, <span class="string">'a'</span>, getter);</span><br><span class="line"><span class="comment">/******/</span>         <span class="keyword">return</span> getter;</span><br><span class="line"><span class="comment">/******/</span>     &#125;;</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span>     <span class="comment">// Object.prototype.hasOwnProperty.call</span></span><br><span class="line"><span class="comment">/******/</span>     <span class="comment">// 工具方法，判断是否object有property属性。</span></span><br><span class="line"><span class="comment">/******/</span>     __webpack_require__.o = <span class="function"><span class="keyword">function</span>(<span class="params">object, property</span>) </span>&#123; <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.hasOwnProperty.call(object, property); &#125;;</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span>     <span class="comment">// __webpack_public_path__</span></span><br><span class="line"><span class="comment">/******/</span>     <span class="comment">// 大概和 webpack.config.js 的 output 有关吧，webpack 的公共路径</span></span><br><span class="line"><span class="comment">/******/</span>     __webpack_require__.p = <span class="string">"/dist/"</span>;</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span>     <span class="comment">// Load entry module and return exports 执行第一个依赖模块并且返回它输出。</span></span><br><span class="line"><span class="comment">/******/</span>     <span class="keyword">return</span> __webpack_require__(__webpack_require__.s = <span class="number">0</span>);</span><br><span class="line"><span class="comment">/******/</span> &#125;)</span><br></pre></td></tr></table></figure>

<h3 id="0号模块"><a href="#0号模块" class="headerlink" title="0号模块"></a>0号模块</h3><p>导出一个全局变量，在web端就是指代window</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 0 */</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">module, exports</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> g;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// This works in non-strict mode</span></span><br><span class="line">    g = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;)();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// This works if eval is allowed (see CSP)</span></span><br><span class="line">        g = g || <span class="built_in">Function</span>(<span class="string">"return this"</span>)() || (<span class="number">1</span>, <span class="built_in">eval</span>)(<span class="string">"this"</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="comment">// This works if the window reference is available</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">window</span> === <span class="string">"object"</span>)</span><br><span class="line">            g = <span class="built_in">window</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// g can still be undefined, but nothing to do about it...</span></span><br><span class="line">    <span class="comment">// We return undefined, instead of nothing here, so it's</span></span><br><span class="line">    <span class="comment">// easier to handle this case. if(!global) &#123; ...&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">module</span>.exports = g;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/***/</span></span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure>

<h3 id="1号模块"><a href="#1号模块" class="headerlink" title="1号模块"></a>1号模块</h3><p>实际上做的事情很明显，就是导出了 main.js 的代码，一个vue实例对象</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 1 */</span></span><br><span class="line"><span class="comment">/***/</span> (<span class="function"><span class="keyword">function</span>(<span class="params">module, __webpack_exports__, __webpack_require__</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(__webpack_exports__, <span class="string">"__esModule"</span>, &#123; <span class="attr">value</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"><span class="comment">/* harmony import */</span> <span class="keyword">var</span> __WEBPACK_IMPORTED_MODULE_0_vue__ = __webpack_require__(<span class="number">2</span>);</span><br><span class="line"><span class="comment">/* harmony import */</span> <span class="keyword">var</span> __WEBPACK_IMPORTED_MODULE_1__App_vue__ = __webpack_require__(<span class="number">6</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从2号模块导出的一个叫a的变量，就是Vue对象本身</span></span><br><span class="line"><span class="keyword">new</span> __WEBPACK_IMPORTED_MODULE_0_vue__[<span class="string">"a"</span> <span class="comment">/* default */</span>](&#123;</span><br><span class="line">    el: <span class="string">'#app'</span>,</span><br><span class="line">    template: <span class="string">'&lt;App/&gt;'</span>,</span><br><span class="line">    components: &#123;</span><br><span class="line">        App: __WEBPACK_IMPORTED_MODULE_1__App_vue__[<span class="string">"a"</span> <span class="comment">/* default */</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/***/</span> &#125;)</span><br></pre></td></tr></table></figure>

<h3 id="2号模块"><a href="#2号模块" class="headerlink" title="2号模块"></a>2号模块</h3><p>即是 Vue 源码本身，从114行一直到了10818行，一共是10705行代码，啧啧啧</p>
<p>webpack 有所配置，所以导出的 Vue 实际上是 vue/dist/vue.esm.js 的完整编译版本。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 2 */</span></span><br><span class="line"><span class="comment">/***/</span> (<span class="function"><span class="keyword">function</span> (<span class="params">module, __webpack_exports__, __webpack_require__</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"><span class="comment">/*!</span></span><br><span class="line"><span class="comment"> * Vue.js v2.5.9</span></span><br><span class="line"><span class="comment"> * (c) 2014-2017 Evan You</span></span><br><span class="line"><span class="comment"> * Released under the MIT License.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 作用域指向__webpack_exports__，并把__webpack_require__(0)作为global，实际上就是window</span></span><br><span class="line"><span class="comment">// __webpack_require__(3).setImmediate)作为setsetImmediate参数传入函数</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">global, setImmediate</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 省略近1w行的代码，关于vue原本本身的解读以后再做......</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 最终 export 出来一个叫 Vue$3的对象</span></span><br><span class="line">    <span class="comment">/* harmony default export */</span></span><br><span class="line">    __webpack_exports__[<span class="string">"a"</span>] = (Vue$<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* WEBPACK VAR INJECTION */</span></span><br><span class="line">&#125;.call(__webpack_exports__, __webpack_require__(<span class="number">0</span>), __webpack_require__(<span class="number">3</span>).setImmediate))</span><br><span class="line"></span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure>

<h3 id="3，4，5号模块"><a href="#3，4，5号模块" class="headerlink" title="3，4，5号模块"></a>3，4，5号模块</h3><p>都和 node_modules/setimmediate 有关，由于 vue 的 DOM 异步更新机制使用到了它，所以被引入。</p>
<p>这里也不做详解，只给出结构。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 3 */</span></span><br><span class="line"><span class="comment">/***/</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">module, exports, __webpack_require__</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 省略代码...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// setimmediate attaches itself to the global object</span></span><br><span class="line">    __webpack_require__(<span class="number">4</span>);</span><br><span class="line">    exports.setImmediate = setImmediate;</span><br><span class="line">    exports.clearImmediate = clearImmediate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***/</span></span><br><span class="line">&#125;),</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 4 */</span></span><br><span class="line"><span class="comment">/***/</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">module, exports, __webpack_require__</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* WEBPACK VAR INJECTION */</span></span><br><span class="line">    (<span class="function"><span class="keyword">function</span> (<span class="params">global, process</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 省略代码...</span></span><br><span class="line">    &#125;.call(exports, __webpack_require__(<span class="number">0</span>), __webpack_require__(<span class="number">5</span>)))</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***/</span></span><br><span class="line">&#125;),</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 5 */</span></span><br><span class="line"><span class="comment">/***/</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">module, exports</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// shim for using process in browser</span></span><br><span class="line">    <span class="keyword">var</span> process = <span class="built_in">module</span>.exports = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 省略代码...</span></span><br><span class="line"></span><br><span class="line">    process.cwd = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'/'</span></span><br><span class="line">    &#125;;</span><br><span class="line">    process.chdir = <span class="function"><span class="keyword">function</span> (<span class="params">dir</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'process.chdir is not supported'</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    process.umask = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">/***/</span></span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure>

<h3 id="6号模块"><a href="#6号模块" class="headerlink" title="6号模块"></a>6号模块</h3><p>和 App.vue 的解析有关，把 App.vue 中的 template 和 script 编译为一个 vue components，并把 style 标签内的样式插入到DOM中。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 6 */</span></span><br><span class="line"><span class="comment">/***/</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">module, __webpack_exports__, __webpack_require__</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">    "use strict"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回具体 App.vue 中 的script 中的代码</span></span><br><span class="line">    <span class="keyword">var</span> __WEBPACK_IMPORTED_MODULE_0__babel_loader_node_modules_vue_loader_lib_selector_type_script_index_0_App_vue__ = __webpack_require__(<span class="number">13</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 把App.vue 的 template 解析为一堆 vue render 函数。</span></span><br><span class="line">    <span class="keyword">var</span> __WEBPACK_IMPORTED_MODULE_1__node_modules_vue_loader_lib_template_compiler_index_id_data_v_66ce2159_hasScoped_false_buble_transforms_node_modules_vue_loader_lib_selector_type_template_index_0_App_vue__ = __webpack_require__(<span class="number">14</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注入vue文件里写入的css函数</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">injectStyle</span>(<span class="params">ssrContext</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 由此可知7号模块是编译并插入vue中的css到DOM上的</span></span><br><span class="line">        __webpack_require__(<span class="number">7</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 12号模块用于输出components渲染函数</span></span><br><span class="line">    <span class="keyword">var</span> normalizeComponent = __webpack_require__(<span class="number">12</span>)</span><br><span class="line">    <span class="comment">/* script */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* template */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* template functional */</span></span><br><span class="line">    <span class="keyword">var</span> __vue_template_functional__ = <span class="literal">false</span></span><br><span class="line">    <span class="comment">/* styles */</span></span><br><span class="line">    <span class="keyword">var</span> __vue_styles__ = injectStyle</span><br><span class="line">    <span class="comment">/* scopeId */</span></span><br><span class="line">    <span class="keyword">var</span> __vue_scopeId__ = <span class="literal">null</span></span><br><span class="line">    <span class="comment">/* moduleIdentifier (server only) */</span></span><br><span class="line">    <span class="keyword">var</span> __vue_module_identifier__ = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 编译模块，混杂template和script。</span></span><br><span class="line">    <span class="keyword">var</span> Component = normalizeComponent(</span><br><span class="line">        __WEBPACK_IMPORTED_MODULE_0__babel_loader_node_modules_vue_loader_lib_selector_type_script_index_0_App_vue__[<span class="string">"a"</span> <span class="comment">/* default */</span> ],</span><br><span class="line">        __WEBPACK_IMPORTED_MODULE_1__node_modules_vue_loader_lib_template_compiler_index_id_data_v_66ce2159_hasScoped_false_buble_transforms_node_modules_vue_loader_lib_selector_type_template_index_0_App_vue__[<span class="string">"a"</span> <span class="comment">/* default */</span> ],</span><br><span class="line">        __vue_template_functional__,</span><br><span class="line">        __vue_styles__,</span><br><span class="line">        __vue_scopeId__,</span><br><span class="line">        __vue_module_identifier__</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* harmony default export */</span></span><br><span class="line">    __webpack_exports__[<span class="string">"a"</span>] = (Component.exports);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/***/</span></span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure>

<h3 id="7、8、9、10、11"><a href="#7、8、9、10、11" class="headerlink" title="7、8、9、10、11"></a>7、8、9、10、11</h3><p>都和样式有关，简言之就是7号模块加载8号模块获取css代码作为参数，并作为参数传入10号模块进行插入</p>
<p>太长也只大意上列出结构</p>
<ul>
<li>7号模块由 style-loader 带入，把所有的css插入到 style 标签里</li>
<li>8号模块加载具体的css代码，</li>
<li>9号模块由css-loader代入，用于做css的sourceMap</li>
<li>10号模块返回具体插入动作函数，供7号模块调用</li>
<li>11号模块把所有的样式组成的数组转为字符串，给10号模块做插入。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 7 */</span></span><br><span class="line"><span class="comment">/***/</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">module, exports, __webpack_require__</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// style-loader: Adds some css to the DOM by adding a &lt;style&gt; tag</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// load the styles</span></span><br><span class="line">    <span class="keyword">var</span> content = __webpack_require__(<span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> content === <span class="string">'string'</span>) content = [</span><br><span class="line">        [<span class="built_in">module</span>.i, content, <span class="string">''</span>]</span><br><span class="line">    ];</span><br><span class="line">    <span class="keyword">if</span> (content.locals) <span class="built_in">module</span>.exports = content.locals;</span><br><span class="line">    <span class="comment">// add the styles to the DOM</span></span><br><span class="line">    <span class="keyword">var</span> update = __webpack_require__(<span class="number">10</span>)(<span class="string">"15459d21"</span>, content, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***/</span></span><br><span class="line">&#125;),</span><br><span class="line"><span class="comment">/* 8 */</span></span><br><span class="line"><span class="comment">/***/</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">module, exports, __webpack_require__</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// css-loader 用于做css的sourceMap</span></span><br><span class="line">    exports = <span class="built_in">module</span>.exports = __webpack_require__(<span class="number">9</span>)(<span class="literal">undefined</span>);</span><br><span class="line">    <span class="comment">// imports</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// module</span></span><br><span class="line">    <span class="comment">// 这就是 App.vue 文件中 style 里的的 css</span></span><br><span class="line">    exports.push([<span class="built_in">module</span>.i, <span class="string">"#app&#123;font-family:Avenir,Helvetica,Arial,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;text-align:center;color:#2c3e50;margin-top:60px&#125;h1,h2&#123;font-weight:400&#125;ul&#123;list-style-type:none;padding:0&#125;li&#123;display:inline-block;margin:0 10px&#125;a&#123;color:#42b983&#125;"</span>, <span class="string">""</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// exports</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/***/</span></span><br><span class="line">&#125;),</span><br><span class="line"><span class="comment">/* 9 */</span></span><br><span class="line"><span class="comment">/***/</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">module, exports</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// css base code, injected by the css-loader</span></span><br><span class="line">    <span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">useSourceMap</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 省略代码...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;),</span><br><span class="line"><span class="comment">/* 10 */</span></span><br><span class="line"><span class="comment">/***/</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">module, exports, __webpack_require__</span>) </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        MIT License http://www.opensource.org/licenses/mit-license.php</span></span><br><span class="line"><span class="comment">        Author Tobias Koppers @sokra</span></span><br><span class="line"><span class="comment">        Modified by Evan You @yyx990803</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...太长只贴了关键步骤，总之关键的函数就是这些</span></span><br><span class="line">    <span class="keyword">var</span> hasDocument = <span class="keyword">typeof</span> <span class="built_in">document</span> !== <span class="string">'undefined'</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">var</span> listToStyles = __webpack_require__(<span class="number">11</span>)</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">var</span> head = hasDocument &amp;&amp; (<span class="built_in">document</span>.head || <span class="built_in">document</span>.getElementsByTagName(<span class="string">'head'</span>)[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">parentId, list, _isProduction</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="keyword">var</span> styles = listToStyles(parentId, list)</span><br><span class="line">        addStylesToDom(styles)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span> (<span class="params">newList</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">addStylesToDom</span> (<span class="params">styles <span class="regexp">/* Array&lt;StyleObject&gt; */</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; styles.length; i++) &#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">            domStyle.parts.push(addStyle(item.parts[j]))</span><br><span class="line">            <span class="comment">// ....</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 总之先调用了addStylesToDom，接着是addStyle，再是createStyleElement插入样式到head中。</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">createStyleElement</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> styleElement = <span class="built_in">document</span>.createElement(<span class="string">'style'</span>)</span><br><span class="line">    styleElement.type = <span class="string">'text/css'</span></span><br><span class="line">    head.appendChild(styleElement)</span><br><span class="line">    <span class="keyword">return</span> styleElement</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">addStyle</span> (<span class="params">obj <span class="regexp">/* StyleObjectPart */</span></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        styleElement = createStyleElement()</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***/</span></span><br><span class="line">&#125;),</span><br><span class="line"><span class="comment">/* 11 */</span></span><br><span class="line"><span class="comment">/***/</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">module, exports</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Translates the list format produced by css-loader into something</span></span><br><span class="line"><span class="comment">     * easier to manipulate.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="title">listToStyles</span>(<span class="params">parentId, list</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> styles = []</span><br><span class="line">        <span class="keyword">var</span> newStyles = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; list.length; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> item = list[i]</span><br><span class="line">            <span class="keyword">var</span> id = item[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">var</span> css = item[<span class="number">1</span>]</span><br><span class="line">            <span class="keyword">var</span> media = item[<span class="number">2</span>]</span><br><span class="line">            <span class="keyword">var</span> sourceMap = item[<span class="number">3</span>]</span><br><span class="line">            <span class="keyword">var</span> part = &#123;</span><br><span class="line">                id: parentId + <span class="string">':'</span> + i,</span><br><span class="line">                css: css,</span><br><span class="line">                media: media,</span><br><span class="line">                sourceMap: sourceMap</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!newStyles[id]) &#123;</span><br><span class="line">                styles.push(newStyles[id] = &#123;</span><br><span class="line">                    id: id,</span><br><span class="line">                    parts: [part]</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                newStyles[id].parts.push(part)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> styles</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/***/</span></span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure>

<h3 id="12、13、14号模块"><a href="#12、13、14号模块" class="headerlink" title="12、13、14号模块"></a>12、13、14号模块</h3><p>12号做 .vue 文件中的 template 和 script 解析并供6号输出，最终返回了一个 vue components 对象，在浏览器控制台打印如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Object</span><br><span class="line">    beforeCreate: [ƒ]</span><br><span class="line">    data: ƒ data()</span><br><span class="line">    inject: &#123;&#125;</span><br><span class="line">    name: &quot;app&quot;</span><br><span class="line">    render: ƒ ()</span><br><span class="line">    staticRenderFns: (2) [ƒ, ƒ, cached: Array(2)]</span><br><span class="line">    _Ctor: &#123;0: ƒ&#125;</span><br><span class="line">    _compiled: true</span><br><span class="line">    __proto__: Object</span><br></pre></td></tr></table></figure>

<p>而13号模块返回具体 script 中的代码，而14号模块则是把 template 解析为一堆 vue render 函数。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 12 */</span></span><br><span class="line"><span class="comment">/***/</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">module, exports</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* globals __VUE_SSR_CONTEXT__ */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// IMPORTANT: Do NOT use ES2015 features in this file.</span></span><br><span class="line">    <span class="comment">// This module is a runtime utility for cleaner component module output and will</span></span><br><span class="line">    <span class="comment">// be included in the final webpack user bundle.</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="title">normalizeComponent</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">        rawScriptExports,</span></span></span><br><span class="line"><span class="function"><span class="params">        compiledTemplate,</span></span></span><br><span class="line"><span class="function"><span class="params">        functionalTemplate,</span></span></span><br><span class="line"><span class="function"><span class="params">        injectStyles,</span></span></span><br><span class="line"><span class="function"><span class="params">        scopeId,</span></span></span><br><span class="line"><span class="function"><span class="params">        moduleIdentifier <span class="regexp">/* server only */</span></span></span></span><br><span class="line"><span class="function"><span class="params">    </span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> esModule</span><br><span class="line">        <span class="keyword">var</span> scriptExports = rawScriptExports = rawScriptExports || &#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ES6 modules interop</span></span><br><span class="line">        <span class="keyword">var</span> type = <span class="keyword">typeof</span> rawScriptExports.default</span><br><span class="line">        <span class="keyword">if</span> (type === <span class="string">'object'</span> || type === <span class="string">'function'</span>) &#123;</span><br><span class="line">            esModule = rawScriptExports</span><br><span class="line">            scriptExports = rawScriptExports.default</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Vue.extend constructor export interop</span></span><br><span class="line">        <span class="keyword">var</span> options = <span class="keyword">typeof</span> scriptExports === <span class="string">'function'</span> ?</span><br><span class="line">            scriptExports.options :</span><br><span class="line">            scriptExports</span><br><span class="line"></span><br><span class="line">        <span class="comment">// render functions</span></span><br><span class="line">        <span class="keyword">if</span> (compiledTemplate) &#123;</span><br><span class="line">            options.render = compiledTemplate.render</span><br><span class="line">            options.staticRenderFns = compiledTemplate.staticRenderFns</span><br><span class="line">            options._compiled = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// functional template</span></span><br><span class="line">        <span class="keyword">if</span> (functionalTemplate) &#123;</span><br><span class="line">            options.functional = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// scopedId</span></span><br><span class="line">        <span class="keyword">if</span> (scopeId) &#123;</span><br><span class="line">            options._scopeId = scopeId</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> hook</span><br><span class="line">        <span class="keyword">if</span> (moduleIdentifier) &#123; <span class="comment">// server build</span></span><br><span class="line">            hook = <span class="function"><span class="keyword">function</span> (<span class="params">context</span>) </span>&#123;</span><br><span class="line">                <span class="comment">// 2.3 injection</span></span><br><span class="line">                context =</span><br><span class="line">                    context || <span class="comment">// cached call</span></span><br><span class="line">                    (<span class="keyword">this</span>.$vnode &amp;&amp; <span class="keyword">this</span>.$vnode.ssrContext) || <span class="comment">// stateful</span></span><br><span class="line">                    (<span class="keyword">this</span>.parent &amp;&amp; <span class="keyword">this</span>.parent.$vnode &amp;&amp; <span class="keyword">this</span>.parent.$vnode.ssrContext) <span class="comment">// functional</span></span><br><span class="line">                <span class="comment">// 2.2 with runInNewContext: true</span></span><br><span class="line">                <span class="keyword">if</span> (!context &amp;&amp; <span class="keyword">typeof</span> __VUE_SSR_CONTEXT__ !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line">                    context = __VUE_SSR_CONTEXT__</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// inject component styles</span></span><br><span class="line">                <span class="keyword">if</span> (injectStyles) &#123;</span><br><span class="line">                    injectStyles.call(<span class="keyword">this</span>, context)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// register component module identifier for async chunk inferrence</span></span><br><span class="line">                <span class="keyword">if</span> (context &amp;&amp; context._registeredComponents) &#123;</span><br><span class="line">                    context._registeredComponents.add(moduleIdentifier)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// used by ssr in case component is cached and beforeCreate</span></span><br><span class="line">            <span class="comment">// never gets called</span></span><br><span class="line">            options._ssrRegister = hook</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (injectStyles) &#123;</span><br><span class="line">            hook = injectStyles</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (hook) &#123;</span><br><span class="line">            <span class="keyword">var</span> functional = options.functional</span><br><span class="line">            <span class="keyword">var</span> existing = functional ?</span><br><span class="line">                options.render :</span><br><span class="line">                options.beforeCreate</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!functional) &#123;</span><br><span class="line">                <span class="comment">// inject component registration as beforeCreate hook</span></span><br><span class="line">                options.beforeCreate = existing ?</span><br><span class="line">                    [].concat(existing, hook) :</span><br><span class="line">                    [hook]</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// for template-only hot-reload because in that case the render fn doesn't</span></span><br><span class="line">                <span class="comment">// go through the normalizer</span></span><br><span class="line">                options._injectStyles = hook</span><br><span class="line">                <span class="comment">// register for functioal component in vue file</span></span><br><span class="line">                options.render = <span class="function"><span class="keyword">function</span> <span class="title">renderWithStyleInjection</span>(<span class="params">h, context</span>) </span>&#123;</span><br><span class="line">                    hook.call(context)</span><br><span class="line">                    <span class="keyword">return</span> existing(h, context)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            esModule: esModule,</span><br><span class="line">            exports: scriptExports,</span><br><span class="line">            options: options</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/***/</span></span><br><span class="line">&#125;),</span><br><span class="line"><span class="comment">/* 13 */</span></span><br><span class="line"><span class="comment">/***/</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">module, __webpack_exports__, __webpack_require__</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">    "use strict"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* harmony default export */</span></span><br><span class="line">    <span class="comment">// 这就是 App.vue 中 script 的部分</span></span><br><span class="line">    __webpack_exports__[<span class="string">"a"</span>] = (&#123;</span><br><span class="line">        name: <span class="string">'app'</span>,</span><br><span class="line">        data: <span class="function"><span class="keyword">function</span> <span class="title">data</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                msg: <span class="string">'Welcome to Your Vue.js App'</span></span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***/</span></span><br><span class="line">&#125;),</span><br><span class="line"><span class="comment">/* 14 */</span></span><br><span class="line"><span class="comment">/***/</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">module, __webpack_exports__, __webpack_require__</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">    "use strict"</span>;</span><br><span class="line">    <span class="comment">// 把template 解析为一堆 render 函数，扔给vue处理最终编译成Vnode节点在渲染成DOM输出到视图</span></span><br><span class="line">    <span class="keyword">var</span> render = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> _vm = <span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">var</span> _h = _vm.$createElement;</span><br><span class="line">        <span class="keyword">var</span> _c = _vm._self._c || _h;</span><br><span class="line">        <span class="keyword">return</span> _c(<span class="string">'div'</span>, &#123;</span><br><span class="line">            attrs: &#123;</span><br><span class="line">                <span class="string">"id"</span>: <span class="string">"app"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, [_c(<span class="string">'h1'</span>, [_vm._v(_vm._s(_vm.msg))]), _vm._v(<span class="string">" "</span>), _c(<span class="string">'h2'</span>, [_vm._v(<span class="string">"Essential Links"</span>)]), _vm._v(<span class="string">" "</span>), _vm._m(<span class="number">0</span>, <span class="literal">false</span>, <span class="literal">false</span>), _vm._v(<span class="string">" "</span>), _c(<span class="string">'h2'</span>, [_vm._v(<span class="string">"Ecosystem"</span>)]), _vm._v(<span class="string">" "</span>), _vm._m(<span class="number">1</span>, <span class="literal">false</span>, <span class="literal">false</span>)])</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> staticRenderFns = [<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> _vm = <span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">var</span> _h = _vm.$createElement;</span><br><span class="line">        <span class="keyword">var</span> _c = _vm._self._c || _h;</span><br><span class="line">        <span class="keyword">return</span> _c(<span class="string">'ul'</span>, [_c(<span class="string">'li'</span>, [_c(<span class="string">'a'</span>, &#123;</span><br><span class="line">            attrs: &#123;</span><br><span class="line">                <span class="string">"href"</span>: <span class="string">"https://vuejs.org"</span>,</span><br><span class="line">                <span class="string">"target"</span>: <span class="string">"_blank"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, [_vm._v(<span class="string">"Core Docs"</span>)])]), _vm._v(<span class="string">" "</span>), _c(<span class="string">'li'</span>, [_c(<span class="string">'a'</span>, &#123;</span><br><span class="line">            attrs: &#123;</span><br><span class="line">                <span class="string">"href"</span>: <span class="string">"https://forum.vuejs.org"</span>,</span><br><span class="line">                <span class="string">"target"</span>: <span class="string">"_blank"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, [_vm._v(<span class="string">"Forum"</span>)])]), _vm._v(<span class="string">" "</span>), _c(<span class="string">'li'</span>, [_c(<span class="string">'a'</span>, &#123;</span><br><span class="line">            attrs: &#123;</span><br><span class="line">                <span class="string">"href"</span>: <span class="string">"https://chat.vuejs.org"</span>,</span><br><span class="line">                <span class="string">"target"</span>: <span class="string">"_blank"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, [_vm._v(<span class="string">"Community Chat"</span>)])]), _vm._v(<span class="string">" "</span>), _c(<span class="string">'li'</span>, [_c(<span class="string">'a'</span>, &#123;</span><br><span class="line">            attrs: &#123;</span><br><span class="line">                <span class="string">"href"</span>: <span class="string">"https://twitter.com/vuejs"</span>,</span><br><span class="line">                <span class="string">"target"</span>: <span class="string">"_blank"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, [_vm._v(<span class="string">"Twitter"</span>)])])])</span><br><span class="line">    &#125;, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> _vm = <span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">var</span> _h = _vm.$createElement;</span><br><span class="line">        <span class="keyword">var</span> _c = _vm._self._c || _h;</span><br><span class="line">        <span class="keyword">return</span> _c(<span class="string">'ul'</span>, [_c(<span class="string">'li'</span>, [_c(<span class="string">'a'</span>, &#123;</span><br><span class="line">            attrs: &#123;</span><br><span class="line">                <span class="string">"href"</span>: <span class="string">"http://router.vuejs.org/"</span>,</span><br><span class="line">                <span class="string">"target"</span>: <span class="string">"_blank"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, [_vm._v(<span class="string">"vue-router"</span>)])]), _vm._v(<span class="string">" "</span>), _c(<span class="string">'li'</span>, [_c(<span class="string">'a'</span>, &#123;</span><br><span class="line">            attrs: &#123;</span><br><span class="line">                <span class="string">"href"</span>: <span class="string">"http://vuex.vuejs.org/"</span>,</span><br><span class="line">                <span class="string">"target"</span>: <span class="string">"_blank"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, [_vm._v(<span class="string">"vuex"</span>)])]), _vm._v(<span class="string">" "</span>), _c(<span class="string">'li'</span>, [_c(<span class="string">'a'</span>, &#123;</span><br><span class="line">            attrs: &#123;</span><br><span class="line">                <span class="string">"href"</span>: <span class="string">"http://vue-loader.vuejs.org/"</span>,</span><br><span class="line">                <span class="string">"target"</span>: <span class="string">"_blank"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, [_vm._v(<span class="string">"vue-loader"</span>)])]), _vm._v(<span class="string">" "</span>), _c(<span class="string">'li'</span>, [_c(<span class="string">'a'</span>, &#123;</span><br><span class="line">            attrs: &#123;</span><br><span class="line">                <span class="string">"href"</span>: <span class="string">"https://github.com/vuejs/awesome-vue"</span>,</span><br><span class="line">                <span class="string">"target"</span>: <span class="string">"_blank"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, [_vm._v(<span class="string">"awesome-vue"</span>)])])])</span><br><span class="line">    &#125;]</span><br><span class="line">    <span class="keyword">var</span> esExports = &#123;</span><br><span class="line">        render: render,</span><br><span class="line">        staticRenderFns: staticRenderFns</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* harmony default export */</span></span><br><span class="line">    __webpack_exports__[<span class="string">"a"</span>] = (esExports);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***/</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>结构梳理，一图胜千言，并且有关于<a href="http://naotu.baidu.com/file/89611b9bc6cd0ac214a98abbd5062ade?token=60ef60d5ed3a60cf" target="_blank" rel="noopener">此图的附注请自行点击参考</a></p>
<p><img src="http://7xn4mw.com1.z0.glb.clouddn.com/17-12-10/52589634.jpg" alt=""></p>
<p>上一篇：<a href="https://github.com/everlose/learningInVue/blob/master/docs/webpack%E6%A8%A1%E5%9D%97%E6%9C%BA%E5%88%B6.md" target="_blank" rel="noopener">webpack模块机制</a></p>
]]></content>
      <categories>
        <category>js-util</category>
      </categories>
      <tags>
        <tag>vue</tag>
        <tag>webpack</tag>
      </tags>
  </entry>
  <entry>
    <title>webpack 打包机制</title>
    <url>/2017/12/11/js-util/webpack-core/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>示例项目由以下命令检出，或者可以翻<a href="https://github.com/everlose/learningInVue" target="_blank" rel="noopener">我的 github</a>，示例所使用的 webpack3 的版本为 3.9.1。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vue init webpack-simple learning-in-vue</span><br></pre></td></tr></table></figure>

<h2 id="一个最简单的例子"><a href="#一个最简单的例子" class="headerlink" title="一个最简单的例子"></a>一个最简单的例子</h2><p>修改入口文件 <code>src/main.js</code></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="string">'This is src/main.js'</span></span><br></pre></td></tr></table></figure>

<p>并且我找到 <code>webpack.config.js</code> 注释掉了 <code>UglifyJsPlugin</code></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// new webpack.optimize.UglifyJsPlugin(&#123;</span></span><br><span class="line"><span class="comment">//     sourceMap: true,</span></span><br><span class="line"><span class="comment">//     compress: &#123;</span></span><br><span class="line"><span class="comment">//         warnings: false</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">// &#125;),</span></span><br></pre></td></tr></table></figure>

<p>最后在 <code>npm run build</code> 后产生了大概70行的代码。且看 <code>dist/build.js</code>，我写上了英文注释的翻译</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/******/</span> (<span class="function"><span class="keyword">function</span>(<span class="params">modules</span>) </span>&#123; <span class="comment">// webpackBootstrap</span></span><br><span class="line"><span class="comment">/******/</span> 	<span class="comment">// The module cache</span></span><br><span class="line"><span class="comment">/******/</span> 	<span class="keyword">var</span> installedModules = &#123;&#125;;</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span> 	<span class="comment">// The require function</span></span><br><span class="line"><span class="comment">/******/</span> 	<span class="function"><span class="keyword">function</span> <span class="title">__webpack_require__</span>(<span class="params">moduleId</span>) </span>&#123;</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span> 		<span class="comment">// Check if module is in cache</span></span><br><span class="line"><span class="comment">/******/</span> 		<span class="keyword">if</span>(installedModules[moduleId]) &#123;</span><br><span class="line"><span class="comment">/******/</span> 			<span class="keyword">return</span> installedModules[moduleId].exports;</span><br><span class="line"><span class="comment">/******/</span> 		&#125;</span><br><span class="line"><span class="comment">/******/</span> 		<span class="comment">// Create a new module (and put it into the cache)</span></span><br><span class="line"><span class="comment">/******/</span> 		<span class="keyword">var</span> <span class="built_in">module</span> = installedModules[moduleId] = &#123;</span><br><span class="line"><span class="comment">/******/</span> 			i: moduleId,</span><br><span class="line"><span class="comment">/******/</span> 			l: <span class="literal">false</span>,</span><br><span class="line"><span class="comment">/******/</span> 			exports: &#123;&#125;</span><br><span class="line"><span class="comment">/******/</span> 		&#125;;</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span> 		<span class="comment">// Execute the module function</span></span><br><span class="line"><span class="comment">/******/</span> 		modules[moduleId].call(<span class="built_in">module</span>.exports, <span class="built_in">module</span>, <span class="built_in">module</span>.exports, __webpack_require__);</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span> 		<span class="comment">// Flag the module as loaded</span></span><br><span class="line"><span class="comment">/******/</span> 		<span class="built_in">module</span>.l = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span> 		<span class="comment">// Return the exports of the module</span></span><br><span class="line"><span class="comment">/******/</span> 		<span class="keyword">return</span> <span class="built_in">module</span>.exports;</span><br><span class="line"><span class="comment">/******/</span> 	&#125;</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span> 	<span class="comment">// expose the modules object (__webpack_modules__)</span></span><br><span class="line"><span class="comment">/******/</span> 	__webpack_require__.m = modules;</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span> 	<span class="comment">// expose the module cache</span></span><br><span class="line"><span class="comment">/******/</span> 	__webpack_require__.c = installedModules;</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span> 	<span class="comment">// define getter function for harmony exports</span></span><br><span class="line"><span class="comment">/******/</span> 	__webpack_require__.d = <span class="function"><span class="keyword">function</span>(<span class="params">exports, name, getter</span>) </span>&#123;</span><br><span class="line"><span class="comment">/******/</span> 		<span class="keyword">if</span>(!__webpack_require__.o(exports, name)) &#123;</span><br><span class="line"><span class="comment">/******/</span> 			<span class="built_in">Object</span>.defineProperty(exports, name, &#123;</span><br><span class="line"><span class="comment">/******/</span> 				configurable: <span class="literal">false</span>,</span><br><span class="line"><span class="comment">/******/</span> 				enumerable: <span class="literal">true</span>,</span><br><span class="line"><span class="comment">/******/</span> 				<span class="keyword">get</span>: getter</span><br><span class="line">/******/ 			&#125;);</span><br><span class="line">/******/ 		&#125;</span><br><span class="line">/******/ 	&#125;;</span><br><span class="line">/******/</span><br><span class="line">/******/ 	// getDefaultExport function for compatibility with non-harmony modules</span><br><span class="line">/******/ 	__webpack_require__.n = function(module) &#123;</span><br><span class="line"><span class="comment">/******/</span> 		<span class="keyword">var</span> getter = <span class="built_in">module</span> &amp;&amp; <span class="built_in">module</span>.__esModule ?</span><br><span class="line"><span class="comment">/******/</span> 			<span class="function"><span class="keyword">function</span> <span class="title">getDefault</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="built_in">module</span>[<span class="string">'default'</span>]; &#125; :</span><br><span class="line"><span class="comment">/******/</span> 			<span class="function"><span class="keyword">function</span> <span class="title">getModuleExports</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="built_in">module</span>; &#125;;</span><br><span class="line"><span class="comment">/******/</span> 		__webpack_require__.d(getter, <span class="string">'a'</span>, getter);</span><br><span class="line"><span class="comment">/******/</span> 		<span class="keyword">return</span> getter;</span><br><span class="line"><span class="comment">/******/</span> 	&#125;;</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span> 	<span class="comment">// Object.prototype.hasOwnProperty.call</span></span><br><span class="line"><span class="comment">/******/</span> 	__webpack_require__.o = <span class="function"><span class="keyword">function</span>(<span class="params">object, property</span>) </span>&#123; <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.hasOwnProperty.call(object, property); &#125;;</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span> 	<span class="comment">// __webpack_public_path__</span></span><br><span class="line"><span class="comment">/******/</span> 	__webpack_require__.p = <span class="string">"/dist/"</span>;</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span> 	<span class="comment">// Load entry module and return exports</span></span><br><span class="line"><span class="comment">/******/</span> 	<span class="keyword">return</span> __webpack_require__(__webpack_require__.s = <span class="number">0</span>);</span><br><span class="line"><span class="comment">/******/</span> &#125;)</span><br><span class="line"><span class="comment">/************************************************************************/</span></span><br><span class="line"><span class="comment">/******/</span> ([</span><br><span class="line"><span class="comment">/* 0 */</span></span><br><span class="line"><span class="comment">/***/</span> (<span class="function"><span class="keyword">function</span>(<span class="params">module, __webpack_exports__, __webpack_require__</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(__webpack_exports__, <span class="string">"__esModule"</span>, &#123; <span class="attr">value</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"><span class="comment">/* harmony default export */</span> __webpack_exports__[<span class="string">"default"</span>] = (<span class="string">'This is src/main.js'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/***/</span> &#125;)</span><br><span class="line"><span class="comment">/******/</span> ]);</span><br><span class="line"><span class="comment">//# sourceMappingURL=build.js.map</span></span><br></pre></td></tr></table></figure>

<p>这么多星号看着好唬人，没想到区区一行 <code>console.log</code> 都能被编译成 70 多行的代码！来简化一下，这个结构无非就是立即调用的函数表达式罢了，并且把所有引用模块包装成一个数组作为参数传入，就如下面代码所展示的：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">modules</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;)([</span><br><span class="line">    (<span class="function"><span class="keyword">function</span>(<span class="params">module, exports</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'This is src/main.js'</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<p>而这个立即调用的函数表达式，前60多行的代码就是 webpack require 的核心。我大概翻译一下</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/******/</span> (<span class="function"><span class="keyword">function</span>(<span class="params">modules</span>) </span>&#123; <span class="comment">// webpackBootstrap</span></span><br><span class="line"><span class="comment">/******/</span> 	<span class="comment">// The module cache</span></span><br><span class="line"><span class="comment">/******/</span> 	<span class="comment">// 缓存模块，所有被加载过的模块都会成为installedModules对象的属性，靠函数__webpack_require__做到。</span></span><br><span class="line"><span class="comment">/******/</span> 	<span class="keyword">var</span> installedModules = &#123;&#125;;</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span> 	<span class="comment">// The require function 核心加载方法</span></span><br><span class="line"><span class="comment">/******/</span> 	<span class="function"><span class="keyword">function</span> <span class="title">__webpack_require__</span>(<span class="params">moduleId</span>) </span>&#123;</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span> 		<span class="comment">// Check if module is in cache</span></span><br><span class="line"><span class="comment">/******/</span> 		<span class="comment">// 检查模块是否已在缓存中，是则直接返回缓存中的模块不需要再次加载</span></span><br><span class="line"><span class="comment">/******/</span> 		<span class="keyword">if</span>(installedModules[moduleId]) &#123;</span><br><span class="line"><span class="comment">/******/</span> 			<span class="keyword">return</span> installedModules[moduleId].exports;</span><br><span class="line"><span class="comment">/******/</span> 		&#125;</span><br><span class="line"><span class="comment">/******/</span> 		<span class="comment">// Create a new module (and put it into the cache)</span></span><br><span class="line"><span class="comment">/******/</span> 		<span class="comment">// 创造一个新模块并放入缓存中，i是模块标识，l意为是否加载此模块完毕，exports是此模块执行后的输出对象</span></span><br><span class="line"><span class="comment">/******/</span> 		<span class="keyword">var</span> <span class="built_in">module</span> = installedModules[moduleId] = &#123;</span><br><span class="line"><span class="comment">/******/</span> 			i: moduleId,</span><br><span class="line"><span class="comment">/******/</span> 			l: <span class="literal">false</span>,</span><br><span class="line"><span class="comment">/******/</span> 			exports: &#123;&#125;</span><br><span class="line"><span class="comment">/******/</span> 		&#125;;</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span> 		<span class="comment">// Execute the module function</span></span><br><span class="line"><span class="comment">/******/</span> 		<span class="comment">// 传入参数并执行模块函数</span></span><br><span class="line"><span class="comment">/******/</span> 		modules[moduleId].call(<span class="built_in">module</span>.exports, <span class="built_in">module</span>, <span class="built_in">module</span>.exports, __webpack_require__);</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span> 		<span class="comment">// Flag the module as loaded 标为true代表模块执行完成。</span></span><br><span class="line"><span class="comment">/******/</span> 		<span class="built_in">module</span>.l = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span> 		<span class="comment">// Return the exports of the module 返回此模块输出的对象</span></span><br><span class="line"><span class="comment">/******/</span> 		<span class="keyword">return</span> <span class="built_in">module</span>.exports;</span><br><span class="line"><span class="comment">/******/</span> 	&#125;</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span> 	<span class="comment">// expose the modules object (__webpack_modules__)</span></span><br><span class="line"><span class="comment">/******/</span> 	<span class="comment">// webpack 私有变量，保存传入的modules，即所有的模块组成的数组</span></span><br><span class="line"><span class="comment">/******/</span> 	__webpack_require__.m = modules;</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span> 	<span class="comment">// expose the module cache</span></span><br><span class="line"><span class="comment">/******/</span> 	<span class="comment">// 保存缓存中的模块数组</span></span><br><span class="line"><span class="comment">/******/</span> 	__webpack_require__.c = installedModules;</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span> 	<span class="comment">// define getter function for harmony exports</span></span><br><span class="line"><span class="comment">/******/</span> 	<span class="comment">// 为 es6 exports 定义 getter</span></span><br><span class="line"><span class="comment">/******/</span> 	__webpack_require__.d = <span class="function"><span class="keyword">function</span>(<span class="params">exports, name, getter</span>) </span>&#123;</span><br><span class="line"><span class="comment">/******/</span> 	    <span class="comment">// 如果 exports 输出的对象本身不包含 name 属性时，定义一个。</span></span><br><span class="line"><span class="comment">/******/</span> 		<span class="keyword">if</span>(!__webpack_require__.o(exports, name)) &#123;</span><br><span class="line"><span class="comment">/******/</span> 			<span class="built_in">Object</span>.defineProperty(exports, name, &#123;</span><br><span class="line"><span class="comment">/******/</span> 				configurable: <span class="literal">false</span>,</span><br><span class="line"><span class="comment">/******/</span> 				enumerable: <span class="literal">true</span>,</span><br><span class="line"><span class="comment">/******/</span> 				<span class="keyword">get</span>: getter</span><br><span class="line">/******/ 			&#125;);</span><br><span class="line">/******/ 		&#125;</span><br><span class="line">/******/ 	&#125;;</span><br><span class="line">/******/</span><br><span class="line">/******/ 	// getDefaultExport function for compatibility with non-harmony modules</span><br><span class="line">/******/ 	// 解决 ES module 和 Common js module 的冲突，ES 则返回 module['default']</span><br><span class="line">/******/ 	__webpack_require__.n = function(module) &#123;</span><br><span class="line"><span class="comment">/******/</span> 		<span class="keyword">var</span> getter = <span class="built_in">module</span> &amp;&amp; <span class="built_in">module</span>.__esModule ?</span><br><span class="line"><span class="comment">/******/</span> 			<span class="function"><span class="keyword">function</span> <span class="title">getDefault</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="built_in">module</span>[<span class="string">'default'</span>]; &#125; :</span><br><span class="line"><span class="comment">/******/</span> 			<span class="function"><span class="keyword">function</span> <span class="title">getModuleExports</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="built_in">module</span>; &#125;;</span><br><span class="line"><span class="comment">/******/</span> 		__webpack_require__.d(getter, <span class="string">'a'</span>, getter);</span><br><span class="line"><span class="comment">/******/</span> 		<span class="keyword">return</span> getter;</span><br><span class="line"><span class="comment">/******/</span> 	&#125;;</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span> 	<span class="comment">// Object.prototype.hasOwnProperty.call</span></span><br><span class="line"><span class="comment">/******/</span> 	<span class="comment">// 工具方法，判断是否object有property属性。</span></span><br><span class="line"><span class="comment">/******/</span> 	__webpack_require__.o = <span class="function"><span class="keyword">function</span>(<span class="params">object, property</span>) </span>&#123; <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.hasOwnProperty.call(object, property); &#125;;</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span> 	<span class="comment">// __webpack_public_path__</span></span><br><span class="line"><span class="comment">/******/</span> 	<span class="comment">// 大概和 webpack.config.js 的 output 有关吧，webpack 的公共路径</span></span><br><span class="line"><span class="comment">/******/</span> 	__webpack_require__.p = <span class="string">"/dist/"</span>;</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span> 	<span class="comment">// Load entry module and return exports 执行第一个依赖模块并且返回它输出。</span></span><br><span class="line"><span class="comment">/******/</span> 	<span class="keyword">return</span> __webpack_require__(__webpack_require__.s = <span class="number">0</span>);</span><br><span class="line"><span class="comment">/******/</span> &#125;)</span><br><span class="line"><span class="comment">/************************************************************************/</span></span><br><span class="line"><span class="comment">/******/</span> ([</span><br><span class="line"><span class="comment">/* 0 */</span></span><br><span class="line"><span class="comment">/***/</span> (<span class="function"><span class="keyword">function</span>(<span class="params">module, __webpack_exports__, __webpack_require__</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(__webpack_exports__, <span class="string">"__esModule"</span>, &#123; <span class="attr">value</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"><span class="comment">/* harmony default export */</span> __webpack_exports__[<span class="string">"default"</span>] = (<span class="string">'This is src/main.js'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/***/</span> &#125;)</span><br><span class="line"><span class="comment">/******/</span> ]);</span><br><span class="line"><span class="comment">//# sourceMappingURL=build.js.map</span></span><br></pre></td></tr></table></figure>

<p>注意关键的一步，在下面完成了模块注入最为关键的一步。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// moduleId第一次执行时为0，modules[0]既是外部第一个依赖</span></span><br><span class="line"><span class="comment">// 执行时 this 作用域指向 module.exports 的那个对象</span></span><br><span class="line"><span class="comment">// 并传入参数 module, module.exports, __webpack_require__</span></span><br><span class="line">modules[moduleId].call(<span class="built_in">module</span>.exports, <span class="built_in">module</span>, <span class="built_in">module</span>.exports, __webpack_require__);</span><br><span class="line"></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体模块执行收到参数 module, module.exports, __webpack_require__</span></span><br><span class="line"><span class="comment">// 并且修改了 __webpack_exports__ 给他加入了 default 属性对象。</span></span><br><span class="line"><span class="comment">// __esModule标记本模块是es6模块，__webpack_require__.n 将会处理它输出 module['default']</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">module, __webpack_exports__, __webpack_require__</span>) </span>&#123;</span><br><span class="line"><span class="meta">    "use strict"</span>;</span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(__webpack_exports__, <span class="string">"__esModule"</span>, &#123; <span class="attr">value</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">    <span class="comment">/* harmony default export */</span> __webpack_exports__[<span class="string">"default"</span>] = (<span class="string">'This is src/main.js'</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="其他引入方式"><a href="#其他引入方式" class="headerlink" title="其他引入方式"></a>其他引入方式</h2><p>就如 <a href="https://doc.webpack-china.org/concepts/modules#-webpack-" target="_blank" rel="noopener">webpack 3</a> 官网所说</p>
<blockquote>
<p>对比 Node.js 模块，webpack 模块能够以各种方式表达它们的依赖关系，几个例子如下：</p>
</blockquote>
<ul>
<li>ES2015 import 语句</li>
<li>CommonJS require() 语句</li>
<li>AMD define 和 require 语句</li>
<li>css/sass/less 文件中的 @import 语句。</li>
<li>样式(url(…))或 HTML 文件中的图片链接(image url)</li>
</ul>
<p>webpack 能处理的模块类型比较多，上面的例子里我们只演示 ES2015 import 语句。</p>
<h3 id="CommonJs-require"><a href="#CommonJs-require" class="headerlink" title="CommonJs require()"></a>CommonJs require()</h3><p>src/main.js 写成</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="string">'This is src/main.js'</span>;</span><br></pre></td></tr></table></figure>

<p>那么 dist/build.js 将会是</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/******/</span> (<span class="function"><span class="keyword">function</span>(<span class="params">modules</span>) </span>&#123; <span class="comment">// webpackBootstrap</span></span><br><span class="line"><span class="comment">/******/</span> 	<span class="comment">// ...</span></span><br><span class="line"><span class="comment">/******/</span> &#125;)</span><br><span class="line"><span class="comment">/************************************************************************/</span></span><br><span class="line"><span class="comment">/******/</span> ([</span><br><span class="line"><span class="comment">/* 0 */</span></span><br><span class="line"><span class="comment">/***/</span> (<span class="function"><span class="keyword">function</span>(<span class="params">module, exports</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体模块执行收到参数 module, module.exports（空对象）, __webpack_require__</span></span><br><span class="line"><span class="comment">// 这里正好修改 module.exports。</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="string">'This is src/main.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***/</span> &#125;)</span><br><span class="line"><span class="comment">/******/</span> ]);</span><br><span class="line"><span class="comment">//# sourceMappingURL=build.js.map</span></span><br></pre></td></tr></table></figure>

<h3 id="Amd-模块"><a href="#Amd-模块" class="headerlink" title="Amd 模块"></a>Amd 模块</h3><p>src/main.js 写成</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">define([], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        amd: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'AMD'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>那么 dist/build.js 将会是</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/******/</span> (<span class="function"><span class="keyword">function</span>(<span class="params">modules</span>) </span>&#123; <span class="comment">// webpackBootstrap</span></span><br><span class="line"><span class="comment">/******/</span> 	<span class="comment">// ...</span></span><br><span class="line"><span class="comment">/******/</span> &#125;)</span><br><span class="line"><span class="comment">/************************************************************************/</span></span><br><span class="line"><span class="comment">/******/</span> ([</span><br><span class="line"><span class="comment">/* 0 */</span></span><br><span class="line"><span class="comment">/***/</span> (<span class="function"><span class="keyword">function</span>(<span class="params">module, exports, __webpack_require__</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_RESULT__ = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        amd: <span class="function"><span class="keyword">function</span> <span class="title">amd</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'AMD'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),</span><br><span class="line">				__WEBPACK_AMD_DEFINE_RESULT__ !== <span class="literal">undefined</span> &amp;&amp; (<span class="built_in">module</span>.exports = __WEBPACK_AMD_DEFINE_RESULT__));</span><br><span class="line"></span><br><span class="line"><span class="comment">/***/</span> &#125;)</span><br><span class="line"><span class="comment">/******/</span> ]);</span><br><span class="line"><span class="comment">//# sourceMappingURL=build.js.map</span></span><br></pre></td></tr></table></figure>

<p>生成了好啰嗦的的一段，简言之还是跳不脱 <code>module.exports = __WEBPACK_AMD_DEFINE_RESULT__</code> 这句话</p>
<h3 id="image"><a href="#image" class="headerlink" title="image"></a>image</h3><p>webpack 竟然能把这些静态资源作为模块，但其实这是通过loader实现的。 image 则可配置 url-loader 设置，被编译成base 64编码的串。</p>
<p>在 <code>webpack.config.js</code> 中配置 url-loader 并 舍弃 file-loader，配置 url-loader 若在 1Mb 大小内的图片则直接编译为base 64编码。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     test: /\.(png|jpg|gif|svg)$/,</span></span><br><span class="line"><span class="comment">//     loader: 'file-loader',</span></span><br><span class="line"><span class="comment">//     options: &#123;</span></span><br><span class="line"><span class="comment">//         name: '[name].[ext]?[hash]'</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">// &#125;,</span></span><br><span class="line">&#123;</span><br><span class="line">    test: <span class="regexp">/\.(png|jpg|gif|svg)$/</span>,</span><br><span class="line">    loader: <span class="string">'url-loader'</span>,</span><br><span class="line">    options: &#123;</span><br><span class="line">        limit: <span class="number">10000</span>,</span><br><span class="line">        name: <span class="string">'[name].[ext]?[hash]'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure>

<p>修改 <code>src/main.js</code>，使其引入图片</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> image <span class="keyword">from</span> <span class="string">'./assets/images/logo.png'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> image</span><br></pre></td></tr></table></figure>

<p>编译后的 <code>dist/build.js</code> 则</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/******/</span> (<span class="function"><span class="keyword">function</span>(<span class="params">modules</span>) </span>&#123; <span class="comment">// webpackBootstrap</span></span><br><span class="line"><span class="comment">/******/</span> 	<span class="comment">// ...</span></span><br><span class="line"><span class="comment">/******/</span> &#125;)</span><br><span class="line"><span class="comment">/************************************************************************/</span></span><br><span class="line"><span class="comment">/******/</span> ([</span><br><span class="line"><span class="comment">/* 0 */</span></span><br><span class="line"><span class="comment">/***/</span> (<span class="function"><span class="keyword">function</span>(<span class="params">module, __webpack_exports__, __webpack_require__</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(__webpack_exports__, <span class="string">"__esModule"</span>, &#123; <span class="attr">value</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"><span class="comment">// 0号模块 从 1号模块导出中获得了图片，__webpack_require__ 实际上是所有的以来模块数组</span></span><br><span class="line"><span class="comment">/* harmony import */</span> <span class="keyword">var</span> __WEBPACK_IMPORTED_MODULE_0__assets_images_logo_png__ = __webpack_require__(<span class="number">1</span>);</span><br><span class="line"><span class="comment">/* harmony import */</span> <span class="keyword">var</span> __WEBPACK_IMPORTED_MODULE_0__assets_images_logo_png___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0__assets_images_logo_png__);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* harmony default export */</span> __webpack_exports__[<span class="string">"default"</span>] = (__WEBPACK_IMPORTED_MODULE_0__assets_images_logo_png___default.a);</span><br><span class="line"></span><br><span class="line"><span class="comment">/***/</span> &#125;),</span><br><span class="line"><span class="comment">/* 1 */</span></span><br><span class="line"><span class="comment">/***/</span> (<span class="function"><span class="keyword">function</span>(<span class="params">module, exports</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 省略真正的base 64图片编码，太长了</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgA..........."</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/***/</span> &#125;)</span><br><span class="line"><span class="comment">/******/</span> ]);</span><br><span class="line"><span class="comment">//# sourceMappingURL=build.js.map</span></span><br></pre></td></tr></table></figure>

<h3 id="css"><a href="#css" class="headerlink" title="css"></a>css</h3><p>css 在本项目中则通过 vue-style-loader 与 css-loader 转化为js代码，调用时就是被插入。</p>
<p>在 <code>src/main.js</code> 下写入</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> style <span class="keyword">from</span> <span class="string">'./assets/styles/reset.css'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> style;</span><br></pre></td></tr></table></figure>

<p>编译后的 <code>dist/build.js</code> 将会多出一大堆的函数，首先0号依赖还是熟悉的面孔</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/******/</span> (<span class="function"><span class="keyword">function</span>(<span class="params">modules</span>) </span>&#123; <span class="comment">// webpackBootstrap</span></span><br><span class="line"><span class="comment">/******/</span> 	<span class="comment">// ...</span></span><br><span class="line"><span class="comment">/******/</span> &#125;)</span><br><span class="line"><span class="comment">/************************************************************************/</span></span><br><span class="line"><span class="comment">/******/</span> ([</span><br><span class="line"><span class="comment">/* 0 */</span></span><br><span class="line"><span class="comment">/***/</span> (<span class="function"><span class="keyword">function</span>(<span class="params">module, __webpack_exports__, __webpack_require__</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 0号模块依旧是熟悉的代码，依赖于 1号模块输出的对象。</span></span><br><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(__webpack_exports__, <span class="string">"__esModule"</span>, &#123; <span class="attr">value</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"><span class="comment">/* harmony import */</span> <span class="keyword">var</span> __WEBPACK_IMPORTED_MODULE_0__assets_styles_reset_css__ = __webpack_require__(<span class="number">1</span>);</span><br><span class="line"><span class="comment">/* harmony import */</span> <span class="keyword">var</span> __WEBPACK_IMPORTED_MODULE_0__assets_styles_reset_css___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0__assets_styles_reset_css__);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* harmony default export */</span> __webpack_exports__[<span class="string">"default"</span>] = (__WEBPACK_IMPORTED_MODULE_0__assets_styles_reset_css___default.a);</span><br><span class="line"></span><br><span class="line"><span class="comment">/***/</span> &#125;),</span><br><span class="line"><span class="comment">/* 1 */</span></span><br><span class="line"><span class="comment">/***/</span> (<span class="function"><span class="keyword">function</span>(<span class="params">module, exports, __webpack_require__</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// style-loader: Adds some css to the DOM by adding a &lt;style&gt; tag</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// load the styles 调用2号模块获取css具体内容</span></span><br><span class="line"><span class="keyword">var</span> content = __webpack_require__(<span class="number">2</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">typeof</span> content === <span class="string">'string'</span>) content = [[<span class="built_in">module</span>.i, content, <span class="string">''</span>]];</span><br><span class="line"><span class="keyword">if</span>(content.locals) <span class="built_in">module</span>.exports = content.locals;</span><br><span class="line"><span class="comment">// add the styles to the DOM 调用4号模块去具体插入css内容</span></span><br><span class="line"><span class="keyword">var</span> update = __webpack_require__(<span class="number">4</span>)(<span class="string">"0b88176b"</span>, content, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/***/</span> &#125;),</span><br><span class="line"><span class="comment">/* 2 */</span></span><br><span class="line"><span class="comment">/***/</span> (<span class="function"><span class="keyword">function</span>(<span class="params">module, exports, __webpack_require__</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">exports = <span class="built_in">module</span>.exports = __webpack_require__(<span class="number">3</span>)(<span class="literal">undefined</span>);</span><br><span class="line"><span class="comment">// imports</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// module 这里就是我们写的 reset.css 的具体内容了，</span></span><br><span class="line">exports.push([<span class="built_in">module</span>.i, <span class="string">"*&#123;margin:0;padding:0&#125;"</span>, <span class="string">""</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// exports</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/***/</span> &#125;),</span><br><span class="line"><span class="comment">/* 3 */</span></span><br><span class="line"><span class="comment">/***/</span> (<span class="function"><span class="keyword">function</span>(<span class="params">module, exports</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// css base code, injected by the css-loader</span></span><br><span class="line"><span class="comment">// 3号模块太长，不贴，调试后得知貌似只是暴露了两个方法出来</span></span><br><span class="line"><span class="comment">// ......</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/***/</span> &#125;),</span><br><span class="line"><span class="comment">/* 4 */</span></span><br><span class="line"><span class="comment">/***/</span> (<span class="function"><span class="keyword">function</span>(<span class="params">module, exports, __webpack_require__</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...太长只贴了关键步骤，总之关键的函数就是这些</span></span><br><span class="line"><span class="keyword">var</span> hasDocument = <span class="keyword">typeof</span> <span class="built_in">document</span> !== <span class="string">'undefined'</span></span><br><span class="line"><span class="keyword">var</span> head = hasDocument &amp;&amp; (<span class="built_in">document</span>.head || <span class="built_in">document</span>.getElementsByTagName(<span class="string">'head'</span>)[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">parentId, list, _isProduction</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">var</span> styles = listToStyles(parentId, list)</span><br><span class="line">    addStylesToDom(styles)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span> (<span class="params">newList</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addStylesToDom</span> (<span class="params">styles <span class="regexp">/* Array&lt;StyleObject&gt; */</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; styles.length; i++) &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        domStyle.parts.push(addStyle(item.parts[j]))</span><br><span class="line">        <span class="comment">// ....</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 总之先调用了addStylesToDom，接着是addStyle，再是createStyleElement插入样式到head中。</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createStyleElement</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> styleElement = <span class="built_in">document</span>.createElement(<span class="string">'style'</span>)</span><br><span class="line">  styleElement.type = <span class="string">'text/css'</span></span><br><span class="line">  head.appendChild(styleElement)</span><br><span class="line">  <span class="keyword">return</span> styleElement</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addStyle</span> (<span class="params">obj <span class="regexp">/* StyleObjectPart */</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    styleElement = createStyleElement()</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/***/</span> &#125;),</span><br><span class="line"><span class="comment">/* 5 */</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="comment">/******/</span> ]);</span><br><span class="line"><span class="comment">//# sourceMappingURL=build.js.map</span></span><br></pre></td></tr></table></figure>


<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://juejin.im/post/59b9d2336fb9a00a636a3158" target="_blank" rel="noopener">探索webpack模块以及webpack3新特性</a><br><a href="https://segmentfault.com/a/1190000004144950" target="_blank" rel="noopener">webpack把你的项目编译成了什么</a></p>
]]></content>
      <categories>
        <category>js-util</category>
      </categories>
      <tags>
        <tag>vue</tag>
        <tag>webpack</tag>
      </tags>
  </entry>
  <entry>
    <title>canvas 高清屏兼容</title>
    <url>/2017/12/07/canvas/canvas-retina/</url>
    <content><![CDATA[<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>废话不多说，直接上代码</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使canvas在不同分辨率屏幕上显示最佳像素</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> CanvasModule = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     *  功能  获取屏幕的分辨率  方便canvas在不同分辨率屏幕上显示最佳像素</span></span><br><span class="line"><span class="comment">     *  返回合适的分辨率</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">var</span> getRatio = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> ctx = <span class="built_in">document</span>.createElement(<span class="string">"canvas"</span>).getContext(<span class="string">"2d"</span>),</span><br><span class="line">            dpr = <span class="built_in">window</span>.devicePixelRatio || <span class="number">1</span>,</span><br><span class="line">            bsr = ctx.webkitBackingStorePixelRatio ||</span><br><span class="line">            ctx.mozBackingStorePixelRatio ||</span><br><span class="line">            ctx.msBackingStorePixelRatio ||</span><br><span class="line">            ctx.oBackingStorePixelRatio ||</span><br><span class="line">            ctx.backingStorePixelRatio || <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dpr / bsr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 功能   创建适应屏幕分辨率的canvas画布</span></span><br><span class="line"><span class="comment">     * 返回相应canvas</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">var</span> createHiDPICanvas = <span class="function"><span class="keyword">function</span>(<span class="params">canvas</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> w = canvas.clientWidth; </span><br><span class="line">        <span class="keyword">var</span> h = canvas.clientHeight;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> ratio = getRatio();</span><br><span class="line"></span><br><span class="line">        canvas.width = w * ratio;</span><br><span class="line">        canvas.height = h * ratio;</span><br><span class="line">        canvas.style.width = w + <span class="string">'px'</span>;</span><br><span class="line">        canvas.style.height = h + <span class="string">'px'</span>;</span><br><span class="line">        canvas.getContext(<span class="string">"2d"</span>).setTransform(ratio, <span class="number">0</span>, <span class="number">0</span>, ratio, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> canvas;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        createHiDPICanvas: createHiDPICanvas,</span><br><span class="line">        ratio: getRatio()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>


<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"canvas"</span> <span class="attr">width</span>=<span class="string">"600"</span> <span class="attr">style</span>=<span class="string">"border:1px solid #aaa; display:block"</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">'canvas'</span>)</span><br><span class="line">CanvasModule.createHiDPICanvas(canvas);</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>canvas</category>
      </categories>
      <tags>
        <tag>canvas</tag>
      </tags>
  </entry>
  <entry>
    <title>控制 webkit 的滚动条样式</title>
    <url>/2017/12/04/css/webkit-scrollbar/</url>
    <content><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>修改webkit内核浏览器的滚动条样式</p>
<h2 id="伪元素"><a href="#伪元素" class="headerlink" title="伪元素"></a>伪元素</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-pseudo">::-webkit-scrollbar</span>              &#123; <span class="comment">/* 1 */</span> &#125;</span><br><span class="line"><span class="selector-pseudo">::-webkit-scrollbar-button</span>       &#123; <span class="comment">/* 2 */</span> &#125;</span><br><span class="line"><span class="selector-pseudo">::-webkit-scrollbar-track</span>        &#123; <span class="comment">/* 3 */</span> &#125;</span><br><span class="line"><span class="selector-pseudo">::-webkit-scrollbar-track-piece</span>  &#123; <span class="comment">/* 4 */</span> &#125;</span><br><span class="line"><span class="selector-pseudo">::-webkit-scrollbar-thumb</span>        &#123; <span class="comment">/* 5 */</span> &#125;</span><br><span class="line"><span class="selector-pseudo">::-webkit-scrollbar-corner</span>       &#123; <span class="comment">/* 6 */</span> &#125;</span><br><span class="line"><span class="selector-pseudo">::-webkit-resizer</span>                &#123; <span class="comment">/* 7 */</span> &#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.css-tricks.com/wp-content/uploads/2011/05/scrollbarparts.png" alt=""></p>
<h2 id="伪类"><a href="#伪类" class="headerlink" title="伪类"></a>伪类</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-pseudo">:horizontal</span></span><br><span class="line"><span class="selector-pseudo">:vertical</span></span><br><span class="line"><span class="selector-pseudo">:decrement</span></span><br><span class="line"><span class="selector-pseudo">:increment</span></span><br><span class="line"><span class="selector-pseudo">:start</span></span><br><span class="line"><span class="selector-pseudo">:end</span> </span><br><span class="line"><span class="selector-pseudo">:double-button</span></span><br><span class="line"><span class="selector-pseudo">:single-button</span></span><br><span class="line"><span class="selector-pseudo">:no-button</span></span><br><span class="line"><span class="selector-pseudo">:corner-present</span></span><br><span class="line"><span class="selector-pseudo">:window-inactive</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">:horizontal – 作用于水平方向的滚动条</span><br><span class="line"></span><br><span class="line">:vertical – 作用于垂直方向滚动条</span><br><span class="line"></span><br><span class="line">:decrement – The decrement pseudo-class applies to buttons and track pieces. It indicates whether or not the button or track piece will decrement the view’s position when used (e.g., up on a vertical scrollbar, left on a horizontal scrollbar).</span><br><span class="line"></span><br><span class="line">:increment – The increment pseudo-class applies to buttons and track pieces. It indicates whether or not a button or track piece will increment the view’s position when used (e.g., down on a vertical scrollbar, right on a horizontal scrollbar).</span><br><span class="line"></span><br><span class="line">:start – The start pseudo-class applies to buttons and track pieces. It indicates whether the object is placed before the thumb.</span><br><span class="line"></span><br><span class="line">:end – The end pseudo-class applies to buttons and track pieces. It indicates whether the object is placed after the thumb.</span><br><span class="line"></span><br><span class="line">:double-button – The double-button pseudo-class applies to buttons and track pieces. It is used to detect whether a button is part of a pair of buttons that are together at the same end of a scrollbar. For track pieces it indicates whether the track piece abuts a pair of buttons.</span><br><span class="line"></span><br><span class="line">:single-button – The single-button pseudo-class applies to buttons and track pieces. It is used to detect whether a button is by itself at the end of a scrollbar. For track pieces it indicates whether the track piece abuts a singleton button.</span><br><span class="line"></span><br><span class="line">:no-button – Applies to track pieces and indicates whether or not the track piece runs to the edge of the scrollbar, i.e., there is no button at that end of the track.</span><br><span class="line"></span><br><span class="line">:corner-present – Applies to all scrollbar pieces and indicates whether or not a scrollbar corner is present.</span><br><span class="line"></span><br><span class="line">:window-inactive – Applies to all scrollbar pieces and indicates whether or not the window containing the scrollbar is currently active. (In recent nightlies, this pseudo-class now applies to ::selection as well. We plan to extend it to work with any content and to propose it as a new standard pseudo-class.)</span><br></pre></td></tr></table></figure>

<h2 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-pseudo">::-webkit-scrollbar</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">12px</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-pseudo">::-webkit-scrollbar-track</span> &#123;</span><br><span class="line">    <span class="attribute">-webkit-box-shadow</span>: inset <span class="number">0</span> <span class="number">0</span> <span class="number">6px</span> <span class="built_in">rgba</span>(0,0,0,0.3); </span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-pseudo">::-webkit-scrollbar-thumb</span> &#123;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">-webkit-box-shadow</span>: inset <span class="number">0</span> <span class="number">0</span> <span class="number">6px</span> <span class="built_in">rgba</span>(0,0,0,0.5); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.css-tricks.com/wp-content/uploads/2011/05/simplecustomscrollbar.png" alt=""></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://css-tricks.com/custom-scrollbars-in-webkit/" target="_blank" rel="noopener">https://css-tricks.com/custom-scrollbars-in-webkit/</a></p>
]]></content>
      <categories>
        <category>css</category>
      </categories>
      <tags>
        <tag>css 2</tag>
      </tags>
  </entry>
  <entry>
    <title>Js 关闭当前页面</title>
    <url>/2017/12/01/javascript/close-current-page/</url>
    <content><![CDATA[<h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>以前见到过一个当你保存某表单成功后，显示倒计时并自动关闭页面的效果，现在终于轮到我来实现了。</p>
<p>不过这有何好说，直接调用下面的代码不就关闭了么？</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">window.close()</span><br></pre></td></tr></table></figure>

<p>然而，在最新的 chrome 浏览器上写上却是显示一个警告并且代码并不生效。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Scripts may close only the windows that were opened by it.</span><br></pre></td></tr></table></figure>

<p>翻了好多资料却都于事无补。</p>
<h2 id="close函数的限制"><a href="#close函数的限制" class="headerlink" title="close函数的限制"></a>close函数的限制</h2><p>上面出现的警告信息我在 stackoverflow 上看到有人回答</p>
<blockquote>
<p>If your script did not initiate opening the window (with something like window.open), then the script in that window is not allowed to close it. Its a security to prevent a website taking control of your browser and closing windows.</p>
</blockquote>
<p>简而言之，<code>window.close()</code> 是有限制的，window.open 会返回一个对象，这个对象就是打开的新页面的 window 对象，</p>
<p>在 pageA 中写入</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">let pageB = window.open(&apos;xxx pageB&apos;);</span><br><span class="line">pageB.close();</span><br></pre></td></tr></table></figure>

<p>这就可以看见关闭了新打开的 pageB 页面。</p>
<h2 id="跨页面通信"><a href="#跨页面通信" class="headerlink" title="跨页面通信"></a>跨页面通信</h2><p>然而我们在前一个页面却不知道下一个页面的变化，比如上面例子我们不知道新打开的 pageB 页面到底做了什么，pageA 页面就不知道何时才能关闭 pageB。</p>
<p>这时候就需要用上 postMessage 跨页面通信。</p>
<p>在 pageA 上写上监听</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'message'</span>, (event) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'this is a message'</span>);</span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<p>在 pageB 上可以发送 postMessage</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.opener.postMessage(<span class="string">'close'</span>, <span class="string">'*'</span>);</span><br></pre></td></tr></table></figure>

<p>在 pageA 上打开 pageB 后就能在控制台上看到 pageA 控制台打印出了 <code>this is a message</code></p>
<h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><p>pageA</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'message'</span>, (event) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (event.data === <span class="string">'close'</span>) &#123;</span><br><span class="line">        event.source.top.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>


<p>pageB</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.top.opener.postMessage(<span class="string">'close'</span>, <span class="string">'*'</span>);</span><br></pre></td></tr></table></figure>

<p>当然，如果考虑 iframe 中会比较复杂，所以才用了 window.top。</p>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
  </entry>
  <entry>
    <title>Vue You are using the runtime-only build</title>
    <url>/2017/11/19/js-lib/vue-runtime-only/</url>
    <content><![CDATA[<h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>早上起来新建个项目写单测的时候发现报出一个错误</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.error node_modules/vue/dist/vue.runtime.common.js:<span class="number">572</span></span><br><span class="line">    [Vue warn]: You are using the runtime-only build <span class="keyword">of</span> Vue where the template compiler is not available. Either pre-compile the templates into render functions, or use the compiler-included build.</span><br><span class="line"></span><br><span class="line">    (found <span class="keyword">in</span> &lt;Root&gt;)</span><br></pre></td></tr></table></figure>

<p>runtime-only ? 这是什么情况，我只是在单测代码里构建了一个 vm 对象啊，写入了</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    template: <span class="string">`</span></span><br><span class="line"><span class="string">        &lt;p&gt;&#123;&#123; text &#125;&#125;&lt;/p&gt;</span></span><br><span class="line"><span class="string">    `</span>,</span><br><span class="line">    data () &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            text: <span class="string">'hello world'</span></span><br><span class="line">        &#125;l</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).$mount(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<p>接着是 <code>npm run unit</code> 启动的</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">  <span class="string">"unit"</span>: <span class="string">"jest test/unit/specs --coverage"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>查了查资料得知 vue2 分为完整构建(包含独立构建和运行时构建) 和 运行时构建两种模式。</p>
<p>简单来说, 完整构建和运行时构建的区别就是：可不可以用template选项。运行时构建少了编译 template 为 render 函数的一个阶段所以代码小一些。</p>
<p>上段代码中由于 vm 使用了 template 所以需要完整构建，我找了找 vue 的 npm package 的 main 入口用的是 vue.runtime.common.js，这个是运行时构建，于是乎报错。</p>
<p>只要修改单测代码中的一句话，引用完整构建的 vue 函数就行了</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue/dist/vue.min.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<h2 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h2><p>那么问题来了，我们平常写项目代码的时候是直接使用 <code>import Vue from &#39;vue&#39;</code> 的，为何不是使用完整构建呢？</p>
<p>那是因为 webpack 中的 vue-loader 已经提前把你的 vue 文件中的 template 给编译成了 render 函数。</p>
<h2 id="附上-vue2-dist目录下的文件"><a href="#附上-vue2-dist目录下的文件" class="headerlink" title="附上 vue2 dist目录下的文件"></a>附上 vue2 dist目录下的文件</h2><ul>
<li>vue.common.js 基于 CommonJS 的完整构建</li>
<li>vue.esm.js 基于 ES Module 的完整构建</li>
<li>vue.js 基于 UMD 的完整构建，可以用 cdn 直接引入</li>
<li>vue.min.js 和 vue.js 一样, 属于压缩后版本</li>
<li>vue.runtime.common.js 基于 CommonJS 的运行时构建</li>
<li>vue.runtime.esm.js 基于 ES Module 的运行时构建</li>
<li>vue.runtime.js 基于 UMD 的运行时构建，可以用 cdn 直接引入</li>
<li>vue.runtime.min.js 和 vue.runtime.js 一样, 属于压缩后版本</li>
</ul>
<p>如果想变动使用的 vue 文件，除了在 import 的时候写上具体路径外，还可以使用 webpack 别名</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    resolve: &#123;</span><br><span class="line">        alias: &#123;</span><br><span class="line">            <span class="string">'vue$'</span>: <span class="string">'vue.esm.js'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>js-lib</category>
      </categories>
      <tags>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>POST提交的三种表单类型简介</title>
    <url>/2017/11/09/javascript/form-type/</url>
    <content><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>在和小伙伴对接的时候，围绕数组数据传递我们产生了一些争执，于是我耐下心再去找了一下表单格式的资料。</p>
<p>假定要传递的数据格式为以下一个 Js 对象</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    num: <span class="number">4</span>,</span><br><span class="line">    str: <span class="string">'test, test'</span>,</span><br><span class="line">    arr: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="application-x-www-form-urlencoded"><a href="#application-x-www-form-urlencoded" class="headerlink" title="application/x-www-form-urlencoded"></a>application/x-www-form-urlencoded</h2><p>窗体数据被编码为名称/值对。这是标准的编码格式。在发送前编码所有字符（默认）。</p>
<p>需要设置 request header 中的 <code>Content-Type: application/x-www-form-urlencoded</code>，查看 postman 中发出去的请求头和数据内容变成以下格式</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">POST /py/api/classrooms/1/trainings HTTP/1.1</span><br><span class="line">Host: 112.124.109.3:8080</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Postman-Token: c7f6dcf3-f78c-b874-c944-6faabdb3b13a</span><br><span class="line"></span><br><span class="line">arr=%5B1%2C2%2C3%5D&amp;str=test%2C+test&amp;num=4</span><br></pre></td></tr></table></figure>

<p>提交的数据经由qs这个库序列化后，在chrome下展示的是 <code>Form Data</code>，并且数据将会被显示为</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Form Data</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    num: 4,</span><br><span class="line">    str: test, test</span><br><span class="line">    arr[0]: 1,</span><br><span class="line">    arr[1]: 2,</span><br><span class="line">    arr[3]: 3,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>后台接到这种格式 arr，却是不太容易把它当成数组。</p>
<h2 id="multipart-form-data"><a href="#multipart-form-data" class="headerlink" title="multipart/form-data"></a>multipart/form-data</h2><p>窗体数据被编码为一条消息，页上的每个控件对应消息<br>中的一个部分。不对字符编码，这种格式一般用于带上传功能的表单，数据包裹并被 boundary 分割。</p>
<p>查看 postman 中发出去的请求头和数据内容变成以下格式，注意 <code>Content-Type</code> 字段</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">POST /py/api/classrooms/1/trainings HTTP/1.1</span><br><span class="line">Host: 112.124.109.3:8080</span><br><span class="line">Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Postman-Token: a5497708-c791-a09b-aca7-47d9b6b150e2</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundary7MA4YWxkTrZu0gW</span><br><span class="line">Content-Disposition: form-data; name=&quot;arr&quot;</span><br><span class="line"></span><br><span class="line">[1,2,3]</span><br><span class="line">------WebKitFormBoundary7MA4YWxkTrZu0gW</span><br><span class="line">Content-Disposition: form-data; name=&quot;str&quot;</span><br><span class="line"></span><br><span class="line">test, test</span><br><span class="line">------WebKitFormBoundary7MA4YWxkTrZu0gW</span><br><span class="line">Content-Disposition: form-data; name=&quot;num&quot;</span><br><span class="line"></span><br><span class="line">4</span><br><span class="line">------WebKitFormBoundary7MA4YWxkTrZu0gW--</span><br></pre></td></tr></table></figure>

<h2 id="application-json"><a href="#application-json" class="headerlink" title="application/json"></a>application/json</h2><p>和 <code>text/plain</code> 类似，提交的是原数据，空格转换为 “+” 加号，但不对特殊字符编码。</p>
<p>查看 postman 中发出去的请求头和数据内容变成以下格式，注意 <code>Content-Type</code> 字段</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">POST /test HTTP/1.1</span><br><span class="line">Host: 112.124.109.3:8080</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Postman-Token: 87808356-8aa9-adfd-4e15-e4434ba4509d</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;arr&quot;: [1,2,3],</span><br><span class="line">    &quot;str&quot;: &quot;test, test&quot;,</span><br><span class="line">    &quot;num&quot;: 4</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在chrome下展示的是 <code>Request Payload</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Request Payload</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;arr&quot;: [1,2,3],</span><br><span class="line">    &quot;str&quot;: &quot;test, test&quot;,</span><br><span class="line">    &quot;num&quot;: 4</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>如果约定传 <code>Form Data</code>，也就是 <code>application/x-www-form-urlencoded</code>头，则数组和对象只能转为字符串后，后端经过一层解析来读取。</p>
<p>如果约定传 <code>request payload</code>，也就是 <code>application/json</code>头，则数组和对象随便传递，后端接到的也就是未经处理过的原数据。</p>
<p>而文件上传才用 <code>multipart/form-data</code>。</p>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>form</tag>
      </tags>
  </entry>
  <entry>
    <title>mac 系统常用命令</title>
    <url>/2017/11/09/os/mac-command-in-common-use/</url>
    <content><![CDATA[<h2 id="基本命令"><a href="#基本命令" class="headerlink" title="基本命令"></a>基本命令</h2><h3 id="列出文件"><a href="#列出文件" class="headerlink" title="列出文件"></a>列出文件</h3><p>ls 参数 目录名</p>
<p>例: 看看驱动目录下有什么:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ls /System/Library/Extensions</span><br></pre></td></tr></table></figure>

<p>参数 -w 显示中文，-l 详细信息， -a 包括隐藏文件，-h 将文件容量以较易读的方式（GB，kB等）列出来  , -R ：连同子目录的内容一起列出。</p>
<h3 id="查找文件"><a href="#查找文件" class="headerlink" title="查找文件"></a>查找文件</h3><p>find &lt;指定目录&gt; &lt;指定条件&gt; &lt;指定动作&gt;</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 搜索当前目录（含子目录，以下同）中，所有文件名以my开头的文件。</span></span><br><span class="line">find . -name <span class="string">'my*'</span></span><br><span class="line"><span class="comment"># 搜索当前目录中，所有文件名以my开头的文件，并显示它们的详细信息。</span></span><br><span class="line">find . -name <span class="string">'my*'</span> -ls</span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h3 id="转换目录"><a href="#转换目录" class="headerlink" title="转换目录"></a>转换目录</h3><p>cd</p>
<p>例：想到驱动目录下溜达一圈</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd /System/Library/Extensions</span><br></pre></td></tr></table></figure>

<h3 id="建立新目录"><a href="#建立新目录" class="headerlink" title="建立新目录"></a>建立新目录</h3><p>mkdir 目录名</p>
<p>例：在驱动目录下建一个备份目录backup</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkdir /System/Library/Extensions/backup</span><br></pre></td></tr></table></figure>

<h3 id="拷贝文件"><a href="#拷贝文件" class="headerlink" title="拷贝文件"></a>拷贝文件</h3><p>cp 参数 源文件 目标文件</p>
<p>例：想把桌面的Natit.kext 拷贝到驱动目录中</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cp -R ~/Desktop/Natit.kext /System/Library/Extensions</span><br></pre></td></tr></table></figure>

<p>参数R表示对目录进行递归操作，kext在图形界面下看起来是个文件，实际上是个文件夹。</p>
<p>把驱动目录下的所有文件备份到桌面backup</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cp -R /System/Library/Extensions/* ~/Desktop/backup</span><br></pre></td></tr></table></figure>

<h3 id="删除文件"><a href="#删除文件" class="headerlink" title="删除文件"></a>删除文件</h3><p>rm 参数 文件</p>
<p>例：想删除驱动的缓存</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rm -rf /System/Library/Extensions.kextcache</span><br><span class="line">rm -rf /System/Library/Extensions.mkext</span><br></pre></td></tr></table></figure>

<p>参数－rf 表示递归和强制，千万要小心使用，如果执行了 rm -rf / 你的系统就全没了</p>
<h3 id="移动文件"><a href="#移动文件" class="headerlink" title="移动文件"></a>移动文件</h3><p>mv 文件</p>
<p>例：想把AppleHDA.Kext 移到桌面</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mv /System/Library/Extensions/AppleHDA.kext ~/Desktop</span><br></pre></td></tr></table></figure>

<p>想把AppleHDA.Kext 移到备份目录中</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mv /System/Library/Extensions/AppleHDA.kext /System/Library/Extensions/backup</span><br></pre></td></tr></table></figure>

<h3 id="文本编辑"><a href="#文本编辑" class="headerlink" title="文本编辑"></a>文本编辑</h3><p>nano 文件名</p>
<p>例：编辑natit Info.plist</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nano /System/Library/Extensions/Natit.kext/Info.plist</span><br></pre></td></tr></table></figure>

<p>或者vim 文件名。</p>
<h2 id="目录操作"><a href="#目录操作" class="headerlink" title="目录操作"></a>目录操作</h2><table>
<thead>
<tr>
<th>命令名</th>
<th>功能描述</th>
<th>使用举例</th>
</tr>
</thead>
<tbody><tr>
<td>mkdir</td>
<td>创建一个目录</td>
<td>mkdir dirname</td>
</tr>
<tr>
<td>rmdir</td>
<td>删除一个目录</td>
<td>rmdir dirname</td>
</tr>
<tr>
<td>mvdir</td>
<td>移动或重命名一个目录</td>
<td>mvdir dir1 dir2</td>
</tr>
<tr>
<td>cd</td>
<td>改变当前目录</td>
<td>cd dirname</td>
</tr>
<tr>
<td>pwd</td>
<td>显示当前目录的路径名</td>
<td>pwd</td>
</tr>
<tr>
<td>ls</td>
<td>显示当前目录的内容</td>
<td>ls -la</td>
</tr>
</tbody></table>
<h2 id="文件操作"><a href="#文件操作" class="headerlink" title="文件操作"></a>文件操作</h2><table>
<thead>
<tr>
<th>命令名</th>
<th>功能描述</th>
<th>使用举例</th>
</tr>
</thead>
<tbody><tr>
<td>cat</td>
<td>显示或连接文件</td>
<td>cat filename</td>
</tr>
<tr>
<td>od</td>
<td>显示非文本文件的内容</td>
<td>od -c filename</td>
</tr>
<tr>
<td>cp</td>
<td>复制文件或目录</td>
<td>cp file1 file2</td>
</tr>
<tr>
<td>rm</td>
<td>删除文件或目录</td>
<td>rm filename</td>
</tr>
<tr>
<td>mv</td>
<td>改变文件名或所在目录</td>
<td>mv file1 file2</td>
</tr>
<tr>
<td>find</td>
<td>使用匹配表达式查找文件</td>
<td>find . -name “*.c” -print</td>
</tr>
<tr>
<td>file</td>
<td>显示文件类型</td>
<td>file filename</td>
</tr>
</tbody></table>
<h2 id="选择操作"><a href="#选择操作" class="headerlink" title="选择操作"></a>选择操作</h2><table>
<thead>
<tr>
<th>命令名</th>
<th>功能描述</th>
<th>使用举例</th>
</tr>
</thead>
<tbody><tr>
<td>head</td>
<td>显示文件的最初几行</td>
<td>head -20 filename</td>
</tr>
<tr>
<td>tail</td>
<td>显示文件的最后几行</td>
<td>tail -15 filename</td>
</tr>
<tr>
<td>cut</td>
<td>显示文件每行中的某些域</td>
<td>cut -f1,7 -d: /etc/passwd</td>
</tr>
<tr>
<td>colrm</td>
<td>从标准输入中删除若干列</td>
<td>colrm 8 20 file2</td>
</tr>
<tr>
<td>diff</td>
<td>比较并显示两个文件的差异</td>
<td>diff file1 file2</td>
</tr>
<tr>
<td>sort</td>
<td>排序或归并文件</td>
<td>sort -d -f -u file1</td>
</tr>
<tr>
<td>uniq</td>
<td>去掉文件中的重复行</td>
<td>uniq file1 file2</td>
</tr>
<tr>
<td>comm</td>
<td>显示两有序文件的公共和非公共行</td>
<td>comm file1 file2</td>
</tr>
<tr>
<td>wc</td>
<td>统计文件的字符数、词数和行数</td>
<td>wc filename</td>
</tr>
<tr>
<td>nl</td>
<td>给文件加上行号</td>
<td>nl file1 &gt;file2</td>
</tr>
</tbody></table>
<h2 id="进程操作"><a href="#进程操作" class="headerlink" title="进程操作"></a>进程操作</h2><table>
<thead>
<tr>
<th>命令名</th>
<th>功能描述</th>
<th>使用举例</th>
</tr>
</thead>
<tbody><tr>
<td>ps</td>
<td>显示进程当前状态</td>
<td>ps -ef</td>
</tr>
<tr>
<td>kill</td>
<td>终止进程</td>
<td>kill -9 30142</td>
</tr>
</tbody></table>
<h2 id="时间操作"><a href="#时间操作" class="headerlink" title="时间操作"></a>时间操作</h2><table>
<thead>
<tr>
<th>命令名</th>
<th>功能描述</th>
<th>使用举例</th>
</tr>
</thead>
<tbody><tr>
<td>date</td>
<td>显示系统的当前日期和时间</td>
<td>date</td>
</tr>
<tr>
<td>cal</td>
<td>显示日历</td>
<td>cal 8 1996</td>
</tr>
<tr>
<td>time</td>
<td>统计程序的执行时间</td>
<td>time a.out</td>
</tr>
</tbody></table>
<h2 id="网络与通信操作"><a href="#网络与通信操作" class="headerlink" title="网络与通信操作"></a>网络与通信操作</h2><table>
<thead>
<tr>
<th>命令名</th>
<th>功能描述</th>
<th>使用举例</th>
</tr>
</thead>
<tbody><tr>
<td>telnet</td>
<td>远程登录</td>
<td>telnet hpc.sp.net.edu.cn</td>
</tr>
<tr>
<td>rlogin</td>
<td>远程登录</td>
<td>rlogin hostname -l username</td>
</tr>
<tr>
<td>rsh</td>
<td>在远程主机执行指定命令</td>
<td>rsh f01n03 date</td>
</tr>
<tr>
<td>ftp</td>
<td>在本地主机与远程主机之间传输文件</td>
<td>ftpftp.sp.net.edu.cn</td>
</tr>
<tr>
<td>rcp</td>
<td>在本地主机与远程主机 之间复制文件</td>
<td>rcp file1 host1:file2</td>
</tr>
<tr>
<td>ping</td>
<td>给一个网络主机发送 回应请求</td>
<td>ping hpc.sp.net.edu.cn</td>
</tr>
<tr>
<td>mail</td>
<td>阅读和发送电子邮件</td>
<td>mail</td>
</tr>
<tr>
<td>write</td>
<td>给另一用户发送报文</td>
<td>write username pts/1</td>
</tr>
<tr>
<td>mesg</td>
<td>允许或拒绝接收报文</td>
<td>mesg n</td>
</tr>
</tbody></table>
<h2 id="korn-shell命令"><a href="#korn-shell命令" class="headerlink" title="korn shell命令"></a>korn shell命令</h2><table>
<thead>
<tr>
<th>命令名</th>
<th>功能描述</th>
<th>使用举例</th>
</tr>
</thead>
<tbody><tr>
<td>history</td>
<td>列出最近执行过的 几条命令及编号</td>
<td>history</td>
</tr>
<tr>
<td>r</td>
<td>重复执行最近执行过的 某条命令</td>
<td>r -2</td>
</tr>
<tr>
<td>alias</td>
<td>给某个命令定义别名</td>
<td>alias del=rm -i</td>
</tr>
<tr>
<td>unalias</td>
<td>取消对某个别名的定义</td>
<td>unalias del</td>
</tr>
</tbody></table>
<h2 id="其他命令"><a href="#其他命令" class="headerlink" title="其他命令"></a>其他命令</h2><table>
<thead>
<tr>
<th>命令名</th>
<th>功能描述</th>
<th>使用举例</th>
</tr>
</thead>
<tbody><tr>
<td>uname</td>
<td>显示操作系统的有关信息</td>
<td>uname -a</td>
</tr>
<tr>
<td>clear</td>
<td>清除屏幕或窗口内容</td>
<td>clear</td>
</tr>
<tr>
<td>env</td>
<td>显示当前所有设置过的环境变量</td>
<td>env</td>
</tr>
<tr>
<td>who</td>
<td>列出当前登录的所有用户</td>
<td>who</td>
</tr>
<tr>
<td>whoami</td>
<td>显示当前正进行操作的用户名</td>
<td>whoami</td>
</tr>
<tr>
<td>tty</td>
<td>显示终端或伪终端的名称</td>
<td>tty</td>
</tr>
<tr>
<td>stty</td>
<td>显示或重置控制键定义</td>
<td>stty -a</td>
</tr>
<tr>
<td>du</td>
<td>查询磁盘使用情况</td>
<td>du -k subdir</td>
</tr>
<tr>
<td>df /tmp</td>
<td>显示文件系统的总空间和可用空间</td>
<td></td>
</tr>
<tr>
<td>w</td>
<td>显示当前系统活动的总信息</td>
<td></td>
</tr>
</tbody></table>
<h2 id="Mac-OS-X-终端命令开启功能"><a href="#Mac-OS-X-终端命令开启功能" class="headerlink" title="Mac OS X 终端命令开启功能"></a>Mac OS X 终端命令开启功能</h2><ol>
<li>显示资源库</li>
</ol>
<ul>
<li>方法一</li>
</ul>
<p>显示：chflags nohidden ~/Library/<br>隐藏：chflags hidden ~/Library/</p>
<ul>
<li>方法二：</li>
</ul>
<p>打开Finder，菜单中选择前往按住option键就会显示资源库项(每次打开都需要重复操作一次)。</p>
<ol start="2">
<li>Finder显示隐藏文件</li>
</ol>
<ul>
<li>显示隐藏文件</li>
</ul>
<p>defaults write com.apple.finder AppleShowAllFiles -bool true<br>killall Finder</p>
<ul>
<li>恢复隐藏文件</li>
</ul>
<p>在“终端”中输入下面的命令：<br>defaults write com.apple.finder AppleShowAllFiles -bool false<br>killall Finder</p>
]]></content>
      <categories>
        <category>os</category>
      </categories>
  </entry>
  <entry>
    <title>input 中文输入法输入优化</title>
    <url>/2017/11/07/javascript/compositionstart/</url>
    <content><![CDATA[<h2 id="场景描述"><a href="#场景描述" class="headerlink" title="场景描述"></a>场景描述</h2><p>当用户当前输入法状态是中文时，在未选择词组到输入框也会触发事件</p>
<p><img src="http://7xn4mw.com1.z0.glb.clouddn.com/17-11-6/60509335.jpg" alt=""></p>
<p>如图所示输入了input做了事件监听输入事件时强制转化成大写，而引发的中文输入法的情况下输入a，也已经触发了输入动作。</p>
<h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><p>需要引入两个事件：<a href="https://developer.mozilla.org/en-US/docs/Web/Events/compositionstart" target="_blank" rel="noopener">compositionstart和compositionend</a>，ie9+ 的兼容。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"plate"</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> node = <span class="built_in">document</span>.querySelector(<span class="string">'#person'</span>);</span><br><span class="line"><span class="keyword">var</span> cpLock = <span class="literal">false</span>;</span><br><span class="line">node.addEventListener(<span class="string">'compositionstart'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    cpLock = <span class="literal">true</span>;</span><br><span class="line">&#125;)</span><br><span class="line">node.addEventListener(<span class="string">'compositionend'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    cpLock = <span class="literal">false</span>;</span><br><span class="line">&#125;)</span><br><span class="line">node.addEventListener(<span class="string">'input'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!cpLock) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.value);</span><br><span class="line">        <span class="keyword">this</span>.value = <span class="keyword">this</span>.value.toUpperCase();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>compositionstart</p>
<blockquote>
<p>当浏览器有非直接的文字输入时, compositionstart事件会以同步模式触发.</p>
</blockquote>
<p>compositionend</p>
<blockquote>
<p>当浏览器是直接的文字输入时, compositionend会以同步模式触发.</p>
</blockquote>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="http://frontenddev.org/article/compatible-with-processing-and-chinese-input-method-to-optimize-the-input-events.html" target="_blank" rel="noopener">input 事件兼容处理以及中文输入法优化</a></p>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>form</tag>
      </tags>
  </entry>
  <entry>
    <title>防抖和节流函数</title>
    <url>/2017/11/03/javascript/debounce-and-throttling/</url>
    <content><![CDATA[<h2 id="防抖"><a href="#防抖" class="headerlink" title="防抖"></a>防抖</h2><p>防抖技术即是可以把多个顺序地调用合并成一次，是在停止操作的一定时间内，规定事件才被触发一次。</p>
<p>通俗一点来说，看看下面这个简化的例子：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 防抖动函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">debounce</span> (<span class="params">func, wait, immediate</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> timeout;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> context = <span class="keyword">this</span>, args = <span class="built_in">arguments</span>;</span><br><span class="line">        <span class="keyword">var</span> later = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            timeout = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">if</span> (!immediate) func.apply(context, args);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">var</span> callNow = immediate &amp;&amp; !timeout;</span><br><span class="line">        clearTimeout(timeout);</span><br><span class="line">        timeout = setTimeout(later, wait);</span><br><span class="line">        <span class="keyword">if</span> (callNow) func.apply(context, args);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> myEfficientFn = debounce(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 滚动中的真正的操作</span></span><br><span class="line">&#125;, <span class="number">250</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 绑定监听</span></span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'resize'</span>, myEfficientFn);</span><br></pre></td></tr></table></figure>

<p>大概功能就是如果 250ms 内没有连续触发两次 scroll 事件，那么才会触发我们真正想在 scroll 事件中触发的函数。</p>
<h2 id="节流（Throttling）"><a href="#节流（Throttling）" class="headerlink" title="节流（Throttling）"></a>节流（Throttling）</h2><p>防抖函数确实不错，但是也存在问题，譬如图片的懒加载，我希望在下滑过程中图片不断的被加载出来，而不是只有当我停止下滑时候，图片才被加载出来。又或者下滑时候的数据的 ajax 请求加载也是同理。</p>
<p>这个时候，我们希望即使页面在不断被滚动，但是滚动 handler 也可以以一定的频率被触发（譬如 250ms 触发一次），这类场景，就要用到另一种技巧，称为节流函数（throttling）。</p>
<p>节流函数，只允许一个函数在 X 毫秒内执行一次。</p>
<p>与防抖相比，节流函数最主要的不同在于它保证在 X 毫秒内至少执行一次我们希望触发的事件 handler。</p>
<p>与防抖相比，节流函数多了一个 mustRun 属性，代表 mustRun 毫秒内，必然会触发一次 handler ，同样是利用定时器，看看简单的示例</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 简单的节流函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">throttle</span> (<span class="params">func, wait, mustRun</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> timeout,</span><br><span class="line">        startTime = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> context = <span class="keyword">this</span>,</span><br><span class="line">            args = <span class="built_in">arguments</span>,</span><br><span class="line">            curTime = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line"> </span><br><span class="line">        clearTimeout(timeout);</span><br><span class="line">        <span class="comment">// 如果达到了规定的触发时间间隔，触发 handler</span></span><br><span class="line">        <span class="keyword">if</span>(curTime - startTime &gt;= mustRun)&#123;</span><br><span class="line">            func.apply(context, args);</span><br><span class="line">            startTime = curTime;</span><br><span class="line">        <span class="comment">// 没达到触发间隔，重新设定定时器</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            timeout = setTimeout(func, wait);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 实际想绑定在 scroll 事件上的 handler</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">realFunc</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Success"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 采用了节流函数</span></span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'scroll'</span>, throttle(realFunc,<span class="number">500</span>,<span class="number">1000</span>));</span><br></pre></td></tr></table></figure>

<p>上面简单的节流函数的例子可以拿到浏览器下试一下，大概功能就是如果在一段时间内 scroll 触发的间隔一直短于 500ms ，那么能保证事件我们希望调用的 handler 至少在 1000ms 内会触发一次。</p>
<h2 id="使用-rAF（requestAnimationFrame）触发滚动事件"><a href="#使用-rAF（requestAnimationFrame）触发滚动事件" class="headerlink" title="使用 rAF（requestAnimationFrame）触发滚动事件"></a>使用 rAF（requestAnimationFrame）触发滚动事件</h2><p>window.requestAnimationFrame() 这个方法是用来在页面重绘之前，通知浏览器调用一个指定的函数。这个方法接受一个函数为参，该函数会在重绘前调用。</p>
<p>rAF 常用于 web 动画的制作，用于准确控制页面的帧刷新渲染，让动画效果更加流畅，当然它的作用不仅仅局限于动画制作，我们可以利用它的特性将它视为一个定时器。（当然它不是定时器）</p>
<p>通常来说，rAF 被调用的频率是每秒 60 次，也就是 1000/60 ，触发频率大概是 16.7ms 。（当执行复杂操作时，当它发现无法维持 60fps 的频率时，它会把频率降低到 30fps 来保持帧数的稳定。）</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> ticking = <span class="literal">false</span>; <span class="comment">// rAF 触发锁</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onScroll</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!ticking) &#123;</span><br><span class="line">        requestAnimationFrame(realFunc);</span><br><span class="line">        ticking = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">realFunc</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// do something...</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Success"</span>);</span><br><span class="line">    ticking = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 滚动事件监听</span></span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'scroll'</span>, onScroll, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<p>上面简单的使用 rAF 的例子可以拿到浏览器下试一下，大概功能就是在滚动的过程中，保持以 16.7ms 的频率触发事件 handler。</p>
<p>使用 requestAnimationFrame 优缺点并存，首先我们不得不考虑它的兼容问题，其次因为它只能实现以 16.7ms 的频率来触发，代表它的可调节性十分差。但是相比 throttle(func, xx, 16.7) ，用于更复杂的场景时，rAF 可能效果更佳，性能更好。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>debounce 防抖动: 防抖技术即是可以把多个顺序地调用合并成一次，也就是在一定时间内，规定事件被触发的次数。</p>
<p>throttling 节流函数: 只允许一个函数在 X 毫秒内执行一次，只有当上一次函数执行后过了你规定的时间间隔，才能进行下一次该函数的调用。</p>
<p>requestAnimationFrame: 16.7ms 触发一次 handler，降低了可控性，但是提升了性能和精确度。</p>
<h2 id="参照"><a href="#参照" class="headerlink" title="参照"></a>参照</h2><p><a href="http://www.cnblogs.com/coco1s/p/5499469.html" target="_blank" rel="noopener">http://www.cnblogs.com/coco1s/p/5499469.html</a></p>
<h2 id="附录-其他成熟的函数库"><a href="#附录-其他成熟的函数库" class="headerlink" title="附录-其他成熟的函数库"></a>附录-其他成熟的函数库</h2><p>underscore提供了比较成熟的防抖，节流函数，参见下文</p>
<p><a href="https://blog.coding.net/blog/the-difference-between-throttle-and-debounce-in-underscorejs" target="_blank" rel="noopener">https://blog.coding.net/blog/the-difference-between-throttle-and-debounce-in-underscorejs</a></p>
<p>防抖函数</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 空闲控制 返回函数连续调用时，空闲时间必须大于或等于 wait，func 才会执行</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param  &#123;function&#125; func        传入函数</span></span><br><span class="line"><span class="comment"> * @param  &#123;number&#125;   wait        表示时间窗口的间隔</span></span><br><span class="line"><span class="comment"> * @param  &#123;boolean&#125;  immediate   设置为ture时，调用触发于开始边界而不是结束边界</span></span><br><span class="line"><span class="comment"> * @return &#123;function&#125;             返回客户调用函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">_.debounce = <span class="function"><span class="keyword">function</span> (<span class="params">func, wait, immediate</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> timeout, args, context, timestamp, result;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> later = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 据上一次触发时间间隔</span></span><br><span class="line">        <span class="keyword">var</span> last = _.now() - timestamp;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 上次被包装函数被调用时间间隔last小于设定时间间隔wait</span></span><br><span class="line">        <span class="keyword">if</span> (last &lt; wait &amp;&amp; last &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            timeout = setTimeout(later, wait - last);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            timeout = <span class="literal">null</span>;</span><br><span class="line">            <span class="comment">// 如果设定为immediate===true，因为开始边界已经调用过了此处无需调用</span></span><br><span class="line">            <span class="keyword">if</span> (!immediate) &#123;</span><br><span class="line">                result = func.apply(context, args);</span><br><span class="line">                <span class="keyword">if</span> (!timeout) context = args = <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        context = <span class="keyword">this</span>;</span><br><span class="line">        args = <span class="built_in">arguments</span>;</span><br><span class="line">        timestamp = _.now();</span><br><span class="line">        <span class="keyword">var</span> callNow = immediate &amp;&amp; !timeout;</span><br><span class="line">        <span class="comment">// 如果延时不存在，重新设定延时</span></span><br><span class="line">        <span class="keyword">if</span> (!timeout) timeout = setTimeout(later, wait);</span><br><span class="line">        <span class="keyword">if</span> (callNow) &#123;</span><br><span class="line">            result = func.apply(context, args);</span><br><span class="line">            context = args = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>节流函数</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 频率控制 返回函数连续调用时，func 执行频率限定为 次 / wait</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param  &#123;function&#125;   func      传入函数</span></span><br><span class="line"><span class="comment"> * @param  &#123;number&#125;     wait      表示时间窗口的间隔</span></span><br><span class="line"><span class="comment"> * @param  &#123;object&#125;     options   如果想忽略开始边界上的调用，传入&#123;leading: false&#125;。</span></span><br><span class="line"><span class="comment"> *                                如果想忽略结尾边界上的调用，传入&#123;trailing: false&#125;</span></span><br><span class="line"><span class="comment"> * @return &#123;function&#125;             返回客户调用函数   </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">_.throttle = <span class="function"><span class="keyword">function</span> (<span class="params">func, wait, options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> context, args, result;</span><br><span class="line">    <span class="keyword">var</span> timeout = <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// 上次执行时间点</span></span><br><span class="line">    <span class="keyword">var</span> previous = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (!options) options = &#123;&#125;;</span><br><span class="line">    <span class="comment">// 延迟执行函数</span></span><br><span class="line">    <span class="keyword">var</span> later = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 若设定了开始边界不执行选项，上次执行时间始终为0</span></span><br><span class="line">        previous = options.leading === <span class="literal">false</span> ? <span class="number">0</span> : _.now();</span><br><span class="line">        timeout = <span class="literal">null</span>;</span><br><span class="line">        result = func.apply(context, args);</span><br><span class="line">        <span class="keyword">if</span> (!timeout) context = args = <span class="literal">null</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> now = _.now();</span><br><span class="line">        <span class="comment">// 首次执行时，如果设定了开始边界不执行选项，将上次执行时间设定为当前时间。</span></span><br><span class="line">        <span class="keyword">if</span> (!previous &amp;&amp; options.leading === <span class="literal">false</span>) previous = now;</span><br><span class="line">        <span class="comment">// 延迟执行时间间隔</span></span><br><span class="line">        <span class="keyword">var</span> remaining = wait - (now - previous);</span><br><span class="line">        context = <span class="keyword">this</span>;</span><br><span class="line">        args = <span class="built_in">arguments</span>;</span><br><span class="line">        <span class="comment">// 延迟时间间隔remaining小于等于0，表示上次执行至此所间隔时间已经超过一个时间窗口</span></span><br><span class="line">        <span class="comment">// remaining大于时间窗口wait，表示客户端系统时间被调整过</span></span><br><span class="line">        <span class="keyword">if</span> (remaining &lt;= <span class="number">0</span> || remaining &gt; wait) &#123;</span><br><span class="line">            clearTimeout(timeout);</span><br><span class="line">            timeout = <span class="literal">null</span>;</span><br><span class="line">            previous = now;</span><br><span class="line">            result = func.apply(context, args);</span><br><span class="line">            <span class="keyword">if</span> (!timeout) context = args = <span class="literal">null</span>;</span><br><span class="line">            <span class="comment">//如果延迟执行不存在，且没有设定结尾边界不执行选项</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!timeout &amp;&amp; options.trailing !== <span class="literal">false</span>) &#123;</span><br><span class="line">            timeout = setTimeout(later, remaining);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
  </entry>
  <entry>
    <title>记vue大型表单项目的一个性能问题</title>
    <url>/2017/10/27/js-lib/vue-form/</url>
    <content><![CDATA[<h2 id="问题场景"><a href="#问题场景" class="headerlink" title="问题场景"></a>问题场景</h2><p>身为一个表单表格工程师，自然日复一日的写着表单表格，本以为已经没啥难点的时候转眼间就来了一个有意思的情况，在超大量 数据绑定在 vue 的时候出现了表单操作起来卡顿的情况。</p>
<p>这里先贴上<a href="https://github.com/everlose/more-form-demo/tree/v1.0.1" target="_blank" rel="noopener">本项目出现的情况演示的 github 上的地址，tag1.0.1</a></p>
<p>如图所见，当在 input 输入数据的时候，连续输入会感觉明显的延迟。</p>
<p><img src="http://7xn4mw.com1.z0.glb.clouddn.com/17-10-26/99045022.jpg" alt=""></p>
<p>那么，这到底是怎么回事？</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>上述的表单数据项修改频繁由后端返回，于是在前端需要渲染从后端返回的 68kb 的一个 JSON 数据串，包括所有配置表单项以及其可能的选项值，<a href="https://github.com/everlose/more-form-demo/blob/v1.0.1/src/data.json" target="_blank" rel="noopener">数据见这里</a></p>
<p>核心渲染是有这么一段</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"basic-info ct-form"</span> <span class="attr">v-for</span>=<span class="string">"(config, configIndex) in formConfig"</span> <span class="attr">:key</span>=<span class="string">"configIndex"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">"form__title"</span>&gt;</span>&#123;&#123;config.title&#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-form</span> <span class="attr">class</span>=<span class="string">"form-content"</span> <span class="attr">ref</span>=<span class="string">"form"</span> <span class="attr">label-width</span>=<span class="string">"150px"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form-item</span></span></span><br><span class="line"><span class="tag">            <span class="attr">class</span>=<span class="string">"basic-form-item"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">v-for</span>=<span class="string">"(item, itemIndex) in config.formItems"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:key</span>=<span class="string">"itemIndex"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:prop</span>=<span class="string">"item.code"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:label</span>=<span class="string">"item.name"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:required</span>=<span class="string">"item.required"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:rules</span>=<span class="string">"item.rules"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-radio-group</span></span></span><br><span class="line"><span class="tag">                <span class="attr">v-if</span>=<span class="string">"item.type === 'radio'"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">v-model</span>=<span class="string">"formData[item.code]"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-radio</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">v-for</span>=<span class="string">"(option, radioIndex) in formOptions[item.optionCode]"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">:key</span>=<span class="string">"option.value"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">:label</span>=<span class="string">"option.value"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">:disabled</span>=<span class="string">"item.disabled"</span>&gt;</span></span><br><span class="line">                    &#123;&#123; option.label &#125;&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">el-radio</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-radio-group</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-input</span></span></span><br><span class="line"><span class="tag">                <span class="attr">v-else-if</span>=<span class="string">"item.type === 'input'"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">:class</span>=<span class="string">"&#123; longInput: item.isLongInput &#125;"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">:placeholder</span>=<span class="string">"item.placeholder || '请输入'"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">v-model</span>=<span class="string">"formData[item.code]"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">:label</span>=<span class="string">"item.label"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">:disabled</span>=<span class="string">"item.disabled"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">:maxlength</span>=<span class="string">"item.maxLength"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-select</span></span></span><br><span class="line"><span class="tag">                <span class="attr">v-else-if</span>=<span class="string">"item.type === 'select'"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">v-model</span>=<span class="string">"formData[item.code]"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">:disabled</span>=<span class="string">"item.disabled"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">:placeholder</span>=<span class="string">"item.placeholder || '请选择'"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-option</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">v-for</span>=<span class="string">"(option, optionsIndex) in formOptions[item.optionCode]"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">:key</span>=<span class="string">"option.value"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">:label</span>=<span class="string">"option.label"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">:value</span>=<span class="string">"option.value"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">el-option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-select</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这就是一个简单的双层遍历渲染所有表单配置项的模版代码，其中的 formConfig 正是所有配置表单项，数据量极多。formOptions 挂载了所有表单选项值，也是动辄几千项。</p>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>正当我对着这么高的操作延时发愁的时候，组里一个大佬提醒我，可能是 Vue.prototype._update 这个触发的太频繁了。</p>
<p>我急忙找到这一段打了个断点调试</p>
<p><img src="http://7xn4mw.com1.z0.glb.clouddn.com/17-10-26/49459645.jpg" alt=""></p>
<p>Vue.prototype._update 这函数里触发的是 VNode 虚拟节点的比对更新，打断点调试后发现实际上这是一个循环，在控制台里输出 <code>this.$el</code> 的时候能得到正在深度遍历中的节点，沿着根结点 App（也是 formConfig 数据绑定的作用域） 开始直到具体触发输入的那个表单元素。</p>
<p>在本项目里是使用了遍历输出所有的表单元素，并且当前组件的作用域是直接挂在根结点上的，是否就是这个遍历引发了如此高的延时呢？于是我找到上图右侧的调用堆栈，发现正是 <code>flushSchedulerQueue</code> 函数写着一个 for 循环。</p>
<p><img src="http://7xn4mw.com1.z0.glb.clouddn.com/17-10-26/45559864.jpg" alt=""></p>
<p>在 <code>flushSchedulerQueue</code> 函数中的 for 循环里头尾插入代码来获取耗费时间。</p>
<p>结果得知输入时的延迟大概在 300ms 之上。</p>
<p><img src="http://7xn4mw.com1.z0.glb.clouddn.com/17-10-26/12172972.jpg" alt=""></p>
<p>似乎问题就找到了，<code>flushSchedulerQueue</code> 函数针对 data 中数据的修改把 watcher 推送进队列里在更新，这一循环耗费的时间比较长。</p>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>其实早在调试 <code>Vue.prototype._update</code> 函数就初见端倪，循环中的 <code>this.$el</code> 从当前组件的根部开始深度遍历，遍历了太多次，那么只要想办法缩小当前组件所绑定的数据量就解决了。</p>
<p>于是核心代码调整为</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"basic-info ct-form"</span> <span class="attr">v-for</span>=<span class="string">"(config, configIndex) in formConfig"</span> <span class="attr">:key</span>=<span class="string">"configIndex"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">edit-form</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:config</span>=<span class="string">"config"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:data</span>=<span class="string">"formData"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:options</span>=<span class="string">"formOptions"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">edit-form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>只是用一个 edit-form 包裹刚刚所有的 el-form-item 的渲染代码就解决了，再次调试 <code>Vue.prototype._update</code> 得出遍历节点 <code>this.$el</code> 已经变为下图所示的 <code>div.edit-form</code> 了，<code>flushSchedulerQueue</code> 函数 for 循环的延迟也变为 10ms 左右</p>
<p><img src="http://7xn4mw.com1.z0.glb.clouddn.com/17-10-26/88158757.jpg" alt=""></p>
<p>修复版的代码在2.0.0的tag上，<a href="https://github.com/everlose/more-form-demo/tree/v2.0.0" target="_blank" rel="noopener">这里贴上链接</a></p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>本质上这就是一个原则，最好不要在一个vue组件上直接绑定如此多的数据，如果有大量数据请分多个组件绑定。这么浅尝辄止实在让人不够尽兴，于是这里贴上 Vue.prototype._update 前的关键部分调用堆栈以及其函数作用。</p>
<p>找到项目中 node_modules 下的 vue.esm.js</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 往input里输入将会触发model data的更新</span><br><span class="line">978 set: function reactiveSetter (newVal)</span><br><span class="line"># 订阅器dep是数据绑定和视图更新的关键，这里触发去通知相关视图的更新</span><br><span class="line">994 dep.notify();</span><br><span class="line">673 Dep.prototype.notify</span><br><span class="line"># notify函数里的subs实际上是Watcher对象的实例，这里触发视图更新操作</span><br><span class="line">677 subs[i].update(); subs实际上是包裹watcher的数组</span><br><span class="line">3093 Watcher.prototype.update</span><br><span class="line"># 把watcher塞进一个队列里，这里是和异步更新视图有关。</span><br><span class="line">3100 queueWatcher(this);</span><br><span class="line">2945 function queueWatcher (watcher) push到队列里</span><br><span class="line"># nextTick是具体做异步更新的部分</span><br><span class="line">2963 nextTick(flushSchedulerQueue); </span><br><span class="line">1778 function nextTick (cb, ctx)</span><br><span class="line"># 异步操作实际上是原生 H5 MessageChannel API 通道通信来推送消息来实现变化。</span><br><span class="line">1738 port.postMessage(1); </span><br><span class="line"></span><br><span class="line"># 注意在异步操作中，最终传入的回调函数被执行来进行下面视图的更新。这里是执行一个任务调度队列的调度过程，需要循环遍历。</span><br><span class="line">2856 function flushSchedulerQueue</span><br><span class="line">3108 Watcher.prototype.run</span><br><span class="line"># Evaluate the getter, and re-collect dependencies.</span><br><span class="line">3043 Watcher.prototype.get</span><br><span class="line"># watcher中的getter的name就叫updateComponent，于是被执行</span><br><span class="line">2689 updateComponent</span><br><span class="line">2690 vm._update(vm._render(), hydrating);</span><br><span class="line"># 进入vue的生命周期中的update函数</span><br><span class="line">2548 Vue.prototype._update</span><br><span class="line"># patch做的是vnode的节点比对，最终把新的vnode结构渲染到具体视图，不再多做描述。</span><br><span class="line">2572 vm.$el = vm.__patch__(prevVnode, vnode);</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>js-lib</category>
      </categories>
      <tags>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>git 远端回滚操作</title>
    <url>/2017/10/02/source-control/remote-rollback/</url>
    <content><![CDATA[<h2 id="查找提交记录"><a href="#查找提交记录" class="headerlink" title="查找提交记录"></a>查找提交记录</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git <span class="built_in">log</span></span><br><span class="line"></span><br><span class="line">commit 16577b2c2b8d1f6e92528aa417acc83dcd2f4b64</span><br><span class="line">Author: 陈子云 &lt;ever-lose@foxmail.com&gt;</span><br><span class="line">Date:   Wed Mar 8 17:31:26 2017 +0800</span><br><span class="line"></span><br><span class="line">    commit最近记录1</span><br><span class="line"></span><br><span class="line">commit fec5d9f293c4aecad66c9a1414d2e3045be04aad</span><br><span class="line">Author: 陈子云 &lt;ever-lose@foxmail.com&gt;</span><br><span class="line">Date:   Mon Feb 6 15:58:29 2017 +0800</span><br><span class="line"></span><br><span class="line">    commit最近记录2</span><br><span class="line"></span><br><span class="line">commit 0279a5684d59afbc0ed568e1c2319395da0a3eeb</span><br><span class="line">Merge: 1e93cdd 64f9f9e</span><br><span class="line">Author: 陈子云 &lt;ever-lose@foxmail.com&gt;</span><br><span class="line">Date:   Wed Jan 11 14:06:20 2017 +0800</span><br><span class="line"></span><br><span class="line">    commit最近记录3</span><br></pre></td></tr></table></figure>

<p>找到最近若干次的commit记录，假如我们需要舍弃记录1和记录2，希望直接把远端的分枝回滚到记录3。</p>
<h2 id="强制回滚"><a href="#强制回滚" class="headerlink" title="强制回滚"></a>强制回滚</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git reset --hard 0279a568</span><br><span class="line"></span><br><span class="line">HEAD is now at 0279a56 commit最近记录3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果只是要回到之前一个提交记录</span></span><br><span class="line"><span class="comment"># git reset --hard HEAD^1</span></span><br></pre></td></tr></table></figure>

<p>其中–hard后面的八位字符时上面提交记录里的commit后面的一串的前八位。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git status</span><br><span class="line"></span><br><span class="line">On branch master</span><br><span class="line">Your branch is behind <span class="string">'origin/master'</span> by 2 commits, and can be fast-forwarded.</span><br><span class="line">  (use <span class="string">"git pull"</span> to update your <span class="built_in">local</span> branch)</span><br></pre></td></tr></table></figure>

<p>查看得知本地回滚成功，但是远程的库还没回滚。</p>
<h2 id="远程回滚"><a href="#远程回滚" class="headerlink" title="远程回滚"></a>远程回滚</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git push -f origin master</span><br><span class="line"></span><br><span class="line">Total 0 (delta 0), reused 0 (delta 0)</span><br><span class="line">To git.souche.com:fis-projects/dafengche-maintain-query-f2e.git</span><br><span class="line">+ 16577b2...0279a56 master -&gt; master (forced update)</span><br></pre></td></tr></table></figure>

<p>成功的提示如上。但是如果执行后不成功，提示如下的话，则需要上 gitlab／github 上设置 Protected Branches 了，为的是去除本分支的保护后才能强制覆盖提交。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git push -f origin master</span><br><span class="line"></span><br><span class="line">Total 0 (delta 0), reused 0 (delta 0)</span><br><span class="line">remote: GitLab: You are not allowed to force push code to a protected branch on this project.</span><br><span class="line">To git.souche.com:fis-projects/dafengche-maintain-query-f2e.git</span><br><span class="line"> ! [remote rejected] master -&gt; master (pre-receive hook declined)</span><br><span class="line">error: failed to push some refs to <span class="string">'git@git.souche.com:fis-projects/dafengche-maintain-query-f2e.git'</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>source-control</category>
      </categories>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>makefile文件配置说明</title>
    <url>/2017/09/27/js-util/makefile/</url>
    <content><![CDATA[<h2 id="基本格式"><a href="#基本格式" class="headerlink" title="基本格式"></a>基本格式</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">target: prerequisities</span><br><span class="line">[TAB]command</span><br></pre></td></tr></table></figure>

<p>target就是你要执行的命令套件，prerequisties就是依赖，而command就是实际执行的命令，##必须注意：必须用TAB键来连接命令，如果使用了空格那么会报语法错误</p>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ssh-dev: </span><br><span class="line">    ssh root@112.124.x.x</span><br></pre></td></tr></table></figure>

<p>makefile 的解析过程</p>
<ol>
<li>首先makefile会读取你的makefile文件.</li>
<li>读取指定的target.</li>
<li>解析后面的依赖是否更新</li>
<li>如果更新则执行command</li>
<li>没有则do nothing</li>
</ol>
<h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2><p>在makefile中，通常可以用”#”标识来作为注释</p>
<h2 id="回声"><a href="#回声" class="headerlink" title="回声"></a>回声</h2><p>make 运行这段脚本时会输出命令内容 <code>ssh root@112.124.x.x</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ make ssh-dev</span><br><span class="line"></span><br><span class="line">ssh root@112.124.x.x</span><br><span class="line">root@112.124.x.x&apos;s password:</span><br></pre></td></tr></table></figure>

<p>如果你不想让make打印出来，可以在首行加上”@”表示取消回声.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ssh-dev:</span><br><span class="line">    @ssh root@112.124.c.c</span><br></pre></td></tr></table></figure>

<h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><p>声明</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">DIST_PATH=/root/xxproj/dist</span><br><span class="line"></span><br><span class="line">DEV_REMOTE_SERVER=root@112.124.x.x</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ssh-dev:</span><br><span class="line">    @ssh $(DEV_REMOTE_SERVER)</span><br></pre></td></tr></table></figure>

<h2 id="自动变量"><a href="#自动变量" class="headerlink" title="自动变量"></a>自动变量</h2><p>$@ 指代当前构建的目标</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a.js b.js:</span><br><span class="line">    touch $@</span><br><span class="line">//等价于:</span><br><span class="line">a.js b.js:</span><br><span class="line">    touch a.js b.js;</span><br><span class="line">//也等价于:</span><br><span class="line">a.js:</span><br><span class="line">    touch a.js;</span><br><span class="line">b.js: </span><br><span class="line">    touch b.js</span><br></pre></td></tr></table></figure>

<p>$(filter-out $@,$(MAKECMDGOALS)) 指代参数</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">make ssh-dev 123</span><br><span class="line"># 那么 $(filter-out $@,$(MAKECMDGOALS)) 实际上等同于 123</span><br></pre></td></tr></table></figure>

<h2 id="解决隐含规则的冲突"><a href="#解决隐含规则的冲突" class="headerlink" title="解决隐含规则的冲突"></a>解决隐含规则的冲突</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.PHONY: ssh-dev</span><br></pre></td></tr></table></figure>

<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://segmentfault.com/a/1190000004437816" target="_blank" rel="noopener">前端入门-&gt;makefile</a></p>
]]></content>
      <categories>
        <category>js-util</category>
      </categories>
  </entry>
  <entry>
    <title>给 node 程序设置良好的日志格式</title>
    <url>/2017/09/18/node/node-log/</url>
    <content><![CDATA[<p>我们使用 winston 和 express-winston 记录日志。新建 logs 目录存放日志文件，修改 index.js</p>
<h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 正常请求的日志</span></span><br><span class="line">app.use(expressWinston.logger(&#123;</span><br><span class="line">    transports: [</span><br><span class="line">        <span class="keyword">new</span> (winston.transports.Console)(&#123;</span><br><span class="line">            json: <span class="literal">true</span>,</span><br><span class="line">            colorize: <span class="literal">true</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> winston.transports.File(&#123;</span><br><span class="line">            filename: <span class="string">'logs/success.log'</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;));</span><br><span class="line"><span class="comment">// 路由</span></span><br><span class="line">routes(app);</span><br><span class="line"><span class="comment">// 错误请求的日志</span></span><br><span class="line">app.use(expressWinston.errorLogger(&#123;</span><br><span class="line">    transports: [</span><br><span class="line">        <span class="keyword">new</span> winston.transports.Console(&#123;</span><br><span class="line">            json: <span class="literal">true</span>,</span><br><span class="line">            colorize: <span class="literal">true</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> winston.transports.File(&#123;</span><br><span class="line">            filename: <span class="string">'logs/error.log'</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>

<p>可以看出：我们将正常请求的日志打印到终端并写入了 logs/success.log，将错误请求的日志打印到终端并写入了 logs/error.log。需要注意的是：记录正常请求日志的中间件要放到 routes(app) 之前，记录错误请求日志的中间件要放到 routes(app) 之后。</p>
<p>logs/success.log 形式如下面的</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">"res"</span>:&#123;<span class="string">"statusCode"</span>:304&#125;,<span class="string">"req"</span>:&#123;<span class="string">"url"</span>:<span class="string">"/login.html"</span>,<span class="string">"headers"</span>:&#123;<span class="string">"host"</span>:<span class="string">"localhost:8110"</span>,<span class="string">"connection"</span>:<span class="string">"keep-alive"</span>,<span class="string">"cache-control"</span>:<span class="string">"max-age=0"</span>,<span class="string">"upgrade-insecure-requests"</span>:<span class="string">"1"</span>,<span class="string">"user-agent"</span>:<span class="string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36"</span>,<span class="string">"accept"</span>:<span class="string">"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8"</span>,<span class="string">"accept-encoding"</span>:<span class="string">"gzip, deflate, br"</span>,<span class="string">"accept-language"</span>:<span class="string">"zh-CN,zh;q=0.9,en;q=0.8"</span>,<span class="string">"cookie"</span>:<span class="string">"_ga=GA1.1.962647850.1532401353; connect.sid=s%3AvPL_N3OEN-0NcRLGJBFw6Y6zt8hmrgyp.FPajpbCi8CMMymut1vt98HeHbapZnvTmY9U%2Fpr1yFaU"</span>,<span class="string">"if-none-match"</span>:<span class="string">"W/\"267-1640437f348\""</span>,<span class="string">"if-modified-since"</span>:<span class="string">"Fri, 15 Jun 2018 16:12:13 GMT"</span>&#125;,<span class="string">"method"</span>:<span class="string">"GET"</span>,<span class="string">"httpVersion"</span>:<span class="string">"1.1"</span>,<span class="string">"originalUrl"</span>:<span class="string">"/login.html"</span>,<span class="string">"query"</span>:&#123;&#125;&#125;,<span class="string">"responseTime"</span>:3,<span class="string">"level"</span>:<span class="string">"info"</span>,<span class="string">"message"</span>:<span class="string">"HTTP GET /login.html"</span>,<span class="string">"timestamp"</span>:<span class="string">"2018-08-03T17:13:30.372Z"</span>&#125;</span><br><span class="line">&#123;<span class="string">"res"</span>:&#123;<span class="string">"statusCode"</span>:200&#125;,<span class="string">"req"</span>:&#123;<span class="string">"url"</span>:<span class="string">"/static/js/manifest.519623f75946789ea0b5.js"</span>,<span class="string">"headers"</span>:&#123;<span class="string">"host"</span>:<span class="string">"localhost:8110"</span>,<span class="string">"connection"</span>:<span class="string">"keep-alive"</span>,<span class="string">"user-agent"</span>:<span class="string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36"</span>,<span class="string">"accept"</span>:<span class="string">"*/*"</span>,<span class="string">"referer"</span>:<span class="string">"http://localhost:8110/login.html"</span>,<span class="string">"accept-encoding"</span>:<span class="string">"gzip, deflate, br"</span>,<span class="string">"accept-language"</span>:<span class="string">"zh-CN,zh;q=0.9,en;q=0.8"</span>,<span class="string">"cookie"</span>:<span class="string">"_ga=GA1.1.962647850.1532401353; connect.sid=s%3AC6FUKlyraQq_G28MeY1nwkLy1MnEKEeO.39nIF8UJros%2BlhEorA693%2F9g8eqr7dC%2BUvEQNJSVhKA"</span>&#125;,<span class="string">"method"</span>:<span class="string">"GET"</span>,<span class="string">"httpVersion"</span>:<span class="string">"1.1"</span>,<span class="string">"originalUrl"</span>:<span class="string">"/static/js/manifest.519623f75946789ea0b5.js"</span>,<span class="string">"query"</span>:&#123;&#125;&#125;,<span class="string">"responseTime"</span>:5,<span class="string">"level"</span>:<span class="string">"info"</span>,<span class="string">"message"</span>:<span class="string">"HTTP GET /static/js/manifest.519623f75946789ea0b5.js"</span>,<span class="string">"timestamp"</span>:<span class="string">"2018-08-03T17:13:30.398Z"</span>&#125;</span><br></pre></td></tr></table></figure>

<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p>注意这两个库的版本，本人在<a href="mailto:winston@2.4.0" target="_blank" rel="noopener">winston@2.4.0</a> 和 <a href="mailto:express-winston@2.6.0" target="_blank" rel="noopener">express-winston@2.6.0</a> 上能成功，而如果 winston 升级到3后上面的代码会报错。并且需要手动创建 logs 文件夹以及其两个 log 文件</p>
<h2 id="参考来源"><a href="#参考来源" class="headerlink" title="参考来源"></a>参考来源</h2><p><a href="https://maninboat.gitbooks.io/n-blog/content/book/4.13%20%E6%97%A5%E5%BF%97.html" target="_blank" rel="noopener">https://maninboat.gitbooks.io/n-blog/content/book/4.13%20%E6%97%A5%E5%BF%97.html</a></p>
]]></content>
      <categories>
        <category>node</category>
      </categories>
  </entry>
  <entry>
    <title>package.json 的版本说明</title>
    <url>/2017/09/16/node/package.json/</url>
    <content><![CDATA[<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>package.json 对于 Node.js 应用来说是一个不可或缺的文件，它存储了该 Node.js 应用的名字、版本、描述、作者、入口文件、脚本、版权等等信息。npm 官网有 package.json 每个字段的详细介绍：<a href="https://docs.npmjs.com/files/package.json" target="_blank" rel="noopener">https://docs.npmjs.com/files/package.json</a>。</p>
<h2 id="semver"><a href="#semver" class="headerlink" title="semver"></a>semver</h2><p>语义化版本（semver）即 dependencies、devDependencies 和 peerDependencies 里的如：<code>&quot;co&quot;: &quot;^4.6.0&quot;</code>。</p>
<p>semver 格式：<code>主版本号.次版本号.修订号</code>。版本号递增规则如下：</p>
<ul>
<li><code>主版本号</code>：做了不兼容的 API 修改</li>
<li><code>次版本号</code>：做了向下兼容的功能性新增</li>
<li><code>修订号</code>：做了向下兼容的 bug 修正</li>
</ul>
<p>更多阅读：</p>
<ol>
<li><a href="http://semver.org/lang/zh-CN/" target="_blank" rel="noopener">http://semver.org/lang/zh-CN/</a></li>
<li><a href="http://taobaofed.org/blog/2016/08/04/instructions-of-semver/" target="_blank" rel="noopener">http://taobaofed.org/blog/2016/08/04/instructions-of-semver/</a></li>
</ol>
<p>作为 Node.js 的开发者，我们在发布 npm 模块的时候一定要遵守语义化版本的命名规则，即：有 breaking change 发大版本，有新增的功能发小版本，有小的 bug 修复或优化则发修订版本。</p>
]]></content>
      <categories>
        <category>node</category>
      </categories>
  </entry>
  <entry>
    <title>.git 文件太大时怎样处理</title>
    <url>/2017/09/14/source-control/git-depth-1/</url>
    <content><![CDATA[<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>github 上的 repo 由于 commit 次数过多 导致 repo 被 clone 下来时的 .git 文件夹特别大，就会定在某个文件上下载缓慢。</p>
<p>我确定当前 commit 之前的 change 对我都没有用了，用什么方法能清除之前的提交记录，让 clone 下来的 .git 文件夹变小一点呢？</p>
<h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><p>clone 的时候，可以指定深度，如下，为 1 即表示只克隆最近一次 commit。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git://xxoo --depth 1</span><br></pre></td></tr></table></figure>

<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>其实如果一不小心在某个版本提交了一个很大的文件，就很容易出现笔者现在的情形，如果开发过程当中操作不当提交了不该提交的库文件，请参照笔者下笔记《git远端回滚》。</p>
]]></content>
      <categories>
        <category>source-control</category>
      </categories>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>vue2.0版本的broadcat以及dispatch</title>
    <url>/2017/09/11/js-lib/vue-broadcast/</url>
    <content><![CDATA[<h2 id="问题场景"><a href="#问题场景" class="headerlink" title="问题场景"></a>问题场景</h2><p>最近在业务中遇到一种情况，一个页面有若干子模块，子模块中用了一个弹窗组件，简化模型如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">grand-page</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent-form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-modal</span>&gt;</span><span class="tag">&lt;/<span class="name">el-modal</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent-form</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span>&gt;</span>点击显示parent-form<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">grand-page</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>问题来了，数据在最外层的 grand-page 拉取，再一层层传入，点击 el-button 后触发显示 parent-form ，而 parent-form 要显示又得显示 el-modal，如果要写两层 props 就传递一个 show 变量是否展示。</p>
<p>写起来麻烦不说，也很不智能，因为 vue2 中不允许直接改 props 的值，所以得写两层的 emit &amp; on 来监听 show 变量。 </p>
<p>还有一种方法是使用 <code>.sync</code> 修饰符，很可惜，这么做只能在父子组件间使用，但是从 grand-page 到 el-modal 这祖孙间在用一个 show 变量就行不通了。</p>
<p>于是就引申出了本篇的话题，想在祖和孙之间传数据，自然少不了 <code>$broadcast</code> 了，虽然在 vue2 中它被废弃了，但是我们可以通过语法糖来实现它。</p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>vue2 使用 $emit 和 $on 来传递并接收事件，并且在同一个组件里，就可以 $emit 某个事件让 $on 接收到。如果我们遍历当前组件所有子组件，也就是 <code>this.$children</code> ，并且在每个子组件里 $emit 一个事件，目标的子孙组件都可以使用 $on 来监听，就完成了 broadcat 的过程。</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>摘取 <a href="https://github.com/ElemeFE/element" target="_blank" rel="noopener">Element</a> 的 mixin 中的 emitter 关于这部分的代码</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">broadcast</span>(<span class="params">componentName, eventName, params</span>) </span>&#123;</span><br><span class="line">    <span class="comment">/*遍历当前节点下的所有子组件*/</span></span><br><span class="line">    <span class="keyword">this</span>.$children.forEach(<span class="function">(<span class="params">child</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">/*获取子组件名称*/</span></span><br><span class="line">        <span class="keyword">var</span> name = child.$options.componentName;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (name === componentName) &#123;</span><br><span class="line">            <span class="comment">/*如果是我们需要广播到的子组件的时候调用$emit触发所需事件，在子组件中用$on监听*/</span></span><br><span class="line">            child.$emit.apply(child, [eventName].concat(params));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">/*非所需子组件则递归遍历深层次子组件*/</span></span><br><span class="line">            broadcast.apply(child, [componentName, eventName].concat([params]));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    methods: &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            向所有子组件进行事件广播。</span></span><br><span class="line"><span class="comment">            这里包了一层，为了修改broadcast的this对象为当前Vue实例</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        broadcast(componentName, eventName, params) &#123;</span><br><span class="line">            broadcast.call(<span class="keyword">this</span>, componentName, eventName, params);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>接着祖元素调用</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Emitter <span class="keyword">from</span> <span class="string">'@/mixins/emitter.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    mixins: [Emitter],</span><br><span class="line">    methods: &#123;</span><br><span class="line">        showTheForm () &#123;</span><br><span class="line">            <span class="keyword">this</span>.broadcast(<span class="string">'parent-form'</span>, <span class="string">'show'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>子元素接收</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    created () &#123;</span><br><span class="line">        <span class="keyword">this</span>.$on(<span class="string">'show'</span>, (val) =&gt; &#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>这么做的好处是子元素内部的数据可以不从父元素中 props ，使得子元素看起来结构能更加清晰。</p>
]]></content>
      <categories>
        <category>js-lib</category>
      </categories>
      <tags>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>js跨域的几种方式</title>
    <url>/2017/09/07/javascript/js-cors/</url>
    <content><![CDATA[<h2 id="jsonp请求"><a href="#jsonp请求" class="headerlink" title="jsonp请求"></a>jsonp请求</h2><p>ajax 本身是不可以跨域的，通过产生一个 script 标签来实现跨域。因为 script 标签的 src 属性是没有跨域的限制的。<br>jquery 其实设置了 dataType: ‘jsonp’ 后，$.ajax 方法就和 ajax XmlHttpRequest 没什么关系了，取而代之的则是 JSONP 协议。<br>JSONP 是一个非官方的协议，它允许在服务器端集成 Script tags 返回至客户端，通过 javascript callback 的形式实现跨域访问。</p>
<p>jQuery并没有用其它新奇的技术，只不是对 <code>&lt;script src=&quot;&quot;/&gt;</code> 做了个封装，以实现jsonp跨域的方式。</p>
<p>我们封装一层jsonp的实现，废话不说，上代码</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> jsonp = <span class="function"><span class="keyword">function</span> (<span class="params">opts</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//to produce random string</span></span><br><span class="line">    <span class="keyword">var</span> generateRandomAlphaNum = <span class="function"><span class="keyword">function</span> (<span class="params">len</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> rdmString = <span class="string">''</span>;</span><br><span class="line">        <span class="keyword">for</span> (; rdmString.length &lt; len; rdmString += <span class="built_in">Math</span>.random().toString(<span class="number">36</span>).substr(<span class="number">2</span>));</span><br><span class="line">        <span class="keyword">return</span> rdmString.substr(<span class="number">0</span>, len);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> url = <span class="keyword">typeof</span> opts === <span class="string">'string'</span> ? opts : opts.url,</span><br><span class="line">        callbackName = opts.callbackName || <span class="string">'jsonpCallback'</span> + generateRandomAlphaNum(<span class="number">10</span>),</span><br><span class="line">        callbackFn = opts.callbackFn || <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">    <span class="keyword">if</span> (url.indexOf(<span class="string">'callback'</span>) === <span class="number">-1</span>) &#123;</span><br><span class="line">        url += url.indexOf(<span class="string">'?'</span>) === <span class="number">-1</span> ? <span class="string">'?callback='</span> + callbackName :</span><br><span class="line">            <span class="string">'&amp;callback='</span> + callbackName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> opts === <span class="string">'object'</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> params = (<span class="function"><span class="keyword">function</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> str = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> prop <span class="keyword">in</span> obj)&#123;</span><br><span class="line">                str += prop + <span class="string">'='</span> + obj[prop] + <span class="string">'&amp;'</span></span><br><span class="line">            &#125;</span><br><span class="line">            str = str.slice(<span class="number">0</span>, str.length - <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> str;</span><br><span class="line">        &#125;)(opts.data);</span><br><span class="line">        url += <span class="string">'&amp;'</span> + params;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> eleScript= <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line">    eleScript.type = <span class="string">'text/javascript'</span>;</span><br><span class="line">    eleScript.id = <span class="string">'jsonp'</span>;</span><br><span class="line">    eleScript.src = url;</span><br><span class="line">    <span class="built_in">document</span>.getElementsByTagName(<span class="string">'HEAD'</span>)[<span class="number">0</span>].appendChild(eleScript);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// window[callbackName] = callbackFn;</span></span><br><span class="line">    <span class="comment">//return promise</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">window</span>[callbackName] = <span class="function"><span class="keyword">function</span> (<span class="params">json</span>) </span>&#123;</span><br><span class="line">            resolve(json);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//onload are executed just after the sync request is comple，</span></span><br><span class="line">        <span class="comment">//please use 'onreadystatechange' if need support IE9-</span></span><br><span class="line">        eleScript.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="comment">//delete the script element when a request done。</span></span><br><span class="line">            <span class="built_in">document</span>.getElementById(<span class="string">'jsonp'</span>).outerHTML = <span class="string">''</span>;</span><br><span class="line">            eleScript = <span class="literal">null</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">        eleScript.onerror = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">document</span>.getElementById(<span class="string">'jsonp'</span>).outerHTML = <span class="string">''</span>;</span><br><span class="line">            eleScript = <span class="literal">null</span>;</span><br><span class="line">            reject(<span class="string">'error'</span>);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">jsonp(&#123;</span><br><span class="line">    url: <span class="string">'http://erp.souche.com/pc/car/carpricetagaction/carPriceInfo.jsonp'</span>, <span class="comment">/*url写异域的请求地址*/</span></span><br><span class="line">    data: &#123;</span><br><span class="line">        carId: <span class="string">'0a499720d77f4e55a0ac490ed115fc4e'</span>,</span><br><span class="line">        picNum: <span class="number">5</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(d.data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>jsonp的缺点：只支持GET请求，也容易被运营商劫持插入奇怪的广告。</p>
<p>jsonp的优点：能支持老的浏览器。</p>
<h2 id="xhr2"><a href="#xhr2" class="headerlink" title="xhr2"></a>xhr2</h2><p>XHR2在众多HTML5新特性中算是比较低调的一个了。我翻了几本HTML5的书，只有《HTML5高级程序设计》弱弱地讲了几页。网上的资料也不多，很大的一个原因我估计是目前有浏览器还压根不兼容，看看下面的兼容列表：</p>
<ul>
<li>Chrome 7.0及以上</li>
<li>Firefox 3.5以上</li>
<li>Internet Explorer 10及以上</li>
<li>Opera 12.1及以上</li>
<li>Safari 5.0及以上</li>
<li>android broswer 3及以上</li>
<li>ios safari 5.1及以上</li>
</ul>
<p>XHR2这么叫多少有点误导的感觉，实际上没有什么XHR1，XHR2这样的概念，XHR2只是一套新的规范，在原有XHR对象上新增了一些功能：跨域访问，全新的事件，还有请求进度以及响应进度。 所以呢，要实现XHR2特性还是使用XMLHttpRequest对象，前提是浏览器要支持XHR2：<br>http发现这是一个跨源的ajax请求后就自动在头信息添加一个origin字段，服务器根据这个字段判断是否同意这次请求，如果同意这次请求则在响应头中插入字段 <code>Access-Control-Allow-Origin</code> 。</p>
<p>这是常见的一个 http response header 里关于 xhr2 的设置</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Access-Control-Allow-Credentials: true</span><br><span class="line">Access-Control-Allow-Headers: Origin, X-Requested-With, Content-Type, Accept, TT, _security_token</span><br><span class="line">Access-Control-Allow-Methods: POST, GET, PUT, OPTIONS, DELETE</span><br><span class="line">Access-Control-Allow-Origin: http://xxx.domain.com</span><br></pre></td></tr></table></figure>

<p>请注意，如果需要请求中带上 cookie 则把 <code>Access-Control-Allow-Credentials</code> 设置为 true。但是如果 <code>Access-Control-Allow-Origin</code> 为 * 时，这么设置将会报错。</p>
<p>优点是支持所有类型的http请求</p>
<p>缺点是 <code>Access-Control-Allow-Origin</code> 这个头所跨的域本人实践写多个域名无效，那么就只能跨一个网站。</p>
<h2 id="后台代理方式"><a href="#后台代理方式" class="headerlink" title="后台代理方式"></a>后台代理方式</h2><p>这种方式可以解决所有跨域问题，也就是将后台作为代理，每次对其它域的请求转交给本域的后台，本域的后台通过模拟http请求去访问其它域，再将返回的结果返回给前台。</p>
<p>优点是无论访问的是文档，还是js文件都可以实现跨域。</p>
<p>缺点为每一个请求都需要一个后端去写转发的支持。</p>
<h2 id="iframe跨域"><a href="#iframe跨域" class="headerlink" title="iframe跨域"></a>iframe跨域</h2><p>对于主域相同而子域不同的例子，可以通过设置document.domain的办法来解决。具体的做法是可以在 <code>http://www.a.com/a.html</code> 和<code>http://script.a.com/b.html</code> 两个文件中分别加上 <code>document.domain = &#39;a.com&#39;</code>；然后通过 a.html 文件中创建一个 iframe ，去控制 iframe 的 contentDocument，这样两个js文件之间就可以“交互”了。当然这种办法只能解决主域相同而二级域名不同的情况，如果你异想天开的把script.a.com的domian设为alibaba.com那显然是会报错地！代码如下：</p>
<p><a href="http://www.a.com" target="_blank" rel="noopener">www.a.com</a> 上的 a.html</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">document.domain = &apos;a.com&apos;;</span><br><span class="line">var ifr = document.createElement(&apos;iframe&apos;);</span><br><span class="line">ifr.src = &apos;http://script.a.com/b.html&apos;;</span><br><span class="line">ifr.style.display = &apos;none&apos;;</span><br><span class="line">document.body.appendChild(ifr);</span><br><span class="line">ifr.onload = function()&#123;</span><br><span class="line">    var doc = ifr.contentDocument || ifr.contentWindow.document;</span><br><span class="line">    // 在这里操纵b.html</span><br><span class="line">    alert(doc.getElementsByTagName(&quot;h1&quot;)[0].childNodes[0].nodeValue);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>script.a.com 上的 b.html</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">document.domain = &apos;a.com&apos;;</span><br></pre></td></tr></table></figure>

<p>问题：</p>
<ul>
<li>安全性，当一个站点（b.a.com）被攻击后，另一个站点（c.a.com）会引起安全漏洞。</li>
<li>如果一个页面中引入多个iframe，要想能够操作所有iframe，必须都得设置相同domain。</li>
</ul>
<h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2><p>实际开发过程中，我的做法是本地用后台代理方式，也就是node中转一层去获取数据，关于这一点比方说 webpack 的配置项 proxyTable 就提供了这样的功能。下面提供了一段简单的配置</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> devConf = &#123;</span><br><span class="line">    env: <span class="string">'dev'</span>,</span><br><span class="line">    globalConfig: &#123;</span><br><span class="line">        NODE_ENV: <span class="built_in">JSON</span>.stringify(<span class="string">"development"</span>),</span><br><span class="line">        TEST: <span class="built_in">JSON</span>.stringify(<span class="string">"/api/get"</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    proxyTable: &#123;</span><br><span class="line">        <span class="string">'/api/get'</span>: &#123;</span><br><span class="line">            target: <span class="string">'http://test.sqaproxy.xx.com'</span>,</span><br><span class="line">            changeOrigin: <span class="literal">true</span>,</span><br><span class="line">            pathRewrite: &#123;</span><br><span class="line">                <span class="string">'/api/get'</span>: <span class="string">''</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>那么具体文件中访问 globalConfig 中的 TEST 变量就是代理后的地址</p>
<p>而到了预发和线上时，自然有后端返回的 <code>Access-Control-Allow-Origin</code> 头来做 xhr2 跨域。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="http://www.ruanyifeng.com/blog/2016/04/cors.html" target="_blank" rel="noopener">阮一峰，跨域资源共享 CORS 详解</a></li>
<li><a href="http://rubyer.me/blog/324/" target="_blank" rel="noopener">jsonp原理</a></li>
<li><a href="http://www.cnblogs.com/rainman/archive/2011/02/20/1959325.html" target="_blank" rel="noopener">iframe跨域</a></li>
</ul>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
  </entry>
  <entry>
    <title>grid 布局简单 demo</title>
    <url>/2017/08/08/css/grid-introduce/</url>
    <content><![CDATA[<h2 id="兼容性"><a href="#兼容性" class="headerlink" title="兼容性"></a>兼容性</h2><p>chrome 60+<br>FF 52+<br>IE 10+, -ms-<br>Android none<br>IOS safari 10.3+</p>
<h2 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box a"</span>&gt;</span>A<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box b"</span>&gt;</span>B<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box c"</span>&gt;</span>C<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box d"</span>&gt;</span>D<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box e"</span>&gt;</span>E<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box f"</span>&gt;</span>F<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box g"</span>&gt;</span>G<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box h"</span>&gt;</span>H<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box i"</span>&gt;</span>I<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box j"</span>&gt;</span>J<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.wrapper</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: grid;</span><br><span class="line">    <span class="attribute">grid-template-columns</span>: <span class="number">100px</span> <span class="number">10px</span> <span class="number">100px</span> <span class="number">10px</span> <span class="number">100px</span> <span class="number">10px</span> <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">grid-template-rows</span>: auto <span class="number">10px</span> auto <span class="number">10px</span> auto <span class="number">10px</span> auto <span class="number">10px</span> auto;</span><br><span class="line">    <span class="attribute">grid-template-columns</span>: (col) <span class="number">100px</span> (gutter) <span class="number">10px</span> (col) <span class="number">100px</span> (gutter) <span class="number">10px</span> (col) <span class="number">100px</span> (gutter) <span class="number">10px</span> (col) <span class="number">100px</span> (gutter); </span><br><span class="line">    <span class="attribute">grid-template-rows</span>: (row) auto (gutter) <span class="number">10px</span> (row) auto (gutter) <span class="number">10px</span> (row) auto (gutter) <span class="number">10px</span> (row) auto (gutter) <span class="number">10px</span> (row) auto;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#444</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">150%</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.a</span>&#123;</span><br><span class="line">    <span class="attribute">grid-column</span>: <span class="number">1</span> / <span class="number">6</span>; </span><br><span class="line">    <span class="attribute">grid-row</span>: <span class="number">1</span> / <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.b</span> &#123;</span><br><span class="line">    <span class="attribute">grid-column</span>: <span class="number">7</span> / <span class="number">8</span>; </span><br><span class="line">    <span class="attribute">grid-row</span>: <span class="number">1</span> / <span class="number">10</span>; </span><br><span class="line">    <span class="attribute">background</span>: orange;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.c</span> &#123; </span><br><span class="line">    <span class="attribute">grid-column</span>: <span class="number">1</span> / <span class="number">2</span>; </span><br><span class="line">    <span class="attribute">grid-row</span>: <span class="number">3</span> / <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.d</span> &#123; </span><br><span class="line">    <span class="attribute">grid-column</span>: <span class="number">3</span> / <span class="number">4</span>; </span><br><span class="line">    <span class="attribute">grid-row</span>: <span class="number">3</span> / <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.e</span> &#123; </span><br><span class="line">    <span class="attribute">grid-column</span>: <span class="number">5</span> / <span class="number">6</span>; </span><br><span class="line">    <span class="attribute">grid-row</span>: <span class="number">3</span> / <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.f</span> &#123; </span><br><span class="line">    <span class="attribute">grid-column</span>: <span class="number">1</span> / <span class="number">4</span>; </span><br><span class="line">    <span class="attribute">grid-row</span>: <span class="number">5</span> / <span class="number">6</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.g</span> &#123;</span><br><span class="line">    <span class="attribute">grid-column</span>: <span class="number">5</span> / <span class="number">6</span>; </span><br><span class="line">    <span class="attribute">grid-row</span>: <span class="number">5</span> / <span class="number">6</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.h</span> &#123;</span><br><span class="line">    <span class="attribute">grid-column</span>: <span class="number">1</span> / <span class="number">2</span>; </span><br><span class="line">    <span class="attribute">grid-row</span>: <span class="number">7</span> / <span class="number">8</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.i</span> &#123;</span><br><span class="line">    <span class="attribute">grid-column</span>: <span class="number">3</span> / <span class="number">6</span>; </span><br><span class="line">    <span class="attribute">grid-row</span>: <span class="number">7</span> / <span class="number">8</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.j</span> &#123;</span><br><span class="line">    <span class="attribute">grid-column</span>: <span class="number">1</span> / <span class="number">6</span>; </span><br><span class="line">    <span class="attribute">grid-row</span>: <span class="number">9</span> / <span class="number">10</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://7xn4mw.com1.z0.glb.clouddn.com/17-8-8/53362367.jpg" alt=""></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://segmentfault.com/a/1190000002448197" target="_blank" rel="noopener">CSS Grid布局：合并单元格布局</a></li>
<li><a href="http://www.w3cplus.com/css3/css-grid-layout-terminology-part1.html" target="_blank" rel="noopener">CSS Grid布局：图解网格布局中术语之一</a></li>
<li><a href="http://www.w3cplus.com/css3/css-grid-layout-terminology-part2.html" target="_blank" rel="noopener">CSS Grid布局：图解网格布局中术语二</a></li>
<li><a href="http://www.w3cplus.com/css3/css-grid-layout-terminology-part3.html" target="_blank" rel="noopener">CSS Grid布局：图解网格布局中术语三</a></li>
<li><a href="http://www.w3cplus.com/css3/css-grid-layout-using-grid-areas.html" target="_blank" rel="noopener">CSS Grid布局：网格区域</a></li>
<li><a href="http://www.w3cplus.com/css3/css-grid-layout-units-of-measurement-and-basic-keywords.html" target="_blank" rel="noopener">CSS Grid布局：列和间距</a></li>
<li><a href="http://www.w3cplus.com/css3/solving-problems-with-css-grid-and-flexbox-the-card-ui.html" target="_blank" rel="noopener">使用CSS Grid和Flexbox制作Card</a></li>
</ul>
]]></content>
      <categories>
        <category>css</category>
      </categories>
      <tags>
        <tag>css 3</tag>
      </tags>
  </entry>
  <entry>
    <title>怎么复制去剪贴板</title>
    <url>/2017/08/08/javascript/how-to-copy-to-clipboard/</url>
    <content><![CDATA[<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>创建一个input，并append到body中，设置其value，并且让其select选中文本。</p>
<p>调用 document.execCommand 命令复制，最后移除input。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var doCopy = function (code) &#123;</span><br><span class="line">    var input = document.createElement(&apos;input&apos;);</span><br><span class="line">    document.body.appendChild(input);</span><br><span class="line">    input.value = `&#123;$&#123;code&#125;&#125;`;</span><br><span class="line">    input.select();</span><br><span class="line">    document.execCommand(&apos;Copy&apos;);</span><br><span class="line">    document.body.removeChild(input);</span><br><span class="line"></span><br><span class="line">    console.log(&apos;复制成功&apos;)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="兼容性"><a href="#兼容性" class="headerlink" title="兼容性"></a>兼容性</h2><p>根据 <a href="https://caniuse.com/#search=execCommand" target="_blank" rel="noopener">Can I use</a> 的数据</p>
<p>chrome 4+<br>FF 9+<br>Safari 6+<br>IE 6+</p>
<p>想必不会遇到兼容性问题，不过需要注意的是 execCommand 所能直接支持的命令有限。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document/execCommand" target="_blank" rel="noopener">MDN execCommand</a><br><a href="http://blog.csdn.net/woshinia/article/details/18664903" target="_blank" rel="noopener">execCommand的用法</a></p>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
  </entry>
  <entry>
    <title>git 修改 commit 记录</title>
    <url>/2017/07/19/source-control/git-commit-modify/</url>
    <content><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>在使用 Git 作为版本控制的时，处于多种原因想修改commit。以下有三种情况</p>
<ul>
<li>如果没有push到服务器的情况，，只是本地进行了commit，并且没有进行新的commit，只需要<code>git commit --amend;</code></li>
<li>还没push到服务器，但是有了新的commit，只需要git reset –soft xxx （xxx有问题那次提交的commit id）</li>
<li>如果已经push到了服务器，并且有了多个commit，而这些 commit 拼接起来才是完整的任务。为了避免太多commit，推荐将这些 commit 合并成一个。</li>
</ul>
<h2 id="问题再现"><a href="#问题再现" class="headerlink" title="问题再现"></a>问题再现</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git status</span><br><span class="line"></span><br><span class="line">commit 1a607dcdc4ab522ce94b395fff5968c5035362b4</span><br><span class="line">Author: 陈子云 &lt;ever-lose@foxmail.com&gt;</span><br><span class="line">Date:   Tue Mar 21 16:05:34 2017 +0800</span><br><span class="line"></span><br><span class="line">    changelog补上</span><br><span class="line"></span><br><span class="line">commit a7bd84613243535f5a2de1d1f35037531ea153e3</span><br><span class="line">Author: 陈子云 &lt;ever-lose@foxmail.com&gt;</span><br><span class="line">Date:   Tue Mar 21 16:03:14 2017 +0800</span><br><span class="line"></span><br><span class="line">    标签合并出错，html结构被改乱了</span><br><span class="line"></span><br><span class="line">commit 8a7c40cd96153f1eb51648f46389c9ef4395c8a9</span><br><span class="line">Author: 陈子云 &lt;ever-lose@foxmail.com&gt;</span><br><span class="line">Date:   Tue Mar 7 19:37:11 2017 +0800</span><br><span class="line"></span><br><span class="line">    chore(package.json): update verison to 2.2.2</span><br></pre></td></tr></table></figure>

<p>在“标签合并出错，html结构被改乱了”之后发现changelog还没写呢，于是在提交了一发“changelog补上”，希望能把这两个提交合并成一个。</p>
<h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># You can do a soft reset and amend the changes to the root commit. </span></span><br><span class="line">$ git reset HEAD^1</span><br><span class="line"></span><br><span class="line">Unstaged changes after reset:</span><br><span class="line">M	CHANGELOG.md</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ git add ./</span><br><span class="line">$ git commit --amend</span><br><span class="line"></span><br><span class="line">[photoGallery df482e8] 标签合并出错，html结构被改乱了</span><br><span class="line"> Date: Tue Mar 21 16:03:14 2017 +0800</span><br><span class="line"> 2 files changed, 18 insertions(+), 17 deletions(-)</span><br></pre></td></tr></table></figure>

<p>合并成功</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git <span class="built_in">log</span></span><br><span class="line"></span><br><span class="line">commit df482e862824c9ba8335f6ca25491231b44fc9e1</span><br><span class="line">Author: 陈子云 &lt;ever-lose@foxmail.com&gt;</span><br><span class="line">Date:   Tue Mar 21 16:03:14 2017 +0800</span><br><span class="line"></span><br><span class="line">    标签合并出错，html结构被改乱了</span><br><span class="line"></span><br><span class="line">commit 8a7c40cd96153f1eb51648f46389c9ef4395c8a9</span><br><span class="line">Author: 陈子云 &lt;ever-lose@foxmail.com&gt;</span><br><span class="line">Date:   Tue Mar 7 19:37:11 2017 +0800</span><br><span class="line"></span><br><span class="line">    chore(package.json): update verison to 2.2.2</span><br></pre></td></tr></table></figure>

<p>最后在push就大功告成。</p>
]]></content>
      <categories>
        <category>source-control</category>
      </categories>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>git 修改 commit 记录</title>
    <url>/2017/07/19/source-control/git-ignore-global/</url>
    <content><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Mac 中每个目录都会有个文件叫.DS_Store, 用于存储当前文件夹的一些 Meta 信息。每次提交代码时，我都要在代码仓库的 .gitignore 中声明，忽略这类文件。有方法可以全局性的忽略某种类型的文件吗？按照以下两步就可实现</p>
<h2 id="一、创建-gitignore-global-文件，把需要全局忽略的文件类型塞到这个文件里。"><a href="#一、创建-gitignore-global-文件，把需要全局忽略的文件类型塞到这个文件里。" class="headerlink" title="一、创建 ~/.gitignore_global 文件，把需要全局忽略的文件类型塞到这个文件里。"></a>一、创建 ~/.gitignore_global 文件，把需要全局忽略的文件类型塞到这个文件里。</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># .gitignore_global</span><br><span class="line">####################################</span><br><span class="line">######## OS generated files ########</span><br><span class="line">####################################</span><br><span class="line">.DS_Store</span><br><span class="line">.DS_Store?</span><br><span class="line">*.swp</span><br><span class="line">._*</span><br><span class="line">.Spotlight-V100</span><br><span class="line">.Trashes</span><br><span class="line">Icon?</span><br><span class="line">ehthumbs.db</span><br><span class="line">Thumbs.db</span><br><span class="line">####################################</span><br><span class="line">############# Packages #############</span><br><span class="line">####################################</span><br><span class="line">*.7z</span><br><span class="line">*.dmg</span><br><span class="line">*.gz</span><br><span class="line">*.iso</span><br><span class="line">*.jar</span><br><span class="line">*.rar</span><br><span class="line">*.tar</span><br><span class="line">*.zip</span><br></pre></td></tr></table></figure>

<h2 id="二、在-gitconfig-中引入-gitignore-global。"><a href="#二、在-gitconfig-中引入-gitignore-global。" class="headerlink" title="二、在 ~/.gitconfig 中引入 .gitignore_global。"></a>二、在 ~/.gitconfig 中引入 .gitignore_global。</h2><p>这是我的.gitconfig 文件:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[user]</span><br><span class="line">name = 陈子云</span><br><span class="line">email = ever-lose@foxmail.com</span><br><span class="line">[push]</span><br><span class="line">    default = matching</span><br><span class="line">[core]</span><br><span class="line">    excludesfile = ~/.gitignore_global</span><br></pre></td></tr></table></figure>

<p>搞定了！在所有的文件夹下 .DS_Store .swp .zip 等文件类型会被 Git 自动忽略。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="http://www.07net01.com/2015/03/804033.html" target="_blank" rel="noopener">http://www.07net01.com/2015/03/804033.html</a></p>
]]></content>
      <categories>
        <category>source-control</category>
      </categories>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>git rebase 操作</title>
    <url>/2017/07/19/source-control/git-rebase/</url>
    <content><![CDATA[<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><p>新建一个分支</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git checkout -b bugfix/style</span><br></pre></td></tr></table></figure>

<p>做了一些修改，然后 add，commit提交</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git checkout master</span><br><span class="line">git rebase bugfix/style</span><br></pre></td></tr></table></figure>

<p>如果这一步没有冲突就直接 push。</p>
<p>如有这一步出现冲突，则Git会停止rebase并会让你去解决 冲突；在解决完冲突后，用<code>git add</code>命令去更新这些内容的索引(index), 然后，你无需执行 git-commit,只要执行:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git rebase --continue</span><br></pre></td></tr></table></figure>

<p>这样git会继续应用(apply)余下的补丁。</p>
<p>如果希望修改push前的commit，则</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git commit --amend</span><br></pre></td></tr></table></figure>

<p>在任何时候，你可以用–abort参数来终止rebase的行动，并且master 分支会回到rebase开始前的状态。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git rebase --abort</span><br></pre></td></tr></table></figure>

<h2 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h2><p>merge分支</p>
<p><img src="http://img.souche.com/20170719/png/31daa9e6b580b6e4aeb4dd1a2f0353b9.png" alt=""></p>
<p>rebase分支</p>
<p><img src="http://img.souche.com/20170719/png/48aa27e71e82bbf0863e4e8babdc6a67.png" alt=""></p>
<p>rebase用于把一个分支的修改合并到当前分支，使得主干看起来更加清晰。</p>
]]></content>
      <categories>
        <category>source-control</category>
      </categories>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>git 合并代码的三种策略</title>
    <url>/2017/07/19/source-control/git-merge/</url>
    <content><![CDATA[<h2 id="git-merge"><a href="#git-merge" class="headerlink" title="git merge"></a>git merge</h2><h3 id="git-merge-–no-ff"><a href="#git-merge-–no-ff" class="headerlink" title="git merge –no-ff"></a>git merge –no-ff</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -ff为fast-forward模式，合并所有tmp分支上的commit，</span></span><br><span class="line"><span class="comment"># --no为再创建一个新的合并节点。</span></span><br><span class="line"><span class="comment"># 此命令意为合并tmp分支上的所有commit后并新建一个commit。</span></span><br><span class="line"></span><br><span class="line">git merge --no-ff tmp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># stable A---B---C---F</span></span><br><span class="line"><span class="comment"># tmp    A---B---C---D---E</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># stable A---B---C---F---G</span></span><br><span class="line"><span class="comment">#                       /</span></span><br><span class="line"><span class="comment">#                  D---E</span></span><br></pre></td></tr></table></figure>

<h3 id="git-merge-–squash"><a href="#git-merge-–squash" class="headerlink" title="git merge –squash"></a>git merge –squash</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 创建一个新的合并节点，并舍弃tmp分支其他的commit，如D和E</span></span><br><span class="line"><span class="comment"># 把所有tmp分支的改动都放到这个新节点G中</span></span><br><span class="line"><span class="comment"># 如果tmp分支存在太多无意义的commit，这条命令好用。</span></span><br><span class="line"><span class="comment"># finally deleting targetBranch branch.</span></span><br><span class="line"></span><br><span class="line">git merge --squash tmp</span><br><span class="line"></span><br><span class="line"><span class="comment"># stable A---B---C---F</span></span><br><span class="line"><span class="comment"># tmp    A---B---C---D---E</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># stable A---B---C---F---G</span></span><br></pre></td></tr></table></figure>

<h3 id="git-rebase"><a href="#git-rebase" class="headerlink" title="git rebase"></a>git rebase</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 保留tmp分支所有提交，但会直接写入stable分支的提交记录中</span></span><br><span class="line"></span><br><span class="line">git rebase -i tmp</span><br><span class="line"></span><br><span class="line"><span class="comment"># stable A---B---C---F---G</span></span><br><span class="line"><span class="comment"># tmp    A---B---C---D---E</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># stable A---B---C---F---G---D---E</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>source-control</category>
      </categories>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>glob 模式的 Linux Shell 通配符</title>
    <url>/2017/05/27/os/linux-glob/</url>
    <content><![CDATA[<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>glob 模式（globbing）也被称之为 shell 通配符，名字的起源来自于 Unix V6 中的 /etc/glob （详见 man 文档）。glob 是一种特殊的模式匹配，最常见的是通配符拓展，也可以将 glob 模式设为精简了的正则表达式，在最新的 CentOS 7 中已经删除了 glob 的相关描述文档，删除的原因由于 glob 已经整合到了 shell 之中，然后就有了 shell 通配符。</p>
<p>笔者在查阅资料的时候发现关于 glob 模式或者 globbing 的相关描述以及文档是少之又少，所以特地在这里整理一下并重新写一写使用方法</p>
<h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">*   匹配任意长度任意字符</span><br><span class="line">?   匹配任意单个字符</span><br><span class="line">[list]  匹配指定范围内（list）任意单个字符，也可以是单个字符组成的集合</span><br><span class="line">[^list] 匹配指定范围外的任意单个字符或字符集合</span><br><span class="line">[!list] 同[^list]</span><br><span class="line">&#123;str1,str2,...&#125; 匹配 srt1 或者 srt2 或者更多字符串，也可以是集合</span><br></pre></td></tr></table></figure>

<p>专用字符集</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[:alnum:]	任意数字或者字母</span><br><span class="line">[:alpha:]	任意字母</span><br><span class="line">[:space:]	空格</span><br><span class="line">[:lower:]	小写字母</span><br><span class="line">[:digit:]	任意数字</span><br><span class="line">[:upper:]	任意大写字母</span><br><span class="line">[:cntrl:]	控制符</span><br><span class="line">[:graph:]	图形</span><br><span class="line">[:print:]	可打印字符</span><br><span class="line">[:punct:]	标点符号</span><br><span class="line">[:xdigit:]	十六进制数</span><br><span class="line">[:blank:]	空白字符（未验证）</span><br></pre></td></tr></table></figure>

<h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><p>匹配当前文件夹下的 node_modules 下的所有文件</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">"./node_modules/*"</span>: <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>拿 vscode 设置中的 “files.exclude” 举例，如果我希望不显示 node_modules 下的公司内部的包 @souche-f2e 和 @souche-vue ，也显示 vue 全家桶，其他包全都隐藏，则：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">"files.exclude"</span>: &#123;</span><br><span class="line">    <span class="string">"./node_modules/[^@v]*"</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>os</category>
      </categories>
  </entry>
  <entry>
    <title>svg画圆环进度动画</title>
    <url>/2017/05/04/svg/svg-ring-animate/</url>
    <content><![CDATA[<h2 id="一、先画一圆环"><a href="#一、先画一圆环" class="headerlink" title="一、先画一圆环"></a>一、先画一圆环</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/2000/svg"</span> <span class="attr">height</span>=<span class="string">"110"</span> <span class="attr">width</span>=<span class="string">"110"</span> <span class="attr">viewBox</span>=<span class="string">"0 0 110 110"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">circle</span> <span class="attr">cx</span>=<span class="string">"50%"</span> <span class="attr">cy</span>=<span class="string">"50%"</span> <span class="attr">r</span>=<span class="string">"50"</span> <span class="attr">stroke-width</span>=<span class="string">"10"</span> <span class="attr">stroke</span>=<span class="string">"#F2F2F2"</span> <span class="attr">fill</span>=<span class="string">"none"</span>&gt;</span><span class="tag">&lt;/<span class="name">circle</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>定义让外层容器为宽高110px的正方形，并且定义在容器的中心处（cx=”50%”” cy=”50%”）画半径为50px的圆（r=”50”），圆的内容不着色（fill=”none”）。描边为10px，着描边色为灰色（stroke-width=”10” stroke=”#F2F2F2”）</p>
<p><img src="http://7xn4mw.com1.z0.glb.clouddn.com/17-5-3/17004000-file_1493801348693_c319.png" alt=""></p>
<h2 id="二、再来一层绿色圆环叠加"><a href="#二、再来一层绿色圆环叠加" class="headerlink" title="二、再来一层绿色圆环叠加"></a>二、再来一层绿色圆环叠加</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/2000/svg"</span> <span class="attr">height</span>=<span class="string">"110"</span> <span class="attr">width</span>=<span class="string">"110"</span> <span class="attr">viewBox</span>=<span class="string">"0 0 110 110"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">circle</span> <span class="attr">cx</span>=<span class="string">"50%"</span> <span class="attr">cy</span>=<span class="string">"50%"</span> <span class="attr">r</span>=<span class="string">"50"</span> <span class="attr">stroke-width</span>=<span class="string">"10"</span> <span class="attr">stroke</span>=<span class="string">"#F2F2F2"</span> <span class="attr">fill</span>=<span class="string">"none"</span>&gt;</span><span class="tag">&lt;/<span class="name">circle</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">circle</span> <span class="attr">id</span>=<span class="string">"ring"</span> <span class="attr">cx</span>=<span class="string">"50%"</span> <span class="attr">cy</span>=<span class="string">"50%"</span> <span class="attr">r</span>=<span class="string">"50"</span> <span class="attr">stroke-width</span>=<span class="string">"10"</span> <span class="attr">stroke</span>=<span class="string">"green"</span> <span class="attr">fill</span>=<span class="string">"none"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">transform</span>=<span class="string">"rotate(-90 55 55)"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">stroke-dasharray</span>=<span class="string">"100, 314"</span>&gt;</span><span class="tag">&lt;/<span class="name">circle</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>下面的 <code>circle</code> 着描边为绿，并且写上了 <code>stroke-dasharray</code> ，此属性参数第一个数值表示dash，这里代表覆盖范围，后一个数字表示gap长度默认为circle的周长314。此外tranform属性的作用是将圆环从0点位置开始覆盖，不写此属性则从3点位置开始覆盖（rotate第一个参数为角度，第二个和第三个参数为旋转中心，这里为容器的中心）。</p>
<p><img src="http://7xn4mw.com1.z0.glb.clouddn.com/17-5-3/6769724-file_1493801775184_9b3c.png" alt=""></p>
<h2 id="三、给圆环加入渐变色"><a href="#三、给圆环加入渐变色" class="headerlink" title="三、给圆环加入渐变色"></a>三、给圆环加入渐变色</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/2000/svg"</span> <span class="attr">height</span>=<span class="string">"110"</span> <span class="attr">width</span>=<span class="string">"110"</span> <span class="attr">viewBox</span>=<span class="string">"0 0 110 110"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">linearGradient</span> <span class="attr">id</span>=<span class="string">"svg-gradient"</span> <span class="attr">gradientUnits</span>=<span class="string">"userSpaceOnUse"</span> <span class="attr">x1</span>=<span class="string">"100%"</span> <span class="attr">y1</span>=<span class="string">"100%"</span> <span class="attr">x2</span>=<span class="string">"0%"</span> <span class="attr">y2</span>=<span class="string">"0%"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">stop</span> <span class="attr">offset</span>=<span class="string">"0%"</span> <span class="attr">style</span>=<span class="string">"stop-color:yellow"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">stop</span> <span class="attr">offset</span>=<span class="string">"100%"</span> <span class="attr">style</span>=<span class="string">"stop-color:green"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">linearGradient</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">circle</span> <span class="attr">cx</span>=<span class="string">"50%"</span> <span class="attr">cy</span>=<span class="string">"50%"</span> <span class="attr">r</span>=<span class="string">"50"</span> <span class="attr">stroke-width</span>=<span class="string">"10"</span> <span class="attr">stroke</span>=<span class="string">"#F2F2F2"</span> <span class="attr">fill</span>=<span class="string">"none"</span>&gt;</span><span class="tag">&lt;/<span class="name">circle</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">circle</span> <span class="attr">id</span>=<span class="string">"ring"</span> <span class="attr">cx</span>=<span class="string">"50%"</span> <span class="attr">cy</span>=<span class="string">"50%"</span> <span class="attr">r</span>=<span class="string">"50"</span> <span class="attr">stroke-width</span>=<span class="string">"10"</span> <span class="attr">fill</span>=<span class="string">"none"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">stroke</span>=<span class="string">"url(#svg-gradient)"</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">transform</span>=<span class="string">"rotate(-90 55 55)"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">stroke-dasharray</span>=<span class="string">"200, 314"</span>&gt;</span><span class="tag">&lt;/<span class="name">circle</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>id为ring的 <code>circle</code> 改变了stroke属性为 <code>url(#svg-gradient)</code> ，意为以上面的 <code>linearGradient</code> 背景，以起点黄到终点绿渐变。</p>
<p><img src="http://7xn4mw.com1.z0.glb.clouddn.com/17-5-3/56943354-file_1493802117632_4cc0.png" alt=""></p>
<h2 id="四、加入动画"><a href="#四、加入动画" class="headerlink" title="四、加入动画"></a>四、加入动画</h2><figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;<span class="selector-tag">style</span>&gt;</span><br><span class="line"><span class="selector-tag">circle</span> &#123;</span><br><span class="line">    <span class="attribute">-webkit-transition</span>: stroke-dasharray <span class="number">2s</span>;</span><br><span class="line">    <span class="attribute">transition</span>: stroke-dasharray <span class="number">2s</span>;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>设置css动画持续2s</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/2000/svg"</span> <span class="attr">height</span>=<span class="string">"110"</span> <span class="attr">width</span>=<span class="string">"110"</span> <span class="attr">viewBox</span>=<span class="string">"0 0 110 110"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">linearGradient</span> <span class="attr">id</span>=<span class="string">"svg-gradient"</span> <span class="attr">gradientUnits</span>=<span class="string">"userSpaceOnUse"</span> <span class="attr">x1</span>=<span class="string">"100%"</span> <span class="attr">y1</span>=<span class="string">"100%"</span> <span class="attr">x2</span>=<span class="string">"0"</span> <span class="attr">y2</span>=<span class="string">"0"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">stop</span> <span class="attr">offset</span>=<span class="string">"0%"</span> <span class="attr">style</span>=<span class="string">"stop-color:yellow"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">stop</span> <span class="attr">offset</span>=<span class="string">"100%"</span> <span class="attr">style</span>=<span class="string">"stop-color:green"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">linearGradient</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">circle</span> <span class="attr">cx</span>=<span class="string">"50%"</span> <span class="attr">cy</span>=<span class="string">"50%"</span> <span class="attr">r</span>=<span class="string">"50"</span> <span class="attr">stroke-width</span>=<span class="string">"10"</span> <span class="attr">stroke</span>=<span class="string">"#F2F2F2"</span> <span class="attr">fill</span>=<span class="string">"none"</span>&gt;</span><span class="tag">&lt;/<span class="name">circle</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">circle</span> <span class="attr">id</span>=<span class="string">"ring"</span> <span class="attr">cx</span>=<span class="string">"50%"</span> <span class="attr">cy</span>=<span class="string">"50%"</span> <span class="attr">r</span>=<span class="string">"50"</span> <span class="attr">stroke-width</span>=<span class="string">"10"</span> <span class="attr">fill</span>=<span class="string">"none"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">stroke</span>=<span class="string">"url(#svg-gradient)"</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">transform</span>=<span class="string">"rotate(-90 55 55)"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">stroke-dasharray</span>=<span class="string">"0, 314"</span>&gt;</span><span class="tag">&lt;/<span class="name">circle</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>id为ring的 <code>circle</code> 改变了 <code>stroke-dasharray</code> 使其 <code>dash</code> 参数初始化为0。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> targetRing = <span class="built_in">document</span>.getElementById(<span class="string">'ring'</span>);</span><br><span class="line"><span class="keyword">var</span> totalLength = targetRing.getTotalLength();</span><br><span class="line"></span><br><span class="line">targetRing.style.strokeDasharray = totalLength + <span class="string">', '</span> + totalLength;</span><br></pre></td></tr></table></figure>

<p>设置改变 <code>circle</code> 的 <code>stroke-dasharray</code>，0为初始，而周长314为一整个圆（直径为100可算得）。</p>
<h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><p>如果改变了圆环尺寸，以下需要更改</p>
<ul>
<li><code>svg</code> 容器的 <code>width</code> 和 <code>height</code>，还有 <code>viewBox</code></li>
<li>两个 <code>circle</code> 的 <code>r</code> 值 还有 <code>stroke-width</code>值</li>
<li><code>#ring</code> 的 <code>transform=rotate()</code> 里的后两个参数为容器的中心坐标</li>
<li><code>#ring</code> 的 <code>stroke-dasharray</code> 里的最后一个参数当为圆的周长</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="http://www.tuicool.com/articles/VfyMfua" target="_blank" rel="noopener">推酷-理解SVG坐标系统和变换： transform属性</a></li>
<li><a href="http://www.zhangxinxu.com/wordpress/2015/07/svg-circle-loading/" target="_blank" rel="noopener">张鑫旭博客-使用SVG寥寥数行实现圆环loading进度效果</a></li>
</ul>
]]></content>
      <categories>
        <category>svg</category>
      </categories>
  </entry>
  <entry>
    <title>CommonJS 中的 require/exports 和 ES6 中的 import/export 区别？</title>
    <url>/2017/04/10/javascript/commonjs-amd-cmd-es6/</url>
    <content><![CDATA[<h2 id="CommonJS"><a href="#CommonJS" class="headerlink" title="CommonJS"></a>CommonJS</h2><p>CommonJS 会同步加载模块，在一个模块加载完毕后才会加载接下来的代码，写法为</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> math = <span class="built_in">require</span>(<span class="string">'math'</span>);</span><br><span class="line">math.add(<span class="number">2</span>, <span class="number">3</span>);</span><br></pre></td></tr></table></figure>

<p>这对服务器端不是一个问题，因为所有的模块都存放在本地硬盘，可以同步加载完成，等待时间就是硬盘的读取时间。但是，对于浏览器，这却是一个大问题，因为模块都放在服务器端，等待时间取决于网速的快慢，可能要等很长时间，浏览器处于”假死”状态。</p>
<p>鉴于网络原因，CommonJS 为 Node 制定的规范并不完全适合前端应用场景，经过一段争执之后，AMD（require.js）规范最终在前端应用场景胜出，初次还有玉伯定义的 CMD 规范（sea.js）。</p>
<h2 id="AMD"><a href="#AMD" class="headerlink" title="AMD"></a>AMD</h2><p>AMD采用异步加载模块的方式，模块的加载不影响它后面语句的运行。所有依赖这个模块的语句，都定义在一个回调函数中，等到加载完成之后，这个回调函数才会运行。写法为:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// define([module], callback);</span></span><br><span class="line">define([<span class="string">'math'</span>], <span class="function"><span class="keyword">function</span> (<span class="params">math</span>) </span>&#123;</span><br><span class="line">    math.add(<span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>第一个参数[module]，是一个数组，里面的成员就是要加载的模块；第二个参数 callback，则是加载成功之后的回调函数</p>
<h2 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h2><p>CMD 是 SeaJS 在推广过程中对模块定义的规范化产出，CMD 和 AMD 都会事先把模块加载完，区别就在于模块是什么时候被执行的。</p>
<p>CMD 和 AMD 二者所需要的模块在加载(load)的时候，都是并行的，没有区别，而区别在于执行模块的时机：</p>
<ol>
<li>对于依赖的模块AMD是提前执行，CMD是延迟执行。不过 RequireJS 从 2.0 开始，也改成可以延迟执行（根据写法不同，处理方式不通过）。</li>
<li>CMD推崇依赖就近，AMD推崇依赖前置。</li>
</ol>
<p>上述例子的CMD写法变成这样。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">define(<span class="function"><span class="keyword">function</span> (<span class="params">requie, exports, module</span>) </span>&#123; </span><br><span class="line">     </span><br><span class="line">    <span class="comment">//依赖可以就近书写 </span></span><br><span class="line">    <span class="keyword">var</span> math = <span class="built_in">require</span>(<span class="string">'math'</span>); </span><br><span class="line">    math.add(<span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>虽然 AMD也支持CMD写法，但依赖前置是官方文档的默认模块定义写法。 </p>
<p>AMD 的 api 默认是一个当多个用，CMD 严格的区分推崇职责单一。例如：AMD里require分全局的和局部的。CMD里面没有全局的 require, 提供 seajs.use() 来实现模块系统的加载启动。CMD 里每个 API 都简单纯粹.</p>
<h2 id="es6模块"><a href="#es6模块" class="headerlink" title="es6模块"></a>es6模块</h2><p><img src="http://7xn4mw.com1.z0.glb.clouddn.com/public/16-11-21/33605054.jpg" alt=""></p>
<p>不过不能再浏览器里直接使用，而必须经过 webpack 等工具打包后编译成形如以下格式才能使用</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">modules</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//... webpack core</span></span><br><span class="line">&#125;)([</span><br><span class="line">    (<span class="function"><span class="keyword">function</span>(<span class="params">module, exports</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'This is main'</span>);</span><br><span class="line">    &#125;),</span><br><span class="line">    (<span class="function"><span class="keyword">function</span>(<span class="params">module, exports</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'This is package 1'</span>);</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="http://zccst.iteye.com/blog/2215317" target="_blank" rel="noopener">http://zccst.iteye.com/blog/2215317</a></p>
<p><a href="http://www.ruanyifeng.com/blog/2012/10/asynchronous_module_definition.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2012/10/asynchronous_module_definition.html</a></p>
<p><a href="http://my.oschina.net/felumanman/blog/263330?p=1" target="_blank" rel="noopener">http://my.oschina.net/felumanman/blog/263330?p=1</a></p>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
  </entry>
  <entry>
    <title>angular 1.x 脏值检测简析</title>
    <url>/2017/03/30/js-lib/angular-binding/</url>
    <content><![CDATA[<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>假如没有AngularJS，我们想要自己实现这么个功能，应该怎样？</p>
<p>希望点击按钮而下面三个counter都能被改动。html代码如下</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">ng-click</span>=<span class="string">"inc"</span>&gt;</span></span><br><span class="line">    increase 1</span><br><span class="line"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">ng-click</span>=<span class="string">"inc2"</span>&gt;</span></span><br><span class="line">    increase 2</span><br><span class="line"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"color:red"</span> <span class="attr">ng-bind</span>=<span class="string">"counter"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"color:blue"</span> <span class="attr">ng-bind</span>=<span class="string">"counter"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"color:green"</span> <span class="attr">ng-bind</span>=<span class="string">"counter"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>脏检测的机制没有这个阶段，它没有任何途径在数据变更之后立即得到通知，所以只能在每个事件入口中手动调用apply()，把数据的变更应用到界面上。在真正的Angular实现中，这里先进行脏检测，确定数据有变化了，然后才对界面设值。</p>
<p>所以，我们在有ng-click属性的DOM里去封装真正的click，最重要的作用是为了在之后追加一次apply()，把数据的变更应用到界面上去。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 数据模型区开始 */</span></span><br><span class="line"><span class="keyword">var</span> counter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">inc</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    counter++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">inc2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    counter+=<span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 数据模型区结束 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 绑定关系区开始 */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    bind();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bind</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> list = <span class="built_in">document</span>.querySelectorAll(<span class="string">"[ng-click]"</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;list.length; i++) &#123;</span><br><span class="line">        list[i].onclick = (<span class="function"><span class="keyword">function</span>(<span class="params">index</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="built_in">window</span>[list[index].getAttribute(<span class="string">"ng-click"</span>)]();</span><br><span class="line">                apply();</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;)(i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">apply</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> list = <span class="built_in">document</span>.querySelectorAll(<span class="string">"[ng-bind='counter']"</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;list.length; i++) &#123;</span><br><span class="line">        list[i].innerHTML = counter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 绑定关系区结束 */</span></span><br></pre></td></tr></table></figure>


<h2 id="angular核心数据变更响应函数"><a href="#angular核心数据变更响应函数" class="headerlink" title="angular核心数据变更响应函数"></a>angular核心数据变更响应函数</h2><p>对象比对函数和深度拷贝函数使用了lodash的函数库，附上lodash的cdn：<a href="http://apps.bdimg.com/libs/lodash/3.5.0/lodash.js。" target="_blank" rel="noopener">http://apps.bdimg.com/libs/lodash/3.5.0/lodash.js。</a></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Scope</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//在Angular框架中，双美元符前缀$$表示这个变量被当作私有的来考虑，不应当在外部代码中调用。</span></span><br><span class="line">    <span class="comment">//监控对象$watch</span></span><br><span class="line">    <span class="keyword">this</span>.$$watchers = [];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//监控方法</span></span><br><span class="line">Scope.prototype.$watch = <span class="function"><span class="keyword">function</span>(<span class="params">watchFn, listenerFn, valueEq</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">var</span> watcher = &#123;</span><br><span class="line">        <span class="comment">//监听对象，函数执行会返回一个对象做检测值。</span></span><br><span class="line">        watchFn: watchFn,</span><br><span class="line">        <span class="comment">//响应方法，当监听对象的值发生改变则会执行相应方法。</span></span><br><span class="line">        listenerFn: listenerFn || <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">        <span class="comment">//可选参数。true代表值的检查开启，脏检查的值如是对象或着数组则它辅助处理</span></span><br><span class="line">        valueEq: !!valueEq</span><br><span class="line">    &#125;;</span><br><span class="line">    self.$$watchers.push(watcher);</span><br><span class="line">    <span class="comment">//重复$watch一个watcher后将会销毁那个监听器。</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> index = self.$$watchers.indexOf(watcher);</span><br><span class="line">        <span class="keyword">if</span> (index &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            self.$$watchers.splice(index, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">Scope.prototype.$$areEqual = <span class="function"><span class="keyword">function</span>(<span class="params">newValue, oldValue, valueEq</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//如果传入的值是对象或者数组比对的话满足if</span></span><br><span class="line">    <span class="keyword">if</span> (valueEq) &#123;</span><br><span class="line">        <span class="keyword">return</span> _.isEqual(newValue, oldValue);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> newValue === oldValue || (<span class="built_in">Number</span>.isNaN(newValue) &amp;&amp; <span class="built_in">Number</span>.isNaN(oldValue));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">Scope.prototype.$$digestOnce = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">var</span> dirty = <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">//遍历所有的监听对象，如果监听的值有变化的话则执行listenerFn函数。并且返回true，代表数据脏需要持续再digest一次。</span></span><br><span class="line">    <span class="keyword">this</span>.$$watchers.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">watch, index</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> newValue = watch.watchFn(self);</span><br><span class="line">            <span class="keyword">var</span> oldValue = watch.last;</span><br><span class="line">            <span class="keyword">if</span> (!self.$$areEqual(newValue, oldValue, watch.valueEq)) &#123;</span><br><span class="line">                watch.listenerFn(newValue, oldValue, self);</span><br><span class="line">                dirty = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//对象或数组的话则深度拷贝。</span></span><br><span class="line">            watch.last = (watch.valueEq ? _.cloneDeep(newValue) : newValue);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="built_in">console</span>.error(e);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> dirty;</span><br><span class="line">&#125;;</span><br><span class="line">Scope.prototype.$digest = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//angular的digest运行需要控制在一个可接受的迭代数量内</span></span><br><span class="line">    <span class="keyword">var</span> ttl = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">var</span> dirty = <span class="keyword">this</span>.$$digestOnce();</span><br><span class="line">    <span class="comment">//循环到监控的值停止变更，从而稳定下来。</span></span><br><span class="line">    <span class="keyword">while</span> (dirty) &#123;</span><br><span class="line">        <span class="comment">//超过迭代数量限制，而作用域却还在变更，那就认为它永远也不会稳定，放手throw异常咯。</span></span><br><span class="line">        <span class="keyword">if</span> (dirty &amp;&amp; !(ttl--))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="string">"10 digest iterations reached"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        dirty = <span class="keyword">this</span>.$$digestOnce();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//$eval使用一个函数作参数，所做的事情是立即执行这个传入的函数，并且把作用域自身当作参数传递给它，返回的是这个函数的返回值</span></span><br><span class="line">Scope.prototype.$<span class="built_in">eval</span> = <span class="function"><span class="keyword">function</span>(<span class="params">expr, locals</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> expr &amp;&amp; expr(<span class="keyword">this</span>, locals);</span><br><span class="line">&#125;;</span><br><span class="line">Scope.prototype.$apply = <span class="function"><span class="keyword">function</span>(<span class="params">expr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.$<span class="built_in">eval</span>(expr);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.$digest();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> scope = <span class="keyword">new</span> Scope();</span><br><span class="line">scope.name = <span class="string">'chen'</span>;</span><br><span class="line">scope.counter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">scope.$watch(</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">scope</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> scope.name;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">newValue, oldValue, scope</span>) </span>&#123;</span><br><span class="line">        scope.counter++;</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">scope.$digest();</span><br><span class="line"><span class="built_in">console</span>.log(scope.counter === <span class="number">1</span>); <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line">scope.name = <span class="string">'chentt'</span>;</span><br><span class="line">scope.$digest();</span><br><span class="line"><span class="built_in">console</span>.log(scope.counter === <span class="number">2</span>); <span class="comment">//true</span></span><br></pre></td></tr></table></figure>

<h2 id="整合结果"><a href="#整合结果" class="headerlink" title="整合结果"></a>整合结果</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">ng-click</span>=<span class="string">"inc"</span>&gt;</span></span><br><span class="line">    increase 1</span><br><span class="line"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">ng-click</span>=<span class="string">"inc2"</span>&gt;</span></span><br><span class="line">    increase 2</span><br><span class="line"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"color:red"</span> <span class="attr">ng-bind</span>=<span class="string">"counter"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"color:blue"</span> <span class="attr">ng-bind</span>=<span class="string">"counter"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"color:green"</span> <span class="attr">ng-bind</span>=<span class="string">"counter"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://apps.bdimg.com/libs/lodash/3.5.0/lodash.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./scope.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 数据模型区开始 */</span></span><br><span class="line"><span class="keyword">var</span> scope = <span class="keyword">new</span> Scope();</span><br><span class="line">scope.counter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">inc</span>(<span class="params">scope</span>) </span>&#123;</span><br><span class="line">    scope.counter += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">inc2</span>(<span class="params">scope</span>) </span>&#123;</span><br><span class="line">    scope.counter += <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 数据模型区结束 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 绑定关系区开始 */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bind</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> list = <span class="built_in">document</span>.querySelectorAll(<span class="string">"[ng-click]"</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;list.length; i++) &#123;</span><br><span class="line">        list[i].onclick = (<span class="function"><span class="keyword">function</span>(<span class="params">index</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="built_in">window</span>[list[index].getAttribute(<span class="string">"ng-click"</span>)](scope);</span><br><span class="line">                scope.$apply();</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;)(i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">watch</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getBindNames</span> (<span class="params">arr</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> doms = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">document</span>.querySelectorAll(<span class="string">"[ng-bind]"</span>));</span><br><span class="line">        <span class="keyword">var</span> bindNames = doms.map(<span class="function"><span class="keyword">function</span> (<span class="params">dom</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> dom.getAttribute(<span class="string">'ng-bind'</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//去除重复项</span></span><br><span class="line">        <span class="keyword">var</span> <span class="keyword">set</span> = new Set(bindNames);</span><br><span class="line">        return Array.from(<span class="keyword">set</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    var binds = getBindNames();</span><br><span class="line"></span><br><span class="line">    binds.forEach(function (v, k) &#123;</span><br><span class="line">        scope.$watch(</span><br><span class="line">            <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> scope[v];</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="function"><span class="keyword">function</span>(<span class="params">newValue, oldValue, scope</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">var</span> list = <span class="built_in">document</span>.querySelectorAll(<span class="string">"[ng-bind='"</span> + v + <span class="string">"']"</span>);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;list.length; i++) &#123;</span><br><span class="line">                    list[i].innerHTML = scope[v];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        );</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    watch();</span><br><span class="line">    bind();</span><br><span class="line">    scope.$digest();    </span><br><span class="line">    </span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://github.com/xufei/blog/issues/10" target="_blank" rel="noopener">Angular沉思录（一）数据绑定</a></p>
<p><a href="https://github.com/xufei/Make-Your-Own-AngularJS/blob/master/01.md" target="_blank" rel="noopener">构建自己的AngularJS</a></p>
]]></content>
      <categories>
        <category>js-lib</category>
      </categories>
      <tags>
        <tag>angular</tag>
      </tags>
  </entry>
  <entry>
    <title>浏览器强缓存与协商缓存</title>
    <url>/2017/03/23/tcp-http/broswer-cache/</url>
    <content><![CDATA[<h2 id="基本认知"><a href="#基本认知" class="headerlink" title="基本认知"></a>基本认知</h2><p>浏览器缓存分为强缓存和协商缓存： </p>
<ol>
<li><p>浏览器在加载资源时，先根据这个资源的一些http header判断它是否命中强缓存，强缓存如果命中，浏览器直接从自己的缓存中读取资源，不会发请求到服务器，此请求返回的http状态为200，在chrome的开发者工具的network里面size会显示为from cache。</p>
</li>
<li><p>当强缓存没有命中的时候，浏览器一定会发送一个请求到服务器，通过服务器端依据资源的另外一些http header验证这个资源是否命中协商缓存，如果协商缓存命中，服务器会将这个请求返回，并且状态码为304，不会返回这个资源的数据，而是告诉客户端可以直接从缓存中加载这个资源，于是浏览器就又会从自己的缓存中去加载这个资源；</p>
</li>
<li><p>当协商缓存也没有命中的时候，浏览器直接从服务器加载资源数据。</p>
</li>
</ol>
<p>强缓存与协商缓存的共同点是：如果命中，都是从客户端缓存中加载资源，而不是从服务器加载资源数据；区别是：强缓存不发请求到服务器，协商缓存会发请求到服务器。</p>
<h2 id="强缓存原理"><a href="#强缓存原理" class="headerlink" title="强缓存原理"></a>强缓存原理</h2><p>强缓存是利用Expires或者Cache-Control这两个http response header实现的，它们都用来表示资源在客户端缓存的有效期。Expires是http1.0提出的一个表示资源过期时间的header，而Cache-Control则是http1.1提出的，如果同时存在则以Cache-Control为先。如下图</p>
<p><img src="http://img.souche.com/20170322/png/b2b1d73c5b37bf60d72594ea2ee044d3.png" alt=""></p>
<p><code>Expires:Sat, 01 Apr 2017 15:53:40 GMT</code>其实意味着在东八区2017/04/01 23:53:40的时候此资源过期。而<code>Cache-Control:max-age=864000</code>意味着从<code>Date:Wed, 22 Mar 2017 15:53:40 GMT</code>这个日期开始算往后10天则资源过期，这个时间在这里实际上就等同于Expires的时间。</p>
<p>Expires是较老的强缓存管理header，由于它是服务器返回的一个绝对时间，在服务器时间与客户端时间相差较大时，缓存管理容易出现问题，比如随意修改下客户端时间，就能影响缓存命中的结果。而Cache-Control是相对时间就不会有这种问题，两个请求头都加上也是为了兼容不支持http1.1的终端或者路由器。</p>
<h2 id="协商缓存原理"><a href="#协商缓存原理" class="headerlink" title="协商缓存原理"></a>协商缓存原理</h2><p>当浏览器对某个资源的请求没有命中强缓存，就会发一个请求到服务器，验证协商缓存是否命中，如果协商缓存命中，请求响应返回的http状态为304并且会显示一个Not Modified的字符串，并且让浏览器就又从自己的缓存中去加载这个资源。</p>
<p>协商缓存是利用的是【Last-Modified，If-Modified-Since】和【ETag、If-None-Match】这两对Header来管理的。</p>
<h3 id="Last-Modified，If-Modified-Since"><a href="#Last-Modified，If-Modified-Since" class="headerlink" title="Last-Modified，If-Modified-Since"></a>Last-Modified，If-Modified-Since</h3><p><img src="http://img.souche.com/20170323/png/93845cf76c9ae637c201da4318243ab8.png" alt=""></p>
<ol>
<li>浏览器第一次跟服务器请求一个资源，服务器在返回这个资源的同时，在respone的header加上Last-Modified的header，这个header表示这个资源在服务器上的最后修改时间</li>
<li>浏览器再次跟服务器请求这个资源时，在request的header上加上If-Modified-Since的header，这个header的值就是上一次请求时返回的Last-Modified的值</li>
<li>服务器再次收到资源请求时，根据浏览器传过来If-Modified-Since和资源在服务器上的最后修改时间判断资源是否有变化，如果没有变化则返回304 Not Modified，但是不会返回资源内容；如果有变化，就正常返回资源内容。当服务器返回304 Not Modified的响应时，response header中不会再添加Last-Modified的header，因为既然资源没有变化，那么Last-Modified也就不会改变</li>
</ol>
<p>如果协商缓存没有命中，浏览器直接从服务器加载资源时，Last-Modified Header在重新加载的时候会被更新，下次请求时，If-Modified-Since会启用上次返回的Last-Modified值。</p>
<p>有时候也会服务器上资源其实有变化，但是最后修改时间却没有变化的情况，就会影响协商缓存的可靠性。所以就有了另外一对header来管理协商缓存，这对header就是【ETag、If-None-Match】</p>
<h3 id="ETag和If-None-Match"><a href="#ETag和If-None-Match" class="headerlink" title="ETag和If-None-Match"></a>ETag和If-None-Match</h3><p><img src="http://img.souche.com/20170323/png/60a65ccb2dcc8ed1cf372405f811c987.png" alt=""></p>
<p>浏览器第一次跟服务器请求一个资源，会在respone的header加上ETag响应头，这是服务器根据当前请求的资源生成的一个唯一标识，只要资源有变化这个串就不同，只要资源有变化这个串就不同，跟最后修改时间没有关系，所以能很好的补充Last-Modified的问题</p>
<p>浏览器再次跟服务器请求这个资源时，在request的header上加上If-None-Match的header，这个header的值就是上一次请求时返回的ETag的值。</p>
<p>服务器再次收到资源请求时，根据浏览器传过来If-None-Match和然后再根据资源生成一个新的ETag，如果这两个值相同就说明资源没有变化，否则就是有变化；如果没有变化则返回304 Not Modified，但是不会返回资源内容；如果有变化，就正常返回资源内容。与Last-Modified不一样的是，当服务器返回304 Not Modified的响应时，由于ETag重新生成过，response header中还会把这个ETag返回，即使这个ETag跟之前的没有变化</p>
<h2 id="缓存管理"><a href="#缓存管理" class="headerlink" title="缓存管理"></a>缓存管理</h2><p>协商缓存需要配合强缓存使用，你看前面这个截图中，除了Last-Modified这个header，还有强缓存的相关header，因为如果不启用强缓存的话，协商缓存根本没有意义。</p>
<p>如果资源已经被浏览器缓存下来，在缓存失效之前，再次请求时，默认会先检查是否命中强缓存，如果强缓存命中则直接读取缓存，如果强缓存没有命中则发请求到服务器检查是否命中协商缓存，如果协商缓存命中，则告诉浏览器还是可以从缓存读取，否则才从服务器返回最新的资源。这是默认的处理方式，这个方式可能被浏览器的行为改变：</p>
<ul>
<li>当win上ctrl+f5、mac上command+shift+R来强制刷新网页时，直接从服务器加载，跳过强缓存和协商缓存；</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="http://www.cnblogs.com/lyzg/p/5125934.html" target="_blank" rel="noopener">流云诸葛的浏览器缓存知识小结及应用</a></p>
]]></content>
      <categories>
        <category>tcp-http</category>
      </categories>
  </entry>
  <entry>
    <title>DNS 科普文</title>
    <url>/2017/03/23/tcp-http/dns-introduce/</url>
    <content><![CDATA[<h2 id="DNS是什么"><a href="#DNS是什么" class="headerlink" title="DNS是什么"></a>DNS是什么</h2><p>DNS （Domain Name System 的缩写）的作用非常简单，就是根据域名查出IP地址。你可以把它想象成一本巨大的电话本。举例来说，如果你要访问域名 math.stackexchange.com，首先要通过 DNS 查出它的 IP 地址是 151.101.129.69。</p>
<h2 id="查询过程"><a href="#查询过程" class="headerlink" title="查询过程"></a>查询过程</h2><p>使用 dig 命令可以显示整个查询过程，加short可以直接得到ip地址</p>
<p>dig +short everlose.github.com</p>
<p>显示 185.199.110.153，就是 github 的地址。</p>
<h2 id="DNS-服务器"><a href="#DNS-服务器" class="headerlink" title="DNS 服务器"></a>DNS 服务器</h2><p>本机一定要知道 DNS 服务器的IP地址，通过DNS服务器才能知道某个域名的IP到底是什么，才能上网。</p>
<p>DNS 服务器的 IP 地址，有可能是动态的，每次上网时由网关分配，这叫做 DHCP 机制；也有可能是事先指定的固定地址。Linux 系统里面，DNS 服务器的IP地址保存在 /etc/resolv.conf 文件。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ cat /etc/resolv.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># Generated by NetworkManager</span></span><br><span class="line">search localdomain</span><br><span class="line">nameserver 8.8.8.8</span><br><span class="line">nameserver 74.82.42.42</span><br><span class="line">nameserver 8.8.4.4</span><br></pre></td></tr></table></figure>

<p>打开 MAC 下的网络偏好设置里某个网络的高级选项中的 DNS 服务器选项就能看见自己设置的 DNS 服务器，DNS 服务器里最有名的就是 Google 的 8.8.8.8 和 Level 3 的 4.2.2.2。</p>
<h2 id="域名的层级"><a href="#域名的层级" class="headerlink" title="域名的层级"></a>域名的层级</h2><p><a href="http://www.github.com.root" target="_blank" rel="noopener">www.github.com.root</a></p>
<p>主机名.次级域名.顶级域名.根域名</p>
<p>所有域名的尾部都有一个根域名，根域名对于所有域名都是一样的，所以平时都是省略的，也就是说 <a href="http://www.github.com" target="_blank" rel="noopener">www.github.com</a> 真正的域名就是<a href="http://www.github.com.root。" target="_blank" rel="noopener">www.github.com.root。</a></p>
<h2 id="DNS-的记录类型"><a href="#DNS-的记录类型" class="headerlink" title="DNS 的记录类型"></a>DNS 的记录类型</h2><p>域名与 IP 之间的对应关系，称为 “记录”（record）。根据使用场景，”记录”可以分成不同的类型（type），前面已经看到了有 A 记录和 NS 记录。常见的 DNS 记录类型如下。</p>
<ul>
<li>A：地址记录（Address），返回域名指向的IP地址。</li>
<li>NS：域名服务器记录（Name Server），返回保存下一级域名信息的服务器地址。该记录只能设置为域名，不能设置为IP地址。</li>
<li>MX：邮件记录（Mail eXchange），返回接收电子邮件的服务器地址。</li>
<li>CNAME：规范名称记录（Canonical Name），返回另一个域名，即当前查询的域名是另一个域名的跳转，详见下文。</li>
<li>PTR：逆向查询记录（Pointer Record），只用于从IP地址查询域名，详见下文。</li>
</ul>
<p>一般来说，为了服务的安全可靠，至少应该有两条 NS 记录，而A记录和MX记录也可以有多条，这样就提供了服务的冗余性，防止出现单点失败。</p>
<p>CNAME everlose.github.io 这个域名就是一个CNAME记录。</p>
<p>PTR 记录用于从 IP 地址反查域名。dig 命令的 -x 参数用于查询 PTR 记录 <code>dig -x 192.30.252.153</code>。能知道此 ip 的服务器域名是pages.github.com</p>
<h2 id="其它dns工具"><a href="#其它dns工具" class="headerlink" title="其它dns工具"></a>其它dns工具</h2><ul>
<li>host  此命令可以看作dig命令的简化版，返回当前请求域名的各种记录。运行命令<code>host github.com</code>可以得到ip地址，也可以运行<code>host 192.30.252.153</code>得到域名</li>
<li>nslookup 此命令用于互动式查询域名记录</li>
<li>whois 此命令用来查看域名注册情况：<code>whois github.com</code></li>
</ul>
<p>原文地址：<a href="http://www.ruanyifeng.com/blog/2016/06/dns.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2016/06/dns.html</a></p>
]]></content>
      <categories>
        <category>tcp-http</category>
      </categories>
  </entry>
  <entry>
    <title>CSS flex布局实践</title>
    <url>/2017/03/16/css/flex-practice/</url>
    <content><![CDATA[<h2 id="Basic"><a href="#Basic" class="headerlink" title="Basic"></a>Basic</h2><h3 id="flex"><a href="#flex" class="headerlink" title="flex"></a>flex</h3><p>flex的默认值为0 1 auto，后两个属性可选，最常用的就是flex-grow。</p>
<p>flex-grow在分配了剩余空间的分配比例，为0代表不分配。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flex: &lt;&apos;flex-grow&apos;&gt; &lt;&apos;flex-shrink&apos;&gt;? || &lt;&apos;flex-basis&apos;&gt;</span><br><span class="line"></span><br><span class="line">flex: 1 means flex: 1 1 0</span><br><span class="line">flex: 2 means flex: 2 1 0</span><br><span class="line">flex: auto means flex: 1 1 auto</span><br><span class="line">flex: none means flex: 0 0 auto</span><br></pre></td></tr></table></figure>

<h3 id="flex-direction"><a href="#flex-direction" class="headerlink" title="flex-direction"></a>flex-direction</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flex-direction: row | column | row-reverse | column-reverse;</span><br><span class="line"></span><br><span class="line">row（web默认值）：主轴为水平方向，从左到右。</span><br><span class="line">column（RN默认）：主轴为垂直方向，从上到下。</span><br><span class="line">row-reverse：主轴为水平方向，从右到左。</span><br><span class="line">column：主轴为垂直方向，从下到上。</span><br></pre></td></tr></table></figure>

<h3 id="justify-content"><a href="#justify-content" class="headerlink" title="justify-content"></a>justify-content</h3><p>属性定义了项目在主轴上的对齐方式</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flex-start（默认值）：左对齐</span><br><span class="line">flex-end：右对齐</span><br><span class="line">center： 居中</span><br><span class="line">space-between：两端对齐，项目之间的间隔都相等。</span><br><span class="line">space-around：每个项目两侧的间隔相等。。</span><br></pre></td></tr></table></figure>

<h3 id="align-items"><a href="#align-items" class="headerlink" title="align-items"></a>align-items</h3><p>属性定义了项目在侧轴上的对齐方式</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flex-start（web默认值）：侧轴的起点对齐。</span><br><span class="line">flex-end：侧轴的终点对齐。</span><br><span class="line">center：侧轴的中点对齐。</span><br><span class="line">baseline: 项目的第一行文字的基线对齐。</span><br><span class="line">stretch（RN默认值）：如果项目未设置高度或设为auto，将占满整个容器的高度。</span><br></pre></td></tr></table></figure>

<h2 id="常用布局"><a href="#常用布局" class="headerlink" title="常用布局"></a>常用布局</h2><h3 id="两列布局其一"><a href="#两列布局其一" class="headerlink" title="两列布局其一"></a>两列布局其一</h3><p>一列固定，另一列适配父容器宽。</p>
<p><img src="http://img.souche.com/20180412/png/d8091b47c38f70e0a282dc45ab9f3acf.png" alt=""></p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.wrap</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.left</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">120px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.right</span> &#123;</span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrap"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"left"</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"right"</span>&gt;</span>子云<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="两列布局其二"><a href="#两列布局其二" class="headerlink" title="两列布局其二"></a>两列布局其二</h3><p>两列往两边靠的布局，不固定宽</p>
<p><img src="http://img.souche.com/20180412/png/2701b27c8d84fc22fd5f7766fd915f89.png" alt=""></p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.wrap</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrap"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>子云<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="三列布局"><a href="#三列布局" class="headerlink" title="三列布局"></a>三列布局</h3><p>两列固定尺寸而中间列适应父容器的布局</p>
<p><img src="http://img.souche.com/20180412/png/0413217adb3ff1348578dd16d80d187e.png" alt=""></p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.wrap</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.left</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">30px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.center</span> &#123;</span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.right</span>  &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">40px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrap"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"left"</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"center"</span>&gt;</span>请输入..<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"right"</span>&gt;</span>元<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="一行多列均等分"><a href="#一行多列均等分" class="headerlink" title="一行多列均等分"></a>一行多列均等分</h3><p>一行不固定列数，并且要求都能均等分分布的布局</p>
<p><img src="http://img.souche.com/20180412/png/4ed40539211fe23b585c90f61b7ed078.png" alt=""></p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.wrap</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="selector-class">.inner</span> &#123;</span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrap"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"inner"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"inner"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"inner"</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"inner"</span>&gt;</span>4<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"inner"</span>&gt;</span>5<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="固定操作栏"><a href="#固定操作栏" class="headerlink" title="固定操作栏"></a>固定操作栏</h3><p>顶部和底部的操作栏固定不跟随内容滚动</p>
<p><img src="http://img.souche.com/20180412/png/2d7a8e5088d1578579de30be77d82308.png" alt=""></p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.wrap</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">flex-direction</span>: column;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.hd</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#F2F2F2</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.bd</span> &#123;</span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.inner</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">3000px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.blue</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#0000FF</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrap"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"hd"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"bd"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"inner"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"ft"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="水平垂直居中"><a href="#水平垂直居中" class="headerlink" title="水平垂直居中"></a>水平垂直居中</h3><p>弹窗布局就是一个常见的元素水平垂直居中的场景</p>
<p><img src="http://img.souche.com/20180412/png/16f6be69031312e103cb4bad5cf8ce89.png" alt=""></p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.wrap</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#999</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.inner</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">250px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">350px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#FFF</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrap"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"inner"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="流式布局"><a href="#流式布局" class="headerlink" title="流式布局"></a>流式布局</h3><p>不定行的布局，要求每个元素固定大小，常见于选择</p>
<p><img src="http://img.souche.com/20180412/png/333f712ce9ad6b6a14d585648e0c5fb2.png" alt=""></p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.wrap</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">flex-wrap</span>: wrap;</span><br><span class="line">    <span class="attribute">flex-direction</span>: start;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.inner</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>css</category>
      </categories>
      <tags>
        <tag>css 3</tag>
      </tags>
  </entry>
  <entry>
    <title>自适应等比例多列布局</title>
    <url>/2017/02/22/css/eqaul-column/</url>
    <content><![CDATA[<h2 id="布局基础html代码"><a href="#布局基础html代码" class="headerlink" title="布局基础html代码"></a>布局基础html代码</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-class">.c-red</span> &#123;</span></span><br><span class="line">        background-color: red;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="css">    <span class="selector-class">.c-blue</span> &#123;</span></span><br><span class="line">        background-color: blue;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="css">    <span class="selector-class">.c-gray</span> &#123;</span></span><br><span class="line">        background-color: gray;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="css">    <span class="selector-class">.c-orange</span> &#123;</span></span><br><span class="line">        background-color: orange</span><br><span class="line">    &#125;</span><br><span class="line"><span class="css">    <span class="selector-class">.c-green</span> &#123;</span></span><br><span class="line">        background-color: green</span><br><span class="line">    &#125;</span><br><span class="line"><span class="css">    <span class="selector-class">.container</span> &#123;</span></span><br><span class="line">        width: 1000px;</span><br><span class="line">        height: 250px;</span><br><span class="line">        margin: 50px auto;</span><br><span class="line">        border: 5px solid black;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="css">    <span class="selector-class">.item</span> &#123;</span></span><br><span class="line">        height: 250px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item c-red"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item c-blue"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item c-gray"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item c-orange"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item c-green"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="一、浮动布局-百分比"><a href="#一、浮动布局-百分比" class="headerlink" title="一、浮动布局+百分比"></a>一、浮动布局+百分比</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.row</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>:<span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">overflow</span>:hidden;</span><br><span class="line">    <span class="attribute">zoom</span>:<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line">    <span class="attribute">float</span>: left;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">20%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该样式兼容性较好，但是无法实现当里面的列增多时比例也随着变化，必须手动修改，当然你也可以使用一个JS来调整了。</p>
<h2 id="二、行内元素（inline-block）-百分比"><a href="#二、行内元素（inline-block）-百分比" class="headerlink" title="二、行内元素（inline-block）+百分比"></a>二、行内元素（inline-block）+百分比</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.row</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>:<span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">0</span>; <span class="comment">/*行内元素间有字符，诸如回车符等会被浏览器解析成一个空格*/</span></span><br><span class="line">    *word-spacing: -1px;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    *display: inline;</span><br><span class="line">    *<span class="selector-tag">zoom</span>: 1;</span><br><span class="line">    <span class="selector-tag">vertical-align</span>: <span class="selector-tag">top</span>;</span><br><span class="line">    <span class="selector-tag">word-spacing</span>: <span class="selector-tag">normal</span>;</span><br><span class="line">    <span class="selector-tag">letter-spacing</span>: <span class="selector-tag">normal</span>;</span><br><span class="line">    <span class="selector-tag">width</span>: 20%;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="三、display-table-display-table-cell"><a href="#三、display-table-display-table-cell" class="headerlink" title="三、display:table + display:table-cell"></a>三、display:table + display:table-cell</h2><p>我们知道表格可以根据内容进行划分，CSS也有一个样式是display:table来实现类似表格的布局，不过不支持IE8以下浏览器。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.row</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">display</span>: table;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: table-cell;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="四、使用css3-display-flex"><a href="#四、使用css3-display-flex" class="headerlink" title="四、使用css3 display:flex"></a>四、使用css3 display:flex</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.row</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">display</span>: box; <span class="comment">/* OLD 2009版 - Android 4.4- */</span></span><br><span class="line">    <span class="attribute">display</span>: -webkit-box; <span class="comment">/* OLD - iOS 6-, Safari 3.1-6 */</span></span><br><span class="line">    <span class="attribute">display</span>: -webkit-flex; <span class="comment">/* NEW - Chrome */</span></span><br><span class="line">    <span class="attribute">display</span>: flex; <span class="comment">/* NEW, Spec - chrome21+ Opera 12.1, Firefox 20+ */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line">    <span class="attribute">-webkit-box-flex</span>: <span class="number">1</span>;    <span class="comment">/* OLD - iOS 6-, Safari 3.1-6 */</span></span><br><span class="line">    <span class="attribute">-webkit-flex</span>: <span class="number">1</span>;        <span class="comment">/* Chrome */</span></span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该方法只适用于高级浏览器，哪怕是移动端兼容性也不好，IE10以下的还是算了。具体介绍看另一篇文章。</p>
<h2 id="五、使用栅格化系统"><a href="#五、使用栅格化系统" class="headerlink" title="五、使用栅格化系统"></a>五、使用栅格化系统</h2><p>例如Bootstrap的栅格化系统</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">.col-md-3 &#123; float:left; &#125;</span><br><span class="line">@media (min-width: 992px) &#123;</span><br><span class="line">    .col-md-3 &#123; width: 25%; &#125;</span><br><span class="line">    /* 父级容器的3/12 */</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-3"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>缺点和第一个的float一样，需要根据列数来跳出宽度调整。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>如果需要兼容IE6-IE7的，如果列数固定可以使用第一种（浮动布局＋百分比）和第二种（行内元素＋百分比）。如果列数不固定，可以加少量js支持。</p>
<p>如果需要兼容IE8-IE9的，那么考虑第三种（table-ceil），它的兼容性比下面的flex支持的比较好。</p>
<p>如果是只考虑移动的，不考虑低版本浏览器的，那么考虑使用第四种（flex）最为便捷。</p>
]]></content>
      <categories>
        <category>css</category>
      </categories>
      <tags>
        <tag>css 2</tag>
      </tags>
  </entry>
  <entry>
    <title>css文本截断方法</title>
    <url>/2017/02/21/css/css-text-ellipsis/</url>
    <content><![CDATA[<h2 id="单行截断"><a href="#单行截断" class="headerlink" title="单行截断"></a>单行截断</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.ellipsis</span> &#123;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">    <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中<code>overflow: hidden;</code>使元素溢出文本截断，<code>text-overflow: ellipsis</code>使对象向内文本溢出时显示省略标记，而<code>white-space: nowrap</code>使元素内的文本强制不换行。</p>
<p>此方法兼容到ie6过。</p>
<h2 id="多行截断"><a href="#多行截断" class="headerlink" title="多行截断"></a>多行截断</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.ellipsis</span> &#123;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">    <span class="attribute">display</span>: -webkit-box;</span><br><span class="line">    <span class="attribute">-webkit-line-clamp</span>: <span class="number">2</span>;</span><br><span class="line">    <span class="attribute">-webkit-box-orient</span>: vertical;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中<code>-webkit-line-clamp: 2</code>规定超过两行的部分截断</p>
<p>此方法webkit私有，并且使用flex布局，兼容成问题。</p>
]]></content>
      <categories>
        <category>css</category>
      </categories>
      <tags>
        <tag>css 2</tag>
      </tags>
  </entry>
  <entry>
    <title>绕过百度网盘限速设置</title>
    <url>/2017/02/21/chrome-extension/fk-baidu-pan-limit/</url>
    <content><![CDATA[<h2 id="BaiduExporter-插件下载"><a href="#BaiduExporter-插件下载" class="headerlink" title="BaiduExporter 插件下载"></a>BaiduExporter 插件下载</h2><p>网盘助手：<a href="https://github.com/acgotaku/BaiduExporter" target="_blank" rel="noopener">https://github.com/acgotaku/BaiduExporter</a></p>
<h2 id="aria2-多线程下载工具"><a href="#aria2-多线程下载工具" class="headerlink" title="aria2 多线程下载工具"></a>aria2 多线程下载工具</h2><h3 id="aria2下载链接"><a href="#aria2下载链接" class="headerlink" title="aria2下载链接"></a>aria2下载链接</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 手动进入官网下载并安装</span></span><br><span class="line">https://github.com/aria2/aria2/releases/tag/release-1.27.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">brew install aria2</span><br></pre></td></tr></table></figure>

<h3 id="aria2配置"><a href="#aria2配置" class="headerlink" title="aria2配置"></a>aria2配置</h3><p>在用户目录建一个文件夹，并存放配置文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/</span><br><span class="line">mkdir .aria2</span><br><span class="line"><span class="built_in">cd</span> .aria2</span><br><span class="line">vim aria2.conf</span><br></pre></td></tr></table></figure>

<p>上面一步新建了一个 aria2.conf 配置文件后，拷贝以下的配置，修改其 download 为你下载路径</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#用户名</span></span><br><span class="line"><span class="comment">#rpc-user=user</span></span><br><span class="line"><span class="comment">#密码</span></span><br><span class="line"><span class="comment">#rpc-passwd=passwd</span></span><br><span class="line"><span class="comment">#设置加密的密钥</span></span><br><span class="line"><span class="comment">#rpc-secret=secret</span></span><br><span class="line"><span class="comment">#允许rpc</span></span><br><span class="line"><span class="built_in">enable</span>-rpc=<span class="literal">true</span></span><br><span class="line"><span class="comment">#允许所有来源, web界面跨域权限需要</span></span><br><span class="line">rpc-allow-origin-all=<span class="literal">true</span></span><br><span class="line"><span class="comment">#是否启用https加密，启用之后要设置公钥,私钥的文件路径</span></span><br><span class="line"><span class="comment">#rpc-secure=true</span></span><br><span class="line"><span class="comment">#启用加密设置公钥</span></span><br><span class="line"><span class="comment">#rpc-certificate=/home/name/.config/aria2/example.crt</span></span><br><span class="line"><span class="comment">#启用加密设置私钥</span></span><br><span class="line"><span class="comment">#rpc-private-key=/home/name/.config/aria2/example.key</span></span><br><span class="line"><span class="comment">#允许外部访问，false的话只监听本地端口</span></span><br><span class="line">rpc-listen-all=<span class="literal">true</span></span><br><span class="line"><span class="comment">#RPC端口, 仅当默认端口被占用时修改</span></span><br><span class="line"><span class="comment">#rpc-listen-port=6800</span></span><br><span class="line"><span class="comment">#最大同时下载数(任务数), 路由建议值: 3</span></span><br><span class="line">max-concurrent-downloads=5</span><br><span class="line"><span class="comment">#断点续传</span></span><br><span class="line"><span class="built_in">continue</span>=<span class="literal">true</span></span><br><span class="line"><span class="comment">#同服务器连接数</span></span><br><span class="line">max-connection-per-server=5</span><br><span class="line"><span class="comment">#最小文件分片大小, 下载线程数上限取决于能分出多少片, 对于小文件重要</span></span><br><span class="line">min-split-size=10M</span><br><span class="line"><span class="comment">#单文件最大线程数, 路由建议值: 5</span></span><br><span class="line">split=10</span><br><span class="line"><span class="comment">#下载速度限制</span></span><br><span class="line">max-overall-download-limit=0</span><br><span class="line"><span class="comment">#单文件速度限制</span></span><br><span class="line">max-download-limit=0</span><br><span class="line"><span class="comment">#上传速度限制</span></span><br><span class="line">max-overall-upload-limit=0</span><br><span class="line"><span class="comment">#单文件速度限制</span></span><br><span class="line">max-upload-limit=0</span><br><span class="line"><span class="comment">#断开速度过慢的连接</span></span><br><span class="line"><span class="comment">#lowest-speed-limit=0</span></span><br><span class="line"><span class="comment">#验证用，需要1.16.1之后的release版本</span></span><br><span class="line"><span class="comment">#referer=*</span></span><br><span class="line"><span class="comment">#文件保存路径, 默认为当前启动位置</span></span><br><span class="line">dir=//Users/everlose/Downloads/</span><br><span class="line"><span class="comment">#文件缓存, 使用内置的文件缓存, 如果你不相信Linux内核文件缓存和磁盘内置缓存时使用, 需要1.16及以上版本</span></span><br><span class="line"><span class="comment">#disk-cache=0</span></span><br><span class="line"><span class="comment">#另一种Linux文件缓存方式, 使用前确保您使用的内核支持此选项, 需要1.15及以上版本(?)</span></span><br><span class="line"><span class="comment">#enable-mmap=true</span></span><br><span class="line"><span class="comment">#文件预分配, 能有效降低文件碎片, 提高磁盘性能. 缺点是预分配时间较长</span></span><br><span class="line"><span class="comment">#所需时间 none &lt; falloc ? trunc &lt;&lt; prealloc, falloc和trunc需要文件系统和内核支持</span></span><br><span class="line">file-allocation=prealloc</span><br><span class="line"><span class="comment">#不进行证书校验</span></span><br><span class="line">check-certificate=<span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p>最后每次启动时需要手动输入，路径地址自己替换</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">aria2c --conf-path=<span class="string">"/Users/everlose/.aria2/aria2.conf"</span> -D</span><br></pre></td></tr></table></figure>

<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>在百度云盘上导出下载-&gt;ARIA2 RPC，再访问<a href="http://aria2c.com/，可以看得到下载中的内容" target="_blank" rel="noopener">http://aria2c.com/，可以看得到下载中的内容</a></p>
<h2 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h2><ul>
<li><a href="https://github.com/acgotaku/BaiduExporter" target="_blank" rel="noopener">https://github.com/acgotaku/BaiduExporter</a></li>
<li><a href="http://blog.binux.me/2012/12/aria2-examples/" target="_blank" rel="noopener">http://blog.binux.me/2012/12/aria2-examples/</a></li>
<li><a href="https://github.com/aria2/aria2/releases/tag/release-1.27.1" target="_blank" rel="noopener">https://github.com/aria2/aria2/releases/tag/release-1.27.1</a></li>
</ul>
]]></content>
      <categories>
        <category>chrome-extension</category>
      </categories>
      <tags>
        <tag>chrome-extension</tag>
      </tags>
  </entry>
  <entry>
    <title>f**k 百度广告</title>
    <url>/2017/02/20/chrome-extension/fk-baidu-ads/</url>
    <content><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>废话不多说，直接上源码，采用注入css的方式来隐藏搜索结果的广告项，<a href="https://github.com/everlose/chrome-extensions/tree/master/baiduAdRemove" target="_blank" rel="noopener">github 源码</a></p>
<h2 id="基础构建"><a href="#基础构建" class="headerlink" title="基础构建"></a>基础构建</h2><p>一个基础的chrome插件构成目录。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">|____css</span><br><span class="line">| |____baidu.css  放置过滤规则</span><br><span class="line">|____js</span><br><span class="line">| |____background.js  常驻后台的js</span><br><span class="line">|____manifest.json  插件配置</span><br><span class="line">|____pic  插件的图标目录，放置适配三种尺寸</span><br><span class="line">| |____icon_128.png</span><br><span class="line">| |____icon_16.png</span><br><span class="line">| |____icon_48.png</span><br><span class="line">|____README.md</span><br></pre></td></tr></table></figure>

<h2 id="注入脚本"><a href="#注入脚本" class="headerlink" title="注入脚本"></a>注入脚本</h2><p>在background.js里加入以下就可以插入注入css</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">chrome.tabs.onUpdated.addListener(<span class="function"><span class="keyword">function</span> (<span class="params">tabId, changeInfo, tab</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(tab.url != <span class="literal">undefined</span> &amp;&amp; changeInfo.status == <span class="string">'complete'</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (tab.url.match(<span class="string">'baidu.com'</span>)) &#123;</span><br><span class="line">            chrome.tabs.insertCSS(tabId, &#123;<span class="attr">file</span>: <span class="string">'/css/baidu.css'</span>&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="编写css"><a href="#编写css" class="headerlink" title="编写css"></a>编写css</h2><p>笔者目前随手一搜“男科”两字（各位看官不要误会了，笔者很正常哟），前一屏全都是广告，打开控制台一瞧，发现广告的结果项的外容器元素，写了display:block!important</p>
<p><img src="http://7xn4mw.com1.z0.glb.clouddn.com/17-2-20/58883943-file_1487558992842_172ec.png" alt=""></p>
<p>嘿嘿嘿，虽然广告外容器的class名一直再变，id也是一直再变，但是有了style这种属性，就可以利用css属性选择器选中，所以css的规则代码可以写成</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#content_left</span> &gt; <span class="selector-tag">div</span><span class="selector-attr">[style^="display"]</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">0px</span> <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0px</span> <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0px</span> <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#ffffff</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接着百度的搜索结果右边出现的牛头不对马嘴的东西也实在惹人厌，于是再加一条规则去了</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.result-op</span><span class="selector-class">.c-container</span><span class="selector-class">.xpath-log</span>&#123;</span><br><span class="line">    <span class="attribute">height</span>: auto <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#000000</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后一看效果，男科广告果然没了</p>
<p><img src="http://7xn4mw.com1.z0.glb.clouddn.com/17-2-20/44689618-file_1487561140405_aa6d.png" alt=""></p>
<p>然而你们以为这样就结束了么，笔者一艘租房，哟呵，广告居然又出现了</p>
<p><img src="http://7xn4mw.com1.z0.glb.clouddn.com/17-2-20/69497773-file_1487561337138_1f60.png" alt=""></p>
<p>可以看得到第一条的广告并没有强制样式display:block!important的，css有个限制不能通过子元素如何再选到它的祖先元素操作，因为这样会让渲染效率变得极低。所以我们没发选中子元素有广告标记的元素对它祖先进行操作，那么该如何破？</p>
<p>仔细观察看到似乎广告都有id为1并且srcid为1599的属性，虽然笔者并不清楚代表了什么，不过倒是可以试试选它，那么最终的css规则就是这样的</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#content_left</span> &gt; <span class="selector-tag">div</span><span class="selector-attr">[style^="display"]</span>,</span><br><span class="line"><span class="selector-class">.result-op</span><span class="selector-class">.xpath-log</span>,</span><br><span class="line"><span class="selector-attr">[id="1"]</span><span class="selector-attr">[srcid="1599"]</span>&#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">0px</span> <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0px</span> <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0px</span> <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#ffffff</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.result-op</span><span class="selector-class">.c-container</span><span class="selector-class">.xpath-log</span>&#123;</span><br><span class="line">    <span class="attribute">height</span>: auto <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#000000</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这么做的确看不见广告了，但其实会误伤一些标记为官网的链接，只要搜索的文本再详细一点就好了，本着对广告宁杀错勿放过的原则，还是可以接受的。</p>
]]></content>
      <categories>
        <category>chrome-extension</category>
      </categories>
      <tags>
        <tag>chrome-extension</tag>
      </tags>
  </entry>
  <entry>
    <title>查看 chrome 插件的源码</title>
    <url>/2017/01/14/chrome-extension/extension-position/</url>
    <content><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>想查看chrome插件的源码，就需要找到chrome插件安装的位置，接着再文件夹下查找此插件的id。</p>
<h3 id="windows7"><a href="#windows7" class="headerlink" title="windows7"></a>windows7</h3><p>C:\Users\Administrator\AppData\Local\Google\Chrome\User Data\Default\Extensions</p>
<h3 id="mac"><a href="#mac" class="headerlink" title="mac"></a>mac</h3><p>/Users/everlose/Library/Application Support/Google/Chrome/Default/Extensions</p>
<p>其中everlose是我设置的用户名</p>
]]></content>
      <categories>
        <category>chrome-extension</category>
      </categories>
      <tags>
        <tag>chrome-extension</tag>
      </tags>
  </entry>
  <entry>
    <title>chrome 插件简单示例</title>
    <url>/2017/01/14/chrome-extension/simple-demo/</url>
    <content><![CDATA[<h2 id="omnibox"><a href="#omnibox" class="headerlink" title="omnibox"></a><a href="https://github.com/everlose/chrome_extensions_and_apps_programming/tree/master/usd_price" target="_blank" rel="noopener">omnibox</a></h2><p>omnibox 应用程序界面允许向Google Chrome的地址栏注册一个关键字，地址栏也叫omnibox。当用户输入你的扩展关键字，用户开始与你的扩展交互。每个击键都会发送给你的扩展，扩展提供建议作为相应的响应。</p>
<p>制作一款实时查询美元价格的扩展。首先通过异步请求获取Yahoo上美元的价格。获取到数据后我们就要开始编写提供建议的函数了</p>
<p><img src="http://7xn4mw.com1.z0.glb.clouddn.com/17-1-9/12307513-file_1483927705034_d2ca.png" alt=""></p>
<h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a><a href="https://github.com/sneezry/chrome_extensions_and_apps_programming/tree/master/save_all_images" target="_blank" rel="noopener">下载</a></h2><p>编写一个下载当前页面所有图片的扩展</p>
<h2 id="other"><a href="#other" class="headerlink" title="other"></a>other</h2><p><a href="https://github.com/everlose/chrome-extensions" target="_blank" rel="noopener">https://github.com/everlose/chrome-extensions</a></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="http://www.ituring.com.cn/minibook/950" target="_blank" rel="noopener">chrome扩展及应用开发</a></li>
<li><a href="http://open.chrome.360.cn/extension_dev/overview.html" target="_blank" rel="noopener">360极速浏览器应用开放平台</a></li>
</ul>
]]></content>
      <categories>
        <category>chrome-extension</category>
      </categories>
      <tags>
        <tag>chrome-extension</tag>
      </tags>
  </entry>
  <entry>
    <title>JS 版快排</title>
    <url>/2016/12/24/alorigam/quicksort/</url>
    <content><![CDATA[<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//（1）在数据集之中，选择一个元素作为"基准"（pivot）。</span></span><br><span class="line"><span class="comment">//（2）所有小于"基准"的元素，都移到"基准"的左边；所有大于"基准"的元素，都移到"基准"的右边。</span></span><br><span class="line"><span class="comment">//（3）对"基准"左边和右边的两个子集，不断重复第一步和第二步，直到所有子集只剩下一个元素为止。</span></span><br><span class="line"><span class="comment">// (4) 最后返回左边子集，基准，右边子集的结合数组。</span></span><br><span class="line"><span class="keyword">var</span> qsort = [<span class="number">85</span>, <span class="number">24</span>, <span class="number">63</span>, <span class="number">45</span>, <span class="number">17</span>, <span class="number">31</span>, <span class="number">96</span>, <span class="number">50</span>];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">quicksort</span> (<span class="params">arr</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 如果子集只剩下一个元素，或者没有元素，就直接返回该数组</span></span><br><span class="line">    <span class="keyword">if</span> (arr.length &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> arr;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 设置比较基准</span></span><br><span class="line">    <span class="keyword">var</span> pivotIndex = <span class="built_in">Math</span>.floor(arr.length/<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">var</span> pivot = arr.splice(pivotIndex, <span class="number">1</span>)[<span class="number">0</span>];</span><br><span class="line">    <span class="comment">// 定义左子集和右子集</span></span><br><span class="line">    <span class="keyword">var</span> left = [];</span><br><span class="line">    <span class="keyword">var</span> right = [];</span><br><span class="line">    <span class="comment">// 遍历，小于基准的元素移到基准的左边，大于基准的元素移到基准的右边</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, j = arr.length; i &lt; j; i++) &#123;</span><br><span class="line">        arr[i] &lt; pivot ? left.push(arr[i]) : right.push(arr[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 最后返回左边子集，基准，右边子集的结合数组</span></span><br><span class="line">    <span class="keyword">return</span> quicksort(left).concat([pivot], quicksort(right));</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'sort order = '</span> + quicksort(qsort));</span><br></pre></td></tr></table></figure>

<p>参考自阮一峰的<a href="http://www.ruanyifeng.com/blog/2011/04/quicksort_in_javascript.html" target="_blank" rel="noopener">快速排序（Quicksort）的Javascript实现</a></p>
]]></content>
      <categories>
        <category>alorigam</category>
      </categories>
  </entry>
  <entry>
    <title>mongodb 安装与启动</title>
    <url>/2016/12/24/database/mongodb-install/</url>
    <content><![CDATA[<h2 id="安装如下。"><a href="#安装如下。" class="headerlink" title="安装如下。"></a>安装如下。</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">brew install mongodb</span><br></pre></td></tr></table></figure>

<p>出现如下图则成功安装</p>
<p><img src="http://7xn4mw.com1.z0.glb.clouddn.com/15-11-16/17388715.jpg" alt=""> </p>
<h2 id="启动数据库输入命令"><a href="#启动数据库输入命令" class="headerlink" title="启动数据库输入命令"></a>启动数据库输入命令</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo mongod -config /usr/local/etc/mongod.conf</span><br><span class="line"></span><br><span class="line">#或者</span><br><span class="line">sudo mongod -f /usr/local/etc/mongod.conf</span><br></pre></td></tr></table></figure>

<h2 id="可视化界面选择Robomongo"><a href="#可视化界面选择Robomongo" class="headerlink" title="可视化界面选择Robomongo"></a>可视化界面选择Robomongo</h2><p>下载来就可以连接使用</p>
<p><img src="http://7xn4mw.com1.z0.glb.clouddn.com/15-11-16/14736535.jpg" alt=""></p>
<h2 id="开机启动mongodb"><a href="#开机启动mongodb" class="headerlink" title="开机启动mongodb"></a>开机启动mongodb</h2><ol>
<li>mkdir -p ~/Library/LaunchAgents</li>
<li>cp /usr/local/Cellar/mongodb/3.0.4/homebrew.mxcl.mongodb.plist ~/Library/LaunchAgents/</li>
<li>launchctl load -w ~/Library/LaunchAgents/homebrew.mxcl.mongodb.plist</li>
</ol>
<p>注：mongodb/3.0.4/homebrew.mxcl.mongodb.plist这个是本机mongodb的路径</p>
]]></content>
      <categories>
        <category>database</category>
      </categories>
  </entry>
  <entry>
    <title>mysql 常用命令</title>
    <url>/2016/12/24/database/mysql-command-in-common-use/</url>
    <content><![CDATA[<h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">service mysql start</span><br></pre></td></tr></table></figure>

<p>lsof -i -n 检查网络</p>
<p>netstat -a -p -n -t </p>
<p>service是一个管理程序的命令， mysql是/etc/ini下的程序，start是指令开启。</p>
<p>例如<code>service nginx restart</code></p>
<p>更改root密码为</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysql -u root</span><br><span class="line">SET PASSWORD FOR <span class="string">'root'</span>@<span class="string">'localhost'</span> = PASSWORD(<span class="string">'chentongta'</span>);</span><br></pre></td></tr></table></figure>

<h2 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h2><p>当 MySQL 服务已经运行时, 我们可以通过MySQL自带的客户端工具登录到MySQL数据库中,<br>首先打开命令提示符, 输入以下格式的命名:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql -h主机名 -u用户名 -p端口名</span><br></pre></td></tr></table></figure>

<ul>
<li>-h : 该命令用于指定客户端所要登录的MySQL主机名, 登录当前机器该参数可以省略;</li>
<li>-u : 所要登录的用户名;</li>
<li>-p : 告诉服务器将会使用一个密码来登录, 如果所要登录的用户名密码为空, 可以忽略此选项。</li>
</ul>
<p>以登录刚刚安装在本机的MySQL数据库为例，在命令行下输入 mysql -u root -p 按回车确认，如果安装正确且MySQL正在运行，会得到以下响应：</p>
<pre><code>Enter password:</code></pre><p>若密码存在， 输入密码登录，不存在则直接按回车登录， 按照本文中的安装方法， 默认 root 账号是无密码的。<br>登录成功后你将会看到 Welecome to the MySQL monitor… 的提示语。</p>
<p>然后命令提示符会一直以 mysql&gt; 加一个闪烁的光标等待命令的输入， 输入 exit 或 quit 退出登录。</p>
<p>公司：mysql  -u root –socket=/var/lib/mysql/mysql.sock</p>
<h2 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">create database 数据库名 [其他选项];</span><br></pre></td></tr></table></figure>

<p>例如：<code>create database samp_db character set gbk;</code>。</p>
<p>为了便于在命令提示符下显示中文， 在创建时通过 character set gbk 将数据库字符编码指定为 gbk。创建成功时会得到 Query OK, 1 row affected(0.02 sec) 的响应。</p>
<p><strong>注意</strong>: MySQL语句以分号作为语句的结束, 若在语句结尾不添加分号时,<br>命令提示符会以 -&gt; 提示你继续输入(有个别特例, 但加分号是一定不会错的);</p>
<p><strong>提示</strong>: 可以使用 show databases; 命令查看已经创建了哪些数据库。</p>
<h2 id="选择所要操作的数据库"><a href="#选择所要操作的数据库" class="headerlink" title="选择所要操作的数据库"></a>选择所要操作的数据库</h2><p>要对一个数据库进行操作, 必须先选择该数据库, 否则会提示错误:</p>
<pre><code>ERROR 1046(3D000): No database selected</code></pre><p>两种方式对数据库进行使用的选择:</p>
<ol>
<li>在登录数据库时指定, 命令: mysql -D 所选择的数据库名 -h 主机名 -u 用户名 -p<br>例如登录时选择刚刚创建的数据库: mysql -D samp_db -u root -p</li>
<li>在登录后使用 use 语句指定, 命令: use 数据库名;<br>use 语句可以不加分号, 执行 use samp_db 来选择刚刚创建的数据库,<br>选择成功后会提示: Database changed</li>
</ol>
<h2 id="建表"><a href="#建表" class="headerlink" title="建表"></a>建表</h2><p>使用 create table 语句可完成对表的创建, create table 的常见形式:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">create table 表名称(列声明);</span><br></pre></td></tr></table></figure>

<p>以创建 students 表为例, 表中将存放 学号(id)、姓名(name)、性别(sex)、年龄(age)、联系电话(tel) 。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">create table students</span><br><span class="line">(</span><br><span class="line">id int unsigned not null auto_increment primary key,</span><br><span class="line">name char(8) not null,</span><br><span class="line">sex char(4) not null,</span><br><span class="line">age tinyint unsigned not null,</span><br><span class="line">tel char(13) null default &quot;-&quot;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>数据类型参照<a href="http://www.cnblogs.com/zbseoag/archive/2013/03/19/2970004.html" target="_blank" rel="noopener">这篇文章</a> </p>
<p><strong>提示</strong>: 1. 使用 show tables; 命令可查看已创建了表的名称; 2. 使用 describe 表名; 命令可查看已创建的表的详细信息。</p>
<h2 id="插入数据insert"><a href="#插入数据insert" class="headerlink" title="插入数据insert"></a>插入数据insert</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">insert [into] 表名 [(列名1, 列名2, 列名3, ...)] values (值1, 值2, 值3, ...);</span><br></pre></td></tr></table></figure>

<p>其中 [] 内的内容是可选的, 例如, 要给 test 数据库中的 students 表插入一条记录, 执行语句:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">insert into students values(NULL, &quot;王刚&quot;, &quot;男&quot;, 20, &quot;13811371377&quot;);</span><br></pre></td></tr></table></figure>

<p>有时我们只需要插入部分数据, 或者不按照列的顺序进行插入, 可以使用这样的形式进行插入:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">insert into students (name, sex, age) values(&quot;孙丽华&quot;, &quot;女&quot;, 21);</span><br></pre></td></tr></table></figure>

<h2 id="查询表中的数据"><a href="#查询表中的数据" class="headerlink" title="查询表中的数据"></a>查询表中的数据</h2><p>select 语句常用来根据一定的查询规则到数据库中获取数据, 其基本的用法为:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select 列名称 from 表名称 [查询条件];</span><br></pre></td></tr></table></figure>

<p>例如要查询 students 表中所有学生的名字和年龄, 执行语句</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select name, age from students;</span><br></pre></td></tr></table></figure>

<p>也可以使用通配符 * 查询表中所有的内容, 语句:<code>select * from students;</code>。</p>
<h3 id="按特定条件查询"><a href="#按特定条件查询" class="headerlink" title="按特定条件查询:"></a>按特定条件查询:</h3><ul>
<li>where 关键词用于指定查询条件, 用法形式为: <code>select 列名称 from 表名称 where 条件;</code></li>
<li>以查询所有性别为女的信息为例, 输入查询语句: <code>select * from students where sex=&quot;女&quot;;</code></li>
<li>where 子句不仅仅支持 “where 列名 = 值” 这种名等于值的查询形式, 对一般的比较运算的运算符都是支持的, 例如 =、&gt;、&lt;、&gt;=、&lt;、!= 以及一些扩展运算符 is [not] null、in、like 等等。 还可以对查询条件使用 or 和 and 进行组合查询, 以后还会学到更加高级的条件查询方式, 这里不再多做介绍。</li>
</ul>
<p>示例:</p>
<ul>
<li>查询年龄在21岁以上的所有人信息: select * from students where age &gt; 21;</li>
<li>查询名字中带有 “王” 字的所有人信息: select * from students where name like “%王%”;</li>
<li>查询id小于5且年龄大于20的所有人信息: select * from students where id&lt;5 and age&gt;20;</li>
</ul>
<h2 id="更新表中的数据"><a href="#更新表中的数据" class="headerlink" title="更新表中的数据"></a>更新表中的数据</h2><p>update 语句可用来修改表中的数据, 基本的使用形式为:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">update 表名称 set 列名称=新值 where 更新条件;</span><br></pre></td></tr></table></figure>

<p>使用示例:</p>
<ul>
<li>将id为5的手机号改为默认的”-“: <code>update students set tel=default where id=5;</code></li>
<li>将所有人的年龄增加1: <code>update students set age=age+1;</code></li>
<li>将手机号为 13288097888 的姓名改为 “张伟鹏”, 年龄改为 19: <code>update students set name=&quot;张伟鹏&quot;, age=19 where tel=&quot;13288097888&quot;;</code></li>
</ul>
<h2 id="删除表中的数据"><a href="#删除表中的数据" class="headerlink" title="删除表中的数据"></a>删除表中的数据</h2><p>delete 语句用于删除表中的数据, 基本用法为:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">delete from 表名称 where 删除条件;</span><br></pre></td></tr></table></figure>

<p>使用示例:</p>
<ul>
<li>删除id为2的行: <code>delete from students where id=2;</code></li>
<li>删除所有年龄小于21岁的数据: <code>delete from students where age&amp;lt;20;</code></li>
<li>删除表中的所有数据: <code>delete from students;</code></li>
</ul>
<h2 id="创建后表的修改"><a href="#创建后表的修改" class="headerlink" title="创建后表的修改"></a>创建后表的修改</h2><p>alter table 语句用于创建后对表的修改, 基础用法如下:</p>
<h3 id="添加列"><a href="#添加列" class="headerlink" title="添加列"></a>添加列</h3><p>基本形式: <code>alter table 表名 add 列名 列数据类型 [after 插入位置];</code></p>
<p>示例:</p>
<p>在表的最后追加列 address: <code>alter table students add address char(60);</code></p>
<p>在名为 age 的列后插入列 birthday: <code>alter table students add birthday date after age;</code></p>
<h3 id="修改列"><a href="#修改列" class="headerlink" title="修改列"></a>修改列</h3><p>基本形式: <code>alter table 表名 change 列名称 列新名称 新数据类型;</code></p>
<p>示例:</p>
<p>将表 tel 列改名为 telphone: <code>alter table students change tel telphone char(13) default &quot;-&quot;;</code></p>
<p>将 name 列的数据类型改为 char(16): <code>alter table students change name name char(16) not null;</code></p>
<h3 id="删除列"><a href="#删除列" class="headerlink" title="删除列"></a>删除列</h3><p>基本形式: <code>alter table 表名 drop 列名称;</code></p>
<p>示例:</p>
<p>删除 birthday 列: <code>alter table students drop birthday;</code></p>
<h3 id="重命名表"><a href="#重命名表" class="headerlink" title="重命名表"></a>重命名表</h3><p>基本形式: <code>alter table 表名 rename 新表名;</code></p>
<p>示例:</p>
<p>重命名 students 表为 workmates: <code>alter table students rename workmates;</code></p>
<h3 id="删除整张表"><a href="#删除整张表" class="headerlink" title="删除整张表"></a>删除整张表</h3><p>基本形式: <code>drop table 表名;</code></p>
<p>示例: 删除 workmates 表: <code>drop table workmates;</code></p>
<h3 id="删除整个数据库"><a href="#删除整个数据库" class="headerlink" title="删除整个数据库"></a>删除整个数据库</h3><p>基本形式: <code>drop database 数据库名;</code></p>
<p>示例: 删除 test 数据库: <code>drop database test;</code></p>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><h3 id="修改-root-用户密码"><a href="#修改-root-用户密码" class="headerlink" title="修改 root 用户密码"></a>修改 root 用户密码</h3><p>按照本文的安装方式, root 用户默认是没有密码的, 重设 root 密码的方式也较多。</p>
<p>这里仅介绍一种较常用的方式，使用 mysqladmin 方式:</p>
<p>打开命令提示符界面, 执行命令: <code>mysqladmin -u root -p password 新密码</code></p>
<p>执行后提示输入旧密码完成密码修改, 当旧密码为空时直接按回车键确认即可。</p>
]]></content>
      <categories>
        <category>database</category>
      </categories>
  </entry>
  <entry>
    <title>mongodb 常用操作</title>
    <url>/2016/12/24/database/mongodb-command-in-common-use/</url>
    <content><![CDATA[<h2 id="基本命令"><a href="#基本命令" class="headerlink" title="基本命令"></a>基本命令</h2><h3 id="显示当前数据库服务器上的数据库"><a href="#显示当前数据库服务器上的数据库" class="headerlink" title="显示当前数据库服务器上的数据库"></a>显示当前数据库服务器上的数据库</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">show dbs</span><br></pre></td></tr></table></figure>

<h3 id="切换到指定数据库的上下文，可以在此上下文中管理testdb数据库以及其中的集合等"><a href="#切换到指定数据库的上下文，可以在此上下文中管理testdb数据库以及其中的集合等" class="headerlink" title="切换到指定数据库的上下文，可以在此上下文中管理testdb数据库以及其中的集合等"></a>切换到指定数据库的上下文，可以在此上下文中管理testdb数据库以及其中的集合等</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">use testdb</span><br></pre></td></tr></table></figure>

<h3 id="显示数据库中所有的集合（collection）"><a href="#显示数据库中所有的集合（collection）" class="headerlink" title="显示数据库中所有的集合（collection）"></a>显示数据库中所有的集合（collection）</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">show collections</span><br></pre></td></tr></table></figure>

<h3 id="查看数据库服务器的状态"><a href="#查看数据库服务器的状态" class="headerlink" title="查看数据库服务器的状态"></a>查看数据库服务器的状态</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">db.serverStatus()</span><br></pre></td></tr></table></figure>

<h3 id="查询指定数据库统计信息"><a href="#查询指定数据库统计信息" class="headerlink" title="查询指定数据库统计信息"></a>查询指定数据库统计信息</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">use fragment</span><br><span class="line"></span><br><span class="line">db.stats()</span><br></pre></td></tr></table></figure>

<h2 id="基本DDL和DML"><a href="#基本DDL和DML" class="headerlink" title="基本DDL和DML"></a>基本DDL和DML</h2><h3 id="创建数据库。"><a href="#创建数据库。" class="headerlink" title="创建数据库。"></a>创建数据库。</h3><p>直接通过use dbname来切换到这个数据库上下文下面，系统会自动延迟创建该数据库。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">use testdb</span><br><span class="line">show dbs (此刻可能testdb数据库并没有被创建)</span><br><span class="line">db （显示当前使用的数据库，结果位testdb）</span><br><span class="line">db.storeCollection.save(&#123;&apos;version&apos;:&apos;3.5&apos;, &apos;segment&apos;:&apos;e3ol6&apos;&#125;)  （插入一条数据）</span><br><span class="line">show dbs （此刻能看到testdb被创建）</span><br></pre></td></tr></table></figure>

<h3 id="删除数据库"><a href="#删除数据库" class="headerlink" title="删除数据库"></a>删除数据库</h3><p>直接使用db.dropDatabase()即可删除数据库。</p>
<h3 id="创建集合"><a href="#创建集合" class="headerlink" title="创建集合"></a>创建集合</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">db.createCollection(&apos;replicationColletion&apos;, &#123;&apos;capped&apos;:true, &apos;size&apos;:10240, &apos;max&apos;:17855200&#125;)</span><br><span class="line">show collections</span><br></pre></td></tr></table></figure>

<h3 id="删除集合。"><a href="#删除集合。" class="headerlink" title="删除集合。"></a>删除集合。</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">db.mycoll.drop()</span><br></pre></td></tr></table></figure>

<h3 id="增加纪录。"><a href="#增加纪录。" class="headerlink" title="增加纪录。"></a>增加纪录。</h3><h4 id="两种插入方法"><a href="#两种插入方法" class="headerlink" title="两种插入方法"></a>两种插入方法</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">db.storeCollection.save(&#123;&apos;version&apos;:&apos;3.5&apos;, &apos;segment&apos;:&apos;e3ol6&apos;&#125;)</span><br><span class="line">db.storeCollection.insert(&#123;&apos;version&apos;:&apos;3.5&apos;, &apos;segment&apos;:&apos;e3ol6&apos;&#125;)</span><br></pre></td></tr></table></figure>

<p>若新增的数据中存在主键 ，insert() 会提示错误，而save() 则更改原来的内容为新内容。如：</p>
<p>已存在数据： <code>{_id : 1, &quot; name &quot; : &quot; n1 &quot; }</code>，再次进行插入操作时，<code>insert({_id : 1, &quot; name &quot; : &quot; n2 &quot; })</code>会报主键重复的错误提示，<code>save({ _id : 1, &quot; name &quot; : &quot; n2 &quot; })</code>     会把 n1 修改为  n2  。</p>
<p>相同点：</p>
<p>若新增的数据中没有主键时，会增加一条记录。</p>
<p>已存在数据： <code>{ _id : 1, &quot; name &quot; : &quot; n1 &quot; }</code>，再次进行插入操作时，</p>
<p><code>insert({ &quot; name &quot; : &quot; n2 &quot; })</code>    插入的数据因为没有主键，所以会增加一条数据<br><code>save({  &quot; name &quot; : &quot; n2 &quot; })</code>   增加一条数据。</p>
<h4 id="循环插入"><a href="#循环插入" class="headerlink" title="循环插入"></a>循环插入</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">for (var i = 1; i &lt; 100; i++) &#123;</span><br><span class="line">    db.testCollection.insert(&#123;</span><br><span class="line">        age : i % 7,</span><br><span class="line">        name : &apos;name&apos; + Math.round((10 + 20 * Math.random())),</span><br><span class="line">        password : &apos;123456&apos;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="更新记录。"><a href="#更新记录。" class="headerlink" title="更新记录。"></a>更新记录。</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">db.testCollection.update(&#123;age: 6&#125;, &#123;$inc: &#123;age: 1&#125;&#125;) //选择age为6的一条记录，使他的age加1.</span><br><span class="line">db.testCollection.update(&#123;age: 7&#125;, &#123;$set: &#123;password : &apos;456789&apos;&#125;&#125;) //选择age为7的一条记录，设置password为456789</span><br><span class="line"></span><br><span class="line">//如果条件不匹配一个记录，希望能往数据库里新增一个，设置update函数第三个参数为true就可以。这里age为8条件匹配不到数据。</span><br><span class="line">db.testCollection.update(&#123;age: 8&#125;, &#123;$set: &#123;password : &apos;888888&apos;&#125;&#125;, true)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//若要批量更新，设置update函数第四个参数为true就可以了。</span><br><span class="line">db.testCollection.update(&#123;age: 7&#125;, &#123;$set: &#123;password : &apos;456789&apos;&#125;&#125;, true, true)</span><br></pre></td></tr></table></figure>

<p>更新version为3.5的记录的segment值。</p>
<h3 id="查询一条纪录。"><a href="#查询一条纪录。" class="headerlink" title="查询一条纪录。"></a>查询一条纪录。</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">db.storeCollection.findOne(&#123;&apos;version&apos;:&apos;3.5&apos;&#125;)</span><br></pre></td></tr></table></figure>
<p>参数为查询条件，可选，系统会随机查询获取到满足条件的一条记录（如果存在查询结果数量大于等于1）。</p>
<h3 id="查询多条记录。"><a href="#查询多条记录。" class="headerlink" title="查询多条记录。"></a>查询多条记录。</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">db.storeCollection.find()</span><br></pre></td></tr></table></figure>

<p>使用find()函数，参数指定查询条件，不指定条件则查询全部记录。</p>
<p>条件查询包括4种方法：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// 1. $gt（&amp;gt;）、$gte（&amp;gt;=）、$lt（&amp;lt;）、$lt（&amp;lt;=）、$ne（!=）、没有特殊关键字（＝）</span><br><span class="line"></span><br><span class="line">db.testCollection.find(&#123;age: &#123;$$gt:5&#125;&#125;).count() //14。note：去掉gt前面一个$符号，$符号会被解析，wiznote搞的鬼！！！</span><br><span class="line"></span><br><span class="line">db.testCollection.find(&#123;age: &#123;$gte:5&#125;&#125;).count() //28</span><br><span class="line"></span><br><span class="line">db.testCollection.find(&#123;age: &#123;$lt:5&#125;&#125;).count() //71</span><br><span class="line"></span><br><span class="line">db.testCollection.find(&#123;age: &#123;$lte:5&#125;&#125;).count() //85</span><br><span class="line"></span><br><span class="line">db.testCollection.find(&#123;age: &#123;$ne:5&#125;&#125;).count() //85</span><br><span class="line"></span><br><span class="line">db.testCollection.find(&#123;age: 5&#125;).count() //14</span><br><span class="line"></span><br><span class="line">// 2. 没有特殊关键字（&amp;amp;&amp;amp;）、 $or（||）、$in（）、$nin（）</span><br><span class="line"></span><br><span class="line">db.testCollection.find(&#123;age: &#123;$$gt: 5&#125;, password:&apos;123456&apos;&#125;).count() //年龄大于5且密码为123456， 14。</span><br><span class="line"></span><br><span class="line">//年龄为5或者名字为name26，18</span><br><span class="line">db.testCollection.find(&#123;$or:[&#123;age: 5&#125;,  &#123;name:&apos;name26&apos;&#125;]&#125;).count() </span><br><span class="line"></span><br><span class="line">db.testCollection.find(&#123;age: &#123;$in: [1,5, 6]&#125;&#125;).count() //年龄在1、5、6中，43。</span><br><span class="line"></span><br><span class="line">db.testCollection.find(&#123;age: &#123;$nin: [1,5, 6]&#125;&#125;).count() //年龄不在1、5、6中，56</span><br><span class="line"></span><br><span class="line">// 3. 正则表达式匹配，威力强劲</span><br><span class="line">db.testCollection.find(&#123;name: /^name1\d/&#125;).count() //名字以name1开头的，从name10到name19的记录。41</span><br><span class="line"></span><br><span class="line">//4. where语句，大招来了</span><br><span class="line">db.testCollection.find(&#123;$where:function()&#123;return this.age &amp;gt; 5&#125; &#125;).count()</span><br></pre></td></tr></table></figure>

<h3 id="删除纪录"><a href="#删除纪录" class="headerlink" title="删除纪录"></a>删除纪录</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">db.storeCollection.findOne(&#123;&apos;version&apos;: &apos;3.5&apos;&#125;)   （删除version为3.5的纪录）</span><br><span class="line">db.storeCollection.findOne(&#123;&apos;version&apos;: &apos;3.5&apos;&#125;)   （返回结果为空）</span><br></pre></td></tr></table></figure>

<h3 id="统计集合记录数"><a href="#统计集合记录数" class="headerlink" title="统计集合记录数"></a>统计集合记录数</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">db.storeCollection.count()</span><br></pre></td></tr></table></figure>

<h3 id="查询并统计结果记录数"><a href="#查询并统计结果记录数" class="headerlink" title="查询并统计结果记录数"></a>查询并统计结果记录数</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">db.storeCollection.find(&#123;&apos;segment&apos;:&apos;e30l8&apos;&#125;).count()</span><br></pre></td></tr></table></figure>


<h2 id="数据库备份与恢复"><a href="#数据库备份与恢复" class="headerlink" title="数据库备份与恢复"></a>数据库备份与恢复</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 导出数据库，把线上叫的 ruler 集合数据库导出到本地的/data/db</span></span><br><span class="line">$ sudo mongodump -h 172.17.40.x -p 27017 -d ruler -o /data/db/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据库恢复，把 /data/db/ruler 给导入本地的 ruler 数据库</span></span><br><span class="line">$ mongorestore -h 127.0.0.1:27017 -d ruler --dir /data/db/ruler/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 此外还可以了解一下向表导入导出数据的</span></span><br><span class="line"><span class="comment"># mongoimport 和 mongoexport</span></span><br></pre></td></tr></table></figure>

<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul>
<li><a href="http://blog.csdn.net/templar1000/article/details/25310299" target="_blank" rel="noopener">csdn</a></li>
<li><a href="http://www.cnblogs.com/huangxincheng/archive/2012/02/18/2356595.html" target="_blank" rel="noopener">cnblogs</a></li>
</ul>
]]></content>
      <categories>
        <category>database</category>
      </categories>
  </entry>
  <entry>
    <title>跨域方法简介</title>
    <url>/2016/12/24/javascript/cross-domain-methods/</url>
    <content><![CDATA[<h2 id="jsonp请求"><a href="#jsonp请求" class="headerlink" title="jsonp请求"></a>jsonp请求</h2><p>ajax 本身是不可以跨域的，通过产生一个 script 标签来实现跨域。因为 script 标签的 src 属性是没有跨域的限制的。<br>jquery 其实设置了 dataType: ‘jsonp’ 后，$.ajax 方法就和 ajax XmlHttpRequest 没什么关系了，取而代之的则是 JSONP 协议。<br>JSONP 是一个非官方的协议，它允许在服务器端集成 Script tags 返回至客户端，通过 javascript callback 的形式实现跨域访问。</p>
<p>jQuery并没有用其它新奇的技术，只不是对 <code>&lt;script src=&quot;&quot;/&gt;</code> 做了个封装，以实现jsonp跨域的方式。</p>
<p>我们封装一层jsonp的实现，废话不说，上代码</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> jsonp = <span class="function"><span class="keyword">function</span> (<span class="params">opts</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//to produce random string</span></span><br><span class="line">    <span class="keyword">var</span> generateRandomAlphaNum = <span class="function"><span class="keyword">function</span> (<span class="params">len</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> rdmString = <span class="string">''</span>;</span><br><span class="line">        <span class="keyword">for</span> (; rdmString.length &lt; len; rdmString += <span class="built_in">Math</span>.random().toString(<span class="number">36</span>).substr(<span class="number">2</span>));</span><br><span class="line">        <span class="keyword">return</span> rdmString.substr(<span class="number">0</span>, len);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> url = <span class="keyword">typeof</span> opts === <span class="string">'string'</span> ? opts : opts.url,</span><br><span class="line">        callbackName = opts.callbackName || <span class="string">'jsonpCallback'</span> + generateRandomAlphaNum(<span class="number">10</span>),</span><br><span class="line">        callbackFn = opts.callbackFn || <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">    <span class="keyword">if</span> (url.indexOf(<span class="string">'callback'</span>) === <span class="number">-1</span>) &#123;</span><br><span class="line">        url += url.indexOf(<span class="string">'?'</span>) === <span class="number">-1</span> ? <span class="string">'?callback='</span> + callbackName :</span><br><span class="line">            <span class="string">'&amp;callback='</span> + callbackName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> opts === <span class="string">'object'</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> params = (<span class="function"><span class="keyword">function</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> str = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> prop <span class="keyword">in</span> obj)&#123;</span><br><span class="line">                str += prop + <span class="string">'='</span> + obj[prop] + <span class="string">'&amp;'</span></span><br><span class="line">            &#125;</span><br><span class="line">            str = str.slice(<span class="number">0</span>, str.length - <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> str;</span><br><span class="line">        &#125;)(opts.data);</span><br><span class="line">        url += <span class="string">'&amp;'</span> + params;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> eleScript= <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line">    eleScript.type = <span class="string">'text/javascript'</span>;</span><br><span class="line">    eleScript.id = <span class="string">'jsonp'</span>;</span><br><span class="line">    eleScript.src = url;</span><br><span class="line">    <span class="built_in">document</span>.getElementsByTagName(<span class="string">'HEAD'</span>)[<span class="number">0</span>].appendChild(eleScript);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// window[callbackName] = callbackFn;</span></span><br><span class="line">    <span class="comment">//return promise</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">window</span>[callbackName] = <span class="function"><span class="keyword">function</span> (<span class="params">json</span>) </span>&#123;</span><br><span class="line">            resolve(json);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//onload are executed just after the sync request is comple，</span></span><br><span class="line">        <span class="comment">//please use 'onreadystatechange' if need support IE9-</span></span><br><span class="line">        eleScript.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="comment">//delete the script element when a request done。</span></span><br><span class="line">            <span class="built_in">document</span>.getElementById(<span class="string">'jsonp'</span>).outerHTML = <span class="string">''</span>;</span><br><span class="line">            eleScript = <span class="literal">null</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">        eleScript.onerror = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">document</span>.getElementById(<span class="string">'jsonp'</span>).outerHTML = <span class="string">''</span>;</span><br><span class="line">            eleScript = <span class="literal">null</span>;</span><br><span class="line">            reject(<span class="string">'error'</span>);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">jsonp(&#123;</span><br><span class="line">    url: <span class="string">'http://erp.souche.com/pc/car/carpricetagaction/carPriceInfo.jsonp'</span>, <span class="comment">/*url写异域的请求地址*/</span></span><br><span class="line">    data: &#123;</span><br><span class="line">        carId: <span class="string">'0a499720d77f4e55a0ac490ed115fc4e'</span>,</span><br><span class="line">        picNum: <span class="number">5</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(d.data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>jsonp的缺点：只支持GET请求，也容易被运营商劫持插入奇怪的广告。</p>
<p>jsonp的优点：能支持老的浏览器。</p>
<h2 id="xhr2"><a href="#xhr2" class="headerlink" title="xhr2"></a>xhr2</h2><p>XHR2在众多HTML5新特性中算是比较低调的一个了。我翻了几本HTML5的书，只有《HTML5高级程序设计》弱弱地讲了几页。网上的资料也不多，很大的一个原因我估计是目前有浏览器还压根不兼容，看看下面的兼容列表：</p>
<ul>
<li>Chrome 7.0及以上</li>
<li>Firefox 3.5以上</li>
<li>Internet Explorer 10及以上</li>
<li>Opera 12.1及以上</li>
<li>Safari 5.0及以上</li>
<li>android broswer 3及以上</li>
<li>ios safari 5.1及以上</li>
</ul>
<p>XHR2这么叫多少有点误导的感觉，实际上没有什么XHR1，XHR2这样的概念，XHR2只是一套新的规范，在原有XHR对象上新增了一些功能：跨域访问，全新的事件，还有请求进度以及响应进度。 所以呢，要实现XHR2特性还是使用XMLHttpRequest对象，前提是浏览器要支持XHR2：<br>http发现这是一个跨源的ajax请求后就自动在头信息添加一个origin字段，服务器根据这个字段判断是否同意这次请求，如果同意这次请求则在响应头中插入字段 <code>Access-Control-Allow-Origin</code> 。</p>
<p>这是常见的一个 http response header 里关于 xhr2 的设置</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Access-Control-Allow-Credentials: true</span><br><span class="line">Access-Control-Allow-Headers: Origin, X-Requested-With, Content-Type, Accept, TT, _security_token</span><br><span class="line">Access-Control-Allow-Methods: POST, GET, PUT, OPTIONS, DELETE</span><br><span class="line">Access-Control-Allow-Origin: http://xxx.domain.com</span><br></pre></td></tr></table></figure>

<p>请注意，如果需要请求中带上 cookie 则把 <code>Access-Control-Allow-Credentials</code> 设置为 true。但是如果 <code>Access-Control-Allow-Origin</code> 为 * 时，这么设置将会报错。</p>
<p>优点是支持所有类型的http请求</p>
<p>缺点是 <code>Access-Control-Allow-Origin</code> 这个头所跨的域本人实践写多个域名无效，那么就只能跨一个网站。</p>
<h2 id="后台代理方式"><a href="#后台代理方式" class="headerlink" title="后台代理方式"></a>后台代理方式</h2><p>这种方式可以解决所有跨域问题，也就是将后台作为代理，每次对其它域的请求转交给本域的后台，本域的后台通过模拟http请求去访问其它域，再将返回的结果返回给前台。</p>
<p>优点是无论访问的是文档，还是js文件都可以实现跨域。</p>
<p>缺点为每一个请求都需要一个后端去写转发的支持。</p>
<h2 id="iframe跨域"><a href="#iframe跨域" class="headerlink" title="iframe跨域"></a>iframe跨域</h2><p>对于主域相同而子域不同的例子，可以通过设置document.domain的办法来解决。具体的做法是可以在 <code>http://www.a.com/a.html</code> 和<code>http://script.a.com/b.html</code> 两个文件中分别加上 <code>document.domain = &#39;a.com&#39;</code>；然后通过 a.html 文件中创建一个 iframe ，去控制 iframe 的 contentDocument，这样两个js文件之间就可以“交互”了。当然这种办法只能解决主域相同而二级域名不同的情况，如果你异想天开的把script.a.com的domian设为alibaba.com那显然是会报错地！代码如下：</p>
<p><a href="http://www.a.com" target="_blank" rel="noopener">www.a.com</a> 上的 a.html</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">document.domain = &apos;a.com&apos;;</span><br><span class="line">var ifr = document.createElement(&apos;iframe&apos;);</span><br><span class="line">ifr.src = &apos;http://script.a.com/b.html&apos;;</span><br><span class="line">ifr.style.display = &apos;none&apos;;</span><br><span class="line">document.body.appendChild(ifr);</span><br><span class="line">ifr.onload = function()&#123;</span><br><span class="line">    var doc = ifr.contentDocument || ifr.contentWindow.document;</span><br><span class="line">    // 在这里操纵b.html</span><br><span class="line">    alert(doc.getElementsByTagName(&quot;h1&quot;)[0].childNodes[0].nodeValue);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>script.a.com 上的 b.html</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">document.domain = &apos;a.com&apos;;</span><br></pre></td></tr></table></figure>

<p>问题：</p>
<ul>
<li>安全性，当一个站点（b.a.com）被攻击后，另一个站点（c.a.com）会引起安全漏洞。</li>
<li>如果一个页面中引入多个iframe，要想能够操作所有iframe，必须都得设置相同domain。</li>
</ul>
<h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2><p>实际开发过程中，我的做法是本地用后台代理方式，也就是node中转一层去获取数据，关于这一点比方说 webpack 的配置项 proxyTable 就提供了这样的功能。下面提供了一段简单的配置</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> devConf = &#123;</span><br><span class="line">    env: <span class="string">'dev'</span>,</span><br><span class="line">    globalConfig: &#123;</span><br><span class="line">        NODE_ENV: <span class="built_in">JSON</span>.stringify(<span class="string">"development"</span>),</span><br><span class="line">        TEST: <span class="built_in">JSON</span>.stringify(<span class="string">"/api/get"</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    proxyTable: &#123;</span><br><span class="line">        <span class="string">'/api/get'</span>: &#123;</span><br><span class="line">            target: <span class="string">'http://test.sqaproxy.xx.com'</span>,</span><br><span class="line">            changeOrigin: <span class="literal">true</span>,</span><br><span class="line">            pathRewrite: &#123;</span><br><span class="line">                <span class="string">'/api/get'</span>: <span class="string">''</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>那么具体文件中访问 globalConfig 中的 TEST 变量就是代理后的地址</p>
<p>而到了预发和线上时，自然有后端返回的 <code>Access-Control-Allow-Origin</code> 头来做 xhr2 跨域。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="http://www.ruanyifeng.com/blog/2016/04/cors.html" target="_blank" rel="noopener">阮一峰，跨域资源共享 CORS 详解</a></li>
<li><a href="http://rubyer.me/blog/324/" target="_blank" rel="noopener">jsonp原理</a></li>
<li><a href="http://www.cnblogs.com/rainman/archive/2011/02/20/1959325.html" target="_blank" rel="noopener">iframe跨域</a></li>
</ul>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
  </entry>
  <entry>
    <title>.editorconfig文件配置说明</title>
    <url>/2016/12/24/js-util/editorconfig/</url>
    <content><![CDATA[<h2 id="常用的编码规范"><a href="#常用的编码规范" class="headerlink" title="常用的编码规范"></a>常用的编码规范</h2><p>EditorConfig 支持的常用的编码规范，如下</p>
<ul>
<li>charset：文件编码。可选值<ul>
<li>latin1</li>
<li>utf-8。一般用这个。</li>
<li>utf-16be</li>
<li>utf-16le</li>
</ul>
</li>
<li>indent_style: 缩进类型。可选值<ul>
<li>space</li>
<li>tab</li>
</ul>
</li>
<li>indent_size: 缩进数量。可选值<ul>
<li>整数。一般设置 2 或 4。</li>
<li>tab</li>
</ul>
</li>
<li>insert_final_newline：是否在文件的最后插入一个空行。可选值<ul>
<li>true</li>
<li>false</li>
</ul>
</li>
<li>end_of_line：换行符格式。说明见Wiki：换行。可选值<ul>
<li>lf。一般用这个。</li>
<li>crlf</li>
<li>cr</li>
</ul>
</li>
<li>trim_trailing_whitespace：是否删除行尾的空格。可选值<ul>
<li>true</li>
<li>false</li>
</ul>
</li>
</ul>
<p>完整版见<a href="https://github.com/editorconfig/editorconfig/wiki/EditorConfig-Properties" target="_blank" rel="noopener">这里</a></p>
<h2 id="文件内容"><a href="#文件内容" class="headerlink" title="文件内容"></a>文件内容</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># http://editorconfig.org</span><br><span class="line"></span><br><span class="line">root = true</span><br><span class="line"></span><br><span class="line"># 对所有文件生效</span><br><span class="line">[*]</span><br><span class="line">charset = utf-8</span><br><span class="line">indent_style = space</span><br><span class="line">indent_size = 2</span><br><span class="line">end_of_line = lf</span><br><span class="line">insert_final_newline = true</span><br><span class="line">trim_trailing_whitespace = true</span><br><span class="line"></span><br><span class="line"># 对后缀名为 md 的文件生效</span><br><span class="line">[*.md]</span><br><span class="line">trim_trailing_whitespace = false</span><br></pre></td></tr></table></figure>

<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="http://www.jianshu.com/p/712cea0ef70e" target="_blank" rel="noopener">http://www.jianshu.com/p/712cea0ef70e</a></p>
]]></content>
      <categories>
        <category>js-util</category>
      </categories>
  </entry>
  <entry>
    <title>js 库通用封装办法</title>
    <url>/2016/12/24/js-util/module-packing/</url>
    <content><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>封装方法参考了Underscore.js的实现，需要的朋友可以参考下</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> exports !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">module</span> !== <span class="string">'undefined'</span> &amp;&amp; <span class="built_in">module</span>.exports) &#123;</span><br><span class="line">        exports = <span class="built_in">module</span>.exports = yourModule;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        exports.handWritting = yourModule;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.handWritting = yourModule;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="http://www.jb51.net/article/50743.htm" target="_blank" rel="noopener">Node.js中对通用模块的封装方法</a></p>
]]></content>
      <categories>
        <category>js-util</category>
      </categories>
  </entry>
  <entry>
    <title>html5中高级选择器querySelector简介</title>
    <url>/2016/12/24/mobile-h5/queryselector/</url>
    <content><![CDATA[<h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><p>两个方法，其中，querySelector返回满足条件的单个DOM元素，按照深度院线和先序遍历的原则使用参数提供的css选择器在DOM中查找。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//返回class为list下，子元素里class为item的首个DOM元素。</span></span><br><span class="line">element = <span class="built_in">document</span>.querySelector(<span class="string">'.list .item'</span>); </span><br><span class="line"><span class="comment">//注意参数必须严格符合css选择符规范，比如说元素名、类名和id均不能以数字开头，以下代码出错</span></span><br><span class="line"><span class="built_in">document</span>.querySelector(<span class="string">'11abc'</span>);</span><br><span class="line"><span class="comment">//如果类名中有冒号等字符需要经过转义</span></span><br><span class="line"><span class="built_in">document</span>.querySelector(<span class="string">'test\\:abc'</span>)</span><br></pre></td></tr></table></figure>

<p>而querySelectorAll，则是返回满足所有条件的元素，结果是个nodeList集合，查找规则与上面相同。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">elements = <span class="built_in">document</span>.querySelectorAll(<span class="string">'.list .item'</span>); <span class="comment">//结果是是一个nodeList集合</span></span><br></pre></td></tr></table></figure>

<p>这里返回的nodeList集合中的元素是非实时的static node list，而getElementsBy系列的返回的是一个live node list。看下面的例子</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// for循环 [lis.length] 次，lis.length定下不会再被更新。</span></span><br><span class="line"><span class="keyword">var</span> ul = <span class="built_in">document</span>.querySelectorAll(<span class="string">'ul'</span>)[<span class="number">0</span>],</span><br><span class="line">    lis = ul.querySelectorAll(<span class="string">"li"</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; lis.length ; i++)&#123;</span><br><span class="line">    ul.appendChild(<span class="built_in">document</span>.createElement(<span class="string">"li"</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// append操作将无限循环，每append一次，lis都会随之更新，lis.length+1，达不到循环条件结束。</span></span><br><span class="line"><span class="keyword">var</span> ul = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'ul'</span>)[<span class="number">0</span>], </span><br><span class="line">    lis = ul.getElementsByTagName(<span class="string">"li"</span>); </span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; lis.length ; i++)&#123;</span><br><span class="line">    ul.appendChild(<span class="built_in">document</span>.createElement(<span class="string">"li"</span>)); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="兼容性"><a href="#兼容性" class="headerlink" title="兼容性"></a>兼容性</h2><p>querySelectorAll 已被 IE 8+、FF 3.5+、Safari 3.1+、Chrome 和 Opera 10+ 良好支持 。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://www.zhihu.com/question/24702250" target="_blank" rel="noopener">https://www.zhihu.com/question/24702250</a><br><a href="http://www.cnblogs.com/Wayou/p/html5_web_api_queryselector.html" target="_blank" rel="noopener">http://www.cnblogs.com/Wayou/p/html5_web_api_queryselector.html</a></p>
]]></content>
      <categories>
        <category>mobile-h5</category>
      </categories>
  </entry>
  <entry>
    <title>node 爬虫示例</title>
    <url>/2016/12/24/node/node-crawler/</url>
    <content><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>node的爬虫方案，基本思路是使用node发起一个http request请求去请求目标网页上的数据，采用的node方法是。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">http.request(options, callback);</span><br></pre></td></tr></table></figure>

<p>callback参数里是一个函数，返回一个response。</p>
<p>关于options参数应该有</p>
<ul>
<li>host：请求发送到的服务器的域名或IP地址。默认为’localhost’。</li>
<li>hostname：用于支持url.parse()。hostname比host更好一些</li>
<li>port：远程服务器的端口。默认值为80。</li>
<li>localAddress：用于绑定网络连接的本地接口。</li>
<li>socketPath：Unix域套接字（使用host:port或socketPath）</li>
<li>method：指定HTTP请求方法的字符串。默认为’GET’。</li>
<li>path：请求路径。默认为’/‘。如果有查询字符串，则需要包含。例如’/index.html?page=12’。请求路径包含非法字符时抛出异常。目前，只否决空格，不过在未来可能改变。</li>
<li>headers：包含请求头的对象。</li>
<li>auth：用于计算认证头的基本认证，即’user:password’</li>
<li>agent：控制Agent的行为。当使用了一个Agent的时候，请求将默认为Connection: keep-alive。可能的值为：<ul>
<li>undefined（默认）：在这个主机和端口上使用[全局Agent][]。</li>
<li>Agent对象：在Agent中显式使用passed。</li>
<li>false：在对Agent进行资源池的时候，选择停用连接，默认请求为：Connection: close。</li>
</ul>
</li>
<li>keepAlive：{Boolean} 保持资源池周围的套接字在未来被用于其它请求。默认值为false</li>
<li>keepAliveMsecs：{Integer} 当使用HTTP KeepAlive的时候，通过正在保持活动的套接字发送TCP KeepAlive包的频繁程度。默认值为1000。仅当keepAlive被设置为true时才相关。</li>
</ul>
<h2 id="基本例子"><a href="#基本例子" class="headerlink" title="基本例子"></a>基本例子</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 引入模块</span></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//需要带上user－agent参数这个网站才会处理我的请求，不然会出现403错误</span></span><br><span class="line"><span class="keyword">var</span> opt = &#123;</span><br><span class="line">    <span class="comment">//代理服务器的ip或者域名，默认localhost</span></span><br><span class="line">    host: <span class="string">'122.228.179.178'</span>,</span><br><span class="line">    <span class="comment">//代理服务器的端口号，默认80</span></span><br><span class="line">    port: <span class="number">80</span>,</span><br><span class="line">    <span class="comment">//path是访问的路径</span></span><br><span class="line">    path: <span class="string">'http://www.163.com'</span>,</span><br><span class="line">    <span class="comment">//希望发送出去的请求头</span></span><br><span class="line">    headers: &#123;</span><br><span class="line">        <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2490.86 Safari/537.36'</span>,</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//一个request请求，下面是接收的代码。</span></span><br><span class="line"><span class="keyword">var</span> req = http.get(opt, <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> data = <span class="string">''</span>;</span><br><span class="line">    res.setEncoding(<span class="string">"utf8"</span>); </span><br><span class="line"></span><br><span class="line">    res.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">        data += chunk;</span><br><span class="line">    &#125;).on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.log(data)</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//console.log(req);</span></span><br></pre></td></tr></table></figure>

<p>获得data后接下来就是解析了，可以使用正则匹配关键字段，如果返回是html片段也可以使用cheerio模块去处理。关于cheerio模块见<a href="https://cnodejs.org/topic/5203a71844e76d216a727d2e" target="_blank" rel="noopener">这里</a></p>
<h2 id="反爬虫"><a href="#反爬虫" class="headerlink" title="反爬虫"></a>反爬虫</h2><p>爬虫返回403，表示网站采用了防爬技术anti-web-crawling，反爬虫一般会采用比较简单即会检查用户代理（User Agent）信息。再请求头部构造一个User Agent就行了。也可能会检测Referer请求头，还有cookie等。高级的反爬虫会统计一个ip在一小时内请求量是否超过限制，达到则封锁ip，这样的方案就需要加上代理，test.js演示了一个连代理的最基本例子，而具体的寻找代理的设置看<a href="http://kaito-kidd.com/2015/11/02/proxies-service/" target="_blank" rel="noopener">这篇文章</a></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">url: &#123;</span><br><span class="line">    hostname: <span class="string">'122.228.179.178'</span>, <span class="comment">//代理设置</span></span><br><span class="line">    path: <span class="string">'http://www.163.com'</span>,</span><br><span class="line">    agent: <span class="literal">false</span>,</span><br><span class="line">    headers: &#123;</span><br><span class="line">        <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2490.86 Safari/537.36'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="进阶，多线程爬虫例子"><a href="#进阶，多线程爬虫例子" class="headerlink" title="进阶，多线程爬虫例子"></a>进阶，多线程爬虫例子</h2><p>利用了 cluster 模块，代码直接上我的 github 上找吧：<a href="https://github.com/everlose/node-api/tree/master/cluster" target="_blank" rel="noopener">https://github.com/everlose/node-api/tree/master/cluster</a></p>
]]></content>
      <categories>
        <category>node</category>
      </categories>
  </entry>
  <entry>
    <title>怎么升级 node 版本</title>
    <url>/2016/12/24/node/node-update/</url>
    <content><![CDATA[<h2 id="安装n模块"><a href="#安装n模块" class="headerlink" title="安装n模块"></a>安装n模块</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ npm install -g n</span><br></pre></td></tr></table></figure>

<h2 id="升级node-js到最新稳定版"><a href="#升级node-js到最新稳定版" class="headerlink" title="升级node.js到最新稳定版"></a>升级node.js到最新稳定版</h2><p>本人 18 年 8 月更新时最新稳定版已经是 node-v10.8.0</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ n stable</span><br><span class="line"></span><br><span class="line">     install : node-v10.8.0</span><br><span class="line">       mkdir : /usr/<span class="built_in">local</span>/n/versions/node/10.8.0</span><br><span class="line">       fetch : https://nodejs.org/dist/v10.8.0/node-v10.8.0-darwin-x64.tar.gz</span><br><span class="line"><span class="comment">#############                                                             18.1%</span></span><br></pre></td></tr></table></figure>

<p>当然，n 的后面可以跟随版本号，比如 <code>n v0.12.7</code></p>
<h2 id="切换node版本"><a href="#切换node版本" class="headerlink" title="切换node版本"></a>切换node版本</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ n</span><br><span class="line"></span><br><span class="line">    node/10.8.0</span><br><span class="line">    node/5.10.1</span><br><span class="line">    node/7.6.0</span><br><span class="line">  ο node/9.0.0</span><br></pre></td></tr></table></figure>

<p>再选择一项</p>
]]></content>
      <categories>
        <category>node</category>
      </categories>
  </entry>
  <entry>
    <title>npm 常用操作</title>
    <url>/2016/12/24/node/npm-in-common-use/</url>
    <content><![CDATA[<h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><ul>
<li><code>npm -v</code> #显示版本，检查npm是否正确安装。</li>
<li><code>npm install 模块名</code> #安装xxx的模块</li>
<li><code>npm install －g 模块名</code> #全局安装express模块</li>
<li><code>npm ls --depth 0</code> #列出已安装的模块</li>
<li><code>npm ls 模块名</code> #本地模块显示</li>
<li><code>npm show 模块名</code>  #显示xxx模块详情</li>
<li><code>npm update</code> #升级当前目录下项目所有模块</li>
<li><code>npm update 模块名</code> #升级当前目录下指定模块</li>
<li><code>npm update -g 模块名</code> #升级全局的xxx模块</li>
<li><code>npm uninstall 模块名</code> #删除指定模块</li>
<li><code>sudo npm update npm -g</code> #npm升级自身</li>
<li><code>npm home 模块名</code> 打开模块的主页</li>
<li><code>npm repo 模块名</code> 打开模块的github地址</li>
<li><code>npm outdated</code> 查看安装的模块是否过期，当前安装的版本（Current）、你应该要更新到的版本（Wanted）以及仓库中最新的版本（Latest）</li>
<li><code>npm install --production</code> 之安装dependencies</li>
</ul>
<h2 id="切换数据源"><a href="#切换数据源" class="headerlink" title="切换数据源"></a>切换数据源</h2><p>nrm 是一个 NPM 源管理器，允许你快速地在如下 NPM 源间切换</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install -g nrm</span><br></pre></td></tr></table></figure>

<h3 id="列出可选的源"><a href="#列出可选的源" class="headerlink" title="列出可选的源"></a>列出可选的源</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nrm ls</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">* npm ---- https://registry.npmjs.org/</span><br><span class="line">  cnpm --- http://r.cnpmjs.org/</span><br><span class="line">  taobao - http://registry.npm.taobao.org/</span><br><span class="line">  eu ----- http://registry.npmjs.eu/</span><br><span class="line">  au ----- http://registry.npmjs.org.au/</span><br><span class="line">  sl ----- http://npm.strongloop.com/</span><br><span class="line">  nj ----- https://registry.nodejitsu.com/</span><br></pre></td></tr></table></figure>

<p>带 * 的是当前使用的源，上面的输出表明当前源是官方源。</p>
<h3 id="切换"><a href="#切换" class="headerlink" title="切换"></a>切换</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nrm use taobao</span><br><span class="line"></span><br><span class="line">    Registry has been <span class="built_in">set</span> to: http://registry.npm.taobao.org/</span><br></pre></td></tr></table></figure>

<h3 id="增加源"><a href="#增加源" class="headerlink" title="增加源"></a>增加源</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nrm add  &lt;registry&gt; &lt;url&gt; [home]</span><br></pre></td></tr></table></figure>

<h3 id="删除源"><a href="#删除源" class="headerlink" title="删除源"></a>删除源</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nrm del &lt;registry&gt; [your registry]</span><br></pre></td></tr></table></figure>

<h3 id="测试速度"><a href="#测试速度" class="headerlink" title="测试速度"></a>测试速度</h3><p>测试单个</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nrm <span class="built_in">test</span> npm</span><br><span class="line"></span><br><span class="line">    npm ---- 1328ms</span><br></pre></td></tr></table></figure>

<p>测试所有</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nrm <span class="built_in">test</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>node</category>
      </categories>
  </entry>
  <entry>
    <title>iterm2 快捷键</title>
    <url>/2016/12/24/os/iterm2-short-cut-key/</url>
    <content><![CDATA[<ol>
<li>⌘ + 数字可在各tab标签来回切换，⌘ + → ／ ⌘ + ← 也是tab标签切换。</li>
<li>选中即复制，在iterm2中选中内容就已经复制到了剪切板</li>
<li>⌘ + f 查找内容</li>
<li>⌘ + d 横着分屏 ／ ⌘ + [shift] + d 竖着分屏</li>
<li>⌘ + r 清屏</li>
<li>[ctrl] + u 清空当前行。</li>
<li>[ctrl] + a 跳到行首，[ctrl] + e 跳到行尾，</li>
<li>⌘ + ; 补全命令</li>
<li>⌘ + shift ＋ h 列出剪切版历史</li>
</ol>
]]></content>
      <categories>
        <category>os</category>
      </categories>
  </entry>
  <entry>
    <title>curl 命令发送请求 demo</title>
    <url>/2016/12/24/os/curl-demo/</url>
    <content><![CDATA[<h2 id="获取页面信息"><a href="#获取页面信息" class="headerlink" title="获取页面信息"></a>获取页面信息</h2><p>以下为最简单的用法，获取百度首页的HTML文本。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl http://www.baidu.com</span><br></pre></td></tr></table></figure>

<p>如果希望只获取http请求头，则加上-I参数</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -I http://www.baidu.com</span><br></pre></td></tr></table></figure>

<h2 id="表单提交"><a href="#表单提交" class="headerlink" title="表单提交"></a>表单提交</h2><p>get请求表单</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl &quot;www.hotmail.com/when/junk.cgi?birthyear=1905&amp;press=OK&quot;</span><br></pre></td></tr></table></figure>

<p>post请求表单</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl -d &quot;birthyear=1905&amp;press=OK&quot; www.hotmail.com/when/junk.cgi</span><br></pre></td></tr></table></figure>

<h2 id="伪装浏览器"><a href="#伪装浏览器" class="headerlink" title="伪装浏览器"></a>伪装浏览器</h2><p>这个指令表示curl伪装成了IE5.0，用户平台是Windows 2000。（对方服务器是根据这个字串来判断客户端的类型的，所以即使使用AIX也无所谓）。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -A <span class="string">"Mozilla/4.0 (compatible; MSIE 5.01; Windows NT 5.0)"</span> URL</span><br></pre></td></tr></table></figure>


<h2 id="COOKIES"><a href="#COOKIES" class="headerlink" title="COOKIES"></a>COOKIES</h2><p>Cookie是服务器经常使用的一种记忆客户信息的方法。如果cookie被记录在了文件中，那么使用命令：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl -b stored_cookies_in_file www.cookiesite. com</span><br></pre></td></tr></table></figure>

<p>curl可以根据旧的cookie写出新cookie并发送到网站：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl -b cookies.txt -c newcookies.txt www.cookiesite. com</span><br></pre></td></tr></table></figure>

<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><p><a href="http://www.cnblogs.com/wangkangluo1/archive/2012/04/17/2453975.html" target="_blank" rel="noopener">http://www.cnblogs.com/wangkangluo1/archive/2012/04/17/2453975.html</a></p>
</li>
<li><p><a href="http://baike.baidu.com/link?url=niOv_Cyct_R7JTlgWEDykywJs4ieAVFKcDyXeHPPYEntIPof-8NqDtG8UxEYAIZDFkEH9nmwwWdGx7a41o9AWa" target="_blank" rel="noopener">http://baike.baidu.com/link?url=niOv_Cyct_R7JTlgWEDykywJs4ieAVFKcDyXeHPPYEntIPof-8NqDtG8UxEYAIZDFkEH9nmwwWdGx7a41o9AWa</a></p>
</li>
</ul>
]]></content>
      <categories>
        <category>os</category>
      </categories>
  </entry>
  <entry>
    <title>mac快捷键及查看端口关闭程序</title>
    <url>/2016/12/24/os/mac-short-cut-key/</url>
    <content><![CDATA[<h2 id="快捷键"><a href="#快捷键" class="headerlink" title="快捷键"></a>快捷键</h2><ul>
<li>查看桌面 F11</li>
<li>HOME Command + &lt;-</li>
<li>END Command + -&gt;</li>
<li>锁屏 Shift + Control + 电源键 （Windows 下为Win+L）</li>
<li>强制关闭程序 Command + Option + esc（Windows 下为Ctrl+Alt+Delete）</li>
<li>shift + command + control + 4</li>
</ul>
<h2 id="查看端口"><a href="#查看端口" class="headerlink" title="查看端口"></a>查看端口</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">lsof -i tcp:&lt;port&gt;</span><br></pre></td></tr></table></figure>

<p>其中<port>需要替换成想要观察的端口，可以查看该端口被什么程序所使用。</p>
<h2 id="退出程序"><a href="#退出程序" class="headerlink" title="退出程序"></a>退出程序</h2><p>跟据上面查看端口获取到进程的pid</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">kill -9 &lt;pid&gt;</span><br></pre></td></tr></table></figure>

<p>这样就关闭了此程序</p>
<h2 id="调出Activity-Monitor-进程监视器"><a href="#调出Activity-Monitor-进程监视器" class="headerlink" title="调出Activity Monitor(进程监视器)"></a>调出Activity Monitor(进程监视器)</h2><p>按下快捷键：Command+Option+Esc打开“强制退出应用程序”的窗口，然后选中需要退出的程序，再点右下方的“强制退出”即可。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://gold.xitu.io/post/586a303f8d6d810063e3ac0e" target="_blank" rel="noopener">https://gold.xitu.io/post/586a303f8d6d810063e3ac0e</a></p>
]]></content>
      <categories>
        <category>os</category>
      </categories>
  </entry>
  <entry>
    <title>介绍 Mac 系统中各个文件夹</title>
    <url>/2016/12/24/os/mac-sys-file/</url>
    <content><![CDATA[<p>Applications：这个当然就是存放各种软件的位置了。 </p>
<p>System:包含由Apple安装的系统软件。这此资源是系统正常运行所必须的，位于启动卷宗中 </p>
<p>Library：系统资源库。<br>比如字体、ColorSync 配置、偏好设置以及插件都应该安装在 Library 目录下适当的子目录中。</p>
<p>User：包含了某个用户专有的资源。这里也有一个Library文件夹，不同与上边的那个Library，是专为你的帐号服务，里面放的是你自己的个性化字体、配置文件等 </p>
<p>bin：储存有基本的UNIX指令 </p>
<p>sbin：UNIX 系统指令的储存地方, 是比较进阶的指令 </p>
<p>etc：系统设定档桉储存地方 </p>
<p>var：改动频繁的档桉, 都置放于此, 例如各log档桉 </p>
<p>tmp：系统的暂存档 </p>
<p>usr：UNIX的使用者专用档桉夹 </p>
<p><a href="http://www.jb51.net/os/MAC/130901.html" target="_blank" rel="noopener">原文参照</a></p>
]]></content>
      <categories>
        <category>os</category>
      </categories>
  </entry>
  <entry>
    <title>Mac 模拟 tree 命令</title>
    <url>/2016/12/24/os/mac-tree/</url>
    <content><![CDATA[<h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2><p>看到 github 上梳理 vue 项目文件结构时能输出下面的文件树形式，让我感觉很棒。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">├── Makefile</span><br><span class="line">├── README.md</span><br><span class="line">├── build</span><br><span class="line">│   ├── build-prompt.js</span><br><span class="line">│   ├── build.js</span><br><span class="line">│   ├── check-versions.js</span><br><span class="line">│   ├── dev-client.js</span><br><span class="line">│   ├── dev-server.js</span><br><span class="line">│   ├── publish-prompt.js</span><br><span class="line">│   ├── rollback.js</span><br><span class="line">│   ├── tag.js</span><br><span class="line">│   ├── utils.js</span><br><span class="line">│   ├── vue-loader.conf.js</span><br><span class="line">│   ├── webpack.base.conf.js</span><br><span class="line">│   ├── webpack.build.conf.js</span><br><span class="line">│   ├── webpack.dev.conf.js</span><br><span class="line">│   └── webpack.test.conf.js</span><br><span class="line">├── config</span><br><span class="line">│   ├── common.env.js</span><br><span class="line">│   ├── dev.env.js</span><br><span class="line">│   ├── index.js</span><br><span class="line">│   ├── local.env.js</span><br><span class="line">│   ├── prepub.env.js</span><br><span class="line">│   ├── prod.env.js</span><br><span class="line">│   ├── project.config.js</span><br><span class="line">│   └── test.env.js</span><br><span class="line">├── index.html</span><br><span class="line">├── package-lock.json</span><br><span class="line">├── package.json</span><br><span class="line">└── src</span><br><span class="line">    ├── api</span><br><span class="line">    ├── assets</span><br><span class="line">    ├── components</span><br><span class="line">    ├── dictionary</span><br><span class="line">    ├── directives</span><br><span class="line">    ├── pages</span><br><span class="line">    ├── utils</span><br><span class="line">    └── vuex</span><br></pre></td></tr></table></figure>

<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>直接使用 tree 命令 </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">brew install tree</span><br><span class="line"></span><br><span class="line"># 只输出两层并且忽略 node_modules 和 dist 文件夹</span><br><span class="line">tree -L 2 -I &apos;node_modules|dist&apos;</span><br></pre></td></tr></table></figure>

<p>若 brew 安装不了tree，笔者也曾经卡了好久安装不上，还可以用 find 命令去模拟出 tree 命令的效果</p>
<p>打印所有层级</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find . -<span class="built_in">print</span> | sed -e <span class="string">'s;[^/]*/;|____;g;s;____|; |;g'</span></span><br></pre></td></tr></table></figure>

<p>当然你也可以选择忽略 node_modules 文件并可以指定输出层级。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find . -path  <span class="string">"*/node_modules"</span> -prune -o -depth 2 -<span class="built_in">print</span> | sed -e <span class="string">'s;[^/]*/;|____;g;s;____|; |;g'</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>os</category>
      </categories>
  </entry>
  <entry>
    <title>vim基本操作</title>
    <url>/2016/12/24/os/vim-base-opt/</url>
    <content><![CDATA[<h2 id="从命令模式切换到文本输入模式："><a href="#从命令模式切换到文本输入模式：" class="headerlink" title="从命令模式切换到文本输入模式："></a>从命令模式切换到文本输入模式：</h2><ul>
<li>i 在光标左侧输入文本</li>
</ul>
<h2 id="文本修改键，只适用于命令模式："><a href="#文本修改键，只适用于命令模式：" class="headerlink" title="文本修改键，只适用于命令模式："></a>文本修改键，只适用于命令模式：</h2><ul>
<li>x 删除光标位置指定的字符</li>
<li>dd 删除光标所在的行</li>
<li>yy 复制光标所在行，再使用p命令，粘贴复制之处到光标所在行。</li>
<li>u 撤销最近的修改</li>
<li>r 替换光标位置上的一个字符</li>
<li>. 重复上一次的修改</li>
</ul>
<h2 id="光标移动，只适用于命令模式"><a href="#光标移动，只适用于命令模式" class="headerlink" title="光标移动，只适用于命令模式"></a>光标移动，只适用于命令模式</h2><ul>
<li>↑ 将光标向上移动一行</li>
<li>→或[space] 将光标向右移动一位</li>
<li>↓ 将光标向下移动一行</li>
<li>←或[backspace] 将光标向左移动一位</li>
<li>$ 将光标移动到当前行的行尾</li>
<li>^ 将光标移动到当前行的行首</li>
<li>w 将光标向右移动一个词组，到下一个词组的开头</li>
<li>b 将光标向左移动一个词组，到前一个词组的开头</li>
<li>e 将光标移到词组尾部。</li>
<li>[Enter] 将光标移到下一行的行首</li>
<li>[ctrl] + u 屏幕往后移动半页</li>
<li>[ctrl] + d 屏幕往前移动半页</li>
</ul>
<h2 id="退出命令，除了ZZ命令外，其他的都以”-”开始，用-Enter-结束命令行"><a href="#退出命令，除了ZZ命令外，其他的都以”-”开始，用-Enter-结束命令行" class="headerlink" title="退出命令，除了ZZ命令外，其他的都以”:”开始，用[Enter]结束命令行"></a>退出命令，除了ZZ命令外，其他的都以”:”开始，用[Enter]结束命令行</h2><ul>
<li>wq 保存文件，退出编辑器</li>
<li>w 保存文件，不退出编辑器</li>
<li>q 退出编辑器</li>
<li>q! 不保存文件，退出编辑器</li>
<li>ZZ 保存文件，退出编辑器</li>
</ul>
<h2 id="搜索命令，命令模式中使用"><a href="#搜索命令，命令模式中使用" class="headerlink" title="搜索命令，命令模式中使用"></a>搜索命令，命令模式中使用</h2><ul>
<li>? 向前搜索指定字符串，搜索到后按n寻找下一个。</li>
<li>/ 向后搜索指定字符串，搜索到后按n寻找下一个。</li>
</ul>
<h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><p>在vim里可用:help [命令]来查询在线帮助，以上命令在vi中同样可用。</p>
]]></content>
      <categories>
        <category>os</category>
      </categories>
  </entry>
  <entry>
    <title>git 提交到多个远程仓库</title>
    <url>/2016/12/24/source-control/git-multi-remote/</url>
    <content><![CDATA[<h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p>假设我有两个仓库：</p>
<p><a href="mailto:git@github.com" target="_blank" rel="noopener">git@github.com</a>:everlose/CSS3Practice.git</p>
<p><a href="mailto:git@gitlab.com" target="_blank" rel="noopener">git@gitlab.com</a>:everlose/CSS3Practice.git</p>
<p>我希望能再一份本地的工程里push代码能同步到两个仓库里。</p>
<p>如果说push代码的指令如这般：<code>git push all -all</code></p>
<h2 id="命令行操作"><a href="#命令行操作" class="headerlink" title="命令行操作"></a>命令行操作</h2><p>输入：<code>git remote add all git@gitlab.com:everlose/CSS3Practice.git</code></p>
<p>输入：<code>git remote set-url --add all git@github.com:everlose/CSS3Practice.git</code></p>
<p>提交的时候只要输入：<code>git push all -all</code>。就可以生效。结果如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[core]</span><br><span class="line">Saving password to keychain failed</span><br><span class="line">Identity added: /Users/everlose/.ssh/id_rsa (/Users/everlose/.ssh/id_rsa)</span><br><span class="line">Counting objects: 3, <span class="keyword">done</span>.</span><br><span class="line">Delta compression using up to 4 threads.</span><br><span class="line">[core]</span><br><span class="line">Compressing objects: 100% (3/3), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (3/3), 306 bytes | 0 bytes/s, <span class="keyword">done</span>.</span><br><span class="line">Total 3 (delta 2), reused 0 (delta 0)</span><br><span class="line">To git@gitlab.com:everlose/FEDPractice.git</span><br><span class="line">   643bfce..e0fd8f3  master -&gt; master</span><br><span class="line">Branch master <span class="built_in">set</span> up to track remote branch master from all.</span><br><span class="line">[core]</span><br><span class="line">Warning: Permanently added the RSA host key <span class="keyword">for</span> IP address <span class="string">'192.30.252.120'</span> to the list of known hosts.</span><br><span class="line">Counting objects: 3, <span class="keyword">done</span>.</span><br><span class="line">Delta compression using up to 4 threads.</span><br><span class="line">Compressing objects: 100% (3/3), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (3/3), 306 bytes | 0 bytes/s, <span class="keyword">done</span>.</span><br><span class="line">Total 3 (delta 2), reused 0 (delta 0)</span><br><span class="line">To git@github.com:everlose/FEDPractice.git</span><br><span class="line">   643bfce..e0fd8f3  master -&gt; master</span><br><span class="line">Branch master <span class="built_in">set</span> up to track remote branch master from all.</span><br></pre></td></tr></table></figure>

<p>它的原理同下，都是修改了.git/config下的配置。</p>
<h2 id="直接配置-git-config文件"><a href="#直接配置-git-config文件" class="headerlink" title="直接配置.git/config文件"></a>直接配置.git/config文件</h2><p>进入项目的根目录，输入：vim .git/config。</p>
<p>添加如下一行的远程仓库配置，有多少个远程库,就配置多少个url即可。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[remote <span class="string">"all"</span>]  </span><br><span class="line">    url = git@gitlab.com:everlose/CSS3Practice.git </span><br><span class="line">    url = git@github.com:everlose/CSS3Practice.git</span><br></pre></td></tr></table></figure>

<p>提交的时候只要输入：<code>git push all -all</code>。就可以生效。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="http://blog.csdn.net/isea533/article/details/41382699" target="_blank" rel="noopener">csdn：isea533的博客</a></li>
<li><a href="http://stackoverflow.com/questions/5785549/able-to-push-to-all-git-remotes-with-the-one-command" target="_blank" rel="noopener">stackoverflow：Able to push to all git remotes with the one command?</a></li>
</ul>
]]></content>
      <categories>
        <category>source-control</category>
      </categories>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>git 删除所有历史 commit 记录</title>
    <url>/2016/12/24/source-control/git-remove-all-commit-history/</url>
    <content><![CDATA[<p>创建一个叫new_start的分支，改分支没有任何历史记录，但是所有文件都会原封不动的存在。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git checkout --orphan new_start</span><br></pre></td></tr></table></figure>

<p>然后重新开始提交</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git commit -m <span class="string">'新的纪录'</span></span><br><span class="line">git push origin new_start</span><br></pre></td></tr></table></figure>

<p>然后去github上项目主页面-进入项目主页面-右边导航setting-左边导航branches设置默认分支，最后去删除旧分支，并删除远程旧分支</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git branch -d master</span><br><span class="line">git push origin --delete master</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>source-control</category>
      </categories>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>git tag 基本操作</title>
    <url>/2016/12/24/source-control/git-tag-base/</url>
    <content><![CDATA[<h2 id="查看tag"><a href="#查看tag" class="headerlink" title="查看tag"></a>查看tag</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git tag <span class="comment"># 在控制台打印出当前仓库的所有标签</span></span><br><span class="line">git tag -l ‘v0.1.*’ <span class="comment"># 搜索符合模式的标签</span></span><br></pre></td></tr></table></figure>


<h2 id="查看标签信息"><a href="#查看标签信息" class="headerlink" title="查看标签信息"></a>查看标签信息</h2><p>用git show命令可以查看标签的版本信息：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git show v0.0.1</span><br></pre></td></tr></table></figure>

<h2 id="打标签"><a href="#打标签" class="headerlink" title="打标签"></a>打标签</h2><p>git标签分为两种类型：轻量标签和附注标签。轻量标签是指向提交对象的引用，附注标签则是仓库中的一个独立对象。建议使用附注标签。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 创建轻量标签</span></span><br><span class="line">$ git tag v0.0.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建附注标签</span></span><br><span class="line">$ git tag -a v0.0.1 -m “0.0.1版本”</span><br></pre></td></tr></table></figure>

<p>创建轻量标签不需要传递参数，直接指定标签名称即可。</p>
<p>创建附注标签时，参数a即annotated的缩写，指定标签类型，后附标签名。参数m指定标签说明，说明信息会保存在标签对象中。</p>
<h2 id="切换"><a href="#切换" class="headerlink" title="切换"></a>切换</h2><p>与切换分支命令相同，用<code>git checkout [tagname]</code></p>
<h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><p>误打或需要修改标签时，需要先将标签删除，再打新标签。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 删除标签</span></span><br><span class="line">git tag -d v0.0.1</span><br></pre></td></tr></table></figure>

<p>参数d即delete的缩写，意为删除其后指定的标签。</p>
<h2 id="发布"><a href="#发布" class="headerlink" title="发布"></a>发布</h2><p>通常的git push不会将标签对象提交到git服务器，我们需要进行显式的操作：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git push origin v0.0.1 <span class="comment"># 将v0.0.1标签提交到git服务器</span></span><br><span class="line">git push origin –-tags <span class="comment"># 将本地所有标签一次性提交到git服务器</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>source-control</category>
      </categories>
  </entry>
  <entry>
    <title>HTTP 首部字段一览</title>
    <url>/2016/12/24/tcp-http/http-header/</url>
    <content><![CDATA[<h2 id="http首部字段根据实际用途被分为4类"><a href="#http首部字段根据实际用途被分为4类" class="headerlink" title="http首部字段根据实际用途被分为4类"></a>http首部字段根据实际用途被分为4类</h2><h3 id="通用首部字段"><a href="#通用首部字段" class="headerlink" title="通用首部字段"></a>通用首部字段</h3><p>请求报文和响应报文两方都会使用的首部。</p>
<ul>
<li>Cache-Control 控制缓存的行为，例如<code>Cache-Control:private,max-age=0,no-cache</code>。<ul>
<li>Cache-Control: private 表示仅向特定用户返回响应。对于其他用户发送过来的请求则不会返回缓存。</li>
<li>Cache-Control: no-cache 强制向源服务器再次验证。</li>
<li>Cache-Control: max-age = [秒] 表示响应的最大Age值。</li>
</ul>
</li>
<li>Connection 逐跳首部、连接的管理<ul>
<li>Connection: keep-alive，建立持久连接</li>
<li>Connection: close，服务器欲断开连接</li>
</ul>
</li>
<li>Date 创建报文的日期时间，有以下两种格式<ul>
<li>Date:Tue, 05 Jul 2016 12:43:35 GMT</li>
<li>Date:Tue Jul 05 12:43:35  2016</li>
</ul>
</li>
<li>Pragma 报文指令<ul>
<li>Pragma: no-cache。客户端要求所有的中间服务器不返回缓存资源，这个字段只是为了兼容http/1.0版本的服务器，希望服务器不缓存的话，还会加上<code>Cache-Control: no-cache</code>，两个字段一起使用。</li>
</ul>
</li>
<li>Trailer 报文末端的首部一览<ul>
<li>Trailer: Expires，Trailer会事先说明在报文主体后纪录了哪些首部字段，用于HTTP/1.1版本分块传输编码时。</li>
</ul>
</li>
<li>Transfer-Encoding 指定报文主体的传输编码方式<ul>
<li>Transfer-Encoding: chunked。此传输编码方式仅用于分块传输编码时。</li>
</ul>
</li>
<li>Upgrade 升级为其他协议，用于检测HTTP或其他协议能否使用更高的版本进行通信。</li>
<li>Via 代理服务器的相关信息</li>
<li>Warning 错误通知</li>
</ul>
<h3 id="请求首部字段"><a href="#请求首部字段" class="headerlink" title="请求首部字段"></a>请求首部字段</h3><p>从客户端向服务器端发送请求报文时使用的首部，补充了请求的附加内容、客户端信息、响应内容相关优先级等信息。</p>
<ul>
<li>Accept 用户代理可处理的媒体类型<br>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,<em>/</em>;q=0.8。希望服务器返回的资源格式是html或xhtml+xml格式的，如果不能达成则可以返回任意格式。当服务器提供多种内容时，将会返回q（权重值，范围是0～1）最高的媒体类型。</li>
<li>Accept-Charset 优先的字符集<br>Accept-Charset: iso-8859-5, unicode-1-1;q=0.8。通知服务器用户所支持的字符集以及字符集的相对优先顺序，若一次性指定多种字符集，那么按权重q来表示优先级。</li>
<li>Accept-Encoding 优先的内容编码<br>Accept-Encoding:gzip, deflate, sdch。也可以使用星号作为通配符，指定任意的编码格式。</li>
<li>Accept-Language 优先的语言（自然语言）<br>Accept-Language:zh-CN,zh;q=0.8,en;q=0.6。告知服务器用户代理能处理的自然语言集，以及自然语言集的相对优先级。可一次指定多种自然语言集，按权重q来表示相对优先级，</li>
<li>Authorization 认证信息<br>Authorization: Basic dWVub3NlbjpwYXNzd29yZA==。告知服务器用户代理的认证信息（证书）。服务器会先发送401状态吗响应，客户端接收后把首部字段Authorization加入请求进行认证。</li>
<li>Expect 期待服务器的特定行为<br>Expect: 100-continue。告知服务器，期望出现的某种特定行为。因服务器无法理解客户端的期望作出回应而发生错误时，会返回状态码417 Expectation Failed。</li>
<li>From 用户的电子邮箱地址<br>From: <a href="mailto:xxxx@163.com" target="_blank" rel="noopener">xxxx@163.com</a>。告知服务器使用用户代理的用户的电子邮件地址。</li>
<li>Host 请求资源所在服务器<br>Host:shop.prepub.souche.com。告知服务器请求的资源所处的主机名和端口号。此请求头是HTTP/1.1规范里唯一一个必须存在请求内的。</li>
<li>If-Match 比较实体标记（ETag）<br>If-Match: “123456”。附带条件当此值与所请求资源的ETag（实体标记）值匹配一致时，服务器才会接收请求，反之服务器返回412 Precondition Failed。此值设为星号通配符则会被服务器忽略此附带条件。</li>
<li>If-Modified-Since 比较资源的更新时间<br>If-Modified-since: Tue, 05 Jul 2016 12:43:35 GMT。如果资源是在If-Modified-since字段指定的日期时间后发生了更新，则服务器接收此请求，否则返回304 Not Modified。</li>
<li>If-None-Match 比较实体标记（与If-Match相反）<br>与If-Match的作用相反。</li>
<li>If-Range 资源未更新时发送实体Byte的范围请求<br>首部字段If-Range属于附带条件之一。它告知服务器若指定的If-Range字段值（ETag值或者时间）和请求资源的ETag值或时间相一致时，则作为范围请求处理。反之，则返回全体资源。</li>
<li>If-Unmodified-Since 比较资源的更新时间（与If-Modified-Since”相反）</li>
<li>Max-Forwards 最大传输逐跳数<br>Max-Forwards: 2。请求往下可以转发两次，每转发一次Max-Forwards值减1，直到某台服务器接收到Max-Forwards为0的请求后返回响应。</li>
<li>Proxy-Authorization 代理服务器要求客户端的认证信息</li>
<li>Range 实体的字节范围请求</li>
<li>Referer 对请求中URI的原始获取方</li>
<li>TE 传输编码的优先级</li>
<li>User-Agent HTTP客户端程序的信息</li>
</ul>
<h3 id="响应首部字段。"><a href="#响应首部字段。" class="headerlink" title="响应首部字段。"></a>响应首部字段。</h3><p>从服务器端向客户端返回响应报文时使用的首部，补充了响应的附加内容，也会要求客户端附加额外的内容信息。</p>
<ul>
<li>Accept-Ranges 是否接受字节范围请求。当可处理范围请求时值为bytes，反之则指定其为none。</li>
<li>Age 推算资源创建经过时间</li>
<li>ETag 资源的匹配信息</li>
<li>Location 令客户端重定向至指定URI，该字段配合3xx的状态码响应，几乎所有的浏览器接收到包含首部字段的location响应后，都会强制性尝试对重定向资源的访问。</li>
<li>Proxy-Authenticate 代理服务器对客户端的认证信息</li>
<li>Retry-After 对再次发起请求的时机要求，主要配合503和3xx状态码，字段值可以是指定的具体日期时间，也可以是创建响应后的秒数。</li>
<li>Server  HTTP服务器的安装信息<br>Server：Apache/2.2.17(Unix) PHP/5.2.5。告知客户端当前服务器上安装的HTTP服务器应用程序的信息。</li>
<li>Vary 代理服务器缓存的管理信息</li>
<li>WWW-Authenticate 服务器对客户端的认证信息</li>
</ul>
<h3 id="实体首部字段。"><a href="#实体首部字段。" class="headerlink" title="实体首部字段。"></a>实体首部字段。</h3><p>针对请求报文和响应报文的实体部分使用的首部。补充了资源内容更新时间等与实体有关的信息。</p>
<ul>
<li>Allow 资源可支持的HTTP方法<br>Allow：GET，HEAD。</li>
<li>Content-Encoding 实体主体适用的编码方式<br>Content-Encoding：gzip。告知客户端，服务器会对实体的主体部分选用的内容编码方式。</li>
<li>Content-Language 实体主体的自然语言</li>
<li>Content-Length 实体主体的大小（单位：字节）</li>
<li>Content-Location 替代对应资源的URI</li>
<li>Content-MD5 一个由md5算法获得的128位二进制数，在通过base64编码。目的检查报文主题在传输过程中是否保持完整，以及确认传输到达。</li>
<li>Content-Range 实体主体的位置范围</li>
<li>Content-Type 实体主体的媒体类型<br>Content-Type: text/html; charset=UTF-8</li>
<li>Expires 实体主体过期的日期时间，控制资源缓存的时间。如果不希望缓存，最好在Expires字段内写入与首部字段Date相同的时间值。</li>
<li>Last-Modified 资源的最后修改日期时间</li>
</ul>
]]></content>
      <categories>
        <category>tcp-http</category>
      </categories>
  </entry>
  <entry>
    <title>http 请求状态码</title>
    <url>/2016/12/24/tcp-http/http-status-code/</url>
    <content><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>HTTP状态码负责表示客户端HTTP请求的返回结果、标记服务器端的处理是否正常、通知出现的错误等工作。让我们通过本章的学习，好好了解一下状态码的工作机制。</p>
<h3 id="1xx代表请求已接收，等待进一步处理"><a href="#1xx代表请求已接收，等待进一步处理" class="headerlink" title="1xx代表请求已接收，等待进一步处理"></a>1xx代表请求已接收，等待进一步处理</h3><h3 id="2xx代表请求已处理并返回"><a href="#2xx代表请求已处理并返回" class="headerlink" title="2xx代表请求已处理并返回"></a>2xx代表请求已处理并返回</h3><ul>
<li>200，ok，表示从客户端发来的请求在服务器端被正常处理了</li>
<li>204，no content，请求成功被处理不过没有返回信息，多用于客户端不需要更新的时候。</li>
<li>206，partial content，表示客户端对服务器端资源的某一部分进行请求，响应报文由Content-Range指定范围的实体内容。</li>
</ul>
<h3 id="3xx代表请求被转发"><a href="#3xx代表请求被转发" class="headerlink" title="3xx代表请求被转发"></a>3xx代表请求被转发</h3><ul>
<li>301，Moved Permanently，永久重定向,告诉客户端以后应从新地址访问. </li>
<li>302，Found，临时性重定向，302表示资源只是被临时移动了，已移动资源的URI将来仍可能被改动位置，PHP的默认Location重定向用的就是302。但是HTTP 1.1 有303 和307作为详细的补充,其实是对302的细化 </li>
<li>303，See Other，303与302的功能相同，只是303状态码明确表示客户端应当采用GET方法获取资源。 </li>
<li>304，Not Modified。该状态码表示客户端发送附带条件（附带条件的请求是指采用GET方法的请求报文中包含If-Match，If-Modified-Since，If-None-Match，If-Range，If-Unmodified-Since中任一首部）的请求时，服务器端允许请求访问资源，但未满足条件的情况。304状态码返回时，不包含任何响应的主体部分。304虽然被划分在3XX类别中，但是和重定向没有关系。</li>
<li>307，Temporary redirect，临时重定向，与302功能相同。307遵照浏览器标准不会从post换成get，但是对于处理响应时的行为，每种浏览器可能出现不同情况。</li>
</ul>
<h3 id="4xx代表客户端请求有语法错误或者无法实现"><a href="#4xx代表客户端请求有语法错误或者无法实现" class="headerlink" title="4xx代表客户端请求有语法错误或者无法实现"></a>4xx代表客户端请求有语法错误或者无法实现</h3><ul>
<li>400，Bad Request，请求报文有语法错误。</li>
<li>401，Unauthorized，客户端请求没有经过授权，用户认证失败。 </li>
<li>403，Forbidden，服务器端受到了请求但是拒绝提供服务，可能是未获得文件系统访问授权。 </li>
<li>404，Not Found，该状态码表明服务器上无法找到请求的资源。除此之外，也可以在服务器端拒绝请求且不想说明理由时使用。</li>
</ul>
<h3 id="5xx代表服务器端的错误"><a href="#5xx代表服务器端的错误" class="headerlink" title="5xx代表服务器端的错误"></a>5xx代表服务器端的错误</h3><ul>
<li>500，Internal Server Error，该状态码表明服务器端在执行请求时发生了错误。也有可能是Web应用存在的bug或某些临时的故障。</li>
<li>502，网关错误 (Bad gateway)。这个问题是由后端电脑之间不良的 IP 通讯造成的， 可能包括您正在尝试访问的网站的 Web 服务器。</li>
<li>503，Service unavailable，该状态码表明服务器暂时处于超负载或正在进行停机维护，现在无法处理请求。如果事先得知解除以上状况需要的时间，最好写入RetryAfter首部字段再返回给客户端。</li>
<li>504，Gateway Time-out，连接超时，服务器（不一定是web服务器）作为网关或代理，但没有及时从上游服务器收到请求。</li>
</ul>
]]></content>
      <categories>
        <category>tcp-http</category>
      </categories>
  </entry>
  <entry>
    <title>TCP-IP 网络模型的协议族简介</title>
    <url>/2016/12/24/tcp-http/tcp-ip-introduce/</url>
    <content><![CDATA[<h2 id="释义"><a href="#释义" class="headerlink" title="释义"></a>释义</h2><p>计算机网络设备需要进行通信，双方必须基于同样的方法，我们把这样的方法规则称为协议。而协议中存在各式各样的内容。从电缆的规格到IP地址的选定方法、寻找异地用户的方法、双方建立通信的顺序，以及Web页面显示需要处理的步骤，等等。像这样把与互联网相关联的协议集合起来总称为TCP/IP协议族。</p>
<h2 id="分层"><a href="#分层" class="headerlink" title="分层"></a>分层</h2><p>TCP/IP协议族按层次分别分为以下4层：应用层、传输层、网络层和数据链路层。</p>
<ol>
<li>最上面的就是应用层了。应用层决定了向用户提供应用服务时通信的活动。这里面有http、ftp、DNS等等我们熟悉的协议。</li>
<li>而第二层则是传输层。传输层对上层应用层，提供处于网络连接中的两台计算机之间的数据传输。著名的TCP和UDP协议就在这个层次。</li>
<li>第三层是网络层。网络层用来处理在网络上流动的数据包。IP协议就在这里，它负责对数据加上IP地址和其他的数据（后面会讲到）以确定传输的目标，网络层所起的作用就是在众多的传输线路内选择一条传输。</li>
<li>第四层是叫数据链路层，用来处理连接网络的硬件部分。这个层次为待传送的数据加入一个以太网协议头，并进行CRC编码，为最后的数据传输做准备。拥有ARP协议，RARP协议。</li>
</ol>
<h2 id="HTTP通信传输流"><a href="#HTTP通信传输流" class="headerlink" title="HTTP通信传输流"></a>HTTP通信传输流</h2><ul>
<li>首先作为发送端的客户端在应用层（HTTP协议）发出一个想看某个Web页面的HTTP请求。</li>
<li>接着，为了传输方便，在传输层（TCP协议）把从应用层处收到的数据（HTTP请求报文）进行分割，并在各个报文上打上标记序号及端口号后转发给网络层。</li>
<li>在网络层（IP协议），增加作为通信目的地的MAC地址后转发给链路层。这样一来，发往网络的通信请求就准备齐全了。</li>
<li>接收端的服务器在链路层接收到数据，按序往上层发送，一直到应用层。当传输到应用层，才能算真正接收到由客户端发送过来的HTTP请求</li>
</ul>
]]></content>
      <categories>
        <category>tcp-http</category>
      </categories>
  </entry>
  <entry>
    <title>TCP 三次握手过程</title>
    <url>/2016/12/24/tcp-http/tcp-three-way-handshake/</url>
    <content><![CDATA[<h2 id="TCP-简述"><a href="#TCP-简述" class="headerlink" title="TCP 简述"></a>TCP 简述</h2><p>按层次分，TCP位于传输层，提供可靠的字节流服务。所谓的字节流服务（ByteStreamService）是指，为了方便传输，将大块数据分割成以报文段（segment）为单位的数据包进行管理。而可靠传输服务是指，能够把数据准确可靠地传给对方。一言以蔽之，TCP协议为了更容易传送大数据才把数据分割，而且TCP协议能够确认数据最终是否送达到对方。</p>
<h2 id="三次握手的过程"><a href="#三次握手的过程" class="headerlink" title="三次握手的过程"></a>三次握手的过程</h2><p>为了准确无误的将数据送达目标处，TCP协议采用了三次握手的策略。</p>
<ul>
<li>第一次握手：建立连接时, 客户端发送syn包(syn=j)到服务器, 并进入SYN_SEND状态, 等待服务器确认； SYN是同步序列编号(Synchronize Sequence Numbers)</li>
<li>第二次握手：服务器收到syn包, 必须确认客户的SYN（ack=j+1）, 同时自己也发送一个 SYN 包（syn=k）,即 SYN+ACK 包,此时服务器进入 SYN_RECV 状态；</li>
<li>第三次握手：客户端收到服务器的 SYN＋ACK 包,向服务器发送确认包 ACK(ack=k+1), 此包发送完毕, 客户端和服务器进入ESTABLISHED状态, 完成三次握手.</li>
<li>完成三次握手,客户端与服务器开始传送数据 </li>
</ul>
<p><img src="http://7xn4mw.com1.z0.glb.clouddn.com/18-8-3/10372502.jpg" alt=""></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>摘选自《图解http》</p>
]]></content>
      <categories>
        <category>tcp-http</category>
      </categories>
  </entry>
  <entry>
    <title>访问站点流程</title>
    <url>/2016/12/24/tcp-http/visit-site-flow/</url>
    <content><![CDATA[<h2 id="第一步，执行dns解析"><a href="#第一步，执行dns解析" class="headerlink" title="第一步，执行dns解析"></a>第一步，执行dns解析</h2><ol>
<li>去chrome浏览器缓存去寻找dns所对应的ip。查看dns：chrome://net-internals/#dns 。</li>
<li>去操作系统缓存里寻找ip</li>
<li>去本机hosts文件里寻找ip</li>
</ol>
<h2 id="第二步，询问宽带运营商"><a href="#第二步，询问宽带运营商" class="headerlink" title="第二步，询问宽带运营商"></a>第二步，询问宽带运营商</h2><p>如果前三步都获取不到的时候，进入第二步，浏览器去请求宽带运营商提供的dns解析请求。</p>
<h2 id="第三步，准备发送"><a href="#第三步，准备发送" class="headerlink" title="第三步，准备发送"></a>第三步，准备发送</h2><p>拿到目标ip后，浏览器某端口发起的HTTP报文经过在传输层（TCP协议）对收到的数据（HTTP请求报文）进行分割，并在各个报文上打上标记序号及端口号后转发给网络层。在网络层（IP协议），增加作为通信目的地的MAC地址后转发给链路层。这样一来，发往网络的通信请求就准备齐全了。</p>
<h2 id="第四步，发起请求"><a href="#第四步，发起请求" class="headerlink" title="第四步，发起请求"></a>第四步，发起请求</h2><p>浏览器某端口发起的tcp请求经过层层路由最后到服务器端的网卡，服务器端链路层收到数据后，按照链路层一直到应用层顺序往上发送。当到了应用层的时候才算建立了链接，真正收到了客户端发送过来的HTTP请求。</p>
<h2 id="第五步，浏览器解析"><a href="#第五步，浏览器解析" class="headerlink" title="第五步，浏览器解析"></a>第五步，浏览器解析</h2><p>浏览器接收到服务器传回的报文，通常是一个html的文本，开始解析其 html。</p>
<ul>
<li>浏览器并行发起请求去获取 html 所需要的其他静态资源，</li>
<li>并逐行读取 html 标签。</li>
<li>标签和样式一起构成 CSSOM 对象</li>
<li>layout 计算每个元素在页面中的位置</li>
<li>painting 利用 GPU 完成渲染</li>
</ul>
<p>中间如果读取到 js 或者其他 css 浏览器都将暂停读取 html，而开始执行并重复上面 3 到 5 的步骤。</p>
<p>到此，你的浏览器就正确的渲染出了页面。</p>
]]></content>
      <categories>
        <category>tcp-http</category>
      </categories>
  </entry>
  <entry>
    <title>BFC块级格式上下文简介</title>
    <url>/2016/12/08/css/css-bfc/</url>
    <content><![CDATA[<p>块级格式上下文（Block formatting context）</p>
<h2 id="普通流-Normal-Flow"><a href="#普通流-Normal-Flow" class="headerlink" title="普通流(Normal Flow)"></a>普通流(Normal Flow)</h2><p>在普通流中，元素按照其在 HTML 中的先后位置至上而下布局，在这个过程中，行内元素水平排列，直到当行被占满然后换行，块级元素则会被渲染为完整的一个新行， 除非另外指定，否则所有元素默认都是普通流定位，也可以说，普通流中元素的位置由该元素在 HTML 文档中的位置决定。</p>
<h2 id="浮动-Floats"><a href="#浮动-Floats" class="headerlink" title="浮动 (Floats)"></a>浮动 (Floats)</h2><p>在浮动布局中，元素首先按照普通流的位置出现，然后根据浮动的方向尽可能的向左边或右边偏移，其效果与印刷排版中的文本环绕相似。</p>
<h2 id="绝对定位-Absolute-Positioning"><a href="#绝对定位-Absolute-Positioning" class="headerlink" title="绝对定位 (Absolute Positioning)"></a>绝对定位 (Absolute Positioning)</h2><p>在绝对定位布局中，元素会整体脱离普通流，因此绝对定位元素不会对其兄弟元素造成影响（如果看了上文的童鞋，会发现这点与浮动元素会影响兄弟元素是不同的），而元素具体的位置由绝对定位的坐标决定。 </p>
<p>BFC 正是属于普通流的，因此它对兄弟元素也不会造成什么影响。</p>
<h2 id="什么是BFC"><a href="#什么是BFC" class="headerlink" title="什么是BFC?"></a>什么是BFC?</h2><p>块格式化上下文（block formatting context） 是页面 CSS视觉渲染的一部分。它是用于决定块盒子的布局及浮动相互影响的一个区域。 – MDN 块格式上下文</p>
<p>我的理解是，BFC是一个环境，在这个环境中的元素不会影响到其他环境中的布局，也就是说，处于不同BFC中的元素是不会互相干扰的。</p>
<h2 id="BFC的触发条件"><a href="#BFC的触发条件" class="headerlink" title="BFC的触发条件"></a>BFC的触发条件</h2><ul>
<li>根元素或其它包含它的元素</li>
<li>浮动元素，float除none以外的值</li>
<li>绝对定位元素 (元素的 position 为 absolute 或 fixed)</li>
<li>display为以下其中之一的值：inline-block,table-cell,table-caption</li>
<li>overflow 的值不为 visible的元素</li>
<li>弹性盒子 flex boxes (元素的 display: flex 或 inline-flex)</li>
</ul>
<p>其中，最常见的就是overflow:hidden、float:left/right、position:absolute。也就是说，每次看到这些属性的时候，就代表了该元素以及创建了一个BFC了。</p>
<h2 id="BFC的特性"><a href="#BFC的特性" class="headerlink" title="BFC的特性"></a>BFC的特性</h2><ul>
<li>内部的盒会在垂直方向一个接一个排列（可以看作BFC中有一个的常规流）；</li>
<li>处于同一个BFC中的元素相互影响，可能会发生margin collapse；</li>
<li>每个元素的margin box的左边，与容器块border box的左边相接触(对于从左往右的格式化，否则相反)。即使存在浮动也是如此；</li>
<li>BFC就是页面上的一个隔离的独立容器，容器里面的子元素不会影响到外面的元素，反之亦然；</li>
<li>计算BFC的高度时，考虑BFC所包含的所有元素，连浮动元素也参与计算；</li>
<li>浮动盒区域不叠加到BFC上；</li>
</ul>
<h2 id="BFC有什么用？"><a href="#BFC有什么用？" class="headerlink" title="BFC有什么用？"></a>BFC有什么用？</h2><h3 id="阻止外边距折叠"><a href="#阻止外边距折叠" class="headerlink" title="阻止外边距折叠"></a>阻止外边距折叠</h3><p>两个相连的块级元素在垂直上的外边距会发生叠加，有些把这种情况看作是bug，但我觉得可能是出于段落排版的考虑，为了令行间距一致才有的这一特性。我们先来看看例子：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>first<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>second<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">*&#123;margin: 0px;padding: 0px&#125;</span><br><span class="line">p &#123;</span><br><span class="line">    color: red;</span><br><span class="line">    background: #eee;</span><br><span class="line">    width: 100px;</span><br><span class="line">    height: 100px;</span><br><span class="line">    line-height: 100px;</span><br><span class="line">    text-align: center;</span><br><span class="line">    margin: 10px;</span><br><span class="line">    border: solid 1px red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://7xn4mw.com1.z0.glb.clouddn.com/public/16-12-7/56454235.jpg" alt=""></p>
<p>从上面可以看出，我们给两个p元素都设置 margin，但中间的间距却发生了折叠。然后举个BFC的例子：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">.ele&#123;</span><br><span class="line">    overflow: hidden;</span><br><span class="line">    border: solid 1px red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"ele"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>first<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"ele"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>second<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="http://7xn4mw.com1.z0.glb.clouddn.com/public/16-12-7/85569112.jpg" alt=""></p>
<p>从上面可以看出，我们为每个div元素设置 overflow 的值为hidden，产生一个块级格式上下文，因为外边距不会相互重叠。</p>
<h3 id="BFC可以包含浮动的元素"><a href="#BFC可以包含浮动的元素" class="headerlink" title="BFC可以包含浮动的元素"></a>BFC可以包含浮动的元素</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span> = <span class="string">"box"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>= <span class="string">"floatL"</span>&gt;</span>float<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>= <span class="string">"floatL"</span>&gt;</span>float<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">br</span> <span class="attr">style</span>=<span class="string">"clear:both"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span> = <span class="string">"box BFC"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>= <span class="string">"floatL"</span>&gt;</span>float<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>= <span class="string">"floatL"</span>&gt;</span>float<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">*&#123;margin: 0px;padding: 0px&#125;</span><br><span class="line">.floatL&#123;</span><br><span class="line">    float: left;</span><br><span class="line">    width: 100px;</span><br><span class="line">    height: 100px;</span><br><span class="line">    background-color: red;</span><br><span class="line">    text-align: center;</span><br><span class="line">    line-height: 100px;</span><br><span class="line">&#125;</span><br><span class="line">.box&#123;</span><br><span class="line">    border: 1px solid red;</span><br><span class="line">    width: 300px;</span><br><span class="line">    margin: 100px;</span><br><span class="line">    padding: 20px;</span><br><span class="line">&#125;</span><br><span class="line">.BFC&#123;</span><br><span class="line">    overflow: hidden;</span><br><span class="line">    *zoom: 1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从运行结果可以看出，如果块级元素里面包含着浮动元素会发生高度塌陷，但是将它变成一个BFC后，BFC在计算高度时会自动将浮动元素计算在内。</p>
<h3 id="BFC可以阻止元素被浮动元素覆盖"><a href="#BFC可以阻止元素被浮动元素覆盖" class="headerlink" title="BFC可以阻止元素被浮动元素覆盖"></a>BFC可以阻止元素被浮动元素覆盖</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box1"</span>&gt;</span>box1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box2"</span>&gt;</span>box2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">*&#123;margin: 0px; padding: 0px&#125;</span><br><span class="line"> </span><br><span class="line">.box1&#123;</span><br><span class="line">    width: 100px;</span><br><span class="line">    height: 100px;</span><br><span class="line">    line-height: 100px;</span><br><span class="line">    text-align: center;</span><br><span class="line">    background-color: rgba(0, 0, 255, 0.5);</span><br><span class="line">    border: 1px solid #000;</span><br><span class="line">    float: left;</span><br><span class="line">&#125;</span><br><span class="line">.box2&#123;</span><br><span class="line">    width: 200px;</span><br><span class="line">    height: 200px;</span><br><span class="line">    line-height: 100px;</span><br><span class="line">    text-align: center;</span><br><span class="line">    background-color: rgba(255, 0, 0, 0.5);</span><br><span class="line">    border: 1px solid #000;</span><br><span class="line">    /* overflow: hidden; */</span><br><span class="line">    /* *zoom: 1; */</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从上面看出，当元素浮动后，会与后面的块级元素产生相互覆盖。那怎么解决这个问题，只要为后面的元素创建一个BFC。添加 overflow 属性到 box2 上。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">overflow</span>: <span class="selector-tag">hidden</span>;</span><br><span class="line">*<span class="selector-tag">zoom</span>: 1;</span><br></pre></td></tr></table></figure>

<p>这样子阻止了浮动元素重叠的问题。</p>
<h3 id="BFC与-hasLayout"><a href="#BFC与-hasLayout" class="headerlink" title="BFC与 hasLayout"></a>BFC与 hasLayout</h3><p>除了使用 overflow: hidden 触发 BFC 外，还使用了一个 *zomm: 1 的属性，这是 IEhack ，因为 IE6-7 并不支持 W3C 的 BFC ，而是使用私有属性 hasLayout 。从表现上来说， hasLayout 跟 BFC 很相似，只是 hasLayout 自身存在很多问题，导致了 IE6-7 中一系列的 bug 。触发 hasLayout 的条件与触发 BFC 有些相似，推荐为元素设置 IE 特有的 CSS 属性 zoom: 1 触发 hasLayout ， zoom 用于设置或检索元素的缩放比例，值为“1”即使用元素的实际尺寸，使用 zoom: 1 既可以触发 hasLayout 又不会对元素造成其他影响，相对来说会更为方便。</p>
<p>清除浮动</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">//利用伪元素清除浮动</span><br><span class="line"><span class="selector-class">.clearfix</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">     <span class="attribute">content</span>: <span class="string">"."</span>; </span><br><span class="line">     <span class="attribute">display</span>: block; </span><br><span class="line">     <span class="attribute">height</span>: <span class="number">0</span>; </span><br><span class="line">     <span class="attribute">visibility</span>: hidden; </span><br><span class="line">     <span class="attribute">clear</span>: both; </span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.clearfix</span> &#123; </span><br><span class="line">    *zoom: 1; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>css</category>
      </categories>
      <tags>
        <tag>css 2</tag>
      </tags>
  </entry>
  <entry>
    <title>css next</title>
    <url>/2016/12/07/css/css-next/</url>
    <content><![CDATA[<h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><p>记得大家以前说CSS比较鸡肋之处就是CSS不能像其它的语言具有变量之类的特性。不过值得庆幸的是，随着CSS处理器的使用频率越来越高，在CSS中也开始考虑添加CSS处理器的一些特性，最明显的就是CSS的变量，不过在规范中称之为CSS自定义属性。</p>
<p>兼容性：chrome 49+，FF 31+，safari 9.1+，android无，IOS 9.3+</p>
<p>demo</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 声明 */</span></span><br><span class="line"><span class="selector-pseudo">:root</span> &#123;</span><br><span class="line">    <span class="attribute">--color</span>: <span class="number">#0C3934</span>;</span><br><span class="line">    <span class="attribute">--bg</span>: <span class="number">#F8EBEE</span>;</span><br><span class="line">    <span class="attribute">--gutter</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">--columns</span>: <span class="number">12</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 调用 */</span></span><br><span class="line"><span class="selector-class">.child</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--color);</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">var</span>(--bg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="conditional"><a href="#conditional" class="headerlink" title="conditional"></a>conditional</h2><p>早期通过第三方 js 库 Modernizr 来完成检测是否支持 css 3 的一些特有属性，而现在 css 3 出了 @supports 条件判断规则，它充许我们可以根据浏览器对CSS特性的支持情况来定义不同的样式</p>
<p>兼容性：chrome 28+，ie无，FF 23+，android 4.4+，safari 9+，IOS 9.2+。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 如果支持 display: flex 属性的话 */</span></span><br><span class="line">@<span class="keyword">supports</span> (display: flex) &#123;</span><br><span class="line">    <span class="selector-tag">div</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>: flex;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>浏览器也可以调用 window.CSS.supports 来查看所支持的方法</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.CSS.supports(<span class="string">'display'</span>, <span class="string">'flex'</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h2 id="shape"><a href="#shape" class="headerlink" title="shape"></a>shape</h2><p>CSS Shapes使网页设计师能更好的实现自己的创意，除了简单的长方形和正方形，还可以实现任何几何图形布局。改规范提供了两个新的CSS属性：shape-outside和shape-margin。浏览器支持这些规范是有一定道理的，尽管这些属性目前仅可以在Chrome、Opera和Safari看到效果，而且还需要带上浏览器的私有属性-webkit,因此使用的是-webkit-shape-outside和-webkit-shape-margin。</p>
<p>shape-outside属性将使用内容能绕着不规则几何图形排列，不在是中规中距的矩形。最初也可以让内容在一个元素内呈现，比如几何图形是一个圆形，那么文本在这个圆形内呈现，文本也将呈现成一个圆圈形状。然而这效果已经推迟到CSS Shapes Level 2中实现。</p>
<p>兼容性：chrome 37+，ie无，FF无，android无，safari 7.1+要加-webkit-前缀，IOS 8+要加-webkit-前缀。一片惨淡。</p>
<h4 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h4><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.circle</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">250px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">250px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#40a977</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">float</span>: left;</span><br><span class="line">    <span class="attribute">-webkit-shape-outside</span>: <span class="built_in">circle</span>() margin-box;</span><br><span class="line">    <span class="attribute">shape-outside</span>: <span class="built_in">circle</span>() margin-box;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">30px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"clearfix"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"circle"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">"padding-top: 50px;"</span>&gt;</span>Atom<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>A hackable text editor for the 21st Century<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Atom is a text editor that's modern, approachable, yet hackable to the core—a tool you can customize to do anything but also use productively without ever touching a config file.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>Cross-platform editing<span class="tag">&lt;/<span class="name">strong</span>&gt;</span> Atom works across operating systems. You can use it on OS X, Windows, or Linux.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>Built-in package manager<span class="tag">&lt;/<span class="name">strong</span>&gt;</span> Search for and install new packages or start creating your own—all from within Atom.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="图形函数"><a href="#图形函数" class="headerlink" title="图形函数"></a>图形函数</h4><p>与clip-path一起使用，可以得到任何想要得到的图形。</p>
<ul>
<li>circle(r at x y)</li>
<li>ellipse()：顾名思义，这个函数将创建一个随圆形状。可以配置半径和移动圆心坐标。和circle()函数不一样，ellipse()函数可以接受两个半径，第一个是水平方向半径，第二个是垂直方向半径。因此可以这样ellipse(100px 180px at 10% 20%)创建一个椭圆</li>
<li>polygon()：这个函数功能更强大，能够创建更复杂的形状，比如三角形、六边形以及一些不规则的多边形。使用polygon()并不像使用circle()函数创建一个圆那么简单，但不需要过于担心，可以使用多边形转换器这样的工具可以很直观的创建出不规则的多边形形状</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="http://www.w3cplus.com/css3/how-to-use-css-shapes-in-your-web-design.html" target="_blank" rel="noopener">w3cplus</a><br><a href="http://www.w3cplus.com/css3/css3-supports.html" target="_blank" rel="noopener">CSS3条件判断——@supports</a></p>
]]></content>
      <categories>
        <category>css</category>
      </categories>
      <tags>
        <tag>css 3</tag>
      </tags>
  </entry>
  <entry>
    <title>css 命名空间</title>
    <url>/2016/12/07/css/css-namespace/</url>
    <content><![CDATA[<h2 id="常用css类名。"><a href="#常用css类名。" class="headerlink" title="常用css类名。"></a>常用css类名。</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">布局类：header, footer, container, main, content, aside, page, section</span><br><span class="line">包裹类：wrap, inner</span><br><span class="line">区块类：region, block, box</span><br><span class="line">结构类：hd, bd, ft, top, bottom, left, right, middle, col, row, grid, span</span><br><span class="line">列表类：list, item, field</span><br><span class="line">主次类：primary, secondary, sub, minor</span><br><span class="line">大小类：s, m, l, xl, large, small</span><br><span class="line">状态类：active, current, checked, hover, fail, success, warn, error, on, off</span><br><span class="line">导航类：nav, prev, next, breadcrumb, forward, back, indicator, paging, first, last</span><br><span class="line">交互类：tips, alert, modal, pop, panel, tabs, accordion, slide, scroll, overlay,</span><br><span class="line">星级类：rate, star</span><br><span class="line">分割类：group, seperate, divider</span><br><span class="line">等分类：full, half, third, quarter</span><br><span class="line">表格类：table, tr, td, cell, row</span><br><span class="line">图片类：img, thumbnail, original, album, gallery</span><br><span class="line">语言类：cn, en</span><br><span class="line">论坛类：forum, bbs, topic, post</span><br><span class="line">方向类：up, down, left, right</span><br><span class="line">其他语义类：btn, close, ok, cancel, switch; link, title, info, intro, more, icon; form, label, search, contact, phone, date, email, user; view, loading…</span><br></pre></td></tr></table></figure>

<h2 id="BEM"><a href="#BEM" class="headerlink" title="BEM"></a>BEM</h2><p>结合上面的常用类名，并使用BEM，中划线代表状态，下划线代表层级。</p>
<p>举个例子</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 第一级 */</span></span><br><span class="line"><span class="selector-class">.nav</span> &#123;&#125; <span class="comment">/* 表示导航 */</span></span><br><span class="line"><span class="selector-class">.nav--active</span> &#123;&#125; <span class="comment">/* 表示激活状态的nav导航 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 第二级 */</span></span><br><span class="line"><span class="selector-class">.nav__header</span> &#123;&#125; <span class="comment">/* 表示nav导航下的头部结构 */</span></span><br><span class="line"><span class="selector-class">.nav__header--current</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 第三级 */</span></span><br><span class="line"><span class="selector-class">.nav-header__item</span> &#123;&#125;</span><br><span class="line"><span class="selector-class">.nav</span> <span class="selector-tag">header__item</span> &#123;&#125; <span class="comment">/* 或 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 第四级 */</span></span><br><span class="line"><span class="selector-class">.nav-header-item__title</span> &#123;&#125;</span><br><span class="line"><span class="selector-class">.nav</span> <span class="selector-class">.header-item__title</span> &#123;&#125; <span class="comment">/* 或 */</span></span><br></pre></td></tr></table></figure>

<p>此真千变万化，BEM只是一种命名思路，上面的方法也只是变种，大家请因势利导吧。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="http://mp.weixin.qq.com/s?__biz=MzI3MDE0MzAzMw==&amp;mid=2652201884&amp;idx=1&amp;sn=15193ebd41d34cb093afdad3a85526e8&amp;scene=0#wechat_redirect" target="_blank" rel="noopener">http://mp.weixin.qq.com/s?__biz=MzI3MDE0MzAzMw==&amp;mid=2652201884&amp;idx=1&amp;sn=15193ebd41d34cb093afdad3a85526e8&amp;scene=0#wechat_redirect</a></p>
]]></content>
      <categories>
        <category>css</category>
      </categories>
      <tags>
        <tag>css 2</tag>
      </tags>
  </entry>
  <entry>
    <title>css3 scale缩放出现1px问题</title>
    <url>/2016/12/07/css/css3-scale-problem/</url>
    <content><![CDATA[<h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>先来一段html代码</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"parent"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"son"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.parent</span> &#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">16px</span> solid <span class="number">#392A72</span>;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#FFF</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">298px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">206px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.son</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">32px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#392A72</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此刻效果是正常的一倍效果</p>
<p><img src="http://img.souche.com/20170221/png/6afe850fcd59a1762bd8f3b7286f0307.png" alt=""></p>
<p>接着加入container缩放</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">scale</span>(0.7);</span><br><span class="line">    <span class="attribute">transform-origin</span>: <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>则会出现极细致的一条白色边，原因大概就是.parent元素的border和.son的height经过缩放后不会是整数，两个数值的小数点被省去不渲染，导致两者叠加起来和真正要的效果差1px，而让.parent的背景颜色出现。</p>
<p><img src="http://img.souche.com/20170221/png/5577c6cc50e8bba0b241401040b1c52d.png" alt=""></p>
<h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h2><p>不用scale，而用zoom就能解决</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">zoom</span>: <span class="number">0.7</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://img.souche.com/20170221/png/da1a77076e16dd676acc84d08667bcb5.png" alt=""></p>
<p>zoom 本是 ie 私有属性，专用于缩放，chrome也是支持的。zoom 和 css3 的 scale 最大的不同在于它是直接改变了缩放后的盒模型大小。在文档流中 zoom 加在任意一个元素上都会引起一整个页面的重新渲染，而 scale 只是在当前的元素上重绘，所以 zoom 只适合做一些静态元素的缩放。</p>
<p>此外firefox并不支持zoom属性。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://www.zhangxinxu.com/wordpress/2015/11/zoom-transform-scale-diff/" target="_blank" rel="noopener">https://www.zhangxinxu.com/wordpress/2015/11/zoom-transform-scale-diff/</a></p>
]]></content>
      <categories>
        <category>css</category>
      </categories>
      <tags>
        <tag>css 3</tag>
      </tags>
  </entry>
  <entry>
    <title>css 权重图</title>
    <url>/2016/12/07/css/style-weight/</url>
    <content><![CDATA[<p><img src="http://7xn4mw.com1.z0.glb.clouddn.com/public/16-11-21/46680269.jpg" alt=""></p>
<h2 id="原文"><a href="#原文" class="headerlink" title="原文"></a>原文</h2><p><a href="http://www.zhangxinxu.com/wordpress/2012/08/256-class-selector-beat-id-selector/" target="_blank" rel="noopener">http://www.zhangxinxu.com/wordpress/2012/08/256-class-selector-beat-id-selector/</a></p>
]]></content>
      <categories>
        <category>css</category>
      </categories>
      <tags>
        <tag>css 2</tag>
      </tags>
  </entry>
  <entry>
    <title>css3 background</title>
    <url>/2016/12/07/css/css3-background/</url>
    <content><![CDATA[<h2 id="background-color"><a href="#background-color" class="headerlink" title="background-color"></a>background-color</h2><ul>
<li>十六进制的方式#F32600</li>
<li>RGB的方式rgb(200,200,125)，css3扩展有RGBA格式的</li>
<li>hsl颜色，css3扩展，hsl(240,50%,20%);</li>
<li>transparent，透明</li>
</ul>
<h2 id="background-position"><a href="#background-position" class="headerlink" title="background-position"></a>background-position</h2><p>x 和 y 可以取如下</p>
<ul>
<li>top / left / center / bottom</li>
<li>百分值</li>
<li>px值</li>
</ul>
<h2 id="background-origin"><a href="#background-origin" class="headerlink" title="background-origin"></a>background-origin</h2><ul>
<li>border-box</li>
<li>padding-box</li>
<li>content-box</li>
</ul>
<h2 id="background-clip"><a href="#background-clip" class="headerlink" title="background-clip"></a>background-clip</h2><ul>
<li>border-box</li>
<li>padding-box</li>
<li>content-box</li>
</ul>
<h2 id="background-attachment"><a href="#background-attachment" class="headerlink" title="background-attachment"></a>background-attachment</h2><ul>
<li>scroll 默认值。背景图像会随着页面其余部分的滚动而移动。</li>
<li>fixed 当页面的其余部分滚动时，背景图像不会移动。</li>
<li>inherit 规定应该从父元素继承 background-attachment 属性的设置。ie 8不支持此属性值。</li>
</ul>
<h2 id="background-repeat"><a href="#background-repeat" class="headerlink" title="background-repeat"></a>background-repeat</h2><ul>
<li>repeat</li>
<li>no-repeat</li>
<li>repeat-x</li>
<li>repeat-y</li>
<li>space</li>
<li>around</li>
</ul>
<h2 id="background-size"><a href="#background-size" class="headerlink" title="background-size"></a>background-size</h2><ul>
<li>100%： 一个值的时候，其实就是把宽高都拉伸到相对于容器的宽度，简单来说，撑满了；</li>
<li>50%： 这个当然就是宽高都只有容器的一半（50%）的时候；</li>
<li>100% 50%： 这个呢就是宽度相对容器是100%的，而高度是50%；</li>
<li>auto ，默认</li>
<li>contain，等比缩放，以宽高中比较大的那个尺寸填充到容器中，但不一定会撑满容器，而出现背景图片显示不全的情况。比方说图片比较宽，那么以宽度铺满容器宽度，等比渲染其高度。</li>
<li>cover，等比缩放，以宽高中比较小的尺寸填充到容器中，一定会撑满容器，且可能会出现背景图片显示不全的情况。比方说图片比较宽，那么以图片高度铺满容器高度，等比渲染其宽度，所以容器一定被撑满。</li>
</ul>
<h2 id="简写模式"><a href="#简写模式" class="headerlink" title="简写模式"></a>简写模式</h2><p>多图片模式下的写法：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">background</span>: <span class="selector-tag">url</span>(<span class="selector-tag">a</span><span class="selector-class">.png</span>) <span class="selector-tag">top</span> <span class="selector-tag">left</span> <span class="selector-tag">no-repeat</span>,</span><br><span class="line">    url(b.png) center / 100% 100% no-repeat,</span><br><span class="line">    <span class="selector-tag">url</span>(<span class="selector-tag">c</span><span class="selector-class">.png</span>) <span class="selector-tag">white</span>;</span><br></pre></td></tr></table></figure>

<p>以前没有那么多新增属性的时候，简写就是：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">background</span>: <span class="selector-tag">url</span>(<span class="selector-tag">a</span><span class="selector-class">.png</span>) <span class="selector-tag">top</span> <span class="selector-tag">left</span> <span class="selector-tag">no-repeat</span> <span class="selector-tag">fixed</span> <span class="selector-id">#000</span>;</span><br></pre></td></tr></table></figure>

<p>后面多了css3后就应该是</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">background: url(a.png) top left / cover no-repeat fixed content-box content-box #000</span><br></pre></td></tr></table></figure>

<p>其格式就是：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">background: &lt;bg-image&gt; || &lt;position&gt; [ / &lt;bg-size&gt; ]? || &lt;repeat-style&gt; || &lt;attachment&gt; || &lt;box&gt; || &lt;box&gt; || &lt;'background-color'&gt;</span><br></pre></td></tr></table></figure>


<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://segmentfault.com/a/1190000002481921#articleHeader4" target="_blank" rel="noopener">https://segmentfault.com/a/1190000002481921#articleHeader4</a></p>
]]></content>
      <categories>
        <category>css</category>
      </categories>
      <tags>
        <tag>css 3</tag>
      </tags>
  </entry>
  <entry>
    <title>canvas 基本绘图接口</title>
    <url>/2016/12/07/canvas/canvas-base/</url>
    <content><![CDATA[<h2 id="canvas绘图基础–基本绘制接口"><a href="#canvas绘图基础–基本绘制接口" class="headerlink" title="canvas绘图基础–基本绘制接口"></a>canvas绘图基础–基本绘制接口</h2><h3 id="声明一块画布"><a href="#声明一块画布" class="headerlink" title="声明一块画布"></a>声明一块画布</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"canvas"</span> <span class="attr">width</span>=<span class="string">"600"</span> <span class="attr">style</span>=<span class="string">"border:1px solid #aaa; display:block"</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="用javascript在画布上进行绘制"><a href="#用javascript在画布上进行绘制" class="headerlink" title="用javascript在画布上进行绘制"></a>用javascript在画布上进行绘制</h3><p>初始化只需要2步操作：</p>
<ol>
<li>取出canvas标签 <code>var canvas = document.getElementById(&quot;canvas&quot;);</code></li>
<li>取得绘图的上下文环境，是绘制图画所需要的接口，该方法也可以用来判断浏览器是否支持canvas</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var context = canvas.getContext(&quot;2d&quot;);</span><br><span class="line">用js给画布设置高宽：</span><br><span class="line">canvas.width = 800;</span><br><span class="line">canvas.height = 600;</span><br></pre></td></tr></table></figure>

<h3 id="绘制直线"><a href="#绘制直线" class="headerlink" title="绘制直线"></a>绘制直线</h3><p>声明绘制开始：<code>context.beginPath()</code><br>起点（落笔）：<code>context.moveTo(x, y)</code><br>终点：<code>context.lineTo(x, y)</code><br>线条宽度：<code>context.lineWidth = 5</code><br>线条颜色：<code>context.lineStyle = &quot;#005588&quot;</code><br>连起来：<code>context.stroke()</code><br>声明绘制结束：<code>context.closePath()</code></p>
<h3 id="绘制弧线"><a href="#绘制弧线" class="headerlink" title="绘制弧线"></a>绘制弧线</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">context.arc(</span><br><span class="line">    centerx, centery,  radius,          <span class="comment">// 圆心坐标和半径</span></span><br><span class="line">    startingAngle, endingAngle,     <span class="comment">// 起点和终点的弧度值</span></span><br><span class="line">    anticlockwise                           <span class="comment">// 可选，已顺时针绘制还是逆时针，默认false顺时针</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>对startingAngle和endingAngle做下说明</p>
<h3 id="5-填充颜色"><a href="#5-填充颜色" class="headerlink" title="5.填充颜色"></a>5.填充颜色</h3><p>设置颜色：<code>context.fillStyle = &quot;#005588&quot;</code><br>用笔填充：<code>context.fill()</code></p>
<h2 id="canvas-资料"><a href="#canvas-资料" class="headerlink" title="canvas 资料"></a>canvas 资料</h2><p><a href="https://github.com/everlose/canvas-practice" target="_blank" rel="noopener">github demo</a></p>
<p><a href="http://www.w3cplus.com/canvas/introduction-to-prepare.html" target="_blank" rel="noopener">w3cplus-入门准备</a></p>
<p><a href="http://www.w3cplus.com/canvas/canvas-coordinate-system.html" target="_blank" rel="noopener">w3cplus-canvas坐标系统</a></p>
<p><a href="http://www.w3cplus.com/canvas/draw-lines.html" target="_blank" rel="noopener">w3cplus-绘制线段</a></p>
<p><a href="http://www.w3cplus.com/canvas/draw-dashed-and-dotted-lines.html" target="_blank" rel="noopener">w3cplus-绘制虚线和圆点线</a></p>
<p><a href="http://www.w3cplus.com/canvas/canvas-line-style.html" target="_blank" rel="noopener">w3cplus-线型</a></p>
<p><a href="http://www.w3cplus.com/canvas/canvas-states.html" target="_blank" rel="noopener">w3cplus-save()和restore()</a></p>
]]></content>
      <categories>
        <category>canvas</category>
      </categories>
      <tags>
        <tag>canvas</tag>
      </tags>
  </entry>
  <entry>
    <title>正则表达式速查表</title>
    <url>/2016/12/01/js-util/regexp/</url>
    <content><![CDATA[<h2 id="在线"><a href="#在线" class="headerlink" title="在线"></a>在线</h2><p>在线校验工具：<a href="http://regex.zjmainstay.cn/" target="_blank" rel="noopener">http://regex.zjmainstay.cn/</a></p>
<h2 id="速查表"><a href="#速查表" class="headerlink" title="速查表"></a>速查表</h2><p>原链接：<a href="http://www.jb51.net/shouce/jquery1.82/regexp.html" target="_blank" rel="noopener">http://www.jb51.net/shouce/jquery1.82/regexp.html</a></p>
<p>额。hexo貌似没法直观的解析表格中出现的 “|” 符号，所以还是以代码形式展现吧</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">| Char | Description |</span><br><span class="line">| - | - |</span><br><span class="line">| `\` | 将下一个字符标记为一个特殊字符、或一个原义字符、或一个向后引用、或一个八进制转义符。例如，`n`匹配字符`n`。`\n`匹配一个换行符。串行`\\`匹配`\`而`\(`则匹配`(`。</span><br><span class="line">| `^` | 匹配输入字符串的开始位置。如果设置了RegExp对象的Multiline属性，^也匹配`\n`或`\r`之后的位置。</span><br><span class="line">| `$` | 匹配输入字符串的结束位置。如果设置了RegExp对象的Multiline属性，$也匹配`\n`或`\r`之前的位置。</span><br><span class="line">| `*` | 匹配前面的子表达式零次或多次。例如，zo*能匹配`z`以及`zoo`。*等价于&#123;0,&#125;。</span><br><span class="line">| `+` | 匹配前面的子表达式一次或多次。例如，`zo+`能匹配`zo`以及`zoo`，但不能匹配`z`。+等价于&#123;1,&#125;。</span><br><span class="line">| `?` | 匹配前面的子表达式零次或一次。例如，`do(es)?`可以匹配`does`或`does`中的`do`。?等价于&#123;0,1&#125;。</span><br><span class="line">| `&#123;n&#125;` | n是一个非负整数。匹配确定的n次。例如，`o&#123;2&#125;`不能匹配`Bob`中的`o`，但是能匹配`food`中的两个o。</span><br><span class="line">| `&#123;n,&#125;` | n是一个非负整数。至少匹配n次。例如，`o&#123;2,&#125;`不能匹配`Bob`中的`o`，但能匹配`foooood`中的所有o。`o&#123;1,&#125;`等价于`o+`。`o&#123;0,&#125;`则等价于`o*`。</span><br><span class="line">| `&#123;n,m&#125;` | m和n均为非负整数，其中n&lt;=m。最少匹配n次且最多匹配m次。例如，`o&#123;1,3&#125;`将匹配`fooooood`中的前三个o。`o&#123;0,1&#125;`等价于`o?`。请注意在逗号和两个数之间不能有空格。</span><br><span class="line">| `?` | 当该字符紧跟在任何一个其他限制符（*,+,?，&#123;n&#125;，&#123;n,&#125;，&#123;n,m&#125;）后面时，匹配模式是非贪婪的。非贪婪模式尽可能少的匹配所搜索的字符串，而默认的贪婪模式则尽可能多的匹配所搜索的字符串。例如，对于字符串`oooo`，`o+?`将匹配单个`o`，而`o+`将匹配所有`o`。</span><br><span class="line">| `.` | 匹配除`\n`之外的任何单个字符。要匹配包括`\n`在内的任何字符，请使用像`[.\n]`的模式。</span><br><span class="line">| `(pattern)` | 匹配pattern并获取这一匹配。所获取的匹配可以从产生的Matches集合得到，在VBScript中使用SubMatches集合，在JScript中则使用$0…$9属性。要匹配圆括号字符，请使用`\(`或`\)`。</span><br><span class="line">| `(?:pattern)` | 匹配pattern但不获取匹配结果，也就是说这是一个非获取匹配，不进行存储供以后使用。这在使用或字符`(|)`来组合一个模式的各个部分是很有用。例如`industr(?:y|ies)`就是一个比`industry|industries`更简略的表达式。</span><br><span class="line">| `(?=pattern)` | 正向肯定预查，在任何匹配pattern的字符串开始处匹配查找字符串。这是一个非获取匹配，也就是说，该匹配不需要获取供以后使用。例如，`Windows(?=95|98|NT|2000)`能匹配`Windows2000`中的`Windows`，但不能匹配`Windows3.1`中的`Windows`。预查不消耗字符，也就是说，在一个匹配发生后，在最后一次匹配之后立即开始下一次匹配的搜索，而不是从包含预查的字符之后开始。</span><br><span class="line">| `(?!pattern)` | 正向否定预查，在任何不匹配pattern的字符串开始处匹配查找字符串。这是一个非获取匹配，也就是说，该匹配不需要获取供以后使用。例如`Windows(?!95|98|NT|2000)`能匹配`Windows3.1`中的`Windows`，但不能匹配`Windows2000`中的`Windows`。预查不消耗字符，也就是说，在一个匹配发生后，在最后一次匹配之后立即开始下一次匹配的搜索，而不是从包含预查的字符之后开始</span><br><span class="line">| `(?&lt;=pattern)` | 反向肯定预查，与正向肯定预查类拟，只是方向相反。例如，`(?&lt;=95|98|NT|2000)Windows`能匹配`2000Windows`中的`Windows`，但不能匹配`3.1Windows`中的`Windows`。</span><br><span class="line">| `(?&lt;!pattern)` | 反向否定预查，与正向否定预查类拟，只是方向相反。例如`(?&lt;!95|98|NT|2000)Windows`能匹配`3.1Windows`中的`Windows`，但不能匹配`2000Windows`中的`Windows`。</span><br><span class="line">| `x|y` | 匹配x或y。例如，`z|food`能匹配`z`或`food`。`(z|f)ood`则匹配`zood`或`food`。</span><br><span class="line">| `[xyz]` | 字符集合。匹配所包含的任意一个字符。例如，`[abc]`可以匹配`plain`中的`a`。</span><br><span class="line">| `[^xyz]` | 负值字符集合。匹配未包含的任意字符。例如，`[^abc]`可以匹配`plain`中的`p`。</span><br><span class="line">| `[a-z] ` | 字符范围。匹配指定范围内的任意字符。例如，`[a-z]`可以匹配`a`到`z`范围内的任意小写字母字符。</span><br><span class="line">| `[^a-z]` | 负值字符范围。匹配任何不在指定范围内的任意字符。例如，`[^a-z]`可以匹配任何不在`a`到`z`范围内的任意字符。</span><br><span class="line">| `\b` | 匹配一个单词边界，也就是指单词和空格间的位置。例如，`er\b`可以匹配`never`中的`er`，但不能匹配`verb`中的`er`。</span><br><span class="line">| `\B` | 匹配非单词边界。`er\B`能匹配`verb`中的`er`，但不能匹配`never`中的`er`。</span><br><span class="line">| `\c`x | 匹配由x指明的控制字符。例如，\cM匹配一个Control-M或回车符。x的值必须为A-Z或a-z之一。否则，将c视为一个原义的`c`字符。</span><br><span class="line">| `\d` | 匹配一个数字字符。等价于[0-9]。</span><br><span class="line">| `\D` | 匹配一个非数字字符。等价于[^0-9]。</span><br><span class="line">| `\f` | 匹配一个换页符。等价于\x0c和\cL。</span><br><span class="line">| `\n` | 匹配一个换行符。等价于\x0a和\cJ。</span><br><span class="line">| `\r` | 匹配一个回车符。等价于\x0d和\cM。</span><br><span class="line">| `\s` | 匹配任何空白字符，包括空格、制表符、换页符等等。等价于[ \f\n\r\t\v]。</span><br><span class="line">| `\S` | 匹配任何非空白字符。等价于[^ \f\n\r\t\v]。</span><br><span class="line">| `\t` | 匹配一个制表符。等价于\x09和\cI。</span><br><span class="line">| `\v` | 匹配一个垂直制表符。等价于\x0b和\cK。</span><br><span class="line">| `\w` | 匹配包括下划线的任何单词字符。等价于`[A-Za-z0-9_]`。</span><br><span class="line">| `\W` | 匹配任何非单词字符。等价于`[^A-Za-z0-9_]`。</span><br><span class="line">| `\xn` | 匹配n，其中n为十六进制转义值。十六进制转义值必须为确定的两个数字长。例如，`\x41`匹配`A`。`\x041`则等价于`\x04&amp;1`。正则表达式中可以使用ASCII编码。.</span><br><span class="line">| `\num` | 匹配num，其中num是一个正整数。对所获取的匹配的引用。例如，`(.)\1`匹配两个连续的相同字符。</span><br><span class="line">| `\n` | 标识一个八进制转义值或一个向后引用。如果\n之前至少n个获取的子表达式，则n为向后引用。否则，如果n为八进制数字（0-7），则n为一个八进制转义值。</span><br><span class="line">| `\nm` | 标识一个八进制转义值或一个向后引用。如果\nm之前至少有nm个获得子表达式，则nm为向后引用。如果\nm之前至少有n个获取，则n为一个后跟文字m的向后引用。如果前面的条件都不满足，若n和m均为八进制数字（0-7），则\nm将匹配八进制转义值nm。</span><br><span class="line">| `\nml` | 如果n为八进制数字（0-3），且m和l均为八进制数字（0-7），则匹配八进制转义值nml。</span><br><span class="line">| `\un` | 匹配n，其中n是一个用四个十六进制数字表示的Unicode字符。例如，\u00A9匹配版权符号（©）。</span><br></pre></td></tr></table></figure>

<h2 id="常用正则表达式"><a href="#常用正则表达式" class="headerlink" title="常用正则表达式"></a>常用正则表达式</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">| Desc | Rule |</span><br><span class="line">| - | - |</span><br><span class="line">| 非负整数 | `/^\d+$/`</span><br><span class="line">| 正整数 | `/^[1-9]\d*$/`</span><br><span class="line">| 浮点数 | `/^\d+(\.\d+)?$/`</span><br><span class="line">| 小数限制两位 | `/^\d+(\.\d&#123;1,2&#125;)?$/`</span><br><span class="line">| 车牌号 | `/^[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领A-Z]&#123;1&#125;[A-Z]&#123;1&#125;[A-Z0-9]&#123;4&#125;[A-Z0-9挂学警港澳]&#123;1&#125;$/`</span><br><span class="line">| 中文字符验证 | `/^([\u4E00-\u9FA5])+$/`</span><br><span class="line">| 身份证号 | `/^\d&#123;15&#125;|\d&#123;17&#125;([0-9]|X)$/`</span><br><span class="line">| 手机号 | `/^1[34578]\d&#123;9&#125;$/`</span><br><span class="line">| html标签 | `/&lt;\s*(\S+)(\s[^&gt;]*)?&gt;[\s\S]*&lt;\s*\/\1\s*&gt;/`</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>js-util</category>
      </categories>
  </entry>
  <entry>
    <title>css3 HSLA颜色的用法</title>
    <url>/2016/10/02/css/hsla-color/</url>
    <content><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>HSL色彩模式是工业界的一种颜色标准，是通过对色调(H)、饱和度(S)、亮度(L)三个颜色通道的变化以及它们相互之间的叠加来得到各式各样的颜色的，HSL即是代表色调，饱和度，亮度三个通道的颜色，这个标准几乎包括了人类视力所能感知的所有颜色，是目前运用最广的颜色系统之一。HSLA是在HSL的基础上增加一个透明度(A)的设置。</p>
<h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><p>hsla(length || percentage || percentage || opacity)</p>
<h2 id="取值"><a href="#取值" class="headerlink" title="取值"></a>取值</h2><p>length：Hue(色调)。0(或360)表示红色，120表示绿色，240表示蓝色，也可取其他数值来指定颜色。取值为：0 - 360。</p>
<p>percentage：Saturation(饱和度)。取值为：0.0% - 100.0%。饱和度是指色彩的鲜艳程度，也称色彩的纯度。饱和度取决于该色中含色成分和消色成分（灰色）的比例。含色成分越大，饱和度越大；消色成分越大，饱和度越小。饱和度为0％表示灰色。</p>
<p>percentage：Lightness(亮度)。取值为：0.0% - 100.0%。亮度0%就为黑，亮度最大100%则为白。</p>
<p>opacity：Alpha透明度。取值0~1之间。</p>
<h2 id="兼容性"><a href="#兼容性" class="headerlink" title="兼容性"></a>兼容性</h2><p>IE6～8不支持，其他的浏览器ok</p>
<h2 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h2><p>半透明效果，半透明于背景色，此处背景色为黑色，边框的半透明为灰色。</p>
<div class="wrap" style="width: 280px;height: 220px;background: black;"><div class="ct" style="width: 200px;height: 200px;background-color: yellowgreen;border: 10px solid hsla(0, 0%, 100%, .5);background-clip: padding-box;margin:0 auto;"></div></div>

<p>代码如下：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.wrap</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: black;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.wrap</span> <span class="selector-class">.content</span> &#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">10px</span> solid <span class="built_in">hsla</span>(0, 0%, 100%, .5);</span><br><span class="line">    <span class="attribute">background-color</span>: yellowgreen;</span><br><span class="line">    <span class="attribute">background-clip</span>: padding-box;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>css</category>
      </categories>
      <tags>
        <tag>css 3</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2016/10/02/other/hello-world/</url>
    <content><![CDATA[<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>
]]></content>
      <categories>
        <category>other</category>
      </categories>
  </entry>
  <entry>
    <title>H5手机端适配方案研究</title>
    <url>/2016/10/01/mobile-h5/h5-adaptation/</url>
    <content><![CDATA[<h2 id="基础概念"><a href="#基础概念" class="headerlink" title="基础概念"></a>基础概念</h2><h3 id="CSS像素-CSS-pixels"><a href="#CSS像素-CSS-pixels" class="headerlink" title="CSS像素(CSS pixels)"></a>CSS像素(CSS pixels)</h3><p>这个是浏览器使用的抽象单位，用来精确度量网页上的内容。平时经常写的width:100px;height:100px;都是与设备无关的。</p>
<h3 id="设备独立像素-device-independent-pixels-，也可以称为设备无关的逻辑像素"><a href="#设备独立像素-device-independent-pixels-，也可以称为设备无关的逻辑像素" class="headerlink" title="设备独立像素(device independent pixels)，也可以称为设备无关的逻辑像素"></a>设备独立像素(device independent pixels)，也可以称为设备无关的逻辑像素</h3><p>meta里面设置width=device-width，这个device-width就是设备独立像素</p>
<p><img src="http://img.souche.com/20161001/png/6685e4e1ed103709b09fb27dc6ef5faf.png" alt=""></p>
<p>在chrome里 看到的ip6为375x667，ip4为320x480等等都是设备独立像素，<code>它们在数值上与css数值是相等的</code>。而将meta里的viewport的initail-scale设置为1的意义就在于是css像素能与设备独立像素数值相等。</p>
<h3 id="设备像素-device-pixels-，也可以称为物理像素"><a href="#设备像素-device-pixels-，也可以称为物理像素" class="headerlink" title="设备像素(device pixels )，也可以称为物理像素"></a>设备像素(device pixels )，也可以称为物理像素</h3><p><code>是显示屏的最小物理单位</code>，每一像素都包含自己的颜色、亮度。像素是没有大小的、是一个抽象概念、是一个相对单位。 关于像素有一个常见的错误理解：认为像素是一个宽高相等的小方块，并且的像素都是“那么大”，但是不知道这个宽高的具体数字。</p>
<h3 id="分辨率"><a href="#分辨率" class="headerlink" title="分辨率"></a>分辨率</h3><p>泛指量测或显示系统对细节的分辨能力。以ip6手机屏幕为例，分辨率为750×1334，这是指屏幕纵向能显示1920个像素，横向能显示1080个像素</p>
<h3 id="设备像素比，也成dpr"><a href="#设备像素比，也成dpr" class="headerlink" title="设备像素比，也成dpr"></a>设备像素比，也成dpr</h3><p>设备像素比(简称dpr)定义了物理像素和设备独立像素的对应关系，它的值可以按如下的公式的得到：</p>
<p><code>设备像素比 = 物理像素 / 设备独立像素 // 在某一方向上，x方向或者y方向</code></p>
<h2 id="适配方案1"><a href="#适配方案1" class="headerlink" title="适配方案1"></a>适配方案1</h2><p>描述：如果使viewport的initail-scale为1，且给的是ip6尺寸宽度为750px的设计稿。</p>
<p>把chrome的控制台调到iPhone6，设备独立像素为375，设备像素比(dpr)为2，因此前端写元素时应该是<code>css写的尺寸(单位为px) ＝ 设计稿里的元素尺寸 ／ dpr</code>。</p>
<p>问题：如果设计稿中给的是某边框线是1px，那么按照上述规则，就得设置这个边框为0.5px，但是部分机型不会支持小数点的px尺寸。</p>
<p>为了得到极细致的真实1px单位的边框，衍生出了很多的解决办法，使用的比较多的有两种解决方案。其一为transform缩放，其二为动态viewport，不过第二种方法属于另一种适配方案。</p>
<h3 id="transfrom方案"><a href="#transfrom方案" class="headerlink" title="transfrom方案"></a>transfrom方案</h3><p>可以搭配伪元素来使用，如果只是为了得到底边的话，那么设置为高度1px，然后缩放y轴为0.5。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.scale</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.scale</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">""</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">0px</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0px</span>;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">0px</span>;</span><br><span class="line">    <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#ddd</span>;</span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">scaleY</span>(.5);</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">scaleY</span>(.5);</span><br><span class="line">    <span class="attribute">-webkit-transform-origin </span>:<span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">transform-origin </span>:<span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>如果需要设置四边的话，则这么设置</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.scale</span><span class="selector-pseudo">:after</span>&#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">""</span>;</span><br><span class="line">    <span class="attribute">pointer-events</span>: none; <span class="comment">/* 防止点击触发 */</span></span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">200%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">200%</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span><br><span class="line">    <span class="attribute">border</span>:<span class="number">1px</span> solid <span class="number">#999</span>;</span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">scale</span>(.5);</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">scale</span>(.5);</span><br><span class="line">    <span class="attribute">-webkit-transform-origin</span>: <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">transform-origin</span>: <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="适配方案2"><a href="#适配方案2" class="headerlink" title="适配方案2"></a>适配方案2</h2><p>采用动态viewport和rem的方式</p>
<p>源码看如下</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">;(<span class="function"><span class="keyword">function</span>(<span class="params">win</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> h;</span><br><span class="line">    <span class="keyword">var</span> dpr = win.navigator.appVersion.match(<span class="regexp">/iphone/gi</span>)?win.devicePixelRatio:<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">var</span> scale = <span class="number">1</span> / dpr;</span><br><span class="line">    <span class="keyword">var</span> docEl = <span class="built_in">document</span>.documentElement;</span><br><span class="line">    <span class="keyword">var</span> metaEl = <span class="built_in">document</span>.createElement(<span class="string">'meta'</span>);</span><br><span class="line">    win.dpr = dpr;</span><br><span class="line">    docEl.setAttribute(<span class="string">'data-dpr'</span>, dpr);</span><br><span class="line">    metaEl.setAttribute(<span class="string">'name'</span>, <span class="string">'viewport'</span>);</span><br><span class="line">    metaEl.setAttribute(<span class="string">'content'</span>, <span class="string">'initial-scale='</span> + scale + <span class="string">', maximum-scale='</span> + scale + <span class="string">', minimum-scale='</span> + scale + <span class="string">', user-scalable=no'</span>);</span><br><span class="line">    docEl.firstElementChild.appendChild(metaEl);</span><br><span class="line">    win.rem = docEl.getBoundingClientRect().width / <span class="number">16</span>;</span><br><span class="line">    docEl.style.fontSize = win.rem + <span class="string">'px'</span>;</span><br><span class="line">&#125;)(<span class="built_in">window</span>);</span><br></pre></td></tr></table></figure>

<p>基础思想就是设置根节点元素上得font-size，使之为十六分之一屏幕宽度(类似栅格系统，淘宝为1/10分屏宽，贝贝1/16屏宽)。在设置viewport为1/drp的值。</p>
<p>iPhone6计算出的根节点元素的font-size为<code>750px/16=46.876px</code>，那么跟着设计稿的尺寸，css单位应该这么写：<code>css写的尺寸(单位为rem) ＝ 设计稿里的元素尺寸 ／ 46.875</code>。这种方案，页面上使用了rem单位的元素在不同倍率手机下css尺寸都不同，例如在iphone5里，css尺寸就是<code>设计稿元素尺寸 / 46.875 * 40</code>。</p>
<p>然而事情还没有完，如果设计师希望能让大屏的情况显示更多的字，而非把字给这样放大了，那么字体则不能使用rem为单位。看下面的一段代码</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.px2px</span>(@<span class="keyword">name</span>, @px)&#123;</span><br><span class="line">    @&#123;<span class="selector-tag">name</span>&#125;: <span class="selector-tag">round</span>(@<span class="keyword">px</span> / <span class="number">2</span>) * <span class="number">1px</span>;</span><br><span class="line">    <span class="selector-attr">[data-dpr="2"]</span> &amp; &#123;</span><br><span class="line">        @&#123;name&#125;: @px * 1px;</span><br><span class="line">    &#125;</span><br><span class="line">    // for mx3</span><br><span class="line">    <span class="selector-attr">[data-dpr="2.5"]</span> &amp; &#123;</span><br><span class="line">        @&#123;name&#125;: round(@px * 2.5 / 2) * 1px;</span><br><span class="line">    &#125;</span><br><span class="line">    // for 小米note</span><br><span class="line">    <span class="selector-attr">[data-dpr="2.75"]</span> &amp; &#123;</span><br><span class="line">        @&#123;name&#125;: round(@px * 2.75 / 2) * 1px;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-attr">[data-dpr="3"]</span> &amp; &#123;</span><br><span class="line">        @&#123;name&#125;: round(@px / 2 * 3) * 1px</span><br><span class="line">    &#125;</span><br><span class="line">    // for 三星note4</span><br><span class="line">    <span class="selector-attr">[data-dpr="4"]</span> &amp; &#123;</span><br><span class="line">        @&#123;name&#125;: @px * 2px;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fontSize</span>(@<span class="keyword">px</span>) &#123;</span><br><span class="line">    <span class="selector-class">.px2px</span>(<span class="selector-tag">font-size</span>, @<span class="keyword">px</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用法为<code>.fontSize(设计稿里此元素的字体大小) ;</code>，这样就能得到不同倍率下正确的字体大小，不过此法仍然有一个问题，需要穷举出所有的dpr情况，android机子碎片化非常严重，所以总会有一些奇奇怪怪的机型效果不如意。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>日常的h5项目使用viewport的initail-scale为1，宽度设置配合百分比布局，1px问题使用transform方案会最方便。由于每种设备的设备独立像素不同，最终效果也不同，最后的视觉效果如下：</p>
<img src="http://img.souche.com/20161001/png/1560e718bea96228732a9062e359f95f.png" width="325"/>

<img src="http://img.souche.com/20161001/png/9114795947a792a87ab7febb06ab4843.png" width="325"/>

<p>如果是电商的活动页这种对视觉效果比较严谨的，则使用rem和动态viewport方案，最终的视觉效果如下：</p>
<img src="http://img.souche.com/20161001/png/f437397fe070cb8447d484f71500bb13.png" width="325"/>

<img src="http://img.souche.com/20161001/png/b6656f3fd7355f1eb2381594667f9da5.png" width="325"/>
]]></content>
      <categories>
        <category>mobile-h5</category>
      </categories>
  </entry>
  <entry>
    <title>jqfree</title>
    <url>/2016/08/05/js-lib/jqfree/</url>
    <content><![CDATA[<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>this is an imitation jquery, it has fewer fuctions, but only 400+ lines of code. jqfree can not be used in project, we just take few time to do some research and practice about jquery。</p>
<p>github 地址：<a href="https://github.com/everlose/jqfree" target="_blank" rel="noopener">https://github.com/everlose/jqfree</a></p>
<h2 id="jqfree-core"><a href="#jqfree-core" class="headerlink" title="jqfree core"></a>jqfree core</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> $ = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> $.fn.init(selector, context);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">$.fn = $.prototype;</span><br><span class="line"></span><br><span class="line">$.fn.init = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (selector.nodeType === <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>[<span class="number">0</span>] = selector;</span><br><span class="line">        <span class="keyword">this</span>.length = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> parent = context || <span class="built_in">document</span>; </span><br><span class="line">    <span class="keyword">var</span> nodeList = parent.querySelectorAll(selector);</span><br><span class="line">    <span class="keyword">this</span>.length = nodeList.length;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="keyword">this</span>.length; i+=<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>[i] = nodeList[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">$.fn.init.prototype = $.fn;</span><br></pre></td></tr></table></figure>
<p>我们需要一个包装着DOM Elements的伪数组，此伪数组对象使用原型链去挂载共享的DOM处理方法，原理如下图。<br><img src="http://7xn4mw.com1.z0.glb.clouddn.com/16-7-31/23881940.jpg" alt=""></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//选择器</span></span><br><span class="line">$(<span class="string">'body'</span>); <span class="comment">//返回$.fn.init &#123;0: body, length: 1, selector: "body"&#125;</span></span><br><span class="line">$(<span class="string">'.class'</span>);</span><br><span class="line">$(<span class="string">'#id'</span>);</span><br><span class="line">$(<span class="string">'#id .class'</span>);</span><br></pre></td></tr></table></figure>

<h2 id="extend"><a href="#extend" class="headerlink" title="extend"></a>extend</h2><p>jqfree中的extend函数参照了prototype.js的实现方式，$.extend和$.fn.extend功能相同，也都是通过浅拷贝的方式，把第二个参数上的对象扩展添加到第二个参数的对象上，如果没有指定第二个参数，则会把第一个参数添加到this上。需要给DOM元素添加方法的话，使用$.fn.extend如$.fn.append，而需要给全局$对象添加扩展的话，使用$.extend，如$.ajax。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$.extend = $.fn.extend = <span class="function"><span class="keyword">function</span> (<span class="params">destination, source</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//if source is not exist，copy the destination to this。</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> source === <span class="string">'undefined'</span>) &#123;</span><br><span class="line">        source = destination;</span><br><span class="line">        destination = <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> property <span class="keyword">in</span> source) &#123;</span><br><span class="line">        <span class="keyword">if</span> (source.hasOwnProperty(property)) &#123;</span><br><span class="line">            destination[property] = source[property];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> destination;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="traverse"><a href="#traverse" class="headerlink" title="traverse"></a>traverse</h2><p>遍历jqfree对象中的DOM Elements。实际上是遍历了<code>$.fn.init {0: body, length: 1, selector: &quot;body&quot;}</code>这样的一个伪数组中的类似数组的那一部分。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$.fn.extend(&#123;</span><br><span class="line">    each: <span class="function"><span class="keyword">function</span> (<span class="params">func</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> i=<span class="number">0</span>,</span><br><span class="line">            length = <span class="keyword">this</span>.length;</span><br><span class="line">        <span class="keyword">for</span> (; i&lt;length; i+=<span class="number">1</span>) &#123;</span><br><span class="line">            func.call(<span class="keyword">this</span>[i], <span class="keyword">this</span>[i], i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>接受一个回调函数，其第一个参数为dom元素，第二个参数为序号，调用代码如</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">'body'</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params">val, index</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(val, index)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="DOM-processor。"><a href="#DOM-processor。" class="headerlink" title="DOM processor。"></a>DOM processor。</h2><p>文档操作。添加了append，prepend，remove，empty的方法，功用同原版jquery。因为生成的$.fn.init是个包含DOM的伪数组，所以操作中就需要遍历这个数组做append操作，目的是为了让选中的所有DOM元素都append一遍。appendChild为DOM level2方法，从IE6开始就支持。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$.fn.extend(&#123;</span><br><span class="line">    append: <span class="function"><span class="keyword">function</span> (<span class="params">child</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ($.isString(child)) &#123;</span><br><span class="line">            child = $(child)[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">v, k</span>) </span>&#123;</span><br><span class="line">            v.appendChild(child);</span><br><span class="line">        &#125;);</span><br><span class="line">        child = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>调用代码如</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> element = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">$(<span class="string">'body'</span>).append(element);</span><br></pre></td></tr></table></figure>

<h2 id="css"><a href="#css" class="headerlink" title="css"></a>css</h2><p>添加了css的方法，功用同原版jquery。现将css规则转为驼峰式，然后利用style属性插入，如<code>background-color: #FFF</code>，会被当作<code>dom.style.backgroundColor = &#39;#FFF&#39;</code>这样的插入。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$.fn.extend(&#123;</span><br><span class="line">    css: <span class="function"><span class="keyword">function</span> (<span class="params">cssRules, value</span>) </span>&#123;</span><br><span class="line">        <span class="comment">//cssName need to Converted into camel casing。 </span></span><br><span class="line">        <span class="keyword">var</span> transformHump = <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> name.replace(<span class="regexp">/\-(\w)/g</span>, <span class="function"><span class="keyword">function</span>(<span class="params">all, letter</span>)</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> letter.toUpperCase();</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">if</span> ($.isString(cssRules)) &#123;</span><br><span class="line">            <span class="keyword">if</span> ($.isUndefined(value)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">document</span>.defaultView.getComputedStyle(<span class="keyword">this</span>[<span class="number">0</span>], <span class="literal">null</span>)</span><br><span class="line">                    .getPropertyValue(cssRules);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">v, k</span>) </span>&#123;</span><br><span class="line">                    v.style[transformHump(cssRules)] = value;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> cssRules) &#123;</span><br><span class="line">                <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">v, k</span>) </span>&#123;</span><br><span class="line">                    v.style[transformHump(i)] = cssRules[i];</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>支持两种写法，参数1和参数2可以互为键值对，或者参数1为一个对象，另外这里只第一个dom元素的css规则生效。调用代码如</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取选中的第一个元素的某个css属性，其属性名不需要驼峰式写法</span></span><br><span class="line">$(<span class="string">'body'</span>).css(<span class="string">'font-size'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置div元素的css属性。提供了以下两种写法。</span></span><br><span class="line">$(<span class="string">'div'</span>).css(<span class="string">'color'</span>, <span class="string">'#FFF'</span>);</span><br><span class="line">$(<span class="string">'div'</span>).css(&#123;</span><br><span class="line">    color: <span class="string">'#FFF'</span>,</span><br><span class="line">    background: <span class="string">'green'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="DOM-filter"><a href="#DOM-filter" class="headerlink" title="DOM filter"></a>DOM filter</h2><p>添加了dom过滤的几个函数，如children、parent、siblings。返回出去的DOM对象会再次被$.fn.init对象包装。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$.fn.extend(&#123;</span><br><span class="line">    children: <span class="function"><span class="keyword">function</span> (<span class="params">selector</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $(selector, <span class="keyword">this</span>[<span class="number">0</span>]);</span><br><span class="line">    &#125; </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>只对第一个DOM元素生效，调用代码如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$(&apos;body&apos;).children(&apos;.class&apos;); //获取第一个body元素下的所有class名为&apos;.class&apos;的元素</span><br></pre></td></tr></table></figure>


<h2 id="attributes"><a href="#attributes" class="headerlink" title="attributes"></a>attributes</h2><p>获取属性，实现了attr，removeAttr，addClass，hasClass，removeClass，data，html这几个api，功能和jq相似。<br>拿addClass举例来说，classList为H5的API，不支持IE9及以下。所有被匹配的dom元素都会被addClass处理。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$.fn.extend(&#123;</span><br><span class="line">    addClass: <span class="function"><span class="keyword">function</span> (<span class="params">className</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">v, k</span>) </span>&#123;</span><br><span class="line">            <span class="comment">//please use 'v.className += className' if you need support IE9.</span></span><br><span class="line">            v.classList.add(className);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>调用方式如下：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">'body'</span>).addClass(<span class="string">'someClass'</span>);</span><br></pre></td></tr></table></figure>

<h2 id="event"><a href="#event" class="headerlink" title="event"></a>event</h2><p>事件操作。绑定事件使用on，取消绑定事件使用off，触发事件使用trigger。拿on举例，直接使用了addEventListener监听，不支持IE8及以下。需要支持IE8级以下的话，请使用attachEvent兼容。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$.fn.extend(&#123;</span><br><span class="line">    on: <span class="function"><span class="keyword">function</span> (<span class="params">event, func</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">v, k</span>) </span>&#123;</span><br><span class="line">            <span class="comment">//dom level 2，IE8 not support。</span></span><br><span class="line">            v.addEventListener(event, func, <span class="literal">false</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>第一个参数为事件名，第二个参数为回调，调用代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">'body'</span>).on(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'click'</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="effect"><a href="#effect" class="headerlink" title="effect"></a>effect</h2><p>其他效果，鉴于动画用css3会更直观，所以这里只实现了show和hide两个方法。所有匹配的DOM元素都会被影响，这里只是简单设置了display属性为block或者none，有待改进。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$.fn.extend(&#123;</span><br><span class="line">    show: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">           <span class="keyword">this</span>.style.display = <span class="string">'block'</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>调用代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">'body'</span>).hide();</span><br></pre></td></tr></table></figure>

<h2 id="ajax"><a href="#ajax" class="headerlink" title="ajax"></a>ajax</h2><p>抽离jsonp，$.jsonp独立于$.ajax，毕竟jsonp的原理和ajax完全没有关系，如果使用$.ajax的话有些误导别人。<br>$.ajax和$.jsonp方法最后都会返回一个Promise对象，。笔者这里直接使用了ES6提供的Promise对象，ES6提供的Promise在chrome从33版开始支持，IE系列并不支持，如果有需要自己写一个Promise的话请打开下面代码中的注释并加入jqfree.js中。此Promise参照了<a href="https://github.com/panyifei/Front-end-learning/blob/master/%E6%A1%86%E6%9E%B6%E4%BB%A5%E5%8F%8A%E8%A7%84%E8%8C%83/Promise.md" target="_blank" rel="noopener">这里的方案</a>。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* ES6自带了Promise，有需要理解Promise如何实现的话请看这段注释代码</span></span><br><span class="line"><span class="comment">var Promise = function (fn) &#123;</span></span><br><span class="line"><span class="comment">    var state = 'pending';</span></span><br><span class="line"><span class="comment">    var doneList = [];</span></span><br><span class="line"><span class="comment">    var failList= [];</span></span><br><span class="line"><span class="comment">    this.then = function(done ,fail)&#123;</span></span><br><span class="line"><span class="comment">        switch(state)&#123;</span></span><br><span class="line"><span class="comment">            case 'pending':</span></span><br><span class="line"><span class="comment">                doneList.push(done);</span></span><br><span class="line"><span class="comment">                //每次如果没有推入fail方法，我也会推入一个null来占位</span></span><br><span class="line"><span class="comment">                failList.push(fail || null);</span></span><br><span class="line"><span class="comment">                return this;</span></span><br><span class="line"><span class="comment">                break;</span></span><br><span class="line"><span class="comment">            case 'fulfilled':</span></span><br><span class="line"><span class="comment">                done();</span></span><br><span class="line"><span class="comment">                return this;</span></span><br><span class="line"><span class="comment">                break;</span></span><br><span class="line"><span class="comment">            case 'rejected':</span></span><br><span class="line"><span class="comment">                fail();</span></span><br><span class="line"><span class="comment">                return this;</span></span><br><span class="line"><span class="comment">                break;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    function tryToJson(obj) &#123;</span></span><br><span class="line"><span class="comment">        var value;</span></span><br><span class="line"><span class="comment">        try &#123;</span></span><br><span class="line"><span class="comment">            value = JSON.parse(obj);</span></span><br><span class="line"><span class="comment">        &#125; catch (e) &#123;</span></span><br><span class="line"><span class="comment">            value = obj;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        return value</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    function resolve(newValue)&#123;</span></span><br><span class="line"><span class="comment">        state = 'fulfilled';</span></span><br><span class="line"><span class="comment">        setTimeout(function()&#123;</span></span><br><span class="line"><span class="comment">            var value = tryToJson(newValue);</span></span><br><span class="line"><span class="comment">            for (var i = 0; i &lt; doneList.length; i++)&#123;</span></span><br><span class="line"><span class="comment">                var temp = doneList[i](value);</span></span><br><span class="line"><span class="comment">                if (temp instanceof Promise) &#123;</span></span><br><span class="line"><span class="comment">                    var newP = temp;</span></span><br><span class="line"><span class="comment">                    for (i++; i &lt; doneList.length; i++) &#123;</span></span><br><span class="line"><span class="comment">                        newP.then(doneList[i], failList[i]);</span></span><br><span class="line"><span class="comment">                    &#125;</span></span><br><span class="line"><span class="comment">                &#125; else &#123;</span></span><br><span class="line"><span class="comment">                    value = temp;</span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">        &#125;, 0);</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    function reject(newValue)&#123;</span></span><br><span class="line"><span class="comment">        state = 'rejected';</span></span><br><span class="line"><span class="comment">        setTimeout(function()&#123;</span></span><br><span class="line"><span class="comment">            var value = tryToJson(newValue);</span></span><br><span class="line"><span class="comment">            var tempRe = failList[0](value);</span></span><br><span class="line"><span class="comment">            //如果reject里面传入了一个promise，那么执行完此次的fail之后，将剩余的done和fail传入新的promise中</span></span><br><span class="line"><span class="comment">            if(tempRe instanceof Promise)&#123;</span></span><br><span class="line"><span class="comment">                var newP = tempRe;</span></span><br><span class="line"><span class="comment">                for (i=1;i&lt;doneList.length;i++) &#123;</span></span><br><span class="line"><span class="comment">                    newP.then(doneList[i],failList[i]);</span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment">            &#125; else &#123;</span></span><br><span class="line"><span class="comment">                //如果不是promise，执行完当前的fail之后，继续执行doneList</span></span><br><span class="line"><span class="comment">                value = tempRe;</span></span><br><span class="line"><span class="comment">                doneList.shift();</span></span><br><span class="line"><span class="comment">                failList.shift();</span></span><br><span class="line"><span class="comment">                resolve(value);</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">        &#125;, 0);</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    fn(resolve,reject);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">$.extend(&#123;</span><br><span class="line">    ajax: <span class="function"><span class="keyword">function</span> (<span class="params">opts</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest(),</span><br><span class="line">            type = opts.type || <span class="string">'GET'</span>,</span><br><span class="line">            url = opts.url,</span><br><span class="line">            params = opts.data,</span><br><span class="line">            dataType = opts.dataType || <span class="string">'json'</span>;</span><br><span class="line"></span><br><span class="line">        type = type.toUpperCase();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (type === <span class="string">'GET'</span>) &#123;</span><br><span class="line">            params = (<span class="function"><span class="keyword">function</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">                <span class="keyword">var</span> str = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">var</span> prop <span class="keyword">in</span> obj)&#123;</span><br><span class="line">                    str += prop + <span class="string">'='</span> + obj[prop] + <span class="string">'&amp;'</span></span><br><span class="line">                &#125;</span><br><span class="line">                str = str.slice(<span class="number">0</span>, str.length - <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">return</span> str;</span><br><span class="line">            &#125;)(opts.data);</span><br><span class="line">            url += url.indexOf(<span class="string">'?'</span>) === <span class="number">-1</span> ? <span class="string">'?'</span> + params : <span class="string">'&amp;'</span> + params;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        xhr.open(type, url);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (opts.contentType) &#123;</span><br><span class="line">            xhr.setRequestHeader(<span class="string">'Content-type'</span>, opts.contentType);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        xhr.send(params ? params : <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//return promise</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">            <span class="comment">//onload are executed just after the sync request is comple，</span></span><br><span class="line">            <span class="comment">//please use 'onreadystatechange' if need support IE9-</span></span><br><span class="line">            xhr.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (xhr.status === <span class="number">200</span>) &#123;</span><br><span class="line">                    <span class="keyword">var</span> result;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        result = <span class="built_in">JSON</span>.parse(xhr.response);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                        result = xhr.response;</span><br><span class="line">                    &#125;</span><br><span class="line">                    resolve(result);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    reject(xhr.response);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">            </span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    jsonp: <span class="function"><span class="keyword">function</span> (<span class="params">opts</span>) </span>&#123;</span><br><span class="line">        <span class="comment">//to produce random string</span></span><br><span class="line">        <span class="keyword">var</span> generateRandomAlphaNum = <span class="function"><span class="keyword">function</span> (<span class="params">len</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> rdmString = <span class="string">''</span>;</span><br><span class="line">            <span class="keyword">for</span> (; rdmString.length &lt; len; rdmString += <span class="built_in">Math</span>.random().toString(<span class="number">36</span>).substr(<span class="number">2</span>));</span><br><span class="line">            <span class="keyword">return</span> rdmString.substr(<span class="number">0</span>, len);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> url = <span class="keyword">typeof</span> opts === <span class="string">'string'</span> ? opts : opts.url,</span><br><span class="line">            callbackName = opts.callbackName || <span class="string">'jsonpCallback'</span> + generateRandomAlphaNum(<span class="number">10</span>),</span><br><span class="line">            callbackFn = opts.callbackFn || <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">        <span class="keyword">if</span> (url.indexOf(<span class="string">'callback'</span>) === <span class="number">-1</span>) &#123;</span><br><span class="line">            url += url.indexOf(<span class="string">'?'</span>) === <span class="number">-1</span> ? <span class="string">'?callback='</span> + callbackName :</span><br><span class="line">                <span class="string">'&amp;callback='</span> + callbackName;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> opts === <span class="string">'object'</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> params = (<span class="function"><span class="keyword">function</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">                <span class="keyword">var</span> str = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">var</span> prop <span class="keyword">in</span> obj)&#123;</span><br><span class="line">                    str += prop + <span class="string">'='</span> + obj[prop] + <span class="string">'&amp;'</span></span><br><span class="line">                &#125;</span><br><span class="line">                str = str.slice(<span class="number">0</span>, str.length - <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">return</span> str;</span><br><span class="line">            &#125;)(opts.data);</span><br><span class="line">            url += <span class="string">'&amp;'</span> + params;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> eleScript= <span class="built_in">document</span>.createElement(<span class="string">'script'</span>); </span><br><span class="line">        eleScript.type = <span class="string">'text/javascript'</span>;</span><br><span class="line">        eleScript.id = <span class="string">'jsonp'</span>;</span><br><span class="line">        eleScript.src = url;</span><br><span class="line">        <span class="built_in">document</span>.getElementsByTagName(<span class="string">'HEAD'</span>)[<span class="number">0</span>].appendChild(eleScript);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// window[callbackName] = callbackFn;</span></span><br><span class="line">        <span class="comment">//return promise</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">window</span>[callbackName] = <span class="function"><span class="keyword">function</span> (<span class="params">json</span>) </span>&#123;</span><br><span class="line">                resolve(json);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//onload are executed just after the sync request is comple，</span></span><br><span class="line">            <span class="comment">//please use 'onreadystatechange' if need support IE9-</span></span><br><span class="line">            eleScript.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="comment">//delete the script element when a request done。</span></span><br><span class="line">                <span class="built_in">document</span>.getElementById(<span class="string">'jsonp'</span>).outerHTML = <span class="string">''</span>;</span><br><span class="line">                eleScript = <span class="literal">null</span>;</span><br><span class="line">            &#125;;</span><br><span class="line">            eleScript.onerror = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="built_in">document</span>.getElementById(<span class="string">'jsonp'</span>).outerHTML = <span class="string">''</span>;</span><br><span class="line">                eleScript = <span class="literal">null</span>;</span><br><span class="line">                reject(<span class="string">'error'</span>);</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>$.ajax接受一个对象作为参数，并且支持使用promise的写法，调用如下</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">    url: <span class="string">'/test.json'</span></span><br><span class="line">&#125;)</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(d);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $.ajax(&#123;</span><br><span class="line">        url: <span class="string">'/test.json'</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(d);</span><br><span class="line">&#125;)</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(d);</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(d);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//jsonp也可以接受一个url字符串作为参数。</span></span><br><span class="line">$.jsonp(&#123;</span><br><span class="line">    url: <span class="string">'/test.json'</span>,</span><br><span class="line">&#125;)</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(d);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $.jsonp(&#123;</span><br><span class="line">        url: <span class="string">'/test.json'</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(d);</span><br><span class="line">&#125;)</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(d);</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(d);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>注意，本地没法测试ajax函数，如果有需要请在此项目目录下运行<code>node server.js</code>，接着去打开test.html文件的关于ajax的注释，再去<code>localhost:3000/test.html</code>就能看到测试ajax的内容。</p>
<h3 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h3><p>将增删改查cookie操作都用一个函数搞定</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$.extend(&#123;</span><br><span class="line">    cookie: <span class="function"><span class="keyword">function</span> (<span class="params">cookieName, cookieValue, day</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> readCookie = <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> arr,</span><br><span class="line">                reg = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'(^| )'</span> + name + <span class="string">'=([^;]*)(;|$)'</span>),</span><br><span class="line">                matched = <span class="built_in">document</span>.cookie.match(reg);</span><br><span class="line">            <span class="keyword">if</span>(arr = matched) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">unescape</span>(arr[<span class="number">2</span>]);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">var</span> setCookie = <span class="function"><span class="keyword">function</span> (<span class="params">name, value, time</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> Days = time || <span class="number">30</span>;</span><br><span class="line">            <span class="keyword">var</span> exp = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">            exp.setTime(exp.getTime() + Days * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>);</span><br><span class="line">            <span class="built_in">document</span>.cookie = name + <span class="string">"="</span>+ <span class="built_in">escape</span> (value) + <span class="string">";expires="</span> + exp.toGMTString();</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">if</span> (cookieName &amp;&amp; cookieValue) &#123;</span><br><span class="line">            <span class="comment">//set cookie</span></span><br><span class="line">            setCookie(cookieName, cookieValue, day);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cookieName &amp;&amp; $.isNull(cookieValue)) &#123;</span><br><span class="line">            <span class="comment">//delete cookie</span></span><br><span class="line">            setCookie(cookieName, <span class="string">''</span>, <span class="number">-1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cookieName) &#123;</span><br><span class="line">            <span class="comment">//read cookie</span></span><br><span class="line">            <span class="keyword">return</span> readCookie(cookieName);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>调用代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//添加cookie，前两个参数为cookie名和值，必填。第三个参数设置cookie有效时常，单位为天，可选。</span></span><br><span class="line">$.cookie(<span class="string">'test'</span>, <span class="string">'content'</span>);</span><br><span class="line"><span class="comment">//读取cookie，只填第一个参数</span></span><br><span class="line">$.cookie(<span class="string">'test'</span>); <span class="comment">//"content"</span></span><br><span class="line"><span class="comment">//删除cookie, 第二个参数填null</span></span><br><span class="line">$.cookie(<span class="string">'test'</span>, <span class="literal">null</span>);</span><br></pre></td></tr></table></figure>

<h3 id="utils"><a href="#utils" class="headerlink" title="utils"></a>utils</h3><p>添加了变量类型判断、时间解析函数、url解析函数、浮点数四舍五入小数位和获取随机位数字符串的辅助函数。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$.extend(&#123;</span><br><span class="line">    isUndefined: <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> obj === <span class="keyword">void</span> <span class="number">0</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    isNull: <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> obj === <span class="literal">null</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    isBoolean: <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(obj) === <span class="string">'[object Boolean]'</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    isNumber: <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(obj) === <span class="string">'[object Number]'</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    isString: <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(obj) === <span class="string">'[object String]'</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">isNaN</span>: <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> obj !== obj;</span><br><span class="line">    &#125;,</span><br><span class="line">    isFunction: <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">typeof</span> obj === <span class="string">'function'</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    ......</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$.extend(&#123;</span><br><span class="line">    <span class="comment">//$.parseTime(new Date().getTime(), 'YYYY-MM-DD hh:mm:ss')</span></span><br><span class="line">    <span class="comment">//result: "2016-08-03 16:14:12"</span></span><br><span class="line">    parseTime: <span class="function"><span class="keyword">function</span> (<span class="params">timeStamp, format</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>(timeStamp);</span><br><span class="line">        <span class="keyword">var</span> o = &#123; </span><br><span class="line">            <span class="string">'M+'</span> : date.getMonth() + <span class="number">1</span>, <span class="comment">//month </span></span><br><span class="line">            <span class="string">'D+'</span> : date.getDate(), <span class="comment">//day </span></span><br><span class="line">            <span class="string">'h+'</span> : date.getHours(), <span class="comment">//hour </span></span><br><span class="line">            <span class="string">'m+'</span> : date.getMinutes(), <span class="comment">//minute </span></span><br><span class="line">            <span class="string">'s+'</span> : date.getSeconds(), <span class="comment">//second </span></span><br><span class="line">            <span class="string">'S'</span> : date.getMilliseconds() <span class="comment">//millisecond </span></span><br><span class="line">        &#125; </span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="regexp">/(Y+)/</span>.test(format)) &#123; </span><br><span class="line">            format = format.replace(<span class="built_in">RegExp</span>.$<span class="number">1</span>, </span><br><span class="line">                (date.getFullYear() + <span class="string">''</span>).substr(<span class="number">4</span> - <span class="built_in">RegExp</span>.$<span class="number">1.</span>length)); </span><br><span class="line">        &#125; </span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> k <span class="keyword">in</span> o) &#123; </span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'('</span>+ k +<span class="string">')'</span>).test(format)) &#123; </span><br><span class="line">                format = format.replace(<span class="built_in">RegExp</span>.$<span class="number">1</span>, </span><br><span class="line">                    <span class="built_in">RegExp</span>.$<span class="number">1.</span>length == <span class="number">1</span> ? o[k] : (<span class="string">'00'</span>+ o[k]).substr((<span class="string">''</span>+ o[k]).length)); </span><br><span class="line">            &#125; </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">return</span> format; </span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//$.parseUrl(location.href)</span></span><br><span class="line">    <span class="comment">//return an object contains the folling info.</span></span><br><span class="line">    parseUrl: <span class="function"><span class="keyword">function</span> (<span class="params">url</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> a =  <span class="built_in">document</span>.createElement(<span class="string">'a'</span>);</span><br><span class="line">        a.href = url;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            source: url,</span><br><span class="line">            protocol: a.protocol.replace(<span class="string">':'</span>,<span class="string">''</span>),</span><br><span class="line">            host: a.hostname,</span><br><span class="line">            port: a.port,</span><br><span class="line">            query: a.search,</span><br><span class="line">            params: (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="keyword">var</span> ret = &#123;&#125;,</span><br><span class="line">                    seg = a.search.replace(<span class="regexp">/^\?/</span>,<span class="string">''</span>).split(<span class="string">'&amp;'</span>),</span><br><span class="line">                    len = seg.length, i = <span class="number">0</span>, s;</span><br><span class="line">                <span class="keyword">for</span> (;i&lt;len;i++) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!seg[i]) &#123; <span class="keyword">continue</span>; &#125;</span><br><span class="line">                    s = seg[i].split(<span class="string">'='</span>);</span><br><span class="line">                    ret[s[<span class="number">0</span>]] = s[<span class="number">1</span>];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> ret;</span><br><span class="line">            &#125;)(),</span><br><span class="line">            file: (a.pathname.match(<span class="regexp">/\/([^\/?#]+)$/i</span>) || [,<span class="string">''</span>])[<span class="number">1</span>],</span><br><span class="line">            hash: a.hash.replace(<span class="string">'#'</span>,<span class="string">''</span>),</span><br><span class="line">            path: a.pathname.replace(<span class="regexp">/^([^\/])/</span>,<span class="string">'/$1'</span>),</span><br><span class="line">            relative: (a.href.match(<span class="regexp">/tps?:\/\/[^\/]+(.+)/</span>) || [,<span class="string">''</span>])[<span class="number">1</span>],</span><br><span class="line">            segments: a.pathname.replace(<span class="regexp">/^\//</span>,<span class="string">''</span>).split(<span class="string">'/'</span>)</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//$.toFixedFloat(15.658, 2)</span></span><br><span class="line">    <span class="comment">//result: 15.66</span></span><br><span class="line">    toFixedFloat: <span class="function"><span class="keyword">function</span> (<span class="params">value, precision</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> power = <span class="built_in">Math</span>.pow(<span class="number">10</span>, precision || <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">String</span>(<span class="built_in">Math</span>.round(value * power) / power);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//for generate random string</span></span><br><span class="line">    <span class="comment">//$.generateRandomAlphaNum(5)</span></span><br><span class="line">    <span class="comment">//random result: like "rc3sr".</span></span><br><span class="line">    generateRandomAlphaNum: <span class="function"><span class="keyword">function</span> (<span class="params">len</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> rdmString = <span class="string">''</span>;</span><br><span class="line">        <span class="keyword">for</span> (; rdmString.length &lt; len; rdmString += <span class="built_in">Math</span>.random().toString(<span class="number">36</span>).substr(<span class="number">2</span>));</span><br><span class="line">        <span class="keyword">return</span> rdmString.substr(<span class="number">0</span>, len);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>调用如下：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//参数1是时间戳，参数2是格式，年为Y，月为M，日为D，时h，分m，秒s，毫秒S，注意大小写，多余的位数补0</span></span><br><span class="line">$.parseTime(<span class="keyword">new</span> <span class="built_in">Date</span>().getTime(), <span class="string">'YYYY-MM-DD hh:mm:ss'</span>); <span class="comment">//"2016-08-03 16:14:12"。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//参数为url链接</span></span><br><span class="line">$.parseUrl(location.href); <span class="comment">//返回一个带诸多url信息的对象。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//参数1是目标浮点数，参数2是保留到第几位小数</span></span><br><span class="line">$.toFixedFloat(<span class="number">15.658</span>, <span class="number">2</span>); <span class="comment">//四舍五入到两位小数：15.66</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//参数为生成随机的字符串长度</span></span><br><span class="line">$.generateRandomAlphaNum(<span class="number">5</span>); <span class="comment">//如"rc3sr"</span></span><br></pre></td></tr></table></figure>

<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>jqfree纯粹研究用，不考虑诸多兼容。算上注释也就只有400行，可以简单研究一下其代码是如何构建的。从jq毕业一阵子了，总得写点东西纪念下老伙计。<a href="https://github.com/everlose/jqfree" target="_blank" rel="noopener">github地址在这里</a>，有启发的话请不吝给我的github点赞。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="http://www.zhangxinxu.com/wordpress/2013/07/jquery-%E5%8E%9F%E7%90%86-%E6%9C%BA%E5%88%B6/" target="_blank" rel="noopener">张鑫旭 jQuery诞生记-原理与机制</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2013/05/jquery-free.html" target="_blank" rel="noopener">阮一峰 如何做到jquery-free</a></li>
<li><a href="http://www.cnblogs.com/yupeng/archive/2012/03/11/2389997.html" target="_blank" rel="noopener">extend 方法在js框架中的设计</a> </li>
<li><a href="http://www.cnblogs.com/liuzhenwei/p/5235473.html" target="_blank" rel="noopener">刘镇维 Promise简单实现（正常思路版）</a></li>
<li><a href="http://www.jb51.net/article/64330.htm" target="_blank" rel="noopener">JS设置cookie、读取cookie、删除cookie</a></li>
</ul>
]]></content>
      <categories>
        <category>js-lib</category>
      </categories>
      <tags>
        <tag>jquery</tag>
      </tags>
  </entry>
  <entry>
    <title>http请求状态码</title>
    <url>/2016/08/05/network/http-status-code/</url>
    <content><![CDATA[<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>HTTP状态码负责表示客户端HTTP请求的返回结果、标记服务器端的处理是否正常、通知出现的错误等工作。1xx代表请求已接收，等待进一步处理；2xx代表请求已处理并返回；3xx代表请求被转发；4xx代表客户端请求有语法错误或者无法实现；5xx代表服务器端的错误 </p>
<h2 id="1xx代表请求已接收，等待进一步处理"><a href="#1xx代表请求已接收，等待进一步处理" class="headerlink" title="1xx代表请求已接收，等待进一步处理"></a>1xx代表请求已接收，等待进一步处理</h2><h2 id="2xx代表请求已处理并返回"><a href="#2xx代表请求已处理并返回" class="headerlink" title="2xx代表请求已处理并返回"></a>2xx代表请求已处理并返回</h2><ul>
<li>200，ok，表示从客户端发来的请求在服务器端被正常处理了</li>
<li>204，no content，请求成功被处理不过没有返回信息，多用于客户端不需要更新的时候。</li>
<li>206，partial content，表示客户端对服务器端资源的某一部分进行请求，响应报文由Content-Range指定范围的实体内容。</li>
</ul>
<h2 id="3xx代表请求被转发"><a href="#3xx代表请求被转发" class="headerlink" title="3xx代表请求被转发"></a>3xx代表请求被转发</h2><ul>
<li>301，Moved Permanently，永久重定向,告诉客户端以后应从新地址访问. </li>
<li>302，Found，临时性重定向，302表示资源只是被临时移动了，已移动资源的URI将来仍可能被改动位置，PHP的默认Location重定向用的就是302。但是HTTP 1.1 有303 和307作为详细的补充,其实是对302的细化 </li>
<li>303，See Other，303与302的功能相同，只是303状态码明确表示客户端应当采用GET方法获取资源。 </li>
<li>304，Not Modified。该状态码表示客户端发送附带条件（附带条件的请求是指采用GET方法的请求报文中包含If-Match，If-Modified-Since，If-None-Match，If-Range，If-Unmodified-Since中任一首部）的请求时，服务器端允许请求访问资源，但未满足条件的情况。304状态码返回时，不包含任何响应的主体部分。304虽然被划分在3XX类别中，但是和重定向没有关系。</li>
<li>307，Temporary redirect，临时重定向，与302功能相同。307遵照浏览器标准不会从post换成get，但是对于处理响应时的行为，每种浏览器可能出现不同情况。</li>
</ul>
<h2 id="4xx代表客户端请求有语法错误或者无法实现"><a href="#4xx代表客户端请求有语法错误或者无法实现" class="headerlink" title="4xx代表客户端请求有语法错误或者无法实现"></a>4xx代表客户端请求有语法错误或者无法实现</h2><ul>
<li>400，Bad Request，请求报文有语法错误。</li>
<li>401，Unauthorized，客户端请求没有经过授权，用户认证失败。 </li>
<li>403，Forbidden，服务器端受到了请求但是拒绝提供服务，可能是未获得文件系统访问授权。 </li>
<li>404，Not Found，该状态码表明服务器上无法找到请求的资源。除此之外，也可以在服务器端拒绝请求且不想说明理由时使用。</li>
</ul>
<h2 id="5xx代表服务器端的错误"><a href="#5xx代表服务器端的错误" class="headerlink" title="5xx代表服务器端的错误"></a>5xx代表服务器端的错误</h2><ul>
<li>500，Internal Server Error，该状态码表明服务器端在执行请求时发生了错误。也有可能是Web应用存在的bug或某些临时的故障。</li>
<li>503，Service unavailable，该状态码表明服务器暂时处于超负载或正在进行停机维护，现在无法处理请求。如果事先得知解除以上状况需要的时间，最好写入RetryAfter首部字段再返回给客户端。</li>
<li>504，Gateway Time-out，连接超时，服务器（不一定是web服务器）作为网关或代理，但没有及时从上游服务器收到请求。</li>
</ul>
]]></content>
      <categories>
        <category>network</category>
      </categories>
      <tags>
        <tag>http</tag>
      </tags>
  </entry>
</search>
